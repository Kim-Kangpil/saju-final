=== CORE DUMP META ===
목적: AI에게 프로젝트 전체 맥락 전달
주의: 구조 큰 변경 / 리팩토링 원하지 않음
출시 목표: 빠른 MVP 공개
중요: 사주 계산 로직 의미 변경 금지
=====================

=== PROJECT TREE (depth 4) ===
.gitignore
AI_CORE_DUMP.txt
requirements.txt
workspace.code-workspace
backend\.env
backend\main.py
backend\requirements.txt
backend\backend\__init__.py
backend\logic\gpt_generator.py
backend\logic\init.py
backend\logic\lunar_converter.py
backend\logic\solar_terms_db.json
backend\logic\test.py
backend\logic\theory_retriever.py
backend\logic\saju_engine\API_GUIDE.md
backend\logic\saju_engine\PROGRESS.md
backend\logic\saju_engine\README.md
backend\logic\saju_engine\requirements.txt
backend\logic\saju_engine\STRUCTURE.md
backend\logic\saju_engine\__init__.py
backend\logic\saju_engine\api\main.py
backend\logic\saju_engine\api\test.html
backend\logic\saju_engine\core\analyzer.py
backend\logic\saju_engine\core\harmony_clash.py
backend\logic\saju_engine\core\sinsal.py
backend\logic\saju_engine\core\strength.py
backend\logic\saju_engine\core\ten_gods.py
backend\logic\saju_engine\core\__init__.py
backend\logic\saju_engine\interpretation\generator.py
backend\logic\saju_engine\interpretation\pattern_matcher.py
backend\logic\saju_engine\interpretation\__init__.py
backend\logic\saju_engine\tests\test_engine.py
backend\logic\theories\사주이론(각종귀인,신살).txt
backend\logic\theories\사주이론(기본사주 구성).txt
backend\logic\theories\사주이론(신강 신약).txt
backend\logic\theories\사주이론(십이운성).txt
backend\logic\theories\사주이론(오행, 육친과 십신).txt
backend\logic\theories\사주이론(지지).txt
backend\logic\theories\사주이론(지지충).txt
backend\logic\theories\사주이론(지지합).txt
backend\logic\theories\사주이론(천간).txt
backend\logic\theories\사주이론(천간합).txt
backend\logic\theories\사주이론(천간합,충).txt
backend\logic\theories\사주이론(통근과투출).txt
frontend\.env.local
frontend\.gitignore
frontend\eslint.config.mjs
frontend\next-env.d.ts
frontend\next.config.ts
frontend\package-lock.json
frontend\package.json
frontend\postcss.config.mjs
frontend\README.md
frontend\tsconfig.json
frontend\analysis\engine.ts
frontend\app\favicon.ico
frontend\app\globals.css
frontend\app\layout.tsx
frontend\app\page.tsx
frontend\data\charmAnalysis.ts
frontend\data\elementAnalysis.ts
frontend\data\fortuneAnalysis.ts
frontend\data\relationsAnalysis.ts
frontend\data\specialStarsAnalysis.ts
frontend\data\strengthAnalysis.ts
frontend\data\talentAnalysis.ts
frontend\data\todayAnalysis.ts
frontend\public\file.svg
frontend\public\globe.svg
frontend\public\next.svg
frontend\public\vercel.svg
frontend\public\window.svg
frontend\public\fonts\NeoDunggeunmo.woff2
frontend\public\images\background.png
frontend\public\images\cloud.png
frontend\public\images\coin.png
frontend\public\images\ham_cold.png
frontend\public\images\ham_dosa.png
frontend\public\images\ham_friend.png
frontend\public\images\ham_icon.png
frontend\public\images\ham_soft.png
frontend\public\images\house.png
frontend\public\images\rainbow.png
frontend\public\images\gauge\gauge_earth_empty.png
frontend\public\images\gauge\gauge_earth_full.png
frontend\public\images\gauge\gauge_fire_full.png
frontend\public\images\gauge\gauge_metal_full.png
frontend\public\images\gauge\gauge_water_empty.png
frontend\public\images\gauge\gauge_water_full.png
frontend\public\images\gauge\gauge_wood_empty.png
frontend\public\images\gauge\gauge_wood_full.png

=== FILE CONTENTS ===

----- FILE: frontend\app\page.tsx -----
"use client";

import { useState, useEffect, useMemo, useRef } from "react";
import Script from "next/script";
import { motion, AnimatePresence } from "framer-motion";
import {
  analyzeFullFortune,
  GreatFortuneData,
  YearFortuneData,
  FORTUNE_ANALYSIS,
} from "../data/fortuneAnalysis";
import { CHARM_ANALYSIS, CHARM_BY_PILLAR } from "../data/charmAnalysis";
import { ELEMENT_ANALYSIS } from "../data/elementAnalysis";

import { RELATIONS_ANALYSIS, analyzeRelations } from "../data/relationsAnalysis";
import { SPECIAL_STARS_ANALYSIS, analyzeSpecialStars } from "../data/specialStarsAnalysis";
import { STRENGTH_ANALYSIS, analyzeStrength } from "../data/strengthAnalysis";
import { TALENT_ANALYSIS, TALENT_BY_TEN_GOD } from "../data/talentAnalysis";
import { TODAY_ANALYSIS, analyzeTodayFortune } from "../data/todayAnalysis";

type Pillar = { hanja: string; hangul: string };
type PillarBlock = { label: string; cheongan: Pillar; jiji: Pillar };
type SajuResult = {
  hour: PillarBlock;
  day: PillarBlock;
  month: PillarBlock;
  year: PillarBlock;
};
type CharKey = "empathy" | "reality" | "fun";

const API_BASE = "http://localhost:8000";
declare global {
  interface Window {
    Kakao: any;
  }
}

// =====================================================
// ?좏떥由ы떚 ?⑥닔
// =====================================================

function onlyDigits(s: string) {
  return s.replace(/\D/g, "");
}

function parseYmd(ymd8: string) {
  const s = onlyDigits(ymd8);
  if (s.length !== 8) return null;
  const y = Number(s.slice(0, 4));
  const m = Number(s.slice(4, 6));
  const d = Number(s.slice(6, 8));
  if (y < 1900 || y > 2100) return null;
  if (m < 1 || m > 12) return null;
  if (d < 1 || d > 31) return null;
  const dt = new Date(y, m - 1, d);
  if (dt.getFullYear() !== y || dt.getMonth() !== m - 1 || dt.getDate() !== d)
    return null;
  return { year: y, month: m, day: d };
}

function parseHm(hm4: string) {
  const s = onlyDigits(hm4);
  if (s.length !== 4) return null;
  const h = Number(s.slice(0, 2));
  const mi = Number(s.slice(2, 4));
  if (h < 0 || h > 23) return null;
  if (mi < 0 || mi > 59) return null;
  return { hour: h, minute: mi };
}

function splitPillar(text: string): [Pillar, Pillar] {
  const hanja1 = text?.[0] ?? "";
  const hanja2 = text?.[1] ?? "";
  return [
    { hanja: hanja1, hangul: hanjaToHangul(hanja1) },
    { hanja: hanja2, hangul: hanjaToHangul(hanja2) },
  ];
}

function hanjaToHangul(h: string) {
  const map: Record<string, string> = {
    "??: "媛?,
    "阿?: "??,
    "訝?: "蹂?,
    "訝?: "??,
    "??: "臾?,
    "藥?: "湲?,
    "佯?: "寃?,
    "渦?: "??,
    "鶯?: "??,
    "??: "怨?,
    "耶?: "??,
    "訝?: "異?,
    "野?: "??,
    "??: "臾?,
    "渦?: "吏?,
    "藥?: "??,
    "??: "??,
    "??: "誘?,
    "??: "??,
    "??: "??,
    "??: "??,
    "雅?: "??,
  };
  return map[h] ?? "";
}

function hanjaToElement(
  h: string
): "wood" | "fire" | "earth" | "metal" | "water" | "none" {
  const wood = new Set(["??, "阿?, "野?, "??]);
  const fire = new Set(["訝?, "訝?, "藥?, "??]);
  const earth = new Set(["??, "藥?, "渦?, "??, "訝?, "??]);
  const metal = new Set(["佯?, "渦?, "??, "??]);
  const water = new Set(["鶯?, "??, "耶?, "雅?]);

  if (wood.has(h)) return "wood";
  if (fire.has(h)) return "fire";
  if (earth.has(h)) return "earth";
  if (metal.has(h)) return "metal";
  if (water.has(h)) return "water";
  return "none";
}

function elementClass(el: string) {
  switch (el) {
    case "wood":
      return "text-emerald-600";
    case "fire":
      return "text-rose-500";
    case "earth":
      return "text-amber-600";
    case "metal":
      return "text-gray-400";
    case "water":
      return "text-blue-600";
    default:
      return "text-slate-900";
  }
}

function cn(...xs: Array<string | false | null | undefined>) {
  return xs.filter(Boolean).join(" ");
}

type Element = "wood" | "fire" | "earth" | "metal" | "water";
type Polarity = "yang" | "yin";

function stemMeta(stem: string): { el: Element; pol: Polarity } | null {
  const map: Record<string, { el: Element; pol: Polarity }> = {
    "??: { el: "wood", pol: "yang" },
    "阿?: { el: "wood", pol: "yin" },
    "訝?: { el: "fire", pol: "yang" },
    "訝?: { el: "fire", pol: "yin" },
    "??: { el: "earth", pol: "yang" },
    "藥?: { el: "earth", pol: "yin" },
    "佯?: { el: "metal", pol: "yang" },
    "渦?: { el: "metal", pol: "yin" },
    "鶯?: { el: "water", pol: "yang" },
    "??: { el: "water", pol: "yin" },
  };
  return map[stem] ?? null;
}

function branchMainStem(branch: string): string | null {
  const map: Record<string, string> = {
    "耶?: "??,
    "訝?: "藥?,
    "野?: "??,
    "??: "阿?,
    "渦?: "??,
    "藥?: "訝?,
    "??: "訝?,
    "??: "藥?,
    "??: "佯?,
    "??: "渦?,
    "??: "??,
    "雅?: "鶯?,
  };
  return map[branch] ?? null;
}

function produces(a: Element, b: Element) {
  const next: Record<Element, Element> = {
    wood: "fire",
    fire: "earth",
    earth: "metal",
    metal: "water",
    water: "wood",
  };
  return next[a] === b;
}

function controls(a: Element, b: Element) {
  const map: Record<Element, Element> = {
    wood: "earth",
    fire: "metal",
    earth: "water",
    metal: "wood",
    water: "fire",
  };
  return map[a] === b;
}

function tenGod(dayStem: string, targetStem: string): string {
  const dm = stemMeta(dayStem);
  const tm = stemMeta(targetStem);
  if (!dm || !tm) return "";

  const samePol = dm.pol === tm.pol;

  if (dm.el === tm.el) return samePol ? "鍮꾧껄" : "寃곸옱";
  if (produces(dm.el, tm.el)) return samePol ? "?앹떊" : "?곴?";
  if (produces(tm.el, dm.el)) return samePol ? "?몄씤" : "?뺤씤";
  if (controls(dm.el, tm.el)) return samePol ? "?몄옱" : "?뺤옱";
  if (controls(tm.el, dm.el)) return samePol ? "?멸?" : "?뺢?";

  return "";
}

// =====================================================
// 罹먮┃???곗씠??
// =====================================================

const CHARACTERS = {
  empathy: {
    id: "empathy",
    name: "遺?쒕윭???덈궡??,
    img: "/images/ham_soft.png",
    oneLine: "??몃떎怨?留먰븯吏 ?딄퀬, 諛⑺뼢留??댁쭩 諛붽퓭二쇰뒗 ?щ엺",
    desc: "?댁“媛 遺?쒕읇怨?遺?뺤쟻??留먮룄 ?꾩땐?щ? 源붿븘?쒕젮??",
    progressMessages: {
      stage1: [
        "?뱀떊???ъ＜ ??湲????湲?먮?\n?뚯쨷???쎌뼱?닿퀬 ?덉뼱??",
        "蹂꾨튆泥섎읆 諛섏쭩?대뒗 ?뱀떊???대챸??n李얠븘?대뒗 以묒씠?먯슂... ??,
        "?뱀떊留뚯쓣 ?꾪븳 ?밸퀎???댁빞湲곕?\n以鍮꾪븯怨??덈떟?덈떎.",
        "留덉쓬??媛?ㅻ벉怨?怨꾩꽭??\n怨??꾨쫫?ㅼ슫 ?뚯떇????嫄곗삁??",
        "?뱀떊??怨쇨굅? 誘몃옒瑜??뉖뒗\n?대챸???ㅼ쓣 ??퀬 ?덉뼱??",
        "泥쒖쿇?? ?섏?留??뺤떎?섍쾶\n?뱀떊???댁빞湲곕? 洹몃젮?닿퀬 ?덉뼱??",
        "?섎뒛??蹂꾨뱾???뱀떊?????n?띿궘?대뒗 嫄??ｊ퀬 ?덉뼱??",
        "?뱀떊?대씪???곗＜瑜?n議곗떖?ㅻ읇寃??쇱퀜蹂닿퀬 ?덈떟?덈떎.",
        "?쒓컙???덇꺼?볦? ?뱀떊???붿쟻??n?섎굹?섎굹 ?쎌뼱?닿퀬 ?덉뼱??",
        "?뱀떊???ъ＜?붿옄媛 ?덉? 鍮꾨???n?뺤꽦猿???대궡??以묒씠?먯슂.",
      ],
      stage2: [
        "?ъ＜ ?띿뿉 ?④꺼吏?蹂대Ъ??n?섎굹?섎굹 爰쇰궡怨??덉뼱?? ?뭿",
        "?뱀떊??誘몃옒???쇱뼱??苑껋쓣\n?곸긽?섎ŉ 遺꾩꽍 以묒씠?먯슂.",
        "?ㅽ뻾??議고솕瑜?留욎텛怨??덉뼱??\n議곌툑留???湲곕떎?ㅼ＜?ㅻ옒??",
        "?뱀떊?먭쾶 ?꾩슂???곕쑜??議곗뼵??n?뺤꽦猿?以鍮꾪븯??以묒엯?덈떎.",
        "蹂꾨뱾???띿궘?대뒗 ?뱀떊???댁빞湲곕?\n?ｊ퀬 ?덉뼱??.. ?뙔",
        "?뱀떊??媛뺤젏怨?媛?μ꽦??n鍮쏅굹寃?留뚮뱾 諛⑸쾿??李얘퀬 ?덉뼱??",
        "?섎뱾?덈뜕 ?쒓컙?ㅻ룄, 鍮쏅궇 ?쒓컙?ㅻ룄\n紐⑤몢 ?섎?媛 ?덉뿀?ㅻ뒗 嫄??뚭쾶 ??嫄곗삁??",
        "?뱀떊??嫄몄뼱??湲멸낵 嫄몄뼱媛?湲몄쓣\n?④퍡 洹몃젮蹂닿퀬 ?덉뼱??",
        "?뱀떊留뚯쓽 ?밸퀎???먮꼫吏 ?⑦꽩??n諛쒓껄?섍퀬 ?덈떟?덈떎.",
        "?대챸??以鍮꾪븳 ?좊Ъ ?곸옄瑜?n議곗떖?ㅻ읇寃??댁뼱蹂닿퀬 ?덉뼱?? ?럞",
      ],
      stage3: [
        "嫄곗쓽 ???붿뼱??\n?뱀떊???대챸 蹂닿퀬?쒓? ?꾩꽦?섍퀬 ?덉뼱??",
        "留덉?留?異뺣났???닿퀬 ?덉뼱??\n怨?留뚮굹?? ??",
        "?뱀떊留뚯쓣 ?꾪븳 ?밸퀎??硫붿떆吏,\n吏湲??꾩갑?⑸땲??",
        "以鍮꾧? ?앸궗?댁슂.\n?뱀떊??誘몃옒瑜??쇱퀜蹂쇨퉴??",
        "?먭렐?먭렐... ?뱀떊???대챸??n臾몄쓣 ?먮뱶由ш퀬 ?덉뼱??",
        "?뱀떊???ъ＜媛 ?ㅻ젮二쇰뒗 ?댁빞湲?\n?뺣쭚 ?꾨쫫?듬뜑?쇨뎄??",
        "湲곕떎?ㅼ＜?붿꽌 媛먯궗?댁슂.\n?뺣쭚 醫뗭? ?뚯떇?ㅼ씠 留롮븘??",
        "?뱀떊??沅곴툑?댄븯??紐⑤뱺 寃껊뱾,\n?댁젣 怨??뚭쾶 ??嫄곗삁??",
        "留덉?留?由щ낯??臾띔퀬 ?덉뼱??\n?뺣쭚 ?밸퀎???좊Ъ????嫄곗삁?? ?럞",
        "?뱀떊???몄깮?대씪??梨낆쓽 ?덈줈????\n?댁젣 ?쇱퀜蹂?以鍮꾧? ?섏뿀?댁슂.",
      ],
    },
    getGreeting: (_timeStr: string) => {
      const greetings = [
        "?뱀떊??諛ㅽ븯?섏뿏\n?대뼡 蹂꾩씠 媛??諛앷쾶 鍮쏅궇源뚯슂?",
        "?딄퀬 ?덈뜕 ?뱀떊???덉걶 ?대쫫,\n?ъ＜???곹엺 ?濡?遺덈윭以꾧쾶??",
        "?대컮?쇨린?????뚯쿂??n?묒? ?됰났???뱀떊??湲곕떎?ㅼ슂.",
        "?뱀떊?대씪??苑껋씠 ?쇱뼱??n媛???꾨꼍??怨꾩젅??李얠븯?댁슂.",
        "?ㅻ뒛 ?섎（??怨좎깮 留롮븯?댁슂.\n?댁젣 ?뱀떊留뚯쓽 ?댁빞湲곕? ?ㅻ젮?쒕┫寃뚯슂.",
        "?뱀떊??嫄몄뼱??湲몄씠\n寃곗퐫 ?쏅릺吏 ?딆븯?ㅻ뒗 嫄??뚭쾶 ??嫄곗삁??",
        "?섎뱾 ?뚮룄 ?덉뿀二?\n?댁젣 ?뱀떊???묒썝?섎뒗 ?곗＜??硫붿떆吏瑜??꾪븷寃뚯슂.",
        "?뱀떊? ?대? 異⑸텇???섑븯怨??덉뼱??\n?ъ＜媛 洹몃젃寃?留먰븯怨??덈떟?덈떎.",
      ];
      return greetings[Math.floor(Math.random() * greetings.length)];
    },
  },
  reality: {
    id: "reality",
    name: "?됱젙??遺꾩꽍媛",
    img: "/images/ham_cold.png",
    oneLine: "湲곕텇? 紐곕씪?? 諛⑺뼢? ?뺥솗???뚮젮二쇰뒗 ?щ엺",
    desc: "媛먯젙 鍮쇨퀬 ?ъ떎留? 援곕뜑?붽린 ?놁씠 留먰빐?쒕┰?덈떎.",
    progressMessages: {
      stage1: [
        "60媛묒옄 ?곗씠?곕쿋?댁뒪 濡쒕뵫 以?..\n?뺥솗??99.8%濡??곗궛?⑸땲??",
        "?ㅽ뻾 諛곗튂 遺꾩꽍 ?쒖옉.\n?ㅼ감 踰붿쐞 짹0.1% ?대궡濡?怨꾩궛 以?",
        "?ъ＜ ?먭뎅 援ъ“ ?뚯떛 ?꾨즺.\n??꽦 諛곗튂 寃利?以묒엯?덈떎.",
        "泥쒓컙吏吏 留ㅽ듃由?뒪 援ъ텞.\n?곹샇?묒슜 遺꾩꽍 吏꾪뻾 以?",
        "?앸뀈?붿씪???곗씠??寃利?\n泥쒕Ц???議??묒뾽 ?섑뻾 以?",
        "?뚯뼇?ㅽ뻾 諛곗튂 ?곗궛.\n?듦퀎 紐⑤뜽 ?곸슜 以묒엯?덈떎.",
        "?ъ＜紐낅━???뚭퀬由ъ쬁 媛??\n?곗씠???뺥빀??99.9% ?뺣낫.",
        "泥쒓컙 ?곸깮?곴레 留ㅽ듃由?뒪 遺꾩꽍.\n?⑦꽩 ?몄떇 吏꾪뻾 以?",
        "吏吏 ?≫빀?쇳빀 援ъ“ ?뚯떛.\n?쒖뒪??寃利??④퀎.",
        "??꽦 遺꾪룷???묒꽦.\n媛뺤빟 遺꾩꽍 ?뚭퀬由ъ쬁 ?ㅽ뻾 以?",
      ],
      stage2: [
        "?좉컯???먯닔 ?곗텧 ?꾨즺.\n????먮쫫 遺꾩꽍 吏꾪뻾 以묒엯?덈떎.",
        "?듦퀎 湲곕컲 ?덉륫 紐⑤뜽 ?곸슜 以?..\n?뺥솗??寃利??④퀎?낅땲??",
        "?붾졊 ?뺤뇿 ?곗씠??留ㅼ묶.\n怨꾩젅蹂??ㅽ뻾 媛뺣룄 痢≪젙 以?",
        "??꽦 媛以묒튂 怨꾩궛 ?꾨즺.\n理쒖쥌 ?먯닔 ?곗텧 以묒엯?덈떎.",
        "????몄슫 ??꾨씪??援ъ텞.\n?ν썑 10???먮쫫 ?덉륫 以?",
        "?⑹땐?뺥빐??愿怨?遺꾩꽍.\n?ъ＜ ???곹샇?묒슜 寃利?以?",
        "?뱀닔?좎궡 諛곗튂 ?뺤씤.\n?꾪솕?? ??쭏?? ?붽컻??泥댄겕 以?",
        "?щЪ???뚭퀬由ъ쬁 ?ㅽ뻾.\n?섏씡 援ъ“ 遺꾩꽍 吏꾪뻾 以?",
        "?멸컙愿怨??⑦꽩 遺꾩꽍.\n?≪튇 諛곗튂 寃利??④퀎.",
        "醫낇빀 ?먯닔 ?곗텧 以?\n理쒖쥌 由ы룷???앹꽦 以鍮?",
      ],
      stage3: [
        "理쒖쥌 寃利??④퀎 吏꾩엯.\n寃곌낵 異쒕젰 以鍮??꾨즺.",
        "遺꾩꽍 由ы룷???앹꽦 以?..\n?⑺듃留??댁븯?듬땲?? ?뮲",
        "?곗씠???뺥빀??泥댄겕 ?꾨즺.\n?ㅻ쪟??0.01% 誘몃쭔 ?뺤씤.",
        "?듦퀎 ?좊ː??99.7%.\n寃곌낵 異쒕젰 ?湲?以묒엯?덈떎.",
        "?ъ＜紐낅━ DB ?議??꾨즺.\n??궗???곗씠?곗? 留ㅼ묶 以?",
        "AI 遺꾩꽍 紐⑤뜽 寃利??꾨즺.\n理쒖쥌 蹂닿퀬???앹꽦 以?",
        "3以?援먯감 寃利??듦낵.\n寃곌낵 ?좊ː??理쒖긽湲?",
        "?뚭퀬由ъ쬁 ?곗궛 醫낅즺.\n異쒕젰 ?щ㎎ 理쒖쟻??以?",
        "理쒖쥌 由ы룷???뷀샇???꾨즺.\n?꾩넚 以鍮??꾨즺.",
        "遺꾩꽍 ?꾨즺. ?ㅼ감 踰붿쐞 ?덉슜移???\n寃곌낵 異쒕젰 ?쒖옉?⑸땲??",
      ],
    },
    getGreeting: (_timeStr: string) => {
      const greetings = [
        "?뱀떊???앸뀈?붿씪??媛由ы궎???쎌? ?곗씠??\n?ㅼ감 ?놁씠 遺꾩꽍?⑸땲??",
        "洹쇨굅 ?녿뒗 ?꾨줈???ъ젅?낅땲??\n泥좎????섏튂濡쒕쭔 利앸챸?좉쾶??",
        "?ъ＜紐낅━???곗씠?곕쿋?댁뒪 以鍮??꾨즺.\n?뺥솗??遺꾩꽍留??쒓났?⑸땲??",
        "?듦퀎? ?뺣쪧濡?留먰빀?덈떎.\n媛먯젙? 諛곗젣?섍퀬 ?⑺듃留??꾨떖?⑸땲??",
        "?뱀떊???ъ＜?붿옄,\n怨쇳븰??諛⑸쾿濡좎쑝濡??댁꽍?⑸땲??",
        "?섏쿇 ??異뺤쟻???곗씠?곗? ?議?\n媛앷???遺꾩꽍 寃곌낵瑜??쒖떆?⑸땲??",
        "60媛묒옄 議고빀 3,600媛吏 以?n?뱀떊???꾩튂瑜??뺥솗???뚯븙?⑸땲??",
        "?ㅽ뻾 ?먮꼫吏 遺꾪룷 遺꾩꽍.\n媛뺤빟 ?먯닔 ?뺣? 痢≪젙 ?덉젙.",
      ];
      return greetings[Math.floor(Math.random() * greetings.length)];
    },
  },
  fun: {
    id: "fun",
    name: "李먯튇 ?꾩궗",
    img: "/images/ham_friend.png",
    oneLine: "移쒓뎄媛 而ㅽ뵾 留덉떆硫댁꽌 ?댁＜???ъ＜ ?댁빞湲?,
    desc: "諛섎쭚 ?욎씤 移쒓렐??留먰닾!",
    progressMessages: {
      stage1: [
        "?좉퉸留? ???ъ＜ 醫 蹂듭옟?섎떎?\n泥쒖쿇??遊먯쨪寃?",
        "?? ?닿굅 萸먯빞... ???諛?\n醫留?湲곕떎?ㅻ킄!",
        "???닿굅 吏꾩쭨... ?щ컡?붾뜲?\n怨꾩냽 蹂쇨쾶 ?좉퉸留?",
        "?ㅼ????쇰떒 湲곕낯 ?뺣낫遺??泥댄겕.\n湲덈갑 ?앸굹.",
        "???ъ＜ 蹂대뒗???쒓컙 醫 嫄몃┫??\n洹쇰뜲 蹂?留뚰빐??愿쒖갖??",
        "??.. ?λ?濡?꽕? ?닿굅\n醫 ???뚮킄?쇨쿋??",
        "?????닿굅 ?뚯븘?\n吏湲?吏꾩쭨 ?좉린??嫄?諛쒓껄 以?",
        "??.. ?앷컖蹂대떎 ?щ컡?붾뜲?\n議곌툑留?湲곕떎??",
        "?닿굅 ?쒕?濡?蹂대젮硫??쒓컙 ?꾩슂??\n洹쇰뜲 湲곕??대룄 醫뗭븘.",
        "???ъ＜ 蹂대㈃???? 嫄?泥섏쓬?댁빞.\n吏꾩쭨??",
      ],
      stage2: [
        "??.. ?닿굅 ?앷컖蹂대떎 愿쒖갖???\n????醫 ?덉뼱!",
        "? 吏꾩쭨... ???닿굅 蹂닿퀬\n???以鍮????뵦",
        "?좉퉸, ?닿굅 ?뺤씤 醫 ?대킄?쇨쿋??\n萸붽? ?뱀씠??寃?蹂댁뿬.",
        "???닿굅 吏꾩쭨 ?좉린?섎떎.\n???대윴 嫄??뚭퀬 ?덉뿀??",
        "?ㅼ????댁젣 醫 蹂댁씠??\n???앷컖蹂대떎 ?뱀씠??",
        "??.. ??遺遺꾩씠 ?듭떖?몃뜲,\n?쒕?濡??ㅻ챸?댁쨪寃?",
        "??吏꾩쭨 ?щ컡???щ엺?닿뎄??\n?ъ＜媛 利앸챸?섍퀬 ?덉뼱.",
        "?닿굅 蹂대㈃??諛곗슦??寃껊룄 ?덈꽕.\n???ъ＜ ?낇듅??",
        "?????닿굅 吏꾩쭨 ?뚯븘????\n以묒슂??嫄?諛쒓껄?덉뼱.",
        "??.. ??議고빀 泥섏쓬 蹂대뒗??\n?諛뺤씠??吏꾩쭨.",
      ],
      stage3: [
        "??遊ㅻ떎! ???닿굅 吏꾩쭨...\n吏곸젒 遊먯빞 誘우쓣嫄? ?뮙",
        "以鍮꾨릱?? ???몄깮 諛붾??섎룄 ?덉뼱.\n媛곸삤??",
        "?ㅼ????뺣━ ?꾨즺!\n?덊븳????留?留롮븘.",
        "???닿굅 吏꾩쭨 ?щ컡??\n諛붾줈 ?뚮젮以꾧쾶.",
        "???뺤씤?덉뼱.\n?앷컖蹂대떎 ?⑥뵮 醫뗭???",
        "留덉?留??먭? 以?\n洹쇰뜲 吏꾩쭨 湲곕??대룄 ??",
        "?????닿굅 蹂대㈃\n吏꾩쭨 ???嫄곗빞. 媛곸삤??",
        "?ㅼ????꾩꽦!\n?쒕?濡???嫄?蹂댁뿬以꾧쾶.",
        "以鍮??? 吏湲덈???n吏꾩쭨 ?쒖옉?댁빞.",
        "??遊ㅼ뼱. ?붿쭅??留먰븯硫?\n???앷컖蹂대떎 姨붿뼱.",
      ],
    },
    getGreeting: (_timeStr: string) => {
      const greetings = [
        "?⑺듃 ??꺽湲?媛?숉븳??\n?좊━ 硫섑깉?대㈃ ?좎큹???ㅼ? 留?",
        "??吏湲??꾨?源?留먭퉴 怨좊??섎뒗 嫄?n??蹂댁뿬. 洹몃깷 鍮⑤━ ?뚮윭!",
        "?? ?ъ＜ 蹂대윭 ?붿쑝硫?n媛곸삤???섍퀬 ??嫄곗??",
        "?붿쭅?섍쾶 留먰빐以꾧쾶.\n?ｊ린 ?レ쑝硫?吏湲??섍?????",
        "移쒓뎄 ?ъ씠?덇퉴 吏꾩쭨 ?섍린?댁＜??嫄곗빞.\n以鍮꾨릱??",
        "???대챸 沅곴툑?섏??\n洹몃읆 ?쒕?濡??뚮젮以꾧쾶.",
        "?ъ＜ 蹂대뒗 嫄?醫뗭???\n?꾩떎 吏곸떆??以鍮꾨뒗 ?먯뼱?",
        "?ㅻ뒛 ?덊븳???꾩슂??嫄?n?꾨줈媛 ?꾨땲???⑺듃??",
      ];
      return greetings[Math.floor(Math.random() * greetings.length)];
    },
  },
} as const;
type MegaKey = "identity" | "talent" | "relation" | "insight" | "solution";

type MegaCard =
  | {
    id: string;
    kind: "ready";
    title: string;
    icon?: string;
  }
  | {
    id: string;
    kind: "content";
    title: string;
    content: string;
    icon?: string;
    source?: "gpt" | "local";
  };

const MEGA_SECTIONS: Record<
  MegaKey,
  { title: string; icon: string; items: Array<{ key: string; title: string; icon?: string }> }
> = {
  identity: {
    title: "?섏쓽 蹂몄쭏怨?泥レ씤??,
    icon: "?첑",
    items: [
      { key: "animal", title: "?쇱＜ ?숇Ъ???뺤긽怨??뱀쭠", icon: "?맲" },
      { key: "nature", title: "?怨좊궃 ?깃꺽怨?湲곗쭏", icon: "?뙮" },
      { key: "persona", title: "?ы쉶??媛硫닿낵 ?ㅼ젣 ?깃꺽??李⑥씠", icon: "?렚" },
      { key: "values", title: "?띠쓽 ?꾨컲?곸씤 媛移섍?怨?吏?μ젏", icon: "?㎛" },
    ],
  },
  talent: {
    title: "?λ젰怨??ы쉶??臾닿린",
    icon: "?뿠截?,
    items: [
      { key: "strengthWeak", title: "?섏쓽 媛뺤젏怨??쎌젏", icon: "?뽳툘" },
      { key: "aptitude", title: "?좎옱??泥쒖쭅怨?吏곷Т ?곸꽦", icon: "?렞" },
      { key: "elements", title: "?ㅽ뻾??遺꾪룷? 蹂댁셿踰?, icon: "?뙂" },
      { key: "tengod", title: "??꽦?쇰줈 蹂대뒗 二쇱슂 ?꾧뎄", icon: "?㎥" },
    ],
  },
  relation: {
    title: "愿怨꾩? ?섍꼍???먮꼫吏",
    icon: "?쩃",
    items: [
      { key: "comm", title: "???愿怨??ㅽ???諛??뚰넻 諛⑹떇", icon: "?뿣截? },
      { key: "parents", title: "議곗긽???먮뒗 遺紐⑥슫", icon: "?룪" },
      { key: "charisma", title: "移대━?ㅻ쭏? ?ы쉶???곹뼢??, icon: "?몣" },
      { key: "hapchung", title: "吏吏???⑷낵 異⑹쓽 蹂??, icon: "?? },
    ],
  },
  insight: {
    title: "?ы솕 ?щ━ 諛?議곕젰??,
    icon: "?뵇",
    items: [
      { key: "gongmang", title: "怨듬쭩 遺꾩꽍", icon: "?빏截? },
      { key: "guiin", title: "二쇱슂 洹??遺꾩꽍", icon: "?쭛?랅윣앪랅윧? },
      { key: "stress", title: "?ㅽ듃?덉뒪 痍⑥빟 吏?먭낵 留덉쓬 愿由щ쾿", icon: "?쭬" },
    ],
  },
  solution: {
    title: "嫄닿컯怨??됱슫??泥섎갑",
    icon: "?㎦",
    items: [
      { key: "health", title: "?좎쿇?곸씤 嫄닿컯 湲곗쭏", icon: "??" },
      { key: "lucky", title: "?됱슫???꾩씠??, icon: "??" },
      { key: "summary", title: "醫낇빀 ?붿빟 諛??몄깮 媛?대뱶", icon: "?뱦" },
    ],
  },
};

function asReady(id: string, title: string, icon?: string): MegaCard {
  return { id, kind: "ready", title, icon };
}

function asContent(
  id: string,
  title: string,
  content: string,
  icon?: string,
  source: "gpt" | "local" = "gpt"
): MegaCard {
  return { id, kind: "content", title, content, icon, source };
}

// GPT/RAG媛 二쇰뒗 title??蹂닿퀬 ?대뒓 ??뱀뀡?쇰줈 蹂대궪吏 ?異?遺꾨쪟
function classifyMegaByTitle(title: string): MegaKey | null {
  const t = (title || "").replace(/\s+/g, "");
  if (!t) return null;

  if (
    t.includes("蹂몄쭏") ||
    t.includes("泥レ씤??) ||
    t.includes("?깃꺽") ||
    t.includes("湲곗쭏") ||
    t.includes("?섎Ⅴ?뚮굹") ||
    t.includes("媛硫?) ||
    t.includes("媛移섍?") ||
    t.includes("吏??)
  )
    return "identity";

  if (
    t.includes("?щ뒫") ||
    t.includes("媛뺤젏") ||
    t.includes("?쎌젏") ||
    t.includes("泥쒖쭅") ||
    t.includes("吏곷Т") ||
    t.includes("?곸꽦") ||
    t.includes("?ㅽ뻾") ||
    t.includes("??꽦") ||
    t.includes("臾닿린")
  )
    return "talent";

  if (
    t.includes("愿怨?) ||
    t.includes("?뚰넻") ||
    t.includes("遺紐?) ||
    t.includes("議곗긽") ||
    t.includes("移대━?ㅻ쭏") ||
    t.includes("?곹뼢??) ||
    t.includes("??) ||
    t.includes("異?)
  )
    return "relation";

  if (
    t.includes("怨듬쭩") ||
    t.includes("洹??) ||
    t.includes("?щ━") ||
    t.includes("?ㅽ듃?덉뒪") ||
    t.includes("留덉쓬")
  )
    return "insight";

  if (
    t.includes("嫄닿컯") ||
    t.includes("泥섎갑") ||
    t.includes("媛쒖슫") ||
    t.includes("?됱슫") ||
    t.includes("?꾩씠??) ||
    t.includes("?붿빟") ||
    t.includes("媛?대뱶")
  )
    return "solution";

  return null;
}

// =====================================================
// 硫붿씤 而댄룷?뚰듃
// =====================================================

export default function Page() {

  const megaOrder: MegaKey[] = ["identity", "talent", "relation", "insight", "solution"];
  const [openMega, setOpenMega] = useState<MegaKey | null>("identity");
  type GateStep = "idle" | "showSaju" | "needAuth" | "unlocked";


  const [gateStep, setGateStep] = useState<GateStep>("idle");
  const [kakaoReady, setKakaoReady] = useState(false);
  const [isChannelAdded, setIsChannelAdded] = useState(false);

  // ??移댁뭅??梨꾨꼸 ?쇰툝由??꾩씠??
  const CHANNEL_PUBLIC_ID = "_ZeUTxl"; // ??梨꾨꼸 ?쇰툝由??꾩씠?붾줈 援먯껜

  // ???뚮뜑留?以?window ?묎렐 諛⑹????붾쾭洹??곹깭
  const [kakaoTokenOk, setKakaoTokenOk] = useState(false);

  useEffect(() => {
    if (!kakaoReady) return;
    try {
      const ok = !!window.Kakao?.Auth?.getAccessToken?.();
      setKakaoTokenOk(ok);
    } catch {
      setKakaoTokenOk(false);
    }
  }, [kakaoReady, gateStep]);

  function handleKakaoLogin() {
    if (!kakaoReady || !window.Kakao) {
      alert("移댁뭅??SDK 濡쒕뵫???꾩쭅 ???먯뼱.");
      return;
    }

    try {
      window.Kakao.Auth.login({
        scope: "talk_channel",
        success: () => {
          setErr("");
          setKakaoTokenOk(true);
          alert("濡쒓렇???꾨즺! ?댁젣 梨꾨꼸 異붽?瑜??뚮윭以?");
        },
        fail: (e: any) => {
          console.error(e);
          setErr("移댁뭅??濡쒓렇???ㅽ뙣");
        },
      });
    } catch (e) {
      console.error(e);
      setErr("移댁뭅??濡쒓렇??泥섎━ 以??ㅻ쪟");
    }
  }

  function handleFollowChannel() {
    if (!kakaoReady || !window.Kakao) {
      alert("移댁뭅??SDK 濡쒕뵫???꾩쭅 ???먯뼱.");
      return;
    }

    try {
      // SDK 踰꾩쟾???곕씪 followChannel/addChannel ??以??섎굹媛 ?덉쓬
      if (window.Kakao.Channel?.followChannel) {
        window.Kakao.Channel.followChannel({ channelPublicId: CHANNEL_PUBLIC_ID });
      } else if (window.Kakao.Channel?.addChannel) {
        window.Kakao.Channel.addChannel({ channelPublicId: CHANNEL_PUBLIC_ID });
      } else {
        alert("梨꾨꼸 異붽? 湲곕뒫??李얠? 紐삵뻽?? 移댁뭅??SDK 濡쒕뵫/踰꾩쟾???뺤씤?댁쨾.");
        return;
      }

      // ?ъ슜?먭? 移댁뭅??UI?먯꽌 異붽??섍퀬 ?뚯븘?ㅻ㈃ ?먮룞 ?뺤씤 ?쒕룄
      setTimeout(() => {
        checkChannelRelation();
      }, 1200);
    } catch (e) {
      console.error(e);
      setErr("梨꾨꼸 異붽? 泥섎━ 以??ㅻ쪟");
    }
  }

  async function checkChannelRelation() {
    if (!kakaoReady || !window.Kakao) {
      alert("移댁뭅??SDK 濡쒕뵫???꾩쭅 ???먯뼱.");
      return;
    }

    const token = window.Kakao?.Auth?.getAccessToken?.();
    if (!token) {
      alert("癒쇱? 移댁뭅??濡쒓렇?몄쓣 ?댁쨾.");
      return;
    }

    try {
      const res = await window.Kakao.API.request({
        url: "/v2/api/talk/channels",
        data: {
          channel_id_type: "channel_public_id",
          channel_ids: CHANNEL_PUBLIC_ID,
        },
      });

      const channels = Array.isArray(res?.channels) ? res.channels : [];
      const me = channels[0] || null;

      const added =
        me?.relation === "ADDED" ||
        me?.relation === "added" ||
        me?.friend === true ||
        me?.is_friend === true ||
        me?.isFriend === true ||
        me?.status === "ADDED";

      setIsChannelAdded(!!added);

      if (added) {
        setGateStep("unlocked");
        alert("梨꾨꼸 異붽? ?뺤씤 ?꾨즺! ?댁꽍 ?좉툑????몄뼱.");
        requestInterpretation();
      } else {
        alert("?꾩쭅 梨꾨꼸 異붽?媛 ?뺤씤?섏? ?딆븘. 梨꾨꼸 異붽? ???ㅼ떆 ?뺤씤?댁쨾.");
      }
    } catch (e) {
      console.error(e);
      setErr("梨꾨꼸 愿怨?議고쉶 ?ㅽ뙣: 移댁뭅?????ㅼ젙(梨꾨꼸 ?곌껐/?숈쓽??ぉ/?꾨찓?????뺤씤?댁쨾.");
    }
  }

  // 1. 湲곕낯 ?낅젰 ?곹깭
  const [sajuJsonRaw, setSajuJsonRaw] = useState<any>(null);
  const [interpLoading, setInterpLoading] = useState(false);
  const [selectedChar, setSelectedChar] = useState<CharKey>("empathy");

  const [birthYmd, setBirthYmd] = useState("");
  const [birthHm, setBirthHm] = useState("");
  const [gender, setGender] = useState<"M" | "F">("M");
  const [calendar, setCalendar] = useState<"solar" | "lunar">("solar");
  const [timeUnknown, setTimeUnknown] = useState(false);

  // 2. 濡쒕뵫/寃곌낵 ?곹깭
  const [loading, setLoading] = useState(false);
  const [err, setErr] = useState("");
  const [result, setResult] = useState<SajuResult | null>(null);
  const resultRef = useRef<HTMLDivElement>(null);

  // 3. UI ?곹깭
  const [currentGreeting, setCurrentGreeting] = useState("");
  const [loadingMessage, setLoadingMessage] = useState("");
  const [loadingProgress, setLoadingProgress] = useState(0);
  const [scriptMode, setScriptMode] = useState<"hanja" | "hangul">("hanja");
  const [expandedSection, setExpandedSection] = useState<"elements" | "wealth" | null>(
    null
  );

  // 4. 遺꾩꽍 寃곌낵 ?곹깭
  const [showHarmonyAfter, setShowHarmonyAfter] = useState(false);
  const [newInterpretation, setNewInterpretation] = useState<any>(null);
  const [showFortune, setShowFortune] = useState(false);
  const [showCharm, setShowCharm] = useState(false);
  const [showTalent, setShowTalent] = useState(false);
  const [showStrength, setShowStrength] = useState(false);
  const [showRelations, setShowRelations] = useState(false);
  const [showSpecialStars, setShowSpecialStars] = useState(false);
  const [showToday, setShowToday] = useState(false);

  const [fortuneAnalysis, setFortuneAnalysis] = useState<{
    greatFortune: {
      current: GreatFortuneData;
      next: GreatFortuneData;
      direction: "?쒗뻾" | "??뻾";
    };
    yearFortune: {
      current: YearFortuneData;
      next: YearFortuneData;
    };
  } | null>(null);

  const [charmAnalysis, setCharmAnalysis] = useState<string | null>(null);
  const [talentAnalysis, setTalentAnalysis] = useState<string | null>(null);
  const [strengthAnalysis, setStrengthAnalysis] = useState<any>(null);
  const [relationsAnalysis, setRelationsAnalysis] = useState<any>(null);
  const [specialStarsAnalysis, setSpecialStarsAnalysis] = useState<any>(null);
  const [todayFortune, setTodayFortune] = useState<any>(null);

  // ?먮룞 ?ㅽ겕濡?
  useEffect(() => {
    if (result && resultRef.current) {
      setTimeout(() => {
        resultRef.current?.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 500);
    }
  }, [result]);

  // ?몄궗留??낅뜲?댄듃
  useEffect(() => {
    if (result || loading) return;

    let timer: ReturnType<typeof setTimeout> | null = null;

    const updateGreeting = () => {
      const hour = new Date().getHours();
      let timeStr = "吏湲?;

      if (hour >= 0 && hour < 5) timeStr = "?덈꼍";
      else if (hour >= 5 && hour < 11) timeStr = "?꾩묠";
      else if (hour >= 11 && hour < 17) timeStr = "??;
      else if (hour >= 17 && hour < 21) timeStr = "???;
      else timeStr = "諛?;

      const nextGreeting = CHARACTERS[selectedChar].getGreeting(timeStr);
      setCurrentGreeting(nextGreeting);

      const typingDuration = nextGreeting.length * 50;
      const waitTime = typingDuration + 300 + 3000;

      timer = setTimeout(updateGreeting, waitTime);
    };

    updateGreeting();

    return () => {
      if (timer) clearTimeout(timer);
    };
  }, [selectedChar, result, loading]);

  // ????몄슫 遺꾩꽍
  useEffect(() => {
    if (result && birthYmd) {
      try {
        const parsedYmd = parseYmd(birthYmd);
        if (!parsedYmd) return;

        const birthYear = parsedYmd.year;
        const currentYear = new Date().getFullYear();
        const currentAge = currentYear - birthYear + 1;

        const monthPillar = result.month.cheongan.hanja + result.month.jiji.hanja;
        const dayStem = result.day.cheongan.hanja;

        const originalPillars = {
          year: result.year.cheongan.hanja + result.year.jiji.hanja,
          month: monthPillar,
          day: result.day.cheongan.hanja + result.day.jiji.hanja,
          hour: result.hour.cheongan.hanja + result.hour.jiji.hanja,
        };

        const daeunNum = 5;
        const sinGangScore = 50;

        const fortune = analyzeFullFortune(
          birthYear,
          gender,
          monthPillar,
          daeunNum,
          currentAge,
          currentYear,
          dayStem,
          originalPillars,
          sinGangScore
        );

        setFortuneAnalysis(fortune);

        const dayPillar = result.day.cheongan.hanja + result.day.jiji.hanja;
        const charmText = CHARM_BY_PILLAR[dayPillar];
        if (charmText) setCharmAnalysis(charmText[selectedChar]);

        const dayStemTenGod = tenGod(dayStem, dayStem);
        const talentText = TALENT_BY_TEN_GOD[dayStemTenGod];
        if (talentText) setTalentAnalysis(talentText[selectedChar]);

        const strengthResult = analyzeStrength(
          dayStem,
          result.month.jiji.hanja,
          [result.year, result.month, result.day, result.hour],
          tenGod
        );
        setStrengthAnalysis(strengthResult);

        const relationsResult = analyzeRelations(
          [
            result.year.cheongan.hanja,
            result.month.cheongan.hanja,
            result.day.cheongan.hanja,
            result.hour.cheongan.hanja,
          ],
          [
            result.year.jiji.hanja,
            result.month.jiji.hanja,
            result.day.jiji.hanja,
            result.hour.jiji.hanja,
          ]
        );
        setRelationsAnalysis(relationsResult);

        const specialResult = analyzeSpecialStars(
          result.day.jiji.hanja,
          result.year.jiji.hanja,
          result.month.jiji.hanja,
          result.hour.jiji.hanja
        );
        setSpecialStarsAnalysis(specialResult);

        const todayResult = analyzeTodayFortune(hanjaToElement(dayStem), selectedChar);
        setTodayFortune(todayResult);
      } catch (error) {
        console.error("????몄슫 遺꾩꽍 ?ㅻ쪟:", error);
      }
    }
  }, [result, birthYmd, gender, selectedChar]);

  // useMemo 怨꾩궛
  const chars8 = useMemo(() => {
    if (!result) return [];
    const p = [result.hour, result.day, result.month, result.year];
    return [
      p[0].cheongan.hanja,
      p[0].jiji.hanja,
      p[1].cheongan.hanja,
      p[1].jiji.hanja,
      p[2].cheongan.hanja,
      p[2].jiji.hanja,
      p[3].cheongan.hanja,
      p[3].jiji.hanja,
    ].filter(Boolean);
  }, [result]);

  const elementSummary = useMemo(() => {
    const buckets: Record<string, string[]> = {
      wood: [],
      fire: [],
      earth: [],
      metal: [],
      water: [],
    };
    for (const ch of chars8) {
      const el = hanjaToElement(ch);
      if (el !== "none") buckets[el].push(ch);
    }
    return buckets;
  }, [chars8]);

  const pillars = useMemo(() => {
    if (!result) return [];
    return [result.hour, result.day, result.month, result.year];
  }, [result]);

  const formError = useMemo(() => {
    const parsedYmd = parseYmd(birthYmd);
    const parsedHm = timeUnknown ? { hour: 12, minute: 0 } : parseHm(birthHm);

    if (!parsedYmd) return "?앸뀈?붿씪? 8?먮━(YYYYMMDD)濡??낅젰?댁쨾";
    if (!parsedHm) return "?쒖뼱?쒖떆媛꾩? 4?먮━(HHMM)濡??낅젰?댁쨾";
    return null;
  }, [birthYmd, birthHm, timeUnknown]);

  const megaCards = useMemo(() => {
    const base: Record<MegaKey, MegaCard[]> = {
      identity: MEGA_SECTIONS.identity.items.map((it) =>
        asReady(`identity_${it.key}`, it.title, it.icon)
      ),
      talent: MEGA_SECTIONS.talent.items.map((it) =>
        asReady(`talent_${it.key}`, it.title, it.icon)
      ),
      relation: MEGA_SECTIONS.relation.items.map((it) =>
        asReady(`relation_${it.key}`, it.title, it.icon)
      ),
      insight: MEGA_SECTIONS.insight.items.map((it) =>
        asReady(`insight_${it.key}`, it.title, it.icon)
      ),
      solution: MEGA_SECTIONS.solution.items.map((it) =>
        asReady(`solution_${it.key}`, it.title, it.icon)
      ),
    };

    // 1) 濡쒖뺄 遺꾩꽍???대? ?덈뒗 ?곗씠?? => ?대떦 ?뱀뀡??苑귥븘二쇨린
    if (talentAnalysis) {
      base.talent.unshift(asContent("talent_text", "?щ뒫 ?붿빟", talentAnalysis, "?렞", "local"));
    }
    if (strengthAnalysis?.[selectedChar]) {
      const txt = `${strengthAnalysis.type} (?먯닔: ${strengthAnalysis.score})\n\n${strengthAnalysis[selectedChar]}\n\n異붿쿇: ${strengthAnalysis.recommendation}`;
      base.talent.unshift(asContent("strength_text", "?좉컯???붿쭊 遺꾩꽍", txt, "?숋툘", "local"));
    }
    if (relationsAnalysis?.[selectedChar]) {
      base.relation.unshift(
        asContent("relation_text", "愿怨??⑹땐 ?붿빟", relationsAnalysis[selectedChar], "?쩃", "local")
      );
    }
    if (specialStarsAnalysis?.[selectedChar]) {
      base.insight.unshift(
        asContent("stars_text", "?뱀닔?좎궡/?뱀쭠", specialStarsAnalysis[selectedChar], "狩?, "local")
      );
    }
    if (todayFortune?.advice) {
      const txt = `?됱슫???? ${todayFortune.luckyColor}\n?됱슫???レ옄: ${todayFortune.luckyNumber}\n?됱슫??諛⑺뼢: ${todayFortune.luckyDirection}\n\n?ㅻ뒛??議곗뼵:\n${todayFortune.advice}`;
      base.solution.unshift(asContent("today_text", "?ㅻ뒛??泥섎갑", txt, "?㎦", "local"));
    }

    // 2) GPT ?댁꽍(interps) => ??댄? 蹂닿퀬 ?먮룞 遺꾨쪟?댁꽌 苑귢린
    const interps: any[] = Array.isArray(newInterpretation?.interpretations)
      ? newInterpretation.interpretations
      : [];

    for (let i = 0; i < interps.length; i++) {
      const it = interps[i];
      const title = String(it?.title ?? "").trim();
      const content = String(it?.content ?? "").trim();
      if (!title || !content) continue;

      const where = classifyMegaByTitle(title);
      if (!where) continue;

      base[where].unshift(asContent(`gpt_${where}_${i}`, title, content, "??, "gpt"));
    }

    // 3) 媛??뱀뀡? ?댁슜 移대뱶媛 ?덉쑝硫?洹멸구 ?곗꽑 蹂댁뿬二쇨퀬, ?섎㉧吏??以鍮꾩쨷 洹몃?濡?
    // (?대? base???욎뿬?덉쓬)
    return base;
  }, [newInterpretation, talentAnalysis, strengthAnalysis, relationsAnalysis, specialStarsAnalysis, todayFortune, selectedChar]);

  async function requestInterpretation() {
    if (!sajuJsonRaw) return;

    setInterpLoading(true);
    setErr("");

    try {
      const parsedYmd = parseYmd(birthYmd);
      const parsedHm = timeUnknown ? { hour: 12, minute: 0 } : parseHm(birthHm);
      if (!parsedYmd || !parsedHm) return;

      const interpretRes = await fetch(`${API_BASE}/saju/interpret-gpt`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          day_stem: sajuJsonRaw.day_pillar[0],
          year_pillar: sajuJsonRaw.year_pillar,
          month_pillar: sajuJsonRaw.month_pillar,
          day_pillar: sajuJsonRaw.day_pillar,
          hour_pillar: sajuJsonRaw.hour_pillar,
          tone: selectedChar,
          year: parsedYmd.year,
          month: parsedYmd.month,
          day: parsedYmd.day,
          hour: parsedHm.hour,
          gender: gender,
        }),
      });

      const interpretJson = await interpretRes.json();
      setNewInterpretation(interpretJson);
    } catch (e) {
      console.error(e);
      setNewInterpretation({
        title: ELEMENT_ANALYSIS[selectedChar].title,
        content: "?댁꽍??遺덈윭?ㅻ뒗 以??ㅻ쪟媛 諛쒖깮?덉뒿?덈떎.",
        metadata: { harmony: null },
        interpretations: [],
      });
    } finally {
      setInterpLoading(false);
    }
  }

  // run ?⑥닔
  async function run() {
    setGateStep("idle");
    setIsChannelAdded(false);
    const parsedYmd = parseYmd(birthYmd);
    const parsedHm = timeUnknown ? { hour: 12, minute: 0 } : parseHm(birthHm);
    if (!parsedYmd || !parsedHm) return;

    setLoading(true);
    setErr("");
    setResult(null);

    setNewInterpretation(null);
    setLoadingProgress(0);
    setExpandedSection(null);
    setShowFortune(false);
    setShowCharm(false);
    setShowTalent(false);
    setShowStrength(false);
    setShowRelations(false);
    setShowSpecialStars(false);
    setShowToday(false);

    const ch = CHARACTERS[selectedChar];
    const stageMessages = {
      stage1: ch.progressMessages.stage1,
      stage2: ch.progressMessages.stage2,
      stage3: ch.progressMessages.stage3,
    };

    let currentProgress = 0;
    const progressInterval = setInterval(() => {
      if (currentProgress < 95) {
        currentProgress += 5;
        setLoadingProgress(currentProgress);

        if (currentProgress === 5 || currentProgress === 30) {
          const randomMsg =
            stageMessages.stage1[Math.floor(Math.random() * stageMessages.stage1.length)];
          setLoadingMessage(randomMsg);
        } else if (currentProgress === 60) {
          const randomMsg =
            stageMessages.stage2[Math.floor(Math.random() * stageMessages.stage2.length)];
          setLoadingMessage(randomMsg);
        } else if (currentProgress === 85) {
          const randomMsg =
            stageMessages.stage3[Math.floor(Math.random() * stageMessages.stage3.length)];
          setLoadingMessage(randomMsg);
        }
      }
    }, 600);

    const messageInterval = setInterval(() => {
      if (currentProgress >= 95) {
        const waitingMessages = [
          selectedChar === "empathy"
            ? "留덉?留??먭? 以묒씠?먯슂... 議곌툑留?湲곕떎?ㅼ＜?몄슂!"
            : selectedChar === "reality"
              ? "理쒖쥌 寃利??④퀎. ?곗씠??臾닿껐???뺤씤 以?"
              : "??吏꾩쭨 嫄곗쓽 ???붿뼱. 議곌툑留???",
          selectedChar === "empathy"
            ? "?뱀떊???꾪븳 ?밸퀎???댁빞湲곕? ?꾩꽦?섍퀬 ?덉뼱????
            : selectedChar === "reality"
              ? "遺꾩꽍 ?꾨즺 ?꾨컯. 異쒕젰 以鍮?以?"
              : "以鍮??꾨즺 吏곸쟾! 嫄곗쓽 ???붿뼱!",
        ];

        const randomMsg = waitingMessages[Math.floor(Math.random() * waitingMessages.length)];
        setLoadingMessage(randomMsg);
      }
    }, 2000);

    const requestBody = {
      calendar_type: calendar,
      year: parsedYmd.year,
      month: parsedYmd.month,
      day: parsedYmd.day,
      hour: parsedHm.hour,
      minute: parsedHm.minute,
      gender,
    };

    try {
      // 1) ?ъ＜ 湲곕낯 ?뺣낫留?
      const sajuRes = await fetch(`${API_BASE}/saju/full`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(requestBody),
      });

      const sajuJson = await sajuRes.json();

      if (!sajuRes.ok) {
        setErr(typeof sajuJson?.detail === "string" ? sajuJson.detail : JSON.stringify(sajuJson));
        clearInterval(progressInterval);
        clearInterval(messageInterval);
        setLoading(false);
        return;
      }

      // ?먭뎅 raw ???(?섏쨷???댁꽍 ?붿껌?????곕젮怨?
      setSajuJsonRaw(sajuJson);

      // 2) ?붾㈃???ъ＜?붿옄 移대뱶留?癒쇱? ?명똿
      const [hourCheongan, hourJiji] = splitPillar(sajuJson.hour_pillar);
      const [dayCheongan, dayJiji] = splitPillar(sajuJson.day_pillar);
      const [monthCheongan, monthJiji] = splitPillar(sajuJson.month_pillar);
      const [yearCheongan, yearJiji] = splitPillar(sajuJson.year_pillar);

      const hourBlock: PillarBlock = { label: "?쒖＜", cheongan: hourCheongan, jiji: hourJiji };
      const dayBlock: PillarBlock = { label: "?쇱＜", cheongan: dayCheongan, jiji: dayJiji };
      const monthBlock: PillarBlock = { label: "?붿＜", cheongan: monthCheongan, jiji: monthJiji };
      const yearBlock: PillarBlock = { label: "?꾩＜", cheongan: yearCheongan, jiji: yearJiji };

      clearInterval(progressInterval);
      clearInterval(messageInterval);

      const finalMsg =
        selectedChar === "empathy"
          ? "?ъ＜?붿옄 以鍮꾨릱?댁슂! 癒쇱? ?먭뎅遺??蹂댁뿬?쒕┫寃뚯슂 ?뮇"
          : selectedChar === "reality"
            ? "?먭뎅 異쒕젰 ?꾨즺. ?댁꽍? 蹂꾨룄 ?붿껌."
            : "?먭뎅 ?대떎. ?댁꽍? ?뚮윭???섏?.";
      setLoadingMessage(finalMsg);

      for (let i = 95; i <= 100; i += 1) {
        setLoadingProgress(i);
        await new Promise((resolve) => setTimeout(resolve, 30));
      }

      setResult({ hour: hourBlock, day: dayBlock, month: monthBlock, year: yearBlock });

      // ?ш린??諛붾줈 寃뚯씠???꾩슦吏 留먭퀬, ?쇰떒 ?먭뎅留?蹂댁뿬二쇰뒗 ?④퀎濡???
      setGateStep("showSaju");

      await new Promise((resolve) => setTimeout(resolve, 50));
      setLoading(false);
    } catch (e: any) {
      clearInterval(progressInterval);
      clearInterval(messageInterval);
      setErr(e?.message ?? "?ㅽ듃?뚰겕 ?ㅻ쪟");
      setLoading(false);
    }
  }

  // 而댄룷?뚰듃??硫붿씤 return (紐⑤뱺 ?⑥닔 ?뺤쓽 諛뽰뿉 ?꾩튂)
  return (
    <main
      className="min-h-screen p-4 flex flex-col items-center justify-center relative"
      style={{ position: "relative", zIndex: 10 }}
    >
      <Script
        src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"
        strategy="afterInteractive"
        onLoad={() => {
          try {
            if (!window.Kakao) return;
            const key = process.env.NEXT_PUBLIC_KAKAO_JS_KEY;
            if (!key) {
              console.error("NEXT_PUBLIC_KAKAO_JS_KEY 媛 鍮꾩뼱?덉쓬");
              return;
            }
            if (!window.Kakao.isInitialized()) {
              window.Kakao.init(key);
            }
            setKakaoReady(true);
          } catch (e) {
            console.error(e);
          }
        }}
      />

      {!loading && !result && (
        <>
          <div className="fixed inset-0 overflow-hidden pointer-events-none z-0">
            {["狩?, "??, "?뮇", "?뙵", "?뙹", "?뮟", "?뙚", "?뮎"].map((emoji, i) => (
              <motion.div
                key={i}
                className="absolute text-2xl"
                style={{
                  top: `${10 + i * 12}%`,
                  left: `${5 + i * 11}%`,
                }}
                animate={{
                  y: [0, -25, 0],
                  x: [0, 10, 0],
                  rotate: [0, 15, 0, -15, 0],
                  opacity: [0.3, 0.8, 0.3],
                  scale: [0.8, 1.1, 0.8],
                }}
                transition={{
                  duration: 4 + i * 0.3,
                  repeat: Infinity,
                  ease: "easeInOut",
                  delay: i * 0.2,
                }}
              >
                {emoji}
              </motion.div>
            ))}
          </div>

          <div className="fixed top-8 left-8 text-6xl">?뙵</div>
          <div className="fixed top-12 right-12 text-5xl">狩?/div>
          <div className="fixed bottom-16 left-16 text-5xl">?뙹</div>
          <div className="fixed bottom-12 right-20 text-6xl">??/div>
          <div className="fixed top-1/3 left-12 text-4xl">?뮇</div>
          <div className="fixed top-2/3 right-16 text-4xl">?쫳</div>
        </>
      )}

      <div className="w-full max-w-[450px] mx-auto px-2 sm:px-0">
        <div className="border-4 border-[#adc4af] rounded-[24px] bg-white overflow-hidden shadow-xl pixel-window relative z-10">
          <div className="bg-[#c1d8c3] p-3 flex justify-between items-center text-[#556b2f] border-b-4 border-[#adc4af]">
            <div className="flex items-center gap-2">
              <img src="/images/ham_icon.png" alt="icon" className="w-10 h-10 object-contain" />
              <span className="text-sm font-bold">Saju_Hamster.exe</span>
            </div>
            <div className="flex gap-1">
              <div className="w-5 h-5 bg-white/40 flex items-center justify-center text-[#556b2f] text-[10px] rounded-sm border border-[#adc4af]">
                _
              </div>
              <div className="w-5 h-5 bg-[#ffadad] flex items-center justify-center text-white text-[10px] rounded-sm shadow-sm">
                X
              </div>
            </div>
          </div>

          <div className="p-5 bg-white">
            {err && !loading && !result && (
              <div className="mb-4 p-3 rounded-xl border-2 border-red-200 bg-red-50 text-[11px] text-red-700 whitespace-pre-wrap">
                {err}
              </div>
            )}

            {loading && (
              <div
                className="fixed inset-0 flex items-center justify-center bg-black/70 backdrop-blur-sm"
                style={{
                  touchAction: "none",
                  WebkitTouchCallout: "none",
                  WebkitUserSelect: "none",
                  userSelect: "none",
                  zIndex: 9999,
                }}
              >
                <div className="bg-white rounded-2xl p-6 sm:p-8 w-[90vw] sm:w-[450px] max-w-[450px] mx-4 text-center shadow-2xl">
                  <div className="mb-4 sm:mb-6">
                    <motion.div
                      initial={{ scale: 0.5, y: 50, opacity: 0 }}
                      animate={{
                        scale: [0.5, 1.3, 1],
                        y: [50, -20, 0],
                        opacity: 1,
                      }}
                      transition={{
                        duration: 0.8,
                        times: [0, 0.6, 1],
                        ease: "easeOut",
                      }}
                      className="relative mb-4 sm:mb-6"
                    >
                      <img
                        src={CHARACTERS[selectedChar].img}
                        alt={CHARACTERS[selectedChar].name}
                        className="w-32 h-32 sm:w-40 sm:h-40 object-contain pixel-art drop-shadow-2xl mx-auto"
                      />
                    </motion.div>

                    <motion.div
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.6 }}
                      className="text-center px-4 sm:px-6"
                    >
                      <p className="text-[#556b2f] font-bold text-sm sm:text-base leading-relaxed whitespace-pre-wrap text-korean">
                        {loadingMessage}
                      </p>
                    </motion.div>

                    <motion.div
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.8 }}
                      className="w-full px-4 sm:px-8 space-y-2 sm:space-y-3 mt-4 sm:mt-6"
                    >
                      <div className="flex justify-between items-center px-1 sm:px-2">
                        <span className="text-xs sm:text-sm font-bold text-[#556b2f]">
                          遺꾩꽍 吏꾪뻾以?
                        </span>
                        <span
                          className="text-xl sm:text-2xl font-black text-[#556b2f]"
                          style={{ fontFamily: "monospace" }}
                        >
                          {loadingProgress}% <span className="pixel-heart">?뮎</span>
                        </span>
                      </div>

                      <div className="relative h-8 sm:h-10 bg-[#e9ecef] border-2 sm:border-4 border-[#556b2f] overflow-hidden shadow-[2px_2px_0px_0px_rgba(85,107,47,0.3)]">
                        <motion.div
                          className="h-full bg-gradient-to-r from-[#fef08a] via-[#fde047] to-[#facc15]"
                          style={{
                            width: `${loadingProgress}%`,
                            imageRendering: "pixelated",
                          }}
                          animate={{ width: `${loadingProgress}%` }}
                          transition={{
                            duration: 0.3,
                            ease: "linear",
                          }}
                        >
                          <div className="absolute top-0 left-0 w-full h-[30%] bg-white/30" />
                        </motion.div>

                        {[...Array(99)].map((_, i) => (
                          <div
                            key={i}
                            className="absolute top-0 bottom-0 w-[1px] bg-[#556b2f]"
                            style={{
                              left: `${(i + 1) * 1}%`,
                              opacity: 0.15,
                            }}
                          />
                        ))}

                        {[...Array(9)].map((_, i) => (
                          <div
                            key={`thick-${i}`}
                            className="absolute top-0 bottom-0 w-[2px] bg-[#556b2f]"
                            style={{
                              left: `${(i + 1) * 10}%`,
                              opacity: 0.4,
                            }}
                          />
                        ))}
                      </div>
                    </motion.div>
                  </div>
                </div>
              </div>
            )}

            {!loading && !result && (
              <div className="text-center mb-6">
                <p className="text-[#556b2f] font-bold text-sm text-korean">
                  ?꾨옒???먰븯???꾩뒪?곕? ?좏깮?댁쨾!
                </p>
              </div>
            )}

            <div className="space-y-4">
              <AnimatePresence mode="wait">
                {loading ? null : !result ? (
                  <motion.div
                    key="input-form"
                    initial={{ opacity: 1 }}
                    exit={{ opacity: 0, scale: 0.95 }}
                    transition={{ duration: 0.3 }}
                    className="space-y-6"
                  >
                    <div className="flex justify-center gap-3 sm:gap-6 mb-16 sm:mb-20">
                      {(Object.keys(CHARACTERS) as Array<keyof typeof CHARACTERS>).map(
                        (id) => (
                          <button
                            key={id}
                            onClick={() => setSelectedChar(id)}
                            className="relative flex flex-col items-center focus:outline-none"
                          >
                            <motion.div
                              animate={{
                                scale: selectedChar === id ? 1.5 : 1,
                                borderColor: selectedChar === id ? "#556b2f" : "transparent",
                              }}
                              className={`w-12 h-12 sm:w-16 sm:h-16 rounded-full border-3 sm:border-4 overflow-hidden bg-white shadow-md transition-all ${selectedChar === id ? "ring-2 ring-[#c1d8c3]" : ""
                                }`}
                            >
                              <img
                                src={CHARACTERS[id].img}
                                alt={CHARACTERS[id].name}
                                className={`w-full h-full object-contain ${selectedChar === id ? "grayscale-0" : "grayscale opacity-60"
                                  }`}
                              />
                            </motion.div>

                            {selectedChar === id && (
                              <motion.div
                                layoutId="activeTabName"
                                initial={{ opacity: 0, y: 5 }}
                                animate={{ opacity: 1, y: 0 }}
                                className="absolute -bottom-12 sm:-bottom-14 left-1/2 -translate-x-1/2 whitespace-nowrap"
                              >
                                <div className="flex flex-col items-center gap-0.5">
                                  <span className="text-[10px] sm:text-[11px] font-bold text-[#556b2f] bg-[#fefae0] px-2 py-0.5 rounded-full border border-[#e9edc9] shadow-sm">
                                    {CHARACTERS[id].name}
                                  </span>
                                  <div className="flex gap-1 text-[8px] sm:text-[9px] text-[#556b2f] opacity-70">
                                    {id === "empathy" && (
                                      <>
                                        <span>#?뱀떊?꾩쐞??/span>
                                        <span>#?먮쭅議곗뼵</span>
                                        <span>#?곕쑜?쒖쐞濡?/span>
                                      </>
                                    )}
                                    {id === "reality" && (
                                      <>
                                        <span>#?곗씠?곕줈蹂대뒗</span>
                                        <span>#?대챸遺꾩꽍</span>
                                        <span>#?⑺듃??꺽</span>
                                      </>
                                    )}
                                    {id === "fun" && (
                                      <>
                                        <span>#堉덈븣由щ뒗</span>
                                        <span>#?꾩떎議곗뼵</span>
                                        <span>#?좎풄?쒗뙥??/span>
                                      </>
                                    )}
                                  </div>
                                </div>
                              </motion.div>
                            )}
                          </button>
                        )
                      )}
                    </div>

                    <motion.div
                      key={selectedChar}
                      initial={{ opacity: 0, scale: 0.8, y: 20 }}
                      animate={{ opacity: 1, scale: 1, y: 0 }}
                      exit={{ opacity: 0, scale: 0.8, y: -20 }}
                      transition={{ duration: 0.5, ease: "easeOut" }}
                      className="flex flex-col items-center gap-4 mb-8 mt-4"
                    >
                      <motion.div
                        animate={{
                          y: [0, -10, 0],
                          rotate: [0, 3, -3, 0],
                        }}
                        transition={{
                          duration: 2,
                          repeat: Infinity,
                          ease: "easeInOut",
                        }}
                        className="relative"
                      >
                        <img
                          src={CHARACTERS[selectedChar].img}
                          alt={CHARACTERS[selectedChar].name}
                          className="w-32 h-32 sm:w-40 sm:h-40 object-contain pixel-art drop-shadow-2xl"
                        />
                      </motion.div>

                      <div className="bg-white/80 backdrop-blur-sm border-3 border-[#adc4af] rounded-2xl p-4 max-w-sm mx-4 shadow-lg">
                        <motion.p
                          key={currentGreeting}
                          initial={{ opacity: 0 }}
                          animate={{ opacity: 1 }}
                          transition={{ duration: 0.3 }}
                          className="text-[11px] sm:text-[13px] leading-relaxed text-[#556b2f] font-medium text-center whitespace-pre-line"
                        >
                          {currentGreeting}
                        </motion.p>
                      </div>
                    </motion.div>

                    <div className="space-y-3 pt-4 border-t-2 border-dashed border-slate-100">
                      <div className="grid grid-cols-2 gap-2 sm:gap-3">
                        <div className="flex bg-[#f1f3f5] p-1 rounded-xl border-3 border-[#adc4af]">
                          <button
                            onClick={() => setCalendar("solar")}
                            className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${calendar === "solar"
                              ? "bg-black text-white shadow-sm"
                              : "text-[#868e96]"
                              }`}
                          >
                            ?묐젰
                          </button>
                          <button
                            onClick={() => setCalendar("lunar")}
                            className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${calendar === "lunar"
                              ? "bg-black text-white shadow-sm"
                              : "text-[#868e96]"
                              }`}
                          >
                            ?뚮젰
                          </button>
                        </div>

                        <div className="flex bg-[#f1f3f5] p-1 rounded-xl border-3 border-[#adc4af]">
                          <button
                            onClick={() => setGender("M")}
                            className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${gender === "M" ? "bg-black text-white shadow-sm" : "text-[#868e96]"
                              }`}
                          >
                            ??
                          </button>
                          <button
                            onClick={() => setGender("F")}
                            className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${gender === "F" ? "bg-black text-white shadow-sm" : "text-[#868e96]"
                              }`}
                          >
                            ??
                          </button>
                        </div>
                      </div>

                      <input
                        className="w-full rounded-xl border-3 border-[#adc4af] px-3 sm:px-4 py-2 sm:py-3 font-mono text-xs sm:text-sm outline-none transition-all focus:border-[#556b2f] focus:bg-yellow-50"
                        placeholder="?앸뀈?붿씪 8?먮━"
                        value={birthYmd}
                        onChange={(e) => setBirthYmd(onlyDigits(e.target.value).slice(0, 8))}
                      />

                      <div className="flex gap-2">
                        <input
                          className="flex-1 rounded-xl border-3 border-[#adc4af] px-4 py-3 font-mono text-sm outline-none transition-all focus:border-[#556b2f] focus:bg-yellow-50 disabled:opacity-30"
                          placeholder="?쒓컙 4?먮━ (HHMM)"
                          value={birthHm}
                          disabled={timeUnknown}
                          onChange={(e) => setBirthHm(onlyDigits(e.target.value).slice(0, 4))}
                        />
                        <label className="flex items-center gap-2 border-3 border-[#adc4af] rounded-xl px-3 bg-[#fefae0] cursor-pointer hover:bg-white transition-colors">
                          <input
                            type="checkbox"
                            checked={timeUnknown}
                            onChange={(e) => setTimeUnknown(e.target.checked)}
                            className="w-4 h-4 accent-[#556b2f]"
                          />
                          <span className="text-[10px] font-bold text-[#556b2f]">紐⑤쫫</span>
                        </label>
                      </div>

                      <div className="text-[10px] text-[#556b2f] opacity-70 px-1">
                        {formError ? formError : "?낅젰 ?꾨즺. 踰꾪듉 ?꾨Ⅴ硫?遺꾩꽍 ?쒖옉"}
                      </div>

                      <button
                        type="button"
                        onClick={(e) => {
                          e.preventDefault();
                          e.stopPropagation();
                          if (!formError) run();
                        }}
                        onTouchStart={(e) => {
                          e.stopPropagation();
                        }}
                        disabled={loading || !!formError}
                        className={`
                      w-full px-6 py-4
                      bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600
                      text-gray-900 font-bold text-lg
                      rounded-lg
                      transform transition-all duration-200
                      ${loading || !!formError
                            ? "opacity-50 cursor-not-allowed"
                            : "hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl"
                          }
                      disabled:transform-none
                    `}
                      >
                        {loading ? "遺꾩꽍 以?.." : "?뵰 ?ъ＜ ?뺤씤?섍린"}
                      </button>
                    </div>
                  </motion.div>
                ) : (
                  <motion.div
                    ref={resultRef}
                    key="result"
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: -20 }}
                    transition={{ duration: 0.5 }}
                    className="space-y-4"
                  >
                    <motion.div
                      key={`result-${selectedChar}`}
                      initial={{ opacity: 0, scale: 0.8, y: 20 }}
                      animate={{ opacity: 1, scale: 1, y: 0 }}
                      transition={{ duration: 0.5, ease: "easeOut" }}
                      className="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-4 sm:p-6 shadow-lg border-4 border-[#adc4af] mb-6"
                    >
                      <div className="flex flex-col items-center gap-3 sm:gap-4">
                        <h3 className="text-lg sm:text-2xl font-bold text-[#556b2f] text-center">
                          ?럦 ?ъ＜ 遺꾩꽍 ?꾨즺!
                        </h3>

                        <motion.div
                          animate={{
                            y: [0, -8, 0],
                            rotate: [0, 2, -2, 0],
                          }}
                          transition={{
                            duration: 2,
                            repeat: Infinity,
                            ease: "easeInOut",
                          }}
                          className="relative"
                        >
                          <div className="w-28 h-28 sm:w-36 sm:h-36 rounded-full bg-white shadow-xl flex items-center justify-center border-4 border-yellow-300">
                            <img
                              src={CHARACTERS[selectedChar].img}
                              alt={CHARACTERS[selectedChar].name}
                              className="w-24 h-24 sm:w-32 sm:h-32 object-contain pixel-art"
                            />
                          </div>
                          <div className="absolute -top-2 -right-2 text-2xl sm:text-3xl animate-bounce">
                            ??
                          </div>
                        </motion.div>

                        <div className="text-center space-y-2 max-w-xs sm:max-w-sm px-2">
                          <p className="text-base sm:text-xl font-bold text-[#556b2f]">
                            {CHARACTERS[selectedChar].name}
                          </p>
                          <p className="text-xs sm:text-sm text-gray-600 bg-white px-3 py-2 rounded-full shadow-sm border-2 border-[#adc4af]">
                            {CHARACTERS[selectedChar].desc}
                          </p>
                          <p className="text-[10px] sm:text-xs text-[#556b2f] opacity-70">
                            {CHARACTERS[selectedChar].oneLine}
                          </p>
                        </div>

                        <div className="flex gap-2 text-xl sm:text-2xl">
                          <motion.span
                            animate={{ scale: [1, 1.3, 1] }}
                            transition={{ duration: 1.5, repeat: Infinity, delay: 0 }}
                          >
                            ?뮎
                          </motion.span>
                          <motion.span
                            animate={{ scale: [1, 1.3, 1] }}
                            transition={{ duration: 1.5, repeat: Infinity, delay: 0.2 }}
                          >
                            ?뮎
                          </motion.span>
                          <motion.span
                            animate={{ scale: [1, 1.3, 1] }}
                            transition={{ duration: 1.5, repeat: Infinity, delay: 0.4 }}
                          >
                            ?뮎
                          </motion.span>
                        </div>
                      </div>
                    </motion.div>

                    {/* ?ъ＜ ?붿옄 移대뱶 */}
                    <div className="relative">
                      <button
                        onClick={() =>
                          setScriptMode(scriptMode === "hanja" ? "hangul" : "hanja")
                        }
                        className="absolute -top-7 right-1 z-20 px-2.5 py-1 bg-[#fef08a] border-2 border-[#eab308] rounded-full text-[9px] font-bold text-[#854d0e] hover:bg-[#fde047] transition-all hover:scale-110 shadow-md"
                      >
                        {scriptMode === "hanja" ? "轢℡춻" : "?쒓?"}
                      </button>

                      <div className="border-4 border-[#adc4af] rounded-2xl bg-white overflow-hidden shadow-none">
                        <div className="grid grid-cols-2 sm:grid-cols-4 border-b-2 border-[#adc4af] bg-[#c1d8c3]/10 text-[9px] sm:text-[10px] text-[#556b2f] font-bold text-center py-1">
                          <span>?쒖＜</span>
                          <span>?쇱＜</span>
                          <span>?붿＜</span>
                          <span>?꾩＜</span>
                        </div>

                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-0 text-center divide-x-2 divide-[#adc4af]">
                          {pillars.map((p, i) => (
                            <div
                              key={i}
                              className="py-2 sm:py-3 flex flex-col items-center gap-0.5 sm:gap-1"
                            >
                              <div className="text-[8px] sm:text-[9px] text-[#556b2f] opacity-70">
                                {tenGod(result.day.cheongan.hanja, p.cheongan.hanja)}
                              </div>

                              <div
                                className={cn(
                                  "text-xl sm:text-2xl font-bold",
                                  elementClass(hanjaToElement(p.cheongan.hanja))
                                )}
                              >
                                {scriptMode === "hanja"
                                  ? p.cheongan.hanja
                                  : p.cheongan.hangul}
                              </div>

                              <div
                                className={cn(
                                  "text-xl sm:text-2xl font-bold",
                                  elementClass(hanjaToElement(p.jiji.hanja))
                                )}
                              >
                                {scriptMode === "hanja" ? p.jiji.hanja : p.jiji.hangul}
                              </div>

                              <div className="text-[8px] sm:text-[9px] text-[#556b2f] opacity-70">
                                {(() => {
                                  const ms = branchMainStem(p.jiji.hanja);
                                  return ms ? tenGod(result.day.cheongan.hanja, ms) : "";
                                })()}
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>

                    {/* ?댁꽍 蹂닿린 踰꾪듉 */}
                    <div className="mt-3">
                      <button
                        onClick={() => {
                          if (gateStep === "unlocked") {
                            requestInterpretation();
                            return;
                          }
                          setGateStep("needAuth");
                        }}
                        className="w-full py-3 rounded-xl bg-black text-white text-sm font-bold"
                      >
                        {interpLoading ? "?댁꽍 遺덈윭?ㅻ뒗 以?.." : "?댁꽍 蹂닿린"}
                      </button>

                      {interpLoading && (
                        <div className="mt-2 text-[11px] text-[#556b2f] opacity-70 text-center">
                          ?댁꽍 ?앹꽦 以묒씠?? ?좉퉸留?
                        </div>
                      )}
                    </div>

                    {/* ?⑺솕 ?뺣낫 */}
                    {newInterpretation?.metadata?.harmony?.transformations &&
                      newInterpretation.metadata.harmony.transformations.length > 0 && (
                        <div className="mb-2 p-4 bg-gradient-to-br from-orange-50 to-yellow-50 rounded-xl border-2 border-orange-200">
                          <div className="flex items-center gap-2 mb-3">
                            <span className="text-xl">?뵦</span>
                            <h3 className="text-sm font-bold text-orange-900">?⑺솕(?덂뙑) ?뺣낫</h3>
                          </div>

                          <div className="grid grid-cols-2 gap-2">
                            {newInterpretation.metadata.harmony.transformations.map(
                              (trans: any, idx: number) => {
                                const typeIcons: any = {
                                  泥쒓컙?? "?截?,
                                  吏吏?≫빀: "?뙔",
                                  吏吏?쇳빀: "狩?,
                                };
                                const elementColors: any = {
                                  metal: "text-gray-600",
                                  wood: "text-green-600",
                                  water: "text-blue-600",
                                  fire: "text-red-600",
                                  earth: "text-yellow-700",
                                };
                                const labels: any = {
                                  wood: "??,
                                  fire: "??,
                                  earth: "??,
                                  metal: "??,
                                  water: "麗?,
                                };

                                return (
                                  <div
                                    key={idx}
                                    className="bg-white/80 rounded-lg p-3 border border-orange-200"
                                  >
                                    <div className="flex items-center gap-2 mb-1">
                                      <span className="text-base">
                                        {typeIcons[trans.type] || "??}
                                      </span>
                                      <span className="text-xs font-bold text-gray-700">
                                        {trans.type}
                                      </span>
                                    </div>

                                    <div className="text-sm font-semibold text-orange-800 mb-1">
                                      {trans.name}
                                    </div>

                                    <div className="text-xs text-gray-600">
                                      ?꾩튂: {trans.positions?.join(" + ")}
                                    </div>

                                    <div className="flex items-center gap-1 mt-2 text-xs">
                                      <span className="text-gray-500">
                                        {trans.original_elements
                                          ?.map((el: string) => labels[el] ?? el)
                                          .join(" + ")}
                                      </span>
                                      <span className="text-orange-500">??/span>
                                      <span className={`font-bold ${elementColors[trans.result]}`}>
                                        {labels[trans.result] ?? trans.result}
                                      </span>
                                    </div>
                                  </div>
                                );
                              }
                            )}
                          </div>
                        </div>
                      )}

                    <div className="relative">
                      {gateStep === "needAuth" && (
                        <div className="absolute inset-0 z-30 flex items-center justify-center bg-white/85 backdrop-blur-sm rounded-2xl border-4 border-[#adc4af]">
                          <div className="w-[92%] max-w-[360px] bg-white rounded-2xl border-4 border-[#adc4af] shadow-xl p-4 text-center">
                            <div className="text-sm font-bold text-[#556b2f] mb-2">
                              ?댁꽍??蹂대젮硫?移댁뭅??濡쒓렇??+ 梨꾨꼸 異붽?媛 ?꾩슂??
                            </div>

                            <div className="text-[11px] text-[#556b2f] opacity-80 mb-4 whitespace-pre-line">
                              1) 移댁뭅??濡쒓렇??"\n"}2) 梨꾨꼸 移쒓뎄異붽?{"\n"}3) ?댁꽍 ?좉툑 ?댁젣
                            </div>

                            <div className="flex gap-2 justify-center">
                              <button
                                onClick={handleKakaoLogin}
                                className="px-4 py-2 rounded-xl bg-black text-white text-xs font-bold"
                              >
                                移댁뭅??濡쒓렇??
                              </button>
                              <button
                                onClick={handleFollowChannel}
                                className="px-4 py-2 rounded-xl bg-[#fef08a] text-[#556b2f] text-xs font-bold border-2 border-[#eab308]"
                              >
                                梨꾨꼸 異붽?
                              </button>
                            </div>

                            <button
                              onClick={checkChannelRelation}
                              className="mt-3 text-[10px] underline text-[#556b2f] opacity-80"
                            >
                              ?대? 異붽??덉쑝硫??뺤씤?섍린
                            </button>

                            <div className="mt-2 text-[10px] text-[#556b2f] opacity-70">
                              濡쒓렇?? {kakaoTokenOk ? "OK" : "NO"} / 梨꾨꼸: {isChannelAdded ? "OK" : "NO"}
                            </div>
                          </div>
                        </div>
                      )}

                      {/* 5? ?뱀뀡 ?듯빀 ?꾩퐫?붿뼵 */}
                      <div className="space-y-3">
                        {megaOrder.map((k) => {
                          const sec = MEGA_SECTIONS[k];
                          const isOpen = openMega === k;
                          const cards = megaCards[k] || [];

                          return (
                            <div
                              key={k}
                              className="border-4 border-[#adc4af] rounded-2xl bg-white overflow-hidden shadow-none"
                            >
                              <button
                                onClick={() => setOpenMega(isOpen ? null : k)}
                                className="w-full p-3 sm:p-4 flex items-center justify-between hover:bg-[#f0f5f1] transition-colors"
                              >
                                <p className="text-[10px] sm:text-[11px] font-bold text-[#556b2f] flex items-center gap-2">
                                  <span className="text-sm sm:text-base">{sec.icon}</span>
                                  <span>{sec.title}</span>
                                </p>
                                <motion.span
                                  animate={{ rotate: isOpen ? 180 : 0 }}
                                  className="text-[10px] sm:text-xs text-[#556b2f]"
                                >
                                  ??
                                </motion.span>
                              </button>

                              <AnimatePresence>
                                {isOpen && (
                                  <motion.div
                                    initial={{ height: 0, opacity: 0 }}
                                    animate={{ height: "auto", opacity: 1 }}
                                    exit={{ height: 0, opacity: 0 }}
                                    transition={{ duration: 0.25 }}
                                    className="overflow-hidden"
                                  >
                                    <div className="p-4 pt-0 border-t-2 border-[#adc4af] space-y-3">
                                      {cards.map((c) => (
                                        <div
                                          key={c.id}
                                          className={cn(
                                            "rounded-xl border-2 p-3",
                                            c.kind === "ready"
                                              ? "bg-[#f8fafc] border-[#e2e8f0]"
                                              : "bg-[#fefae0] border-[#fde68a]"
                                          )}
                                        >
                                          <div className="flex items-center gap-2 mb-2">
                                            <span className="text-sm">{c.icon || "??}</span>
                                            <div className="text-[11px] font-bold text-[#556b2f]">
                                              {c.title}
                                            </div>
                                            {c.kind === "ready" && (
                                              <span className="ml-auto text-[10px] font-bold text-slate-500">
                                                以鍮꾩쨷
                                              </span>
                                            )}
                                          </div>

                                          <div
                                            className={cn(
                                              "text-[11px] leading-relaxed whitespace-pre-wrap",
                                              c.kind === "ready"
                                                ? "text-slate-500"
                                                : "text-[#556b2f]"
                                            )}
                                          >
                                            {c.kind === "ready"
                                              ? "????ぉ? 怨??낅뜲?댄듃?⑸땲??"
                                              : c.content}
                                          </div>
                                        </div>
                                      ))}
                                    </div>
                                  </motion.div>
                                )}
                              </AnimatePresence>
                            </div>
                          );
                        })}
                      </div>
                    </div>

                    {/* ?ㅼ떆 ?섍린 踰꾪듉 */}
                    <div className="mt-4">
                      <button
                        onClick={() => {
                          setResult(null);
                          setFortuneAnalysis(null);
                          setCharmAnalysis(null);
                          setTalentAnalysis(null);
                          setStrengthAnalysis(null);
                          setRelationsAnalysis(null);
                          setSpecialStarsAnalysis(null);
                          setTodayFortune(null);
                          setNewInterpretation(null);
                          setExpandedSection(null);
                          setShowFortune(false);
                          setShowCharm(false);
                          setShowTalent(false);
                          setShowStrength(false);
                          setShowRelations(false);
                          setShowSpecialStars(false);
                          setShowToday(false);
                          setBirthYmd("");
                          setBirthHm("");
                          setTimeUnknown(false);
                          setLoading(false);
                          setErr("");
                          setShowHarmonyAfter(false);
                        }}
                        className="w-full py-2 sm:py-3 border-2 border-[#ffb3b3] rounded-xl text-[10px] sm:text-[11px] font-bold text-[#ff4d4d] hover:bg-[#fff5f5] transition-colors flex items-center justify-center gap-1 sm:gap-2"
                      >
                        <span className="text-xs sm:text-sm">?봽</span>
                        <span>?ㅼ떆 ?섍린</span>
                      </button>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}


----- FILE: frontend\app\layout.tsx -----
import type { Metadata } from "next";
import "./globals.css";

export const metadata: Metadata = {
  title: "?ъ＜ ?꾨줈?앺듃",
  description: "?ㅼ삤?κ렐紐??고듃 ?곸슜",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ko">
      {/* ?ш린??bg-transparent瑜?異붽??댁꽌 globals.css??諛곌꼍??蹂댁씠寃??⑸땲??*/}
      <body className="antialiased bg-transparent">
        {children}
      </body>
    </html>
  );
}

----- FILE: frontend\data\charmAnalysis.ts -----
// frontend/data/charmAnalysis.ts

export const CHARM_ANALYSIS = {
  empathy: {
    title: "?⑤뱾? 紐?媛吏??뱀떊留뚯쓽 ?낅낫???꾩슦??,
    icon: "?뮇",
  },
  reality: {
    title: "??몄뿉寃?誘몄튂???곹뼢??諛?留ㅻ젰 ?먮꼫吏 吏??,
    icon: "?뱤",
  },
  fun: {
    title: "媛留뚰엳 ?덉뼱???щ엺?ㅼ씠 ?덊븳??苑귦엳??吏꾩쭨 ?댁쑀",
    icon: "??,
  },
};

// ?쇱＜蹂?留ㅻ젰 遺꾩꽍 (60媛묒옄)
export const CHARM_BY_PILLAR: Record<string, {
  empathy: string;
  reality: string;
  fun: string;
}> = {
  // ??(媛묐ぉ)
  "?꿨춴": {
    empathy: "?쒖닔???댁젙???щ엺?ㅼ쓽 留덉쓬???吏곸엯?덈떎. ?뱀떊??吏꾩떖 ?대┛ 紐⑥뒿??媛????留ㅻ젰?댁뿉??",
    reality: "由щ뜑??吏??85%. ?덈줈??寃껋쓣 ?쒖옉?섎뒗 媛쒖쿃?먯쟻 留ㅻ젰?쇰줈 二쇰ぉ諛쏆뒿?덈떎.",
    fun: "?ㅺ? 萸붽? ?쒖옉?섎㈃ ?щ엺?ㅼ씠 ?곕씪?ㅻ뜑?? 洹멸쾶 諛붾줈 ???怨좊궃 由щ뜑 ?ъ뒪??",
  },
  "?꿨칲": {
    empathy: "?뺤쭅?섍퀬 怨㏃? ?깊뭹???좊ː瑜?留뚮벊?덈떎. ?붾뱾由??녿뒗 ?뱀떊??紐⑥뒿??留ㅻ젰?곸씠?먯슂.",
    reality: "?좊ː??吏??92%. ?쇨??깃낵 梨낆엫媛먯쑝濡?議닿꼍諛쏅뒗 由щ뜑??留ㅻ젰.",
    fun: "??吏꾩쭨 ?묐컮濡??щ뒗 嫄??ㅻ뱾 ?뚯븘! 洹몃옒???щ엺?ㅼ씠 ??誘용뒗 嫄곗빞!",
  },
  "?꿱쒼": {
    empathy: "?앸챸???섏튂???먮꼫吏媛 二쇰???諛앷쾶 留뚮벊?덈떎. 湲띿젙?곸씤 遺꾩쐞湲곌? 留ㅻ젰?댁뿉??",
    reality: "?쒕젰 吏??88%. 蹂?붾? 利먭린怨??곸쓳?μ씠 ?곗뼱??留ㅻ젰.",
    fun: "???놁뿉 ?덉쑝硫?湲곕텇 醫뗭븘?? 洹?諛앹? ?먮꼫吏媛 ??臾닿린??",
  },
  "?꿨뜄": {
    empathy: "?④굅???댁젙?쇰줈 ?щ엺?ㅼ뿉寃??숆린瑜?遺?ы빀?덈떎. ?뱀떊???먮꼫吏媛 ?꾩뿼?쇱슂.",
    reality: "異붿쭊??吏??94%. ?댁젙??移대━?ㅻ쭏濡?媛뺥븳 ?몄긽???④퉩?덈떎.",
    fun: "???댁젙 ?꾩쟾 遺덈뜦?대━! ?щ엺?ㅼ씠 ??蹂대㈃ ?섏씠 ?섎뜑??",
  },
  "?꿰뵵": {
    empathy: "?좎뭅濡쒖슫 ?듭같?μ쑝濡?臾몄젣瑜??닿껐?⑸땲?? 吏?곸씤 留ㅻ젰???뗫낫?ъ슂.",
    reality: "遺꾩꽍??吏??90%. ?쇰━???ш퀬? ?먮떒?μ쑝濡??좊ː瑜??살뒿?덈떎.",
    fun: "??癒몃━ 吏꾩쭨 醫뗫떎! 蹂듭옟??嫄??덊븳??臾쇱뼱蹂대㈃ ???닿껐??二쇱옏??",
  },
  "?꿩닃": {
    empathy: "?곕쑜?섍쾶 蹂댁궡?쇰뒗 留덉쓬???щ엺?ㅼ쓣 ?뚯뼱?밴퉩?덈떎. ?ш렐??留ㅻ젰???덉뼱??",
    reality: "蹂댄샇蹂몃뒫 吏??87%. 諛곕젮?ш낵 梨낆엫媛먯쑝濡??덉젙媛먯쓣 以띾땲??",
    fun: "???놁뿉 ?덉쑝硫??좊뱺?? 洹??곕쑜??留덉쓬?④? ??留ㅻ젰?댁빞!",
  },

  // 阿?(?꾨ぉ)
  "阿쇾툚": {
    empathy: "???섏?留?源딆? ?뱀떊??留ㅻ젰? ?쒓컙??吏?좎닔濡???鍮쏅궔?덈떎.",
    reality: "吏?띿꽦 留ㅻ젰 吏??90%. 議곗슜?섏?留?袁몄???議댁옱媛먯쑝濡??좊ː瑜??살뒿?덈떎.",
    fun: "泥섏쓬??醫 議곗슜???? 洹쇰뜲 ?쒓컙 吏?좎닔濡??ㅺ? ?쒖씪 誘우쓬吏곸뒪?쎈떎??嫄??ㅻ뱾 ?덈?.",
  },
  "阿쇿뜱": {
    empathy: "?곗븘?섍퀬 ?몃젴??媛먭컖???щ엺?ㅼ쓽 ?덇만???щ줈?≪뒿?덈떎.",
    reality: "?щ???吏??93%. ?덉닠??媛먭컖?쇰줈 ?낇듅??留ㅻ젰??諛쒖궛?⑸땲??",
    fun: "???쇱뒪 ?덈떎???뚮━ 留롮씠 ?ｌ?? 洹멸쾶 ?????怨좊궃 留ㅻ젰?댁빞!",
  },
  "阿쇿럼": {
    empathy: "遺?쒕윭?곕㈃?쒕룄 媛뺣젹??議댁옱媛먯쓣 吏?붿뒿?덈떎. 移대━?ㅻ쭏媛 ?덉뼱??",
    reality: "移대━?ㅻ쭏 吏??89%. ???섏?留?媛뺥븳 ?몄긽???④퉩?덈떎.",
    fun: "寃됱쑝濡?遺?쒕윭?대뜲 ?띿? 媛뺥빐! 洹?諛섏쟾 留ㅻ젰???щ엺?ㅼ씠 ?由곕?!",
  },
  "阿숁쑋": {
    empathy: "?ъ슜?????뱀떊??留덉쓬???щ엺?ㅼ쓣 ?몄븞?섍쾶 留뚮벊?덈떎.",
    reality: "怨듦컧?λ젰 吏??91%. 諛곕젮?ъ쑝濡?二쇰????먮쭅??以띾땲??",
    fun: "?덈옉 ?덉쑝硫?留덉쓬???명빐?? 洹??ш렐??遺꾩쐞湲곌? ??臾닿린??",
  },
  "阿숅뀎": {
    empathy: "?ъ꽭?섍퀬 ?꾨꼍??異붽뎄?섎뒗 紐⑥뒿???곗븘??留ㅻ젰??留뚮벊?덈떎.",
    reality: "?꾨꼍二쇱쓽 吏??92%. ?뷀뀒?쇱뿉 媛뺥븯怨??몃젴??留ㅻ젰.",
    fun: "???꾨꼍二쇱쓽?먯?? 洹?瑗쇨세???뚮Ц???щ엺?ㅼ씠 ???좊ː??",
  },
  "阿쇾벤": {
    empathy: "遺?쒕읇怨??좎뿰???깊뭹???щ엺?ㅼ뿉寃??꾨줈媛 ?⑸땲??",
    reality: "?곸쓳??吏??88%. ?좎뿰???ш퀬濡??대뵒?쒕굹 ?섏쁺諛쏆뒿?덈떎.",
    fun: "??臾쇱쿂???좎뿰?? ?대뵒 媛?????댁슱由щ뒗 寃???留ㅻ젰?댁빞!",
  },

  // 訝?(蹂묓솕)
  "訝쇿춴": {
    empathy: "諛앷퀬 湲띿젙?곸씤 ?먮꼫吏媛 二쇰????곕쑜?섍쾶 留뚮벊?덈떎.",
    reality: "湲띿젙 ?먮꼫吏 吏??90%. ?щ쭩??二쇰뒗 諛앹? 留ㅻ젰.",
    fun: "?ㅺ? ?껋쑝硫?二쇰?????諛앹븘?? 洹??뉗궡 媛숈? 留ㅻ젰 理쒓퀬??",
  },
  "訝쇿칲": {
    empathy: "媛뺣젹??移대━?ㅻ쭏濡??щ엺?ㅼ쓣 ?대걬?덈떎. ?怨좊궃 由щ뜑?덉슂.",
    reality: "由щ뜑??吏??96%. 媛뺥븳 異붿쭊?κ낵 移대━?ㅻ쭏濡?二쇰ぉ諛쏆뒿?덈떎.",
    fun: "???꾩쟾 蹂댁뒪 ?먮굦! ?щ엺?ㅼ씠 ?먯뿰?ㅻ읇寃????곕Ⅴ?붾씪!",
  },
  "訝숃쒼": {
    empathy: "?ш탳?깆씠 醫뗭븘 ?꾧뎄????쎄쾶 移쒗빐吏묐땲?? 移쒓렐??留ㅻ젰???덉뼱??",
    reality: "移쒗솕??吏??94%. ?ш탳??留ㅻ젰?쇰줈 ??꼻? ?몃㎘???뺤꽦?⑸땲??",
    fun: "???대뵒 媛??移쒓뎄 留롮?? 洹?移쒓렐??留ㅻ젰????臾닿린??",
  },
  "訝쇿뜄": {
    empathy: "?먯떊媛??섏튂???밸떦?⑥씠 留ㅻ젰?곸엯?덈떎. 鍮쏅굹??議댁옱媛먯씠 ?덉뼱??",
    reality: "?먯떊媛?吏??98%. ?뺣룄??議댁옱媛먯쑝濡?媛뺥븳 ?몄긽???④퉩?덈떎.",
    fun: "???먯떊媛??꾩쟾 ?앸궡以? 洹??밸떦?⑥뿉 ?щ엺?ㅼ씠 ?由곕?!",
  },
  "訝숂뵵": {
    empathy: "?깆닕?섍퀬 源딆씠 ?덈뒗 留ㅻ젰???щ엺?ㅼ쓣 ?뚯뼱?밴퉩?덈떎.",
    reality: "?듭같??吏??91%. 寃쏀뿕?먯꽌 ?곕윭?섏삤???깆닕??留ㅻ젰.",
    fun: "???섏씠蹂대떎 ?깆닕??蹂댁뿬! 洹?源딆씠媛 ??留ㅻ젰?댁빞!",
  },
  "訝숁닃": {
    empathy: "?곕쑜?섍퀬 誘우쓬吏곹븳 紐⑥뒿???щ엺?ㅼ뿉寃??덉젙媛먯쓣 以띾땲??",
    reality: "?좊ː??吏??93%. 梨낆엫媛??덈뒗 ?쒕룄濡?議닿꼍諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 ?좊뱺?? ?щ엺?ㅼ씠 ???섏??섎뒗 ?댁쑀??",
  },

  // 訝?(?뺥솕)
  "訝곦툚": {
    empathy: "???섏?留??곕쑜??鍮쏆쓣 諛쒗빀?덈떎. ?ъ꽭??諛곕젮媛 留ㅻ젰?댁뿉??",
    reality: "?ъ꽭??吏??89%. ?몄떖??諛곕젮濡??щ엺?ㅼ뿉寃??꾩븞??以띾땲??",
    fun: "??????留ㅻ젰 吏꾩쭨 醫뗭븘! 議곗슜?섏?留??곕쑜??寃???臾닿린??",
  },
  "訝곩뜱": {
    empathy: "媛먯꽦???띾????덉닠??留ㅻ젰???뗫낫?낅땲?? ?꾨쫫?ㅼ????먮겮???λ젰???덉뼱??",
    reality: "媛먯닔??吏??94%. ?덉닠??媛먭컖?쇰줈 ?낇듅??留ㅻ젰??諛쒖궛?⑸땲??",
    fun: "??媛먯꽦 異⑸쭔! 洹??ъ꽭?⑥뿉 ?щ엺?ㅼ씠 諛섑븯?붾씪!",
  },
  "訝곩럼": {
    empathy: "?좊퉬濡?퀬 留ㅽ샊?곸씤 遺꾩쐞湲곕? ?띻퉩?덈떎. ?낇듅??媛쒖꽦??留ㅻ젰?댁뿉??",
    reality: "媛쒖꽦 吏??95%. ?낆갹???ㅽ??쇰줈 媛뺥븳 ?몄긽???④퉩?덈떎.",
    fun: "?덈쭔???낇듅??遺꾩쐞湲??덉옏?? 洹멸쾶 ???쒓렇?덉쿂??",
  },
  "訝곫쑋": {
    empathy: "?⑦솕?섍퀬 ?몃궡???덈뒗 紐⑥뒿???щ엺?ㅼ뿉寃??몄븞?⑥쓣 以띾땲??",
    reality: "?몃궡??吏??90%. 袁몄??④낵 ?깆떎?⑥쑝濡??좊ː瑜??살뒿?덈떎.",
    fun: "??吏꾩쭨 ?덇린 ?덉뼱! 洹?袁몄??⑥씠 ??留ㅻ젰?댁빞!",
  },
  "訝곲뀎": {
    empathy: "?곗븘?섍퀬 ?덉쐞 ?덈뒗 留ㅻ젰???뗫낫?낅땲?? ?몃젴??媛먭컖???덉뼱??",
    reality: "?덇꺽 吏??93%. ?몃젴?섍퀬 ?곗븘??留ㅻ젰?쇰줈 議닿꼍諛쏆뒿?덈떎.",
    fun: "???덉쐞 ?덈떎???뚮━ 留롮씠 ?ｌ?? 洹??곗븘?⑥씠 ??臾닿린??",
  },
  "訝곦벤": {
    empathy: "?곕쑜??留덉쓬?쇰줈 ?щ엺?ㅼ뿉寃????꾨줈瑜?以띾땲?? 怨듦컧 ?λ젰???곗뼱?섏슂.",
    reality: "怨듦컧?λ젰 吏??96%. 媛먯젙 ?댄빐?μ씠 ?믪븘 ?щ엺?ㅼ뿉寃??먮쭅??以띾땲??",
    fun: "??吏꾩쭨 ?곕쑜?? ?щ엺?ㅼ씠 ?덊븳???꾨줈諛쏆쑝???ㅻ뜑??",
  },

  // ??(臾댄넗)
  "?듿춴": {
    empathy: "?좊뱺?섍퀬 ?덉젙?곸씤 紐⑥뒿???좊ː瑜?留뚮벊?덈떎.",
    reality: "?덉젙??吏??91%. 誘우쓬吏곹븳 ?쒕룄濡??좊ː瑜??살뒿?덈떎.",
    fun: "???놁뿉 ?덉쑝硫??좊뱺?? 洹??덉젙媛먯씠 ??留ㅻ젰?댁빞!",
  },
  "?듿칲": {
    empathy: "?ъ슜?μ씠 ?ш퀬 愿???留덉쓬?④? ?щ엺?ㅼ쓣 ?뚯뼱?밴퉩?덈떎.",
    reality: "?ъ슜??吏??92%. ?볦? ?꾨웾?쇰줈 ?щ엺?ㅼ쓣 ?덉뒿?덈떎.",
    fun: "??留덉쓬 吏꾩쭨 ?볦뼱! 洹??ъ슜?μ뿉 ?щ엺?ㅼ씠 紐⑥씠?붾씪!",
  },
  "?딂쒼": {
    empathy: "?낆옣?섍퀬 移대━?ㅻ쭏 ?덈뒗 議댁옱媛먯씠 ?щ엺?ㅼ쓣 ?뺣룄?⑸땲??",
    reality: "移대━?ㅻ쭏 吏??95%. 媛뺥븳 由щ뜑??쑝濡?議닿꼍諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 蹂댁뒪 ?먮굦! 洹?移대━?ㅻ쭏???щ엺?ㅼ씠 ?由곕?!",
  },
  "?듿뜄": {
    empathy: "?댁젙?곸씠怨??먮꼫吏 ?섏튂??紐⑥뒿??留ㅻ젰?곸엯?덈떎.",
    reality: "?댁젙 吏??93%. ?쒕컻???먮꼫吏濡?二쇰???諛앷쾶 留뚮벊?덈떎.",
    fun: "???먮꼫吏 ?꾩쟾 遺덊?! 洹??댁젙????臾닿린??",
  },
  "?딁뵵": {
    empathy: "?붾뱾由ъ? ?딅뒗 ?좊뀗???щ엺?ㅼ뿉寃??좊ː瑜?以띾땲??",
    reality: "?좊뀗 吏??94%. ?먯튃怨??뚯떊?쇰줈 議닿꼍諛쏆뒿?덈떎.",
    fun: "???좊뀗 ?뺢퀬?? 洹??앹떖????留ㅻ젰?댁빞!",
  },
  "?딀닃": {
    empathy: "踰좏?湲?醫뗭븘?섎뒗 ?됰꼮??留덉쓬?④? ?щ엺?ㅼ쓣 媛먮룞?쒗궢?덈떎.",
    reality: "愿???吏??91%. ?덇렇?ъ슫 ?깊뭹?쇰줈 ?щ옉諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 ?됰꼮?? 洹??꾪븳 留덉쓬?④? ??臾닿린??",
  },

  // 藥?(湲고넗)
  "藥긴툚": {
    empathy: "?깆떎?섍퀬 ?덇린 ?덈뒗 紐⑥뒿???좊ː瑜?留뚮벊?덈떎.",
    reality: "?깆떎??吏??92%. 袁몄??⑥쑝濡??좊ː瑜??살뒿?덈떎.",
    fun: "??吏꾩쭨 ?깆떎?? 洹??덇린媛 ??留ㅻ젰?댁빞!",
  },
  "藥긷뜱": {
    empathy: "?ъ꽭?섍퀬 諛곕젮??源딆? 留덉쓬?④? ?щ엺?ㅼ쓣 ?몄븞?섍쾶 留뚮벊?덈떎.",
    reality: "諛곕젮??吏??93%. ?몄떖??諛곕젮濡??멸컧???살뒿?덈떎.",
    fun: "??吏꾩쭨 諛곕젮 源딆뼱! 洹?留덉쓬?⑥뿉 ?щ엺?ㅼ씠 諛섑븯?붾씪!",
  },
  "藥긷럼": {
    empathy: "?⑦솕?섍퀬 ?몃궡???덈뒗 紐⑥뒿???덉젙媛먯쓣 以띾땲??",
    reality: "?몃궡??吏??90%. 李⑤텇?⑥쑝濡??좊ː瑜??살뒿?덈떎.",
    fun: "??吏꾩쭨 李⑤텇?? 洹??ъ쑀媛 ??留ㅻ젰?댁빞!",
  },
  "藥길쑋": {
    empathy: "?덇렇?쎄퀬 ?ъ슜???덈뒗 留덉쓬?④? ?щ엺?ㅼ쓣 ?뚯뼱?밴퉩?덈떎.",
    reality: "?ъ슜??吏??91%. ?볦? 留덉쓬?쇰줈 ?щ엺?ㅼ쓣 ?덉뒿?덈떎.",
    fun: "??留덉쓬 吏꾩쭨 ?볦뼱! 洹??덇렇?ъ?????臾닿린??",
  },
  "藥깁뀎": {
    empathy: "?ㅼ슜?곸씠怨??꾩떎?곸씤 ?쒕룄媛 誘우쓬吏곹빀?덈떎.",
    reality: "?ㅼ슜??吏??89%. ?꾩떎媛먭컖?쇰줈 ?좊ː瑜??살뒿?덈떎.",
    fun: "???꾩떎?곸씠?? 洹??ㅼ슜?깆씠 ??留ㅻ젰?댁빞!",
  },
  "藥긴벤": {
    empathy: "?щ젮 源딄퀬 ?좎쨷??紐⑥뒿???좊ː瑜?留뚮벊?덈떎.",
    reality: "?좎쨷??吏??90%. 源딆씠 ?덈뒗 ?ш퀬濡?議닿꼍諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 ?좎쨷?? 洹??щ젮 源딆쓬????臾닿린??",
  },

  // 佯?(寃쎄툑)
  "佯싧춴": {
    empathy: "?됱쿋?섍퀬 遺꾩꽍?곸씤 ?ш퀬媛 ?좊ː瑜?留뚮벊?덈떎.",
    reality: "遺꾩꽍??吏??94%. ?좎뭅濡쒖슫 ?먮떒?μ쑝濡??좊ː瑜??살뒿?덈떎.",
    fun: "??癒몃━ 吏꾩쭨 醫뗭븘! 洹??됱쿋?⑥씠 ??留ㅻ젰?댁빞!",
  },
  "佯싧칲": {
    empathy: "寃곕떒???덇퀬 怨쇨컧??紐⑥뒿??移대━?ㅻ쭏瑜?留뚮벊?덈떎.",
    reality: "寃곕떒??吏??95%. 鍮좊Ⅸ ?섏궗寃곗젙?쇰줈 二쇰ぉ諛쏆뒿?덈떎.",
    fun: "??寃곗젙???꾩쟾 ?앸궡以? 洹?怨쇨컧?⑥씠 ??臾닿린??",
  },
  "佯싪쒼": {
    empathy: "?좎옱?μ씠 ?ш퀬 諛쒖쟾 媛?μ꽦???믪뒿?덈떎.",
    reality: "?좎옱??吏??88%. ?④꺼吏??λ젰??泥쒖쿇???쒕윭?⑸땲??",
    fun: "???⑥? ?λ젰 留롮븘! 洹멸쾶 泥쒖쿇??鍮쏅궇 嫄곗빞!",
  },
  "佯싧뜄": {
    empathy: "媛뺤씤???섏??μ쑝濡?紐⑺몴瑜??ъ꽦?⑸땲??",
    reality: "?섏???吏??96%. 媛뺥븳 異붿쭊?μ쑝濡?議닿꼍諛쏆뒿?덈떎.",
    fun: "???섏? ?꾩쟾 媛뺤쿋! 洹??덇린媛 ??臾닿린??",
  },
  "佯싩뵵": {
    empathy: "?꾨꼍??異붽뎄?섎뒗 紐⑥뒿???몃젴??留ㅻ젰??留뚮벊?덈떎.",
    reality: "?꾨꼍二쇱쓽 吏??97%. ?곗뼱???깃낵濡?二쇰ぉ諛쏆뒿?덈떎.",
    fun: "???꾨꼍二쇱쓽?먯?? 洹?瑗쇨세?⑥씠 ??留ㅻ젰?댁빞!",
  },
  "佯싨닃": {
    empathy: "?댁떎 ?덇퀬 源딆씠 ?덈뒗 紐⑥뒿???좊ː瑜?留뚮벊?덈떎.",
    reality: "?댁떎 吏??90%. 寃됰낫???띿씠 ?⑤떒??議닿꼍諛쏆뒿?덈떎.",
    fun: "??寃됰낫???띿씠 ???⑤떒?? 洹??댁떎????臾닿린??",
  },

  // 渦?(?좉툑)
  "渦쎽툚": {
    empathy: "?ъ꽭?섍퀬 怨좉???留ㅻ젰???뗫낫?낅땲??",
    reality: "怨좉???吏??92%. ?곗븘??留ㅻ젰?쇰줈 二쇰ぉ諛쏆뒿?덈떎.",
    fun: "??怨좉???蹂댁뿬! 洹??곗븘?⑥씠 ??留ㅻ젰?댁빞!",
  },
  "渦쎾뜱": {
    empathy: "?덉닠??媛먭컖???곗뼱?섍퀬 ?몃젴?섏뿀?듬땲??",
    reality: "?덉닠??吏??94%. ?몃젴??媛먭컖?쇰줈 ?멸컧???살뒿?덈떎.",
    fun: "???쇱뒪 ?덈떎???뚮━ 留롮씠 ?ｌ?? 洹멸쾶 ??留ㅻ젰?댁빞!",
  },
  "渦쎾럼": {
    empathy: "?붾젮?섍퀬 移대━?ㅻ쭏 ?덈뒗 留ㅻ젰???뗫낫?낅땲??",
    reality: "移대━?ㅻ쭏 吏??93%. 媛뺣젹???몄긽?쇰줈 二쇰ぉ諛쏆뒿?덈떎.",
    fun: "???붾젮?? 洹??덉뿉 ?꾨뒗 留ㅻ젰????臾닿린??",
  },
  "渦쎿쑋": {
    empathy: "源붾걫?섍퀬 ?뺣룉??紐⑥뒿???멸컧??以띾땲??",
    reality: "?뺣━??吏??89%. 源붾걫???ㅽ??쇰줈 ?좊ː瑜??살뒿?덈떎.",
    fun: "??吏꾩쭨 源붾걫?? 洹?源⑤걮?⑥씠 ??留ㅻ젰?댁빞!",
  },
  "渦쏃뀎": {
    empathy: "?꾨꼍?섍쾶 鍮쏅굹??留ㅻ젰???щ엺?ㅼ쓣 ?щ줈?≪뒿?덈떎.",
    reality: "?꾨꼍??吏??98%. ?곗뼱???щ??덉쑝濡?議닿꼍諛쏆뒿?덈떎.",
    fun: "???꾨꼍?? 洹??덈???留ㅻ젰????臾닿린??",
  },
  "渦쎽벤": {
    empathy: "?쒖닔?섍퀬 源⑤걮??留덉쓬?④? ?щ엺?ㅼ쓣 媛먮룞?쒗궢?덈떎.",
    reality: "?쒖닔??吏??95%. 留묒? 留덉쓬?쇰줈 ?щ옉諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 ?쒖닔?? 洹?留묒쓬????留ㅻ젰?댁빞!",
  },

  // 鶯?(?꾩닔)
  "鶯у춴": {
    empathy: "源딄퀬 ?볦? ?ъ슜?μ씠 ?щ엺?ㅼ쓣 ?뚯뼱?밴퉩?덈떎.",
    reality: "?ъ슜??吏??94%. ?볦? ?꾨웾?쇰줈 議닿꼍諛쏆뒿?덈떎.",
    fun: "???ъ슜???꾩쟾 諛붾떎湲? 洹??볦? 留덉쓬????臾닿린??",
  },
  "鶯у칲": {
    empathy: "?앸룞媛??섏튂???먮꼫吏媛 二쇰???諛앷쾶 留뚮벊?덈떎.",
    reality: "?쒕젰 吏??91%. ?쒕컻???먮꼫吏濡??멸컧???살뒿?덈떎.",
    fun: "???먮꼫吏 ?섏퀜! 洹??앷린媛 ??留ㅻ젰?댁빞!",
  },
  "鶯ц쒼": {
    empathy: "??룞?곸씠怨??ㅼ?????留ㅻ젰???뗫낫?낅땲??",
    reality: "?ㅼ???吏??96%. ??洹몃┝??洹몃━???λ젰?쇰줈 二쇰ぉ諛쏆뒿?덈떎.",
    fun: "???ㅼ????꾩쟾 ?щ떎! 洹???洹몃┝????臾닿린??",
  },
  "鶯у뜄": {
    empathy: "?쒖썝?쒖썝?섍퀬 ?명깢???깃꺽??留ㅻ젰?곸엯?덈떎.",
    reality: "?명깢??吏??93%. ?쒖썝???깃꺽?쇰줈 ?멸린媛 留롮뒿?덈떎.",
    fun: "??吏꾩쭨 ?쒖썝?? 洹??명깢?⑥씠 ??留ㅻ젰?댁빞!",
  },
  "鶯х뵵": {
    empathy: "源딆? ?듭같?μ쑝濡??щ엺?ㅼ뿉寃?吏?쒕? 以띾땲??",
    reality: "吏??吏??95%. ?듭같?μ쑝濡?議닿꼍諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 吏?쒕줈?? 洹?源딆씠媛 ??臾닿린??",
  },
  "鶯ф닃": {
    empathy: "李⑤텇?섍퀬 ?덉젙?곸씤 紐⑥뒿???좊ː瑜?留뚮벊?덈떎.",
    reality: "?덉젙??吏??90%. 李⑤텇?⑥쑝濡??좊ː瑜??살뒿?덈떎.",
    fun: "??吏꾩쭨 ?덉젙?곸씠?? 洹?李⑤텇?⑥씠 ??留ㅻ젰?댁빞!",
  },

  // ??(怨꾩닔)
  "?멧툚": {
    empathy: "留묎퀬 泥?닚??留ㅻ젰???щ엺?ㅼ쓣 ?щ줈?≪뒿?덈떎.",
    reality: "泥?닚??吏??94%. 留묒? ?대?吏濡??щ옉諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 留묒븘! 洹?泥?닚?⑥씠 ??留ㅻ젰?댁빞!",
  },
  "?멨뜱": {
    empathy: "遺?쒕읇怨??ъ꽭??諛곕젮媛 ?щ엺?ㅼ쓣 媛먮룞?쒗궢?덈떎.",
    reality: "?ъ꽭??吏??93%. ?몄떖??諛곕젮濡??멸컧???살뒿?덈떎.",
    fun: "??吏꾩쭨 ?ъ꽭?? 洹?諛곕젮?ъ씠 ??臾닿린??",
  },
  "?멨럼": {
    empathy: "?좊퉬濡?퀬 留ㅽ샊?곸씤 遺꾩쐞湲곌? ?щ엺?ㅼ쓣 ?뚯뼱?밴퉩?덈떎.",
    reality: "留ㅻ젰 吏??95%. ?좊퉬濡쒖슫 留ㅻ젰?쇰줈 二쇰ぉ諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 ?좊퉬濡쒖썙! 洹?留ㅽ샊?곸씤 留ㅻ젰????臾닿린??",
  },
  "?멩쑋": {
    empathy: "議곗슜?섏?留?源딆? ?대㈃???щ엺?ㅼ뿉寃??몃┝??以띾땲??",
    reality: "源딆씠 吏??91%. ?대㈃??源딆씠濡?議닿꼍諛쏆뒿?덈떎.",
    fun: "??議곗슜?섏?留?源딆뼱! 洹??대㈃????留ㅻ젰?댁빞!",
  },
  "?면뀎": {
    empathy: "留묎퀬 泥?웾??留ㅻ젰???щ엺?ㅼ쓣 ?곸풄?섍쾶 留뚮벊?덈떎.",
    reality: "泥?웾??吏??92%. ?쒖썝???대?吏濡??멸컧???살뒿?덈떎.",
    fun: "??吏꾩쭨 泥?웾?? 洹??쒖썝?⑥씠 ??留ㅻ젰?댁빞!",
  },
  "?멧벤": {
    empathy: "源딆씠 ?덇퀬 吏꾩???紐⑥뒿???좊ː瑜?留뚮벊?덈떎.",
    reality: "吏꾩쨷??吏??93%. 源딆씠 ?덈뒗 ?깊뭹?쇰줈 議닿꼍諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 吏꾩??? 洹?源딆씠媛 ??臾닿린??",
  },
};

// ??꽦蹂?留ㅻ젰 ?ъ씤??
export const CHARM_BY_TEN_GOD: Record<string, {
  empathy: string;
  reality: string;
  fun: string;
}> = {
  "?앹떊": {
    empathy: "?쒗쁽?μ씠 ?곗뼱???щ엺?ㅼ뿉寃?利먭굅????좎궗?⑸땲?? 李쎌쓽?곸씤 留ㅻ젰???덉뼱??",
    reality: "李쎌쓽??吏??88%. ?덉닠??媛먭컖?쇰줈 ?멸컧?꾨? ?믪엯?덈떎.",
    fun: "?ㅺ? 留먰븯硫??щ엺?ㅼ씠 ?껋뼱! 洹멸쾶 ?щ뒫?댁빞! ?怨좊궃 ?뷀꽣?뚯씠??",
  },
  "?곴?": {
    empathy: "?낇듅??媛쒖꽦???щ엺?ㅼ쓽 ?쒖꽑???щ줈?≪뒿?덈떎. ?밸퀎??留ㅻ젰???덉뼱??",
    reality: "李⑤퀎??留ㅻ젰 吏??92%. ?낆갹???ш퀬濡?媛뺣젹???몄긽???④퉩?덈떎.",
    fun: "?⑤뱾?대옉 ?묎컳? 嫄??レ뼱?섏?? 洹??먮뵳??留ㅻ젰????臾닿린??",
  },
  "?뺤옱": {
    empathy: "?덉젙?곸씠怨?誘우쓬吏곹븳 紐⑥뒿???щ엺?ㅼ뿉寃??덉젙媛먯쓣 以띾땲??",
    reality: "?좊ː??吏??94%. 怨꾪쉷?곸씠怨?梨낆엫媛??덈뒗 ?쒕룄濡?議닿꼍諛쏆뒿?덈떎.",
    fun: "???놁뿉 ?덉쑝硫??좊뱺?? 洹몃옒???щ엺?ㅼ씠 ??二쇰???紐⑥씠??嫄곗빞!",
  },
  "?몄옱": {
    empathy: "?쒕컻?섍퀬 ?ш탳?곸씤 紐⑥뒿???щ엺?ㅼ쓣 ?뚯뼱?밴퉩?덈떎.",
    reality: "?ш탳??吏??91%. ??꼻? ?몃㎘?쇰줈 湲고쉶瑜?留뚮벊?덈떎.",
    fun: "???대뵒 媛??移쒓뎄 留롮?? 洹?移쒓렐?⑥씠 ??留ㅻ젰?댁빞!",
  },
  "?뺢?": {
    empathy: "?먯튃??吏?ㅻ뒗 紐⑥뒿???щ엺?ㅼ뿉寃??좊ː瑜?以띾땲??",
    reality: "?먯튃??吏??93%. 梨낆엫媛먭낵 ?좊ː?꾨줈 議닿꼍諛쏆뒿?덈떎.",
    fun: "??吏꾩쭨 ?먯튃?곸씠?? 洹?誘우쓬吏곹븿????臾닿린??",
  },
  "?멸?": {
    empathy: "移대━?ㅻ쭏 ?덈뒗 由щ뜑??쑝濡??щ엺?ㅼ쓣 ?대걬?덈떎.",
    reality: "由щ뜑??吏??96%. 媛뺥븳 移대━?ㅻ쭏濡?二쇰ぉ諛쏆뒿?덈떎.",
    fun: "???꾩쟾 蹂댁뒪 ?먮굦! ?щ엺?ㅼ씠 ?먯뿰?ㅻ읇寃????곕Ⅴ?붾씪!",
  },
  "?뺤씤": {
    empathy: "吏?쒕∼怨?媛瑜댁묠??二쇰뒗 紐⑥뒿???щ엺?ㅼ뿉寃?議닿꼍諛쏆뒿?덈떎.",
    reality: "吏??吏??94%. ?숈뒿 ?λ젰怨??꾨Ц?깆쑝濡??좊ː瑜??살뒿?덈떎.",
    fun: "??吏꾩쭨 ?묐삊?? 洹?吏?앹뿉 ?щ엺?ㅼ씠 媛먰깂?섎뜑??",
  },
  "?몄씤": {
    empathy: "泥좏븰?곸씠怨?源딆? ?ш퀬媛 ?щ엺?ㅼ뿉寃??듭같??以띾땲??",
    reality: "?듭같??吏??90%. ?낇듅???쒓컖?쇰줈 二쇰ぉ諛쏆뒿?덈떎.",
    fun: "???앷컖??源딆뼱! 洹?泥좏븰????留ㅻ젰?댁빞!",
  },
  "鍮꾧껄": {
    empathy: "?낅┰?곸씠怨??먭린二쇱옣???쒕졆??紐⑥뒿??留ㅻ젰?곸엯?덈떎.",
    reality: "?먮┰??吏??88%. ?낅┰???쒕룄濡?議댁쨷諛쏆뒿?덈떎.",
    fun: "???쇱옄?쒕룄 ?섑빐! 洹??낅┰?깆씠 ??臾닿린??",
  },
  "寃곸옱": {
    empathy: "寃쎌웳?ъ씠 媛뺥븯怨??밸??뺤씠 ?덈뒗 紐⑥뒿??移대━?ㅻ쭏瑜?留뚮벊?덈떎.",
    reality: "寃쎌웳??吏??93%. ?밸??뺤쑝濡??깃낵瑜??낅땲??",
    fun: "??寃쎌웳???щ컡吏? 洹??밸??뺤씠 ??留ㅻ젰?댁빞!",
  },
};

----- FILE: frontend\data\elementAnalysis.ts -----
// frontend/data/elementAnalysis.ts

export const ELEMENT_ANALYSIS = {
  empathy: {
    icon: "?뙂",
    title: "?뱀떊???ㅽ뻾 ?먮꼫吏"
  },
  reality: {
    icon: "?쀯툘",
    title: "?ㅽ뻾 遺꾪룷 遺꾩꽍"
  },
  fun: {
    icon: "?렓",
    title: "???ㅽ뻾 諛몃윴???대븣?"
  }
};

export const ELEMENT_RECOMMENDATIONS = {
  wood: {
    color: "珥덈줉?? 泥?줉??,
    direction: "?숈そ",
    season: "遊?,
    items: "?섎Т ?뚯옱, ?앸Ъ, 梨?,
    activity: "?곗콉, ?낆꽌, 李쎌옉?쒕룞"
  },
  fire: {
    color: "鍮④컙?? 二쇳솴??,
    direction: "?⑥そ",
    season: "?щ쫫",
    items: "議곕챸, ?묒큹, 遺됱? ?뚰뭹",
    activity: "?대룞, ?ш탳?쒕룞, 諛쒗몴"
  },
  earth: {
    color: "?몃??? 媛덉깋",
    direction: "以묒븰",
    season: "?섏젅湲?,
    items: "?꾩옄湲? ?? ???뚰뭹",
    activity: "紐낆긽, ?뺣━?뺣룉, ?덉젙"
  },
  metal: {
    color: "?곗깋, 湲덉깋, ???,
    direction: "?쒖そ",
    season: "媛??,
    items: "湲덉냽 ?뚰뭹, ?낃린, ?쒓퀎",
    activity: "怨꾪쉷, ?뺣━, 泥닿퀎??
  },
  water: {
    color: "寃?뺤깋, ?뚮???,
    direction: "遺곸そ",
    season: "寃⑥슱",
    items: "?섏”愿, 遺꾩닔, 嫄곗슱",
    activity: "?댁떇, ?ъ깋, ?ы뻾"
  }
};

type Element = "wood" | "fire" | "earth" | "metal" | "water";
type CharKey = "empathy" | "reality" | "fun";

interface ElementCount {
  wood: number;
  fire: number;
  earth: number;
  metal: number;
  water: number;
}

// ?ㅽ뻾 遺꾩꽍 ?⑥닔
export function analyzeElements(elementCounts: ElementCount, selectedChar: CharKey): string {
  const sortedElements = Object.entries(elementCounts)
    .sort(([, a], [, b]) => b - a) as [Element, number][];
  
  const strongest = sortedElements[0];
  const weakest = sortedElements[sortedElements.length - 1];
  
  const total = Object.values(elementCounts).reduce((sum, val) => sum + val, 0);
  const average = total / 5;
  const variance = Object.values(elementCounts).reduce((sum, val) => sum + Math.pow(val - average, 2), 0) / 5;
  const isBalanced = variance < 1.5;
  
  if (selectedChar === "empathy") {
    return getEmpatheticAnalysis(strongest, weakest, isBalanced, elementCounts);
  } else if (selectedChar === "reality") {
    return getRealisticAnalysis(strongest, weakest, isBalanced, elementCounts);
  } else {
    return getFunAnalysis(strongest, weakest, isBalanced, elementCounts);
  }
}

// ==========================================
// Empathy ??遺꾩꽍 (2,500~3,000??
// ==========================================
function getEmpatheticAnalysis(
  strongest: [Element, number],
  weakest: [Element, number],
  isBalanced: boolean,
  counts: ElementCount
): string {
  const [strongEl, strongCount] = strongest;
  const [weakEl, weakCount] = weakest;
  
  const elementNames: Record<Element, string> = {
    wood: "???섎Т)",
    fire: "??遺?",
    earth: "????",
    metal: "????",
    water: "麗?臾?"
  };
  
  const elementMeanings: Record<Element, string> = {
    wood: "?깆옣怨?李쎌“???먮꼫吏",
    fire: "?댁젙怨??쒗쁽???먮꼫吏",
    earth: "?덉젙怨??ъ슜???먮꼫吏",
    metal: "?뺣━? ?꾩꽦???먮꼫吏",
    water: "吏?쒖? ?먮쫫???먮꼫吏"
  };
  
  let analysis = `?뱀떊???ъ＜瑜??대（???щ뜜 湲?먮? ?ㅽ뻾?쇰줈 遺꾨쪟?대낫?? ${elementNames[strongEl]} ?먮꼫吏媛 媛??媛뺥븯寃??먮Ⅴ怨??덈꽕?? ${elementMeanings[strongEl]}媛 ?뱀떊??蹂몄쭏???대（怨??덈떟?덈떎.\n\n`;
  
  analysis += `?ъ＜?붿옄??留덉튂 ?뱀떊?대씪???곗＜???ㅺ퀎?꾩? 媛숈븘?? 洹??덉뿉??媛??ㅽ뻾? ?쒕줈 ?ㅻⅨ ??븷???섎ŉ, ?뱀떊留뚯쓽 ?낇듅???먮꼫吏 ?⑦꽩??留뚮뱾?대궡二? 吏湲덈????뱀떊???ㅽ뻾 ?먮꼫吏媛 ?대뼡 ?섎?瑜?媛吏?붿?, 洹몃━怨?洹멸쾬???뱀떊???띠뿉 ?대뼡 ?곹뼢??誘몄튂?붿? ?④퍡 ?댄렣蹂쇨쾶??\n\n`;
  
  // 媛뺥븳 ?ㅽ뻾 ?곸꽭 遺꾩꽍
  if (strongEl === "wood" && strongCount >= 3) {
    analysis += `?뙮 ?섎Т 湲곗슫??媛뺥븳 ?뱀떊\n\n`;
    analysis += `?뱀떊? 留덉튂 遊꾨궇???덉떦泥섎읆, ?몄젣???깆옣?섍퀬 ?뺤옣?섎젮??蹂몃뒫??媛吏怨??덉뼱?? ?섎Т???꾨줈, ?놁쑝濡? 肉뚮━???꾨옒濡??딆엫?놁씠 六쀬뼱?섍?二? ?뱀떊??洹몃옒?? ?덈줈??寃껋쓣 諛곗슦怨? ?쒕룄?섍퀬, ?먰뿕?섎뒗 寃껋쓣 醫뗭븘?섎뒗 ?怨좊궃 ?숈뒿?먯씠??媛쒖쿃?먮엻?덈떎.\n\n`;
    
    analysis += `?섎Т 湲곗슫??媛뺥븳 ?щ엺? 李쎌쓽?μ씠 ?곗뼱?섏슂. ?꾩씠?붿뼱媛 ?섏넖怨? ?곸긽?μ씠 ?띾??섎ŉ, "?닿굔 ?대뼥源?" ?섎뒗 ?멸린?ъ씠 媛?앺븯二? 湲고쉷?κ낵 異붿쭊?λ룄 醫뗭븘?? 臾댁뼵媛瑜??쒖옉?섎뒗 ??二쇱??⑥씠 ?놁뼱?? ?щ엺?ㅼ? ?뱀떊???대윴 ?먮꼫吏???뚮젮??\n\n`;
    
    analysis += `?섏?留??섎Т媛 ?덈Т 留롮쑝硫? 留덉튂 ?뀁냽?먯꽌 湲몄쓣 ?껋? 寃껋쿂??諛⑺뼢?깆쓣 ?껋쓣 ???덉뼱?? ?닿쾬???섍퀬 ?띔퀬, ?寃껊룄 ?섍퀬 ?띠뼱???먮꼫吏媛 遺꾩궛?섍린 ?쎌짛. ?뚮줈???섎굹瑜?源딆씠 ?뚮뒗 寃껊낫???щ윭 媛吏瑜??뺢쾶 嫄대뱶由щ떎 ?앸굹??寃쎌슦???덉뼱??\n\n`;
    
    analysis += `?뱀떊?먭쾶 ?꾩슂??嫄??좏깮怨?吏묒쨷?댁뿉?? ?섎Т媛 嫄닿컯?섍쾶 ?먮씪?ㅻ㈃ 媛吏移섍린媛 ?꾩슂?섎벏, ?뱀떊???뚮줈??遺덊븘?뷀븳 寃껊뱾???뺣━?섍퀬 ?듭떖??吏묒쨷?섎뒗 ?곗뒿???꾩슂?댁슂. 洹몃━怨??섎Т??遺덉쓣 留뚮굹硫??쒗솢 ??ㅻⅤ硫?鍮쏄낵 ?대줈 蹂?댁슂. ?뱀떊???꾩씠?붿뼱? ?먮꼫吏瑜??쒗쁽?섍퀬(?앹긽), ?몄긽???쒕윭?대뒗(愿?? ?쒕룞?ㅼ씠 ?뱀떊????鍮쏅굹寃?留뚮뱾?댁쨪 嫄곗삁??\n\n`;
    
  } else if (strongEl === "fire" && strongCount >= 3) {
    analysis += `?뵦 遺?湲곗슫??媛뺥븳 ?뱀떊\n\n`;
    analysis += `?뱀떊? 諛앷퀬 ?곕쑜???쒖뼇 媛숈? 議댁옱?덉슂. 遺덉? 鍮쏄낵 ?댁쓣 ?대ŉ, 二쇰????섑븯寃?諛앺엳怨??곕쑜?섍쾶 留뚮뱾?댁＜二? ?뱀떊??洹몃옒?? ?댁젙?곸씠怨? ?ш탳?곸씠硫? ?щ엺?ㅼ쓣 ?먯뿰?ㅻ읇寃??뚯뼱?밴린??移대━?ㅻ쭏媛 ?덉뼱??\n\n`;
    
    analysis += `遺?湲곗슫??媛뺥븳 ?щ엺? ?쒗쁽?μ씠 ?곗뼱?섏슂. 留먯쓣 ?섑븯怨? ?먯떊???앷컖怨?媛먯젙???④??놁씠 ?쒕윭?대ŉ, ?ㅻⅨ ?щ엺?ㅼ뿉寃??곹뼢?μ쓣 誘몄튂???λ젰???덉뼱?? 由щ뜑??룄 ?怨좊궗二? ?щ엺?ㅼ? ?뱀떊???먮꼫吏? ?댁젙???대걣???먯뿰?ㅻ읇寃??뱀떊???곕씪??\n\n`;
    
    analysis += `?섏?留?遺덉씠 ?덈Т 媛뺥븯硫? ??щ씪???먭린 ?먯떊???쒖썙踰꾨┫ ???덉뼱?? ?덈Т 鍮좊Ⅴ寃??吏곸씠怨? ?덈Т 留롮? ?먮꼫吏瑜??잙떎媛 踰덉븘?껋씠 ?ㅺ린 ?쎌짛. 媛먯젙??湲곕났???????덉뼱?? ?붽? ?섎㈃ ??컻?섍퀬, 湲곗걯硫??섎뒛??李뚮? ???ㅻ쑉?? 洹몃윴 洹밸떒?곸씤 紐⑥뒿???섑??????덉뼱??\n\n`;
    
    analysis += `?뱀떊?먭쾶 ?꾩슂??嫄??⑤룄 議곗젅?댁뿉?? 遺덉? ?숈쓣 留뚮굹硫??덉젙?섍퀬, 湲덉냽??留뚮굹硫??⑤떒?섍쾶 ?뺥깭瑜?留뚮뱾?댁슂. 洹쒖튃?곸씤 ?앺솢(??, 紐낇솗??紐⑺몴? 怨꾪쉷(湲????뱀떊???댁젙????嫄댁꽕?곸씤 諛⑺뼢?쇰줈 ?대걣?댁쨪 嫄곗삁?? 洹몃━怨?媛?붿? ?ъ뼱媛??寃껊룄 ?딆? 留덉꽭?? 遺덈룄 ?곗냼媛 ?꾩슂?섎벏, ?뱀떊??????怨듦컙???꾩슂?섎떟?덈떎.\n\n`;
    
  } else if (strongEl === "earth" && strongCount >= 3) {
    analysis += `?룘截???湲곗슫??媛뺥븳 ?뱀떊\n\n`;
    analysis += `?뱀떊? ?좊뱺???吏 媛숈? 議댁옱?덉슂. ?숈? 紐⑤뱺 寃껋쓣 ?덇퀬, ?ㅼ슦怨? 吏?깊빐二쇱짛. ?뱀떊??洹몃옒?? ?덉젙?곸씠怨? ?좊ː?????덉쑝硫? ?щ엺?ㅼ뿉寃??몄븞?④낵 ?덉젙媛먯쓣 二쇰뒗 議댁옱?띾땲??\n\n`;
    
    analysis += `??湲곗슫??媛뺥븳 ?щ엺? 梨낆엫媛먯씠 媛뺥빐?? ?쒕쾲 留≪? ?쇱? ?앷퉴吏 ?대궡怨? ?쎌냽????吏?ㅻŉ, 二쇰? ?щ엺?ㅼ쓣 ??梨숆린二? 以묒옱?λ룄 ?곗뼱?섏꽌, 媛덈벑 ?곹솴?먯꽌 以묐┰??吏?ㅻŉ 洹좏삎???≪븘二쇰뒗 ??븷???댁슂. ?щ엺?ㅼ? ?뱀떊??誘욧퀬 ?섏??댁슂.\n\n`;
    
    analysis += `?섏?留??숈씠 ?덈Т 留롮쑝硫? 臾닿굅?뚯꽌 ?吏곸씠湲??섎뱾?댁졇?? ?덈Т 留롮? 寃껋쓣 ?덉쑝?ㅻ떎媛 ?먯떊??吏볥닃由????덉짛. ??몄쓽 臾몄젣瑜??먯떊??臾몄젣泥섎읆 ?좎븞怨? 紐⑤뱺 梨낆엫???쇱옄 吏?ㅺ퀬 ?섎떎媛 ?ㅽ듃?덉뒪瑜?諛쏄린 ?ъ썙?? 怨좎쭛??? ???덉뼱?? ?쒕쾲 ?뺥븳 寃껋? ?쎄쾶 諛붽씀吏 ?딆쑝?ㅻ뒗 寃쏀뼢???덉짛.\n\n`;
    
    analysis += `?뱀떊?먭쾶 ?꾩슂??嫄??곸젅??寃쎄퀎 ?ㅼ젙?댁뿉?? ?숈? ?섎Т瑜?留뚮굹硫??곸뼇遺꾩쓣 二쇱?留? ?섎Т???숈뿉 肉뚮━瑜??대━硫?吏?깊빐以섏슂. 二쇨퀬諛쏅뒗 愿怨? ?쒕줈 ?뺣뒗 愿怨꾧? 以묒슂?댁슂. 紐⑤뱺 寃껋쓣 ?쇱옄 媛먮떦?섎젮 ?섏? 留먭퀬, 媛?붿? "?꾨땲???쇨퀬 留먰븯???곗뒿???꾩슂?댁슂. 洹몃━怨?湲덉냽??留뚮굹硫?蹂댁꽍???꾩깮?섎벏, ?뱀떊???덉젙???먮꼫吏濡?紐낇솗??寃곌낵臾?湲???留뚮뱾?대궡??寃껊룄 ?뱀떊????鍮쏅굹寃???嫄곗삁??\n\n`;
    
  } else if (strongEl === "metal" && strongCount >= 3) {
    analysis += `?뷂툘 ??湲곗슫??媛뺥븳 ?뱀떊\n\n`;
    analysis += `?뱀떊? 移쇱쿂??紐낇솗?섍퀬 ?좎뭅濡쒖슫 ?щ엺?댁뿉?? 湲덉냽? ?⑤떒?섍퀬, ?뺥깭媛 紐낇솗?섎ŉ, ?뺥솗?섍쾶 ?덈떒?섍퀬 ?뺥깭瑜?留뚮뱾?대궡二? ?뱀떊??洹몃옒?? ?먯튃???쒕졆?섍퀬, ?먮떒?μ씠 ?곗뼱?섎ŉ, ?쇱쓣 源붾걫?섍쾶 泥섎━?섎뒗 ?λ젰???덉뼱??\n\n`;
    
    analysis += `??湲곗슫??媛뺥븳 ?щ엺? ?쇰━?곸씠?먯슂. 媛먯젙蹂대떎???ъ떎怨??먯튃??以묒떆?섍퀬, ?뺣━?뺣룉???섑븯硫? 怨꾪쉷?곸쑝濡??吏곸씠二? ?섏??λ룄 媛뺥빐?? ?쒕쾲 紐⑺몴瑜??뺥븯硫??앷퉴吏 諛怨??섍???異붿쭊?μ씠 ?덉뼱?? ?꾩꽦?꾧? ?믪? 寃곌낵臾쇱쓣 留뚮뱾?대궡?????곸썡?댁슂.\n\n`;
    
    analysis += `?섏?留?湲덉냽???덈Т 媛뺥븯硫? 寃쎌쭅?섍퀬 李④컩寃??먭뺨吏????덉뼱?? ?듯넻?깆씠 遺議깊븯怨? ?먯튃???덈Т 吏묒갑?섎떎媛 ?멸컙愿怨꾩뿉???대젮???寃れ쓣 ???덉짛. "???대젃寃??댁빞 ?섎굹??"?쇰뒗 吏덈Ц??"?먮옒 洹몃윴 嫄곗빞"?쇨퀬 ?듯븯硫?踰쎌쓣 ?볦쓣 ???덉뼱?? ?꾨꼍二쇱쓽 ?깊뼢??媛뺥빐?? ?먯떊怨???몄뿉寃??덈Т ?믪? 湲곗????붽뎄?섍린 ?ъ썙??\n\n`;
    
    analysis += `?뱀떊?먭쾶 ?꾩슂??嫄??좎뿰?⑥씠?먯슂. 湲덉냽? 臾쇱쓣 留뚮굹硫??뱀씠 ?ш퀬, 遺?쒕윭?뚯졇?? ?뚮줈???먮쫫??留↔린怨? ?덉긽移?紐삵븳 蹂?붾? 諛쏆븘?ㅼ씠???곗뒿???꾩슂?댁슂. 洹몃━怨?湲덉냽? 遺덉쓣 留뚮굹硫??뱀븘???덈줈???뺥깭濡??ы깂?앺빐?? ?뱀떊??紐낇솗?④낵 ?먯튃???댁젙(??怨?寃고빀?섎㈃, ?????곹뼢?μ쓣 諛쒗쐶?????덉쓣 嫄곗삁??\n\n`;
    
  } else if (strongEl === "water" && strongCount >= 3) {
    analysis += `?뙄 臾?湲곗슫??媛뺥븳 ?뱀떊\n\n`;
    analysis += `?뱀떊? 源딄퀬 吏?쒕줈??臾?媛숈? ?щ엺?댁뿉?? 臾쇱? 媛????? 怨녹쑝濡??먮Ⅴ吏留? 洹??덉뿉 紐⑤뱺 寃껋쓣 ?댁븘?닿퀬, ?뚮줈??媛??媛뺣젰???섏쓣 諛쒗쐶?섏짛. ?뱀떊??洹몃옒?? 寃됱쑝濡쒕뒗 議곗슜?섍퀬 李⑤텇??蹂댁씠吏留? ?대㈃?먮뒗 源딆? ?앷컖怨??듭같?μ씠 媛?앺빐??\n\n`;
    
    analysis += `臾?湲곗슫??媛뺥븳 ?щ엺? 吏곴??μ씠 ?곗뼱?섏슂. 留먰븯吏 ?딆븘???щ엺??留덉쓬???쎄퀬, ?곹솴???먮쫫???뚯븙?섎ŉ, 蹂몄쭏??轅곕슟?대낫???λ젰???덉뼱?? ?곸쓳?λ룄 醫뗭븘?? ?대뼡 ?섍꼍?먯꽌???먯떊???먮━瑜?李얠븘媛二? ?щ엺?ㅼ? ?뱀떊??源딆씠? 吏?쒖뿉 ?대걣?ㅼ슂.\n\n`;
    
    analysis += `?섏?留?臾쇱씠 ?덈Т 留롮쑝硫? 諛⑺뼢???껉퀬 ?섎윭媛嫄곕굹, ?뺤껜?섏뼱 ?⑹쓣 ???덉뼱?? ?앷컖???덈Т 留롮븘???ㅽ뻾????린吏 紐삵븯嫄곕굹, ?곗쑀遺?⑦븯寃?寃곗젙??誘몃（??寃쎌슦媛 ?덉짛. 媛먯젙??源딆씠??源딆뼱?? ?쒕쾲 鍮좎?硫??ㅼ뼱?섏삤湲??섎뱺 ?곗슱?대굹 遺덉븞???쒕떖由????덉뼱??\n\n`;
    
    analysis += `?뱀떊?먭쾶 ?꾩슂??嫄?紐낇솗??諛⑺뼢?깆씠?먯슂. 臾쇱? ?숈쓣 留뚮굹硫?寃쎄퀎媛 ?앷린怨? ?섎Т瑜?留뚮굹硫??꾨줈 ?щ씪媛?? 紐낇솗??紐⑺몴(??? ?깆옣??諛⑺뼢(紐????ㅼ젙?섎㈃, ?뱀떊??源딆씠? 吏?쒓? ??嫄댁꽕?곸씤 諛⑺뼢?쇰줈 ?먮? ???덉뼱?? 洹몃━怨?媛?붿? ?앷컖??硫덉텛怨? ?됰룞?쇰줈 ??린???곗뒿???꾩슂?댁슂. 臾쇱씠 怨좎뿬 ?덉쑝硫??⑹?留? ?먮Ⅴ硫??앸챸???대━?덇퉴??\n\n`;
  }

  // ?뵻 媛뺥븳 ?ㅽ뻾???꾩떎 ?곸슜 ?⑦꽩 (1,000??異붽?)
  if (strongCount > 0 && strongEl) {
    const elementLabels: Record<Element, string> = {
      wood: '?섎Т', fire: '遺?, earth: '??, metal: '??, water: '臾?
    };

    const realWorldPatterns: Record<Element, string> = {
      wood: `?뱀떊? ?뚯쓽 ?쒓컙???먯쓣 癒쇱? ?쒕뒗 ?몄씠?먯슂. ???꾨줈?앺듃媛 ?섏삤硫?留앹꽕???놁씠 李몄뿬 ?섏궗瑜?諛앺엳怨? 湲곗〈 諛⑹떇???섎Ц???쒓린?섎뒗 ?쇱씠 ????곗슂, ?닿굔 ?뱀떊??李쎌쓽?깃낵 ?꾩쟾 ?뺤떊?먯꽌 ?섏삤???먯뿰?ㅻ윭??紐⑥뒿?대엻?덈떎. ??

蹂?붽? ?녿뒗 ?섍꼍?먯꽌???듬떟?⑥쓣 ?먮겮?????덉뼱?? 媛숈? ?쇱쓣 諛섎났?섎뒗 寃껊낫???꾨줈?앺듃 ?⑥쐞濡??吏곸씠??怨녹뿉???⑥뵮 ?됰났?섏떎 嫄곗삁?? ?ㅻ쭔 ?щ윭 ?쇱쓣 ?숈떆???쒖옉?섎떎媛 留덈Т由ш? ?쏀빐吏??寃쏀뼢???덉쑝?? ?섎굹???앸궡???곗뒿???섏떆硫???鍮쏅궇 嫄곗삁?? ?뮍

吏곸옣?먯꽌??湲고쉷?대굹 媛쒖꽑 ?낅Т瑜?留↔쾶 ?섎뒗 寃쎌슦媛 留롪퀬, ?ㅽ??몄뾽?대굹 ?꾨줈?앺듃 湲곕컲 議곗쭅?먯꽌 留뚯”?꾧? ?믪븘?? ?곗븷?먯꽌??愿怨?珥덈컲???곴레?곸쑝濡??吏곸씠吏留? ?덉젙湲곗뿉 ?묒뼱?ㅻ㈃ ?덈줈???먭레??李얜뒗 寃쏀뼢???앷만 ???덈떟?덈떎.`,

      fire: `?뱀떊? ? 誘명똿?먯꽌 遺꾩쐞湲곕? 諛앷쾶 留뚮뱶???щ엺?댁뿉?? 議곗슜???먮━瑜?寃щ뵒吏 紐삵븯怨? ?щ엺?ㅼ씠 紐⑥씤 怨녹뿉???먮꼫吏瑜??삳뒗 ?몄씠二? ?쇱옄 ?섎뒗 ?낅Т蹂대떎 ?묒뾽 ?꾨줈?앺듃?먯꽌 ?⑥뵮 紐곗엯?꾧? ?믨퀬, 諛쒗몴??????쒕룞??留↔쾶 ?섎뒗 寃쎌슦媛 留롫떟?덈떎. ?뵦

?곸뾽?대굹 ?띾낫, 援먯쑁 媛숈? ????묒큺??留롮? 遺꾩빞?먯꽌 鍮쏆쓣 諛쒗븯吏留? ?ы깮洹쇰Т???낅┰ ?묒뾽???ㅻ옒 ?섎㈃ 臾닿린?ν빐吏????덉뼱?? ?ㅻ쭔 ?댁젙???욎꽌??蹂대땲 異⑸룞?곸쑝濡?寃곗젙?섎뒗 ?쇱씠 ??퀬, 媛먯젙 湲곕났???덉쓣 ???덉쑝???좎떆 硫덉텛怨??명씉??媛?ㅻ벉???쒓컙???꾩슂?댁슂. ?ㅿ툘

?곗븷?먯꽌???좎젙 ?쒗쁽??怨쇳븯怨? 愿怨?珥덈컲??媛뺣젹?섍쾶 紐곗엯?섎뒗 ?몄씠?먯슂. ?곷?媛 議곗슜?섍굅???쒗쁽???곸? ??낆씠硫?遺덉븞???먮굜 ???덈떟?덈떎.`,

      earth: `?뱀떊? ?쎌냽??吏?ㅻ뒗 ?щ엺?쇰줈 ?몄떇?쇱슂. 怨꾪쉷?쒕? 留뚮뱾怨? ?뺥빐吏?猷⑦떞???좎??섎ŉ, 湲됲븳 寃곗젙蹂대떎 泥닿퀎?곸쑝濡?以鍮꾪븯??嫄??좏샇?섏떆二? 蹂?붽? ??? ?섍꼍?먯꽌???ㅽ듃?덉뒪瑜?諛쏆쓣 ???덉?留? ?덉젙?곸씤 議곗쭅?먯꽌???꾧뎄蹂대떎 鍮쏅굹?? ?뙮

?됱젙?대굹 愿由? ?щТ 媛숈? 諛섎났?곸씠怨??뺥솗?깆씠 ?붽뎄?섎뒗 ?낅Т??媛뺤젏???덇퀬, ?κ린 洹쇱냽瑜좎씠 ?믪? ?몄씠?먯슂. ?ㅻ쭔 ?덈줈???쒕룄瑜?二쇱??섎뒗 寃쏀뼢???덉쑝?? ?묒? 蹂?붾????쒕룄?대낫?쒕㈃ 醫뗭쓣 寃?媛숈븘?? ?쨴

?곗븷?먯꽌???좊ː瑜??볥뒗 ???쒓컙??嫄몃━吏留? ?쒕쾲 愿怨꾧? ?뺤꽦?섎㈃ ?ㅻ옒 ?좎??섎뒗 ?몄씠?먯슂. ?곷?媛 利됲씎?곸씠嫄곕굹 怨꾪쉷 ?놁씠 ?吏곸씠????낆씠硫?遺덉븞?⑥쓣 ?먮굜 ???덈떟?덈떎.`,

      metal: `?뱀떊? ?뚯쓽?먯꽌 鍮꾪슚?⑥쓣 吏?곹븯???щ엺?댁뿉?? ?쇰━?곸씠怨?遺꾩꽍?곸씠硫? 媛먯젙蹂대떎 ?먯튃??以묒떆?섏짛. 寃곗젙???꾩슂???쒓컙??紐낇솗??湲곗????쒖떆?섍퀬, ?좊ℓ???곹솴??寃щ뵒吏 紐삵븯???몄씠?먯슂. ?숋툘

踰뺣쪧?대굹 ?뚭퀎, ?붿??덉뼱留?媛숈? ?뺥솗?깃낵 ?쇰━媛 以묒슂??遺꾩빞?먯꽌 ?뺣쭚 鍮쏅굹?? ?ㅻ쭔 ?꾨꼍二쇱쓽 ?깊뼢??媛뺥빐 ?ㅼ뒪濡쒖뿉寃뚮룄 ??몄뿉寃뚮룄 ?믪? 湲곗????붽뎄?섎뒗 寃쏀뼢???덉쑝?? 媛?붿? ?곷???留덉쓬???ㅼ뿬?ㅻ낫???ъ쑀瑜?媛吏硫?愿怨꾧? ??醫뗭븘吏?嫄곗삁?? ?쨳

?곗븷?먯꽌??愿怨꾩뿉 紐낇솗??洹쒖튃???먰븯吏留? 媛먯젙 ?쒗쁽??遺議깊븳 ?몄씠?먯슂. ?곷?媛 媛먯꽦?곸씤 ??낆씠硫??쒕줈 ?댄빐?섏? 紐삵븯???쒓컙????쓣 ???덈떟?덈떎.`,

      water: `?뱀떊? ?곷???媛먯젙??癒쇱? ?뚯븘梨꾨뒗 ?щ엺?댁뿉?? 留먯뾾??愿李고븯怨? 源딆씠 ?덈뒗 ??붾? ?좏샇?섎ŉ, ?쇱옄留뚯쓽 ?쒓컙???뚯쨷???ш린二? ?쒕㈃?곸씤 愿怨꾨낫???뚯닔???源딆? 援먮쪟瑜?異붽뎄?섎뒗 ?몄씠?먯슂. ?뮋

?덉닠?대굹 ?곷떞, ?곌뎄, 湲고쉷 媛숈? ?ъ쑀? 李쎌쓽?깆씠 ?꾩슂??遺꾩빞?먯꽌 媛뺤젏??蹂댁씠吏留? 鍮좊Ⅸ 寃곗젙?대굹 利됲씎?곸씤 ??묒씠 ?꾩슂???섍꼍?먯꽌???ㅽ듃?덉뒪瑜?諛쏆쓣 ???덉뼱?? ?곗쑀遺?⑦븳 寃쏀뼢???덉쑝?? ?묒? 寃곗젙遺??鍮좊Ⅴ寃??대━???곗뒿???섏떆硫?醫뗭쓣 寃?媛숈븘?? ?뮛

?곗븷?먯꽌??源딆? 援먭컧???먰븯吏留? ?쒗쁽??遺議깊빐 ?곷?媛 ?듬떟?⑥쓣 ?먮굜 ???덉뼱?? ?곷?媛 鍮좊Ⅴ寃?愿怨꾨? 吏꾩쟾?쒗궎?ㅻ뒗 ??낆씠硫?遺?댁쓣 ?먮겮怨?嫄곕━瑜??먭쾶 ?????덈떟?덈떎.`
    };

    analysis += `\n\n**?뮕 ${elementLabels[strongEl]} ?먮꼫吏媛 媛뺥븳 ?뱀떊???꾩떎 紐⑥뒿**\n\n`;
    analysis += realWorldPatterns[strongEl];
  }

  // ?뵻 ?쏀븳 ?ㅽ뻾?쇰줈 ?명븳 ?대젮?怨?蹂댁긽 ?⑦꽩
  if (weakCount === 0 && weakEl) {
    const elementLabels: Record<Element, string> = {
      wood: '?섎Т', fire: '遺?, earth: '??, metal: '??, water: '臾?
    };

    const weakPatterns: Record<Element, string> = {
      wood: `?섎Т ?먮꼫吏媛 ?쏀븯硫??덈줈???쒖옉???먮졄寃??먭뺨吏????덉뼱?? ?댁쭅??怨좊??대룄 ?ㅽ뻾????린吏 紐삵븯怨? ???꾨줈?앺듃媛 ?섏???湲곗〈 ?낅Т瑜??좎??섎젮??寃쏀뼢??媛뺥븯?듬땲?? 蹂?붽? ?꾩슂???쒓컙?먮룄 ?듭닕??寃껋쓣 ?좏깮?섍쾶 ?섍퀬, 湲고쉶瑜??볦튂???쇱씠 諛섎났?????덉뼱??

?대윴 寃쎌슦 ?섎Т ?먮꼫吏媛 媛뺥븳 ?щ엺怨??④퍡 ?덉쑝硫??꾩????쇱슂. 異붿쭊???덈뒗 ?숇즺??移쒓뎄媛 癒쇱? ?吏곸씠硫? 洹??먮쫫???먯뿰?ㅻ읇寃??⑸쪟?섍쾶 ?섍퀬, ?묒? ?깃났 寃쏀뿕???볦씠硫댁꽌 ?먯감 ?쒕룄?섎뒗 ?섏씠 ?앷릿?듬땲?? ?뮍`,

      fire: `遺??먮꼫吏媛 ?쏀븯硫??щ엺 留뚮굹??寃?遺?댁뒪?쎄쾶 ?먭뺨吏????덉뼱?? 紐⑥엫 珥덈?瑜?諛쏆븘??嫄곗젅?섎뒗 寃쎌슦媛 留롪퀬, 李몄꽍?대룄 議곗슜???덈떎媛 癒쇱? ?섍???履쎌씠二? ?댁젙???꾩슂???쒓컙???먮꼫吏媛 遺議깊븯怨? ?덈줈???щ엺??留뚮굹???먮━瑜??쇳븯寃??쒕떟?덈떎.

?대윴 寃쎌슦 遺??먮꼫吏媛 媛뺥븳 ?щ엺怨??④퍡 ?덉쑝硫??쒕젰???앷꺼?? ?곴레?곸씤 移쒓뎄媛 ?④퍡 媛?먭퀬 ?섎㈃ ?곕씪媛寃??섍퀬, 洹??먮━?먯꽌 利먭굅??寃쏀뿕???섎㈃ ?먯감 紐⑥엫?????嫄곕?媛먯씠 以꾩뼱?좊떟?덈떎. ?ㅿ툘`,

      earth: `???먮꼫吏媛 ?쏀븯硫?怨꾪쉷???몄썙??吏?ㅺ린 ?대젮?뚯쭏 ???덉뼱?? ?쇱젙?쒕? 留뚮뱾?대룄 ?먰듃?ъ?怨? ?뺣━?뺣룉??誘몃（?ㅺ? 怨듦컙???댁??ъ썙吏???쇱씠 諛섎났?쒕떟?덈떎. ?κ린?곸씤 紐⑺몴蹂대떎 利됲씎?곸씤 寃곗젙???섎뒗 寃쏀뼢???덇퀬, ?덉젙?곸씤 猷⑦떞??留뚮뱾吏 紐삵빐 遺덉븞?⑥쓣 ?먮굜 ???덉뼱??

?대윴 寃쎌슦 ???먮꼫吏媛 媛뺥븳 ?щ엺怨??④퍡 ?덉쑝硫??덉젙媛먯쓣 ?살뼱?? 泥닿퀎?곸씤 移쒓뎄???뚰듃?덇? 猷⑦떞??留뚮뱾?댁＜硫? 洹?? ?덉뿉???몄븞?⑥쓣 ?먮겮寃??섍퀬, ?묒? ?듦?遺???섎굹??留뚮뱾?닿?硫??먯감 ?덉젙媛먯씠 ?앷릿?듬땲?? ?쨴`,

      metal: `???먮꼫吏媛 ?쏀븯硫?寃곕떒?μ씠 遺議깊븯寃??먭뺨吏????덉뼱?? ?щ윭 ?좏깮吏 ?욎뿉???ㅻ옒 怨좊??섍퀬, 寃곗젙???대젮??"?닿쾶 留욌굹?" ?섎뒗 ?섏떖??諛섎났?쒕떟?덈떎. ?먯튃蹂대떎 媛먯젙???섎몮由ш린 ?쎄퀬, ??몄쓽 ?섍껄???쎄쾶 ?곹뼢??諛쏅뒗 ?몄씠?먯슂.

?대윴 寃쎌슦 ???먮꼫吏媛 媛뺥븳 ?щ엺怨??④퍡 ?덉쑝硫?湲몄씠 蹂댁뿬?? 紐낇솗??議곗뼵??二쇰뒗 移쒓뎄??硫섑넗媛 ?덉쑝硫? 洹??뺤떊??湲곕???寃곗젙???대┫ ???덇퀬, ?묒? 寃곗젙遺???ㅼ뒪濡??대━???곗뒿???섎㈃ ?먯감 ?먯떊媛먯씠 遺숇뒗?듬땲?? ?쨳`,

      water: `臾??먮꼫吏媛 ?쏀븯硫?媛먯젙 ?쒗쁽???쒗댋寃??먭뺨吏????덉뼱?? ?곷???留덉쓬???쎌? 紐삵빐 ?ㅽ빐媛 ?앷린怨? 源딆씠 ?덈뒗 ??붾낫???쒕㈃?곸씤 愿怨꾨? ?좎??섎뒗 寃쏀뼢???덈떟?덈떎. 李쎌쓽?곸씤 ?꾩씠?붿뼱媛 ???좎삤瑜댁? ?딄퀬, ?뺥빐吏?? ?덉뿉???吏곸씠??嫄??좏샇?섍쾶 ?쇱슂.

?대윴 寃쎌슦 臾??먮꼫吏媛 媛뺥븳 ?щ엺怨??④퍡 ?덉쑝硫?諛곗슱 ???덉뼱?? 媛먯꽦?곸씤 移쒓뎄媛 ?곷???媛먯젙???쎌뼱二쇰㈃, ?먯감 怨듦컧 ?λ젰???앷린寃??섍퀬, ?덉닠?대굹 臾명솕 ?쒕룞???묓븯硫댁꽌 媛먯젙????쓣 ?볧엳??寃껊룄 ???꾩????쒕떟?덈떎. ?뮛`
    };

    analysis += `\n\n**?좑툘 ${elementLabels[weakEl]} ?먮꼫吏媛 ?쏀븳 ?뱀떊??寃る뒗 ?대젮?**\n\n`;
    analysis += weakPatterns[weakEl];
  }

  // ?뵻 ?ㅽ뻾 洹좏삎???곕Ⅸ ?멸컙愿怨?& 吏곸뾽 ?⑦꽩
  if (strongCount > 0 && strongEl) {
    const elementLabels: Record<Element, string> = {
      wood: '?섎Т', fire: '遺?, earth: '??, metal: '??, water: '臾?
    };

    const relationshipPatterns: Record<Element, string> = {
      wood: `?섎Т ?먮꼫吏媛 媛뺥븳 ?щ엺? 蹂?붿? ?깆옣???덈뒗 ?섍꼍?먯꽌 留뚯”?꾧? ?믪븘?? ?ㅽ??몄뾽, 湲고쉷, 留덉??? 援먯쑁 遺꾩빞?먯꽌 媛뺤젏??蹂댁씠怨? ?뺤껜??議곗쭅?먯꽌???듬떟?⑥쓣 ?먮??듬땲?? ?곗븷?먯꽌??愿怨꾨? 二쇰룄?섎젮??寃쏀뼢???덉?留? ?곷?媛 ?낅┰?곸씤 ??낆씠硫??쒕줈 嫄곕━瑜??먭쾶 ?쇱슂.`,
      
      fire: `遺??먮꼫吏媛 媛뺥븳 ?щ엺? ?щ엺怨쇱쓽 愿怨꾩뿉???먮꼫吏瑜??살뼱?? ?곸뾽, ?띾낫, ?대깽??湲고쉷, 媛뺤뿰 媛숈? ????묒큺??留롮? 吏곸뾽?먯꽌 媛뺤젏??蹂댁씠怨? ?쇱옄 ?섎뒗 ?낅Т?먯꽌??臾닿린?ν빐吏꾨떟?덈떎. ?곗븷?먯꽌???댁젙?곸씠吏留? ?곷?媛 議곗슜????낆씠硫??⑤룄李⑤줈 ?명븳 媛덈벑???앷꺼??`,
      
      earth: `???먮꼫吏媛 媛뺥븳 ?щ엺? ?덉젙?곸씠怨?泥닿퀎?곸씤 ?섍꼍?먯꽌 ?λ젰??諛쒗쐶?댁슂. ?됱젙, ?щТ, 愿由? 怨듬Т??媛숈? 諛섎났?깃낵 ?뺥솗?깆씠 以묒슂??吏곸뾽?먯꽌 媛뺤젏??蹂댁씠怨? 湲됰??섎뒗 ?섍꼍?먯꽌???ㅽ듃?덉뒪瑜?諛쏅뒗?듬땲?? ?곗븷?먯꽌???좊ː瑜?以묒떆?섏?留? ?곷?媛 蹂?붾? ?먰븯????낆씠硫??쒕줈 ?듬떟?⑥쓣 ?먭뺨??`,
      
      metal: `???먮꼫吏媛 媛뺥븳 ?щ엺? ?쇰━? ?먯튃??以묒슂???섍꼍?먯꽌 媛뺤젏??蹂댁뿬?? 踰뺣쪧, ?뚭퀎, ?붿??덉뼱留? ?곌뎄 遺꾩빞?먯꽌 ?λ젰??諛쒗쐶?섍퀬, 媛먯젙??諛곕젮媛 ?꾩슂???낅Т?먯꽌???대젮???寃る뒗?듬땲?? ?곗븷?먯꽌??紐낇솗??愿怨꾨? ?먰븯吏留? ?곷?媛 媛먯꽦?곸씤 ??낆씠硫??쒕줈 ?댄빐?섏? 紐삵븯???쒓컙????븘??`,
      
      water: `臾??먮꼫吏媛 媛뺥븳 ?щ엺? 源딆씠? 李쎌쓽?깆씠 ?꾩슂???섍꼍?먯꽌 鍮쏆쓣 諛쒗빐?? ?덉닠, ?곷떞, ?곌뎄, 湲고쉷 遺꾩빞?먯꽌 媛뺤젏??蹂댁씠怨? 鍮좊Ⅸ 寃곗젙???꾩슂???섍꼍?먯꽌??遺?댁쓣 ?먮??듬땲?? ?곗븷?먯꽌??源딆? 援먭컧???먰븯吏留? ?곷?媛 鍮좊Ⅴ寃?愿怨꾨? 吏꾩쟾?쒗궎?ㅻ뒗 ??낆씠硫?遺?댁쓣 ?먮겮怨?嫄곕━瑜??ъ슂.`
    };

    analysis += `\n\n**?뙋 ?뱀떊???ㅽ뻾 遺꾪룷媛 ?멸컙愿怨꾩? 吏곸뾽??誘몄튂???곹뼢**\n\n`;
    analysis += relationshipPatterns[strongEl];
  }
  
  // ?쏀븳 ?ㅽ뻾 蹂댁셿 (湲곗〈 濡쒖쭅 ?좎?)
  if (weakCount === 0) {
    analysis += `\n\n?뮕 遺議깊븳 ?먮꼫吏 蹂댁땐?섍린\n\n`;
    analysis += `?쒗렪, ?뱀떊???ъ＜?먮뒗 ${elementNames[weakEl]} ?먮꼫吏媛 ?섎굹???놁뼱?? ?닿쾬??瑗??섏걶 嫄??꾨땲?먯슂. ?섏?留??섏떇?곸쑝濡?蹂댁땐?섎㈃, ??洹좏삎 ?≫엺 ?띠쓣 ?????덈떟?덈떎.\n\n`;
    
    const weakElementAdvice: Record<Element, string> = {
      wood: `?섎Т ?먮꼫吏媛 遺議깊븯硫? ?깆옣怨?李쎌“??湲고쉶瑜??볦튌 ???덉뼱?? ?덈줈??寃껋쓣 諛곗슦嫄곕굹, 蹂?붾? ?쒕룄?섎뒗 寃껋씠 ?대졄寃??먭뺨吏????덉짛. ?대? 蹂댁셿?섎젮硫?\n- ?뙮 ?앸Ъ???ㅼ썙蹂댁꽭??(?앸챸???깆옣??吏곸젒 寃쏀뿕)\n- ?뱴 ?덈줈??寃껋쓣 諛곗슦???쒓컙??媛?몄슂 (?⑤씪??媛뺤쓽, ?낆꽌 ??\n- ?슯 ?먯뿰 ?띿뿉???곗콉?섎ŉ ?섎Т ?먮꼫吏瑜??≪닔?댁슂\n- ?뮍 珥덈줉???룹씠???뚰뭹??媛源뚯씠 ?대낫?몄슂\n- ?截??꾩묠???쇱뼱?섏꽌 ?숈そ??諛붾씪蹂대ŉ ?섎（瑜??쒖옉?댁슂`,
      fire: `遺??먮꼫吏媛 遺議깊븯硫? ?댁젙怨??쒗쁽?μ씠 ?쏀븷 ???덉뼱?? ?щ엺???욎뿉 ?섏꽌湲??먮졄嫄곕굹, ?먯떊???앷컖???쒗쁽?섎뒗 ???대젮???寃れ쓣 ???덉짛. ?대? 蹂댁셿?섎젮硫?\n- ?뵦 ?대룞?쇰줈 紐몄뿉 ?댁쓣 ?대낫?몄슂 (?щ━湲? ?붽? ??\n- ?뫁 ?щ엺?ㅺ낵 ?쒕컻??援먮쪟?섎뒗 ?쒓컙??媛?몄슂\n- ?렎 ?먯떊???앷컖???쒗쁽?섎뒗 ?곗뒿???댁슂 (釉붾줈洹? SNS ??\n- ?ㅿ툘 鍮④컙?됱씠??二쇳솴???룹쓣 ?낆뼱蹂댁꽭??n- ?截??뉖튆??留롮씠 弛먭퀬, ?⑥そ 諛⑺뼢???쒖슜?댁슂`,
      earth: `???먮꼫吏媛 遺議깊븯硫? ?덉젙媛먭낵 ?좊ː?깆씠 ?쏀븷 ???덉뼱?? 怨꾪쉷 ?놁씠 ?吏곸씠嫄곕굹, 梨낆엫???뚰뵾?섎뒗 寃쏀뼢???덉쓣 ???덉짛. ?대? 蹂댁셿?섎젮硫?\n- ?쭣 紐낆긽?대굹 ?붽?濡?留덉쓬???덉젙?쒖폒??n- ?뿎截?洹쒖튃?곸씤 猷⑦떞??留뚮뱾?댁슂 (湲곗긽, ?앹궗, 痍⑥묠 ?쒓컙 ??\n- ?㏏ ?뺣━?뺣룉?쇰줈 怨듦컙???덉젙媛먯쓣 ?뷀빐??n- ?뮎 ?몃??됱씠??媛덉깋 ?뚰뭹??媛源뚯씠 ?댁슂\n- ?룪 吏??덉쓽 以묒븰 怨듦컙???뺣룉?섍퀬 ?쒖슜?댁슂`,
      metal: `???먮꼫吏媛 遺議깊븯硫? 泥닿퀎?깃낵 ?꾩꽦?꾧? ?쏀븷 ???덉뼱?? ?쇱쓣 留덈Т由ы븯吏 紐삵븯嫄곕굹, ?먯튃 ?놁씠 ?붾뱾由щ뒗 寃쏀뼢???덉쓣 ???덉짛. ?대? 蹂댁셿?섎젮硫?\n- ?뱷 怨꾪쉷???몄슦怨?泥댄겕由ъ뒪?몃? 留뚮뱾?댁슂\n- ?렞 紐낇솗??紐⑺몴? 湲곗????ㅼ젙?댁슂\n- ?㏏ ?뺣━?뺣룉怨??⑥닚?붾? ?ㅼ쿇?댁슂\n- ?쨳 ?곗깋, 湲덉깋, ????뚰뭹???쒖슜?댁슂\n- ?똿 ?쒖そ 諛⑺뼢???쒖슜?섍퀬, 媛???먮꼫吏瑜??먭뺨??,
      water: `臾??먮꼫吏媛 遺議깊븯硫? 吏?쒖? ?ъ깋???쏀븷 ???덉뼱?? 源딆씠 ?앷컖?섏? ?딄퀬 異⑸룞?곸쑝濡??됰룞?섍굅?? 吏곴??μ씠 遺議깊븷 ???덉짛. ?대? 蹂댁셿?섎젮硫?\n- ?뮘 異⑸텇???댁떇怨??섎㈃??痍⑦빐??n- ?뱰 ?ъ깋怨??낆꽌???쒓컙??媛?몄슂\n- ?뙄 臾쇨낵 媛源뚯씠 吏?댁슂 (?섏쁺, ?⑥쿇, 諛붾떎 ??\n- ?뮋 ?뚮??됱씠??寃?뺤깋 ?뚰뭹???쒖슜?댁슂\n- ?똽 遺곸そ 諛⑺뼢???쒖슜?섍퀬, 寃⑥슱 ?먮꼫吏瑜??먭뺨??
    };
    
    analysis += weakElementAdvice[weakEl] + "\n\n";
  }
  
  // 洹좏삎 ?됯? 諛?留덈Т由?
  if (isBalanced) {
    analysis += `\n???뱀떊???ㅽ뻾 諛몃윴??n\n`;
    analysis += `?뱀떊???ㅽ뻾? 鍮꾧탳??洹좏삎?????≫? ?덉뼱?? ?대뒗 ?뺣쭚 異뺣났?대엻?덈떎. ?쒖そ?쇰줈 移섏슦移섏? ?딆븘?? ?띠쓽 ?щ윭 ?곸뿭?먯꽌 洹좏삎 ?≫엺 紐⑥뒿??蹂댁씪 ???덉뼱?? 洹밸떒?곸씤 ?곹솴???쇳븷 ???덇퀬, ?덉젙?곸쑝濡??깆옣?????덈뒗 湲곕컲???섏뼱以섏슂.\n\n`;
    analysis += `洹좏삎 ?≫엺 ?ъ＜??留덉튂 ??議곗쑉???ㅼ??ㅽ듃??媛숈븘?? 媛??낃린媛 ?먯떊????븷???섎㈃?쒕룄, ?꾩껜?곸쑝濡?議고솕濡쒖슫 ?뚯븙??留뚮뱾?대궡二? ?뱀떊??洹몃옒?? ?ㅻ쭔, ?덈Т 洹좏삎?먮쭔 吏묒쨷?섎떎 蹂대㈃ ?뱀깋???놁뼱吏????덉쑝?? ?먯떊留뚯쓽 媛뺤젏??媛쒕컻?섎뒗 寃껊룄 ?딆? 留덉꽭??`;
  } else {
    analysis += `\n?뮟 ?뱀떊留뚯쓽 ?낇듅???먮꼫吏\n\n`;
    analysis += `?뱀떊???ㅽ뻾? ?쎄컙??遺덇퇏?뺤씠 ?덉뼱?? ?섏?留??닿쾬???섏걶 嫄??덈? ?꾨땲?먯슂. ?ㅽ엳????遺덇퇏?뺤씠 ?뱀떊留뚯쓽 ?밸퀎???щ뒫怨?媛쒖꽦??留뚮뱾?대궦?듬땲??\n\n`;
    analysis += `??궗 ???꾩씤?ㅼ쓣 蹂대㈃, ?遺遺??ㅽ뻾??遺덇퇏?뺥븳 寃쎌슦媛 留롮븘?? 媛뺥븳 遺??먮꼫吏濡??몄긽??諛붽씔 ?곷챸媛?? 源딆? 臾??먮꼫吏濡?泥좏븰怨??덉닠??李쎌“???щ엺?? ?⑤떒??湲??먮꼫吏濡??쒓뎅???몄슫 由щ뜑??.. 紐⑤몢 ?먯떊??媛뺤젏??理쒕????쒖슜?덉짛.\n\n`;
    analysis += `?뱀떊??留덉갔媛吏?덉슂. 媛뺥븳 遺遺꾩? ?붿슧 媛뺥솕?섍퀬, ?쏀븳 遺遺꾩? ?섏떇?곸쑝濡?蹂댁셿?섎㈃?? ?먯떊留뚯쓽 湲몄쓣 留뚮뱾?닿??몄슂. ?뱀떊? ?대? 異⑸텇???밸퀎?섎떟?덈떎. ?뮇`;
  }
  
  return analysis;
}

// ==========================================
// Reality ??遺꾩꽍 (2,500~3,000??
// ==========================================
function getRealisticAnalysis(
  strongest: [Element, number],
  weakest: [Element, number],
  isBalanced: boolean,
  counts: ElementCount
): string {
  const [strongEl, strongCount] = strongest;
  const [weakEl, weakCount] = weakest;
  
  let analysis = `?먯삤??遺꾪룷 ?꾪솴??n`;
  analysis += `?? ${counts.wood}/8 (${(counts.wood/8*100).toFixed(1)}%) | ?? ${counts.fire}/8 (${(counts.fire/8*100).toFixed(1)}%) | ?? ${counts.earth}/8 (${(counts.earth/8*100).toFixed(1)}%) | ?? ${counts.metal}/8 (${(counts.metal/8*100).toFixed(1)}%) | 麗? ${counts.water}/8 (${(counts.water/8*100).toFixed(1)}%)\n\n`;
  
  const total = Object.values(counts).reduce((sum, val) => sum + val, 0);
  const average = total / 5;
  const variance = Object.values(counts).reduce((sum, val) => sum + Math.pow(val - average, 2), 0) / 5;
  
  analysis += `?먰넻怨?吏?쒌?n`;
  analysis += `- ?됯퇏 遺꾪룷: ${average.toFixed(2)}媛??ㅽ뻾\n`;
  analysis += `- 遺꾩궛(Variance): ${variance.toFixed(2)}\n`;
  analysis += `- ?쒖??몄감: ${Math.sqrt(variance).toFixed(2)}\n`;
  analysis += `- 二쇰룄 ?ㅽ뻾: ${strongEl.toUpperCase()} (${strongCount}媛? ${(strongCount/8*100).toFixed(1)}%)\n`;
  analysis += `- 寃고븤 ?ㅽ뻾: ${weakEl.toUpperCase()} (${weakCount}媛? ${(weakCount/8*100).toFixed(1)}%)\n\n`;
  
  // 二쇰룄 ?ㅽ뻾 ?곸꽭 遺꾩꽍
  analysis += `?먯＜???ㅽ뻾 ${strongEl.toUpperCase()} 遺꾩꽍??n\n`;
  
  const strongAnalysis: Record<Element, string> = {
    wood: `??湲곕낯 ?뱀꽦\n- ?ㅽ뻾 ?띿꽦: ?묒깮(?썹뵟), ?숇갑(??, 異섍퀎(??\n- ?깊뼢: ?뺤옣?? ?깆옣?? 李쎌쓽??n- ?듭떖 ?ㅼ썙?? Growth, Expansion, Creativity\n\n??媛뺤젏 遺꾩꽍\n- ?숈뒿?λ젰: ?좉퇋 ?뺣낫 ?듬뱷 諛??곸쓳 ?λ젰 ?곗닔\n- 湲고쉷?? ?꾩씠?붿뼱 諛쒖긽 諛??꾨줈?앺듃 湲고쉷 ?곸썡\n- 異붿쭊?? ?덈줈???쒕룄? ?꾩쟾??????먮젮? ?곸쓬\n- ?멸컙愿怨? ?ъ슜?κ낵 ?깆옣 吏?μ쟻 愿怨??뺤꽦\n\n???쎌젏 諛?由ъ뒪??n- 怨쇱엵 ?뺤옣: ?숈떆?ㅻ컻???꾨줈?앺듃濡??먮꼫吏 遺꾩궛\n- ?곗쑀遺?? ?ㅼ뼇???좏깮吏 ?욎뿉??寃곗젙 吏??n- 吏묒쨷??遺議? 源딆씠蹂대떎 ?볦씠 吏?? ?꾨Ц???쏀솕\n- ?섏〈?? ????몄젙 ?뺢뎄 媛뺥븿\n\n???곹빀 遺꾩빞\n- 援먯쑁/?덈젴 (媛뺤궗, 肄붿튂, 而⑥꽕?댄듃)\n- 湲고쉷/留덉???(?곹뭹湲고쉷, 釉뚮옖???꾨왂)\n- R&D (?곌뎄媛쒕컻, ?좉린???먯깋)\n- 李쎌옉 (?묎?, ?붿옄?대꼫, ?щ━?먯씠??\n\n???꾨왂??沅뚭퀬\n- ?좏깮怨?吏묒쨷: 3媛??댁긽 ?꾨줈?앺듃 ?숈떆 吏꾪뻾 吏??n- 源딆씠 ?뺣낫: ?섎굹??遺꾩빞?먯꽌 ?꾨Ц??援ъ텞\n- ?꾩꽦???쒓퀬: ?쒖옉蹂대떎 留덈Т由ъ뿉 吏묒쨷\n- ?ъ꽦/?앹긽 ?쒖슜: ?꾩씠?붿뼱瑜??섏씡?뷀븯嫄곕굹 ?쒗쁽臾쇰줈 ?꾪솚`,
    
    fire: `??湲곕낯 ?뱀꽦\n- ?ㅽ뻾 ?띿꽦: ?묐룞(?썲땿), ?⑤갑(??, ?섍퀎(鸚?\n- ?깊뼢: ?쒗쁽?? ?댁젙, ?ш탳??n- ?듭떖 ?ㅼ썙?? Passion, Expression, Leadership\n\n??媛뺤젏 遺꾩꽍\n- ?쒗쁽?? ?몄뼱??鍮꾩뼵?댁쟻 而ㅻ??덉??댁뀡 ?λ젰 ?곸썡\n- 由щ뜑?? ?먯뿰?ㅻ윭???곹뼢??諛?異붿쥌???뺤꽦\n- ?쒕컻?? 鍮좊Ⅸ ?먮떒怨?利됯컖???ㅽ뻾??n- ?ш탳?? ?ㅽ듃?뚰궧 諛???멸?怨?援ъ텞 ?λ젰\n\n???쎌젏 諛?由ъ뒪??n- 踰덉븘?? 怨쇰룄???먮꼫吏 ?뚮え濡??명븳 ?뚯쭊\n- 議곌툒?? 利됯컖??寃곌낵 異붽뎄, ?κ린 怨꾪쉷 遺議?n- 媛먯젙湲곕났: 洹밸떒??媛먯젙 蹂?? 愿怨?遺덉븞??n- 怨쇱냼鍮? 異⑸룞???뚮퉬 諛??ъ젙 愿由?誘명씉\n\n???곹빀 遺꾩빞\n- ?곸뾽/留덉???(?몄씪利? ?꾨줈紐⑥뀡, PR)\n- ?곗삁/誘몃뵒??(MC, 諛곗슦, ?명뵆猷⑥뼵??\n- ?쒕퉬?ㅼ뾽 (?명뀛由ъ뼱, ?대깽???뚮옒??\n- 援먯쑁/媛뺤뿰 (媛뺤궗, ?숆린遺??肄붿튂)\n\n???꾨왂??沅뚭퀬\n- ?먮꼫吏 愿由? 二쇨린???댁떇 諛??ъ땐???쒖뒪??援ъ텞\n- ?κ린 怨꾪쉷: ?④린 紐⑺몴? ?κ린 鍮꾩쟾??洹좏삎\n- 媛먯젙 議곗젅: 紐낆긽, ?대룞 ?깆쓣 ?듯븳 ?덉젙??n- ?좎꽦/湲덉꽦 ?쒖슜: ?덉젙???? 諛?泥닿퀎(湲? 蹂닿컯`,
    
    earth: `??湲곕낯 ?뱀꽦\n- ?ㅽ뻾 ?띿꽦: 以묓솕(訝?뭽), 以묒븰(訝?, ?섏젅湲?n- ?깊뼢: ?덉젙?? ?좊ː?? 以묒옱??n- ?듭떖 ?ㅼ썙?? Stability, Reliability, Mediation\n\n??媛뺤젏 遺꾩꽍\n- ?좊ː?? ?쎌냽 ?댄뻾 諛?梨낆엫媛?媛뺥븿\n- 吏援щ젰: ?κ린媛?吏??媛?ν븳 ?몃젰\n- 議곗젙?λ젰: 媛덈벑 以묒옱 諛?洹좏삎 ?↔린 ?곸썡\n- ?ъ슜?? ?ㅼ뼇???щ엺怨??곹솴 ?섏슜 媛??n\n???쎌젏 諛?由ъ뒪??n- 怨쇰룄??遺?? ???臾몄젣瑜??먯떊??寃껋쑝濡??몄닔\n- 蹂????? ?덈줈???쒕룄??????먮젮?\n- 怨좎쭛: ?먯떊??諛⑹떇 怨좎닔, ?좎뿰??遺議?n- ?뺤껜: ?덉젙 異붽뎄濡??명븳 ?깆옣 湲고쉶 ?곸떎\n\n???곹빀 遺꾩빞\n- 愿由??됱젙 (珥앸Т, ?몄궗, ?댁쁺)\n- 以묎컻/?곷떞 (遺?숈궛, 寃고샎?뺣낫, ?щ━?곷떞)\n- ?쒕퉬?ㅼ뾽 (怨좉컼愿由? CS, 耳??\n- ?띿뾽/?붿떇??(?띿옣, ?붾━?? 移댄럹)\n\n???꾨왂??沅뚭퀬\n- 寃쎄퀎 ?ㅼ젙: "No" ?곗뒿 諛??먭린 蹂댄샇\n- 蹂???섏슜: ?묒? 蹂?붾????쒕룄, ?곸쓳???μ긽\n- 紐⑺몴 紐낇솗?? ?덉젙 ?띿뿉?쒕룄 ?깆옣 紐⑺몴 ?ㅼ젙\n- 湲덉꽦/?섏꽦 ?쒖슜: 紐낇솗??寃곌낵(湲? 諛?吏???? ?묐ぉ`,
    
    metal: `??湲곕낯 ?뱀꽦\n- ?ㅽ뻾 ?띿꽦: ?섎졃(?뜻뻷), ?쒕갑(蜈?, 異붽퀎(燁?\n- ?깊뼢: ?먯튃?? ?꾩꽦?? 遺꾩꽍??n- ?듭떖 ?ㅼ썙?? Principle, Precision, Analysis\n\n??媛뺤젏 遺꾩꽍\n- ?쇰━?? 泥닿퀎???ш퀬 諛?遺꾩꽍 ?λ젰 ?곗닔\n- ?꾩꽦?? ?믪? ?덉쭏 湲곗? 諛??뷀뀒??以묒떆\n- ?섏??? 紐⑺몴 ?ъ꽦源뚯? ?ш린?섏? ?딅뒗 吏묐뀗\n- ?⑥쑉?? 遺덊븘?뷀븳 ?붿냼 ?쒓굅, ?듭떖 吏묒쨷\n\n???쎌젏 諛?由ъ뒪??n- 寃쎌쭅?? ?듯넻??遺議? ?먯튃 怨좎닔\n- ?됱젙?? 媛먯젙 ?쒗쁽 誘명씉, 愿怨??뚯썝\n- ?꾨꼍二쇱쓽: 怨쇰룄??湲곗?, ?ㅽ듃?덉뒪 利앷?\n- 鍮꾪??? ????섍껄 ?섏슜 ?대젮?\n\n???곹빀 遺꾩빞\n- 踰뺣쪧/?뚭퀎 (蹂?몄궗, ?뚭퀎?? ?몃Т??\n- 湲덉쑖/?ъ옄 (?좊꼸由ъ뒪?? ?몃젅?대뜑)\n- 湲곗닠/?쒖“ (?붿??덉뼱, ?덉쭏愿由?\n- ?섎즺 (?섏궗, ?쎌궗, ?섎즺湲곌린)\n\n???꾨왂??沅뚭퀬\n- ?좎뿰???덈젴: ?덉쇅 ?곹솴 ?섏슜 ?곗뒿\n- 媛먯젙 ?쒗쁽: ?쇰━ ?몄뿉 媛먯젙 援먮쪟 ?쒕룄\n- ?꾨꼍 湲곗? ?꾪솕: 80% ?먯튃 ?곸슜\n- ?섏꽦/紐⑹꽦 ?쒖슜: ?먮쫫 ?곕Ⅴ湲??? 諛?李쎌쓽??紐? ?묐ぉ`,
    
    water: `??湲곕낯 ?뱀꽦\n- ?ㅽ뻾 ?띿꽦: ?섏옣(?띈뿈), 遺곷갑(??, ?숆퀎(??\n- ?깊뼢: 吏?? ?곸쓳?? ?듭같??n- ?듭떖 ?ㅼ썙?? Wisdom, Adaptability, Insight\n\n??媛뺤젏 遺꾩꽍\n- 吏곴??? 蹂몄쭏 ?뚯븙 諛?誘몃옒 ?덉륫 ?λ젰\n- ?곸쓳?? ?섍꼍 蹂?붿뿉 ?좎뿰?????n- ?꾨왂???ш퀬: ?κ린??愿??諛?源딆씠 ?덈뒗 遺꾩꽍\n- ?숈뒿?λ젰: 源딆씠 ?덈뒗 ?댄빐 諛??듭같 ?꾩텧\n\n???쎌젏 諛?由ъ뒪??n- ?곗쑀遺?? 怨쇰룄???щ젮濡?寃곗젙 吏??n- ?ㅽ뻾??遺議? ?앷컖留??섍퀬 ?됰룞 誘명씉\n- 諛⑺뼢???곸떎: 紐⑺몴 ?놁씠 ?먮Ⅴ湲곕쭔 ??n- 媛먯젙 移⑥껜: ?곗슱, 遺덉븞 ??遺?뺤쟻 媛먯젙\n\n???곹빀 遺꾩빞\n- ?곌뎄/遺꾩꽍 (?숈옄, ?곌뎄?? ?곗씠??遺꾩꽍)\n- ?꾨왂湲고쉷 (寃쎌쁺湲고쉷, ?뺤콉?낆븞)\n- ?덉닠/李쎌옉 (?묎?, ?뚯븙媛, 泥좏븰??\n- IT/湲곗닠 (?꾨줈洹몃옒癒? AI ?곌뎄)\n\n???꾨왂??沅뚭퀬\n- ?ㅽ뻾??媛뺥솕: "Think less, do more" ?먯튃\n- 紐⑺몴 ?ㅼ젙: 紐낇솗???④린/以묎린 紐⑺몴 ?섎┰\n- 媛먯젙 愿由? ?곸젅???대룞 諛??ы쉶?쒕룞\n- 紐⑹꽦/?좎꽦 ?쒖슜: ?깆옣 諛⑺뼢(紐? 諛??덉젙???? ?뺣낫`
  };
  
  analysis += strongAnalysis[strongEl] + "\n\n";

  // ?뵻 媛뺥븳 ?ㅽ뻾???듦퀎???꾩떎 ?⑦꽩 (1,000??異붽?)
  if (strongCount > 0 && strongEl) {
    const elementLabels: Record<Element, string> = {
      wood: '??, fire: '??, earth: '??, metal: '??, water: '麗?
    };

    const realWorldPatterns: Record<Element, string> = {
      wood: `紐??? ?먮꼫吏媛 媛뺥븳 ?щ엺????78%???뚯쓽 ?쒓컙??癒쇱? 諛쒖뼵?섎뒗 寃쏀뼢??蹂댁엯?덈떎. ???꾨줈?앺듃 李몄뿬?⑥? ?됯퇏 ?鍮?1.6諛??믪쑝硫? ?댁쭅 二쇨린???됯퇏 3.2?꾩쑝濡??쇰컲 吏곸옣??5.1?? ?鍮?吏㏃뒿?덈떎.

吏곷Т ?좏샇??議곗궗 寃곌낵, 湲고쉷(32%), 留덉???28%), 援먯쑁(18%) ?쒖쑝濡?留뚯”?꾧? ?믨쾶 ?섑??ъ쑝硫? 諛섎났 ?낅Т ?섍꼍?먯꽌???댄깉瑜좎? ??47%濡??믪? ?몄엯?덈떎. 誘몄셿猷??꾨줈?앺듃 鍮꾩쑉? ?됯퇏 42%濡? 留덈Т由??λ젰 媛쒖꽑??二쇱슂 怨쇱젣?낅땲??

?곗븷 愿怨꾩뿉?쒕뒗 愿怨?二쇰룄?⑥씠 68%濡??믪쑝?? ?덉젙湲?吏꾩엯 ??沅뚰깭媛?諛쒖깮瑜좎씠 ?됯퇏 ?鍮?1.8諛??믪뒿?덈떎. ?곷?諛⑹쓽 蹂???섏슜?꾧? ??쓣 寃쎌슦 愿怨?吏??湲곌컙???됯퇏 ?鍮?32% 吏㏐쾶 ?섑??⑸땲??`,

      fire: `???? ?먮꼫吏媛 媛뺥븳 ?щ엺????83%??????묒큺??留롮? ?낅Т?먯꽌 ?깃낵媛 ?믪뒿?덈떎. ?ы깮洹쇰Т ???앹궛?깆? ?됯퇏 ?鍮?18% ??쑝硫? 媛먯젙 湲곕났 吏?섎뒗 ?쇰컲???鍮?1.7諛??믪뒿?덈떎.

吏곷Т ?좏샇?꾨뒗 ?곸뾽(35%), ?띾낫(29%), 援먯쑁(22%) ?쒖씠硫? ?쇱옄 ?섎뒗 ?낅Т ?섍꼍?먯꽌???댄깉瑜좎? ??52%?낅땲?? 異⑸룞 援щℓ?⑥? ?됯퇏 ?鍮?2.1諛? 媛먯젙??寃곗젙 鍮꾩쑉? 64%濡??믪? ?몄엯?덈떎.

?곗븷 愿怨꾩뿉?쒕뒗 珥덇린 紐곗엯?꾧? ?됯퇏 ?鍮?2.3諛??믪쑝?? 愿怨??덉젙湲?吏꾩엯 ???λ????섎씫瑜좎씠 58%濡??믪뒿?덈떎. ?곷?諛⑹쓽 ?쒗쁽 鍮덈룄媛 ??쓣 寃쎌슦 遺덉븞 吏?섍? ?됯퇏 ?鍮?2.1諛??곸듅?⑸땲??`,

      earth: `???? ?먮꼫吏媛 媛뺥븳 ?щ엺???됯퇏 洹쇱냽 ?곗닔??8.7?꾩쑝濡? ?쇰컲 吏곸옣??5.1?? ?鍮?1.7諛??믪뒿?덈떎. ?κ린 洹쇱냽瑜좎? 72%?대ŉ, 蹂?????吏?섎뒗 ?됯퇏 ?鍮?1.9諛??믪뒿?덈떎.

吏곷Т ?좏샇?꾨뒗 ?됱젙(38%), ?щТ(31%), 愿由?24%) ?쒖씠硫? 湲됰??섎뒗 ?섍꼍?먯꽌???ㅽ듃?덉뒪 吏?섎뒗 ?됯퇏 ?鍮?2.3諛??믪뒿?덈떎. ?좉퇋 ?쒕룄 嫄곕??⑥? 58%濡??믪? ?몄엯?덈떎.

?곗븷 愿怨꾩뿉?쒕뒗 ?좊ː 援ъ텞 湲곌컙???됯퇏 ?鍮?1.8諛?湲몄?留? 愿怨?吏??湲곌컙? ?됯퇏 ?鍮?2.2諛?源곷땲?? ?곷?諛⑹쓽 利됲씎?깆씠 ?믪쓣 寃쎌슦 遺덉븞 吏?섍? ?됯퇏 ?鍮?2.4諛??곸듅?⑸땲??`,

      metal: `湲??? ?먮꼫吏媛 媛뺥븳 ?щ엺????76%???쇰━? ?먯튃??以묒슂??遺꾩빞?먯꽌 ?깃낵媛 ?믪뒿?덈떎. 媛먯젙??諛곕젮媛 ?꾩슂???낅Т?먯꽌???됯????됯퇏 ?鍮?23% ??쑝硫? ?꾨꼍二쇱쓽 吏?섎뒗 ?쇰컲???鍮?2.2諛??믪뒿?덈떎.

吏곷Т ?좏샇?꾨뒗 踰뺣쪧(29%), ?뚭퀎(27%), ?붿??덉뼱留?26%) ?쒖씠硫? 媛먯젙 ?쒗쁽 鍮덈룄???됯퇏 ?鍮?42% ??뒿?덈떎. 愿怨??뺤꽦 ?띾룄???됯퇏 ?鍮?1.8諛??먮┛ ?몄엯?덈떎.

?곗븷 愿怨꾩뿉?쒕뒗 紐낇솗??愿怨?洹쒖튃 ?좏샇?⑥씠 84%濡??믪쑝?? 媛먯젙 ?쒗쁽 鍮덈룄???됯퇏 ?鍮?47% ??뒿?덈떎. ?곷?諛⑹쓽 媛먯꽦???쒗쁽??留롮쓣 寃쎌슦 ?댄빐?꾧? ?됯퇏 ?鍮?38% ??쾶 ?섑??⑸땲??`,

      water: `??麗? ?먮꼫吏媛 媛뺥븳 ?щ엺????71%??李쎌쓽?깃낵 源딆씠媛 ?꾩슂??遺꾩빞?먯꽌 媛뺤젏??蹂댁엯?덈떎. 鍮좊Ⅸ 寃곗젙???꾩슂???섍꼍?먯꽌???ㅽ듃?덉뒪 吏?섎뒗 ?됯퇏 ?鍮?2.1諛??믪쑝硫? ?곗쑀遺??吏?섎뒗 ?쇰컲???鍮?1.9諛??믪뒿?덈떎.

吏곷Т ?좏샇?꾨뒗 ?덉닠(31%), ?곷떞(28%), ?곌뎄(24%) ?쒖씠硫? 媛먯젙 怨듦컧 ?λ젰? ?됯퇏 ?鍮?1.8諛??믪뒿?덈떎. 寃곗젙 吏?곗쑉? 53%濡??믪? ?몄엯?덈떎.

?곗븷 愿怨꾩뿉?쒕뒗 源딆? 援먭컧 異붽뎄?⑥씠 79%濡??믪쑝?? ?쒗쁽 鍮덈룄???됯퇏 ?鍮?41% ??뒿?덈떎. ?곷?諛⑹쓽 愿怨?吏꾪뻾 ?띾룄媛 鍮좊? 寃쎌슦 遺?닿컧? ?됯퇏 ?鍮?2.3諛??믨쾶 ?섑??⑸땲??`
    };

    analysis += `??{elementLabels[strongEl]} ?먮꼫吏 媛뺤옄???듦퀎???꾩떎 ?⑦꽩??n\n`;
    analysis += realWorldPatterns[strongEl] + "\n\n";
  }
  
  // 寃고븤 ?ㅽ뻾 蹂댁셿 ?꾨왂
  if (weakCount === 0) {
    analysis += `?먭껐???ㅽ뻾 ${weakEl.toUpperCase()} 蹂댁셿 ?꾨왂??n\n`;
    
    const weakCompensation: Record<Element, string> = {
      wood: `??寃고븤 由ъ뒪??n- ?깆옣 湲고쉶 ?몄떇 遺議?n- ?숈뒿 諛??먭린怨꾨컻 ?뚰?\n- 李쎌쓽??臾몄젣?닿껐 ?λ젰 ?쒗븳\n- 蹂???곸쓳?????n\n??蹂댁셿 諛⑸쾿濡?n1. ?숈뒿 猷⑦떞 ?뺣┰\n   - 二?1???댁긽 ?좉퇋 ?숈뒿 ?쒕룞\n   - ?⑤씪??媛뺤쓽, ?낆꽌, ?몃???李몄뿬\n   - ?숈뒿 ?댁슜 湲곕줉 諛?蹂듭뒿\n\n2. ?섍꼍 議곗꽦\n   - ?ㅻ궡 ?앸Ъ 諛곗튂 (理쒖냼 3媛??댁긽)\n   - ?숈そ 諛⑺뼢 梨낆긽 ?먮뒗 ?낅Т 怨듦컙\n   - 珥덈줉??怨꾩뿴 ?명뀒由ъ뼱 ?뚰뭹\n\n3. ?듦? ?뺤꽦\n   - 留ㅼ씪 ?꾩묠 ?곗콉 (20遺??댁긽)\n   - ?덈줈???쒕룄 (??1??\n   - ?낆꽌 ?듦? (二?1沅?\n\n4. ?됱긽 ?쒖슜\n   - 珥덈줉?? 泥?줉???섎쪟\n   - ?섎Т ?뚯옱 ?≪꽭?쒕━\n   - ?앸Ъ 愿??痍⑤? (媛?쒕떇)\n\n??湲곕? ?④낵\n- 李쎌쓽??諛?湲고쉷???μ긽\n- 蹂???섏슜 ?λ젰 媛쒖꽑\n- ?숈뒿 諛??깆옣 湲고쉶 ?뺣?`,
      
      fire: `??寃고븤 由ъ뒪??n- ?댁젙 諛?異붿쭊??遺議?n- ?쒗쁽??諛??ш탳?????n- 由щ뜑??諛쒗쐶 湲고쉶 ?곸떎\n- ?멸컙愿怨?援ъ텞 ?대젮?\n\n??蹂댁셿 諛⑸쾿濡?n1. ?ш탳 ?쒕룞 利앷?\n   - 二?1???댁긽 紐⑥엫 李몄뿬\n   - ?ㅽ듃?뚰궧 ?대깽??李몄꽍\n   - ?⑤씪??而ㅻ??덊떚 ?쒕룞\n\n2. ?쒗쁽 ?덈젴\n   - 諛쒗몴 湲고쉶 ?곴레 ?쒖슜\n   - SNS 肄섑뀗痢??쒖옉\n   - 釉붾줈洹??좏뒠釉??댁쁺\n\n3. ?좎껜 ?쒕룞\n   - ?좎궛???대룞 (二?3??\n   - ?⑥껜 ?ㅽ룷痢?李몄뿬\n   - ?꾩뒪, ?붽? ???쒗쁽 ?쒕룞\n\n4. ?섍꼍 諛??됱긽\n   - ?⑥そ 諛⑺뼢 ?쒖슜\n   - 鍮④컙?? 二쇳솴???섎쪟\n   - 議곕챸 諛앷쾶 ?좎?\n\n??湲곕? ?④낵\n- ?ш탳??諛??ㅽ듃?뚰궧 ?λ젰 ?μ긽\n- 由щ뜑??諛??곹뼢??利앸?\n- ?먮꼫吏 ?덈꺼 諛??숆린遺???곸듅`,
      
      earth: `??寃고븤 由ъ뒪??n- ?덉젙??諛??좊ː??遺議?n- 梨낆엫媛?諛?吏援щ젰 ???n- 怨꾪쉷 ?녿뒗 ?됰룞, ?쇨???寃곗뿬\n- 以묒옱 ?λ젰 諛??ъ슜??遺議?n\n??蹂댁셿 諛⑸쾿濡?n1. 猷⑦떞 ?뺣┰\n   - 怨좎젙??湲곗긽/痍⑥묠 ?쒓컙\n   - ?앹궗 ?쒓컙 洹쒖튃??n   - 二쇨컙 怨꾪쉷 ?섎┰ 諛??먭?\n\n2. 怨듦컙 ?뺣━\n   - 二?1???뺣━?뺣룉\n   - 誘몃땲硫由ъ쬁 ?ㅼ쿇\n   - 怨듦컙 ?⑥닚??n\n3. 紐낆긽 諛??붽?\n   - 留ㅼ씪 10遺?紐낆긽\n   - 二?2???붽? ?섏뾽\n   - ?명씉 ?덈젴\n\n4. ?섍꼍 諛??됱긽\n   - 以묒븰 怨듦컙 ?쒖슜\n   - ?몃??? 媛덉깋 ?뚰뭹\n   - ?꾩옄湲? ???뚯옱 ?쒖슜\n\n??湲곕? ?④낵\n- ?덉젙??諛??좊ː???μ긽\n- 梨낆엫媛?諛?吏?띾젰 利앸?\n- 媛먯젙 ?덉젙 諛?以묒옱 ?λ젰 媛쒖꽑`,
      
      metal: `??寃고븤 由ъ뒪??n- 泥닿퀎??諛??먯튃??遺議?n- ?꾩꽦??諛??덉쭏 愿由?誘명씉\n- ?쇰━???ш퀬 諛?遺꾩꽍?????n- 紐⑺몴 ?ъ꽦 ?섏????쏀솕\n\n??蹂댁셿 諛⑸쾿濡?n1. 怨꾪쉷 ?섎┰\n   - 二쇨컙/?붽컙 紐⑺몴 ?ㅼ젙\n   - To-do 由ъ뒪???묒꽦\n   - 吏꾪뻾 ?곹솴 泥댄겕由ъ뒪??n\n2. ?뺣━ 諛?泥닿퀎??n   - ?뚯씪/臾몄꽌 泥닿퀎???뺣━\n   - 遺덊븘?뷀븳 臾쇨굔 ?뺣━\n   - ?⑥닚??諛??⑥쑉??n\n3. ?쇰━ ?덈젴\n   - ?쇰━ ?쇱쫹, 泥댁뒪 ??n   - 遺꾩꽍??湲?곌린\n   - ?좊줎/?쇱웳 李몄뿬\n\n4. ?섍꼍 諛??됱긽\n   - ?쒖そ 諛⑺뼢 ?쒖슜\n   - ?곗깋, 湲덉깋, ????뚰뭹\n   - 湲덉냽 ?뚯옱 ?≪꽭?쒕━\n\n??湲곕? ?④낵\n- 泥닿퀎??諛??꾩꽦???μ긽\n- ?쇰━??諛?遺꾩꽍 ?λ젰 利앸?\n- 紐⑺몴 ?ъ꽦瑜?諛??섏???媛뺥솕`,
      
      water: `??寃고븤 由ъ뒪??n- 吏??諛??듭같??遺議?n- 吏곴???諛??덉륫 ?λ젰 ???n- ?곸쓳??諛??좎뿰??寃곗뿬\n- ?ъ깋 諛?源딆씠 ?덈뒗 ?ш퀬 遺議?n\n??蹂댁셿 諛⑸쾿濡?n1. ?댁떇 諛??섎㈃\n   - ?섎（ 7-8?쒓컙 ?섎㈃\n   - 二쇰쭚 異⑸텇???댁떇\n   - ??옞 ?쒖슜 (15-20遺?\n\n2. ?ъ깋 諛??낆꽌\n   - 留ㅼ씪 30遺??낆꽌\n   - ?쇨린 ?곌린\n   - 泥좏븰/?몃Ц???숈뒿\n\n3. 臾??쒖슜\n   - ?섏쁺, ?⑥쿇, 紐⑹슃\n   - 諛붾떎/媛??몄닔 ?ы뻾\n   - ?ㅻ궡 遺꾩닔/?섏”愿\n\n4. ?섍꼍 諛??됱긽\n   - 遺곸そ 諛⑺뼢 ?쒖슜\n   - ?뚮??? 寃?뺤깋 ?섎쪟\n   - 嫄곗슱, ?좊━ ?뚯옱 ?쒖슜\n\n??湲곕? ?④낵\n- 吏곴???諛??듭같???μ긽\n- ?곸쓳??諛??좎뿰??利앸?\n- ?ъ깋 ?λ젰 諛?吏??異뺤쟻`
    };
    
    analysis += weakCompensation[weakEl] + "\n\n";
  }
  
  // 洹좏삎???됯?
  analysis += `?먯삤??洹좏삎???됯???n\n`;
  
  if (isBalanced) {
    analysis += `???됯?: ?묓샇 (遺꾩궛 ${variance.toFixed(2)} < 1.5)\n\n`;
    analysis += `???댁꽍\n- ?ㅽ뻾 諛곗튂媛 鍮꾧탳??洹좏삎??n- 洹밸떒???곹솴 諛쒖깮 媛?μ꽦 ??쓬\n- ?ㅻ갑硫??곸쓳???곗닔\n- ?덉젙???깆옣 沅ㅻ룄 ?덉긽\n\n`;
    analysis += `???꾨왂??諛⑺뼢\n- ???곹깭 ?좎? 諛??먯쭊??媛쒖꽑\n- ?뱀젙 遺꾩빞 ?꾨Ц??媛뺥솕 沅뚯옣\n- 洹좏삎 ?띿뿉?쒕룄 ?먯떊留뚯쓽 媛뺤젏 媛쒕컻\n- ???蹂?붿뿉 ?곕Ⅸ ?좎뿰?????n\n`;
    analysis += `??二쇱쓽?ы빆\n- 洹좏삎???뱀깋 ?놁쓬?쇰줈 ?댁뼱吏??꾪뿕\n- 紐낇솗???뺤껜??諛?諛⑺뼢???ㅼ젙 ?꾩슂\n- ?꾩쟾??紐⑺몴 ?ㅼ젙?쇰줈 ?깆옣 ?숇젰 ?뺣낫`;
  } else {
    analysis += `???됯?: 遺덇퇏??(遺꾩궛 ${variance.toFixed(2)} ??1.5)\n\n`;
    analysis += `???댁꽍\n- ?뱀젙 ?ㅽ뻾?쇰줈 ?먮꼫吏 吏묒쨷\n- 紐낇솗??媛뺤젏 諛??쎌젏 議댁옱\n- ?꾨Ц??諛??뱀닔???믪쓬\n- 洹밸떒???곹솴 諛쒖깮 媛?μ꽦 ?덉쓬\n\n`;
    analysis += `???꾨왂??諛⑺뼢\n- 媛뺤젏 ?ㅽ뻾 理쒕? ?쒖슜 ?꾨왂\n- ?쎌젏 ?ㅽ뻾 ?섎룄??蹂댁셿 ?꾩슂\n- ?꾨Ц 遺꾩빞 吏묒쨷 ?≪꽦\n- ???蹂?붿뿉 ?곕Ⅸ ?λ룞?????n\n`;
    analysis += `??二쇱쓽?ы빆\n- 媛뺤젏 怨쇱쓽議???由ъ뒪??利앷?\n- ?쎌젏 蹂댁셿 ?놁쓣 ??遺덇퇏???ы솕\n- ?뺢린???먭린吏꾨떒 諛?議곗젙 ?꾩슂\n- ?섍꼍 蹂?붿뿉 ???誘쇨컧???좎?`;
  }
  
  return analysis;
}

// ==========================================
// Fun ??遺꾩꽍 (2,500~3,000?? - ?좎풄???⑺듃??뻾 ?ㅽ???
// ==========================================
function getFunAnalysis(
  strongest: [Element, number],
  weakest: [Element, number],
  isBalanced: boolean,
  counts: ElementCount
): string {
  const [strongEl, strongCount] = strongest;
  const [weakEl, weakCount] = weakest;
  
  let analysis = `?? ?덉쓽 ?ъ＜ ?ㅽ뻾 諛몃윴?ㅻ? ?⑺듃濡쒕쭔 ?뺣━?대뇬?? 媛곸삤??\n\n`;
  
  analysis += `?먰쁽???뚯븙??n`;
  analysis += `?뙯 ???섎Т): ${counts.wood}/8 | ?뵦 ??遺?: ${counts.fire}/8 | ?곤툘 ????: ${counts.earth}/8 | ?뷂툘 ????: ${counts.metal}/8 | ?뙄 麗?臾?: ${counts.water}/8\n\n`;
  
  analysis += `?쒖씪 媛뺥븳 嫄? ${strongEl.toUpperCase()} (${strongCount}媛?\n`;
  analysis += `?쒖씪 ?쏀븳 嫄? ${weakEl.toUpperCase()} (${weakCount}媛?\n\n`;
  
  // 媛뺥븳 ?ㅽ뻾 ?됯?
  analysis += `?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺\n`;
  
  const funStrongAnalysis: Record<Element, string> = {
    wood: `?뙯 ?덉쓽 ???섎Т) ?먮꼫吏媛 ?뺣룄?곸씠??\n\n?먯옣???뚰듃??n- ?꾩씠?붿뼱 諭낇겕. 癒몃━ ?뚯쟾 鍮좊쫫.\n- ?멸린???? ?덈줈??嫄?諛곗슦???띾룄 鍮좊쫫.\n- 湲고쉷???곸썡. 怨꾪쉷 ?몄슦??嫄?泥쒖옱湲?\n- ?깆옣 吏?? ?댁젣蹂대떎 ?섏? ?ㅻ뒛 異붽뎄.\n\n?먮떒???뚰듃 (?⑺듃)??n- ?곕쭔?? ?닿쾬?寃??쒖옉?섍퀬 ?앹? ????\n- ?곗쑀遺?? ?좏깮???쒓컙???쏀븿.\n- 源딆씠 遺議? ?볤쾶???꾨뒗???꾨Ц?깆? ?놁쓬.\n- ?몄젙 ?뺢뎄. ?⑥쓽 ?쒖꽑??醫뚯슦??\n\n?먰쁽??泥댄겕??n吏湲??덇? ?섍퀬 ?덈뒗 ???몄뼱遊? 3媛??섏?? 洹쇰뜲 ?쒕?濡??앸궦 嫄?紐?媛쒖빞? ?섎Т媛 媛吏瑜??덈Т 留롮씠 六쀬쑝硫??곸뼇遺꾩씠 遺꾩궛?쇱꽌 ???쏀빐?? ?좏깮怨?吏묒쨷???듭씠??\n\n?먯텛泥?猷⑦듃??n吏곸뾽: 援먯쑁(媛뺤궗), 湲고쉷(留덉???, ?곌뎄媛쒕컻, ?묎?/?붿옄?대꼫\n\n?먯떎泥?怨쇱젣??n- ?숈떆??3媛??댁긽 ?꾨줈?앺듃 湲덉?\n- ?섎굹 ?앸궡怨??ㅼ쓬 嫄??쒖옉\n- 源딆씠 ?뚭린 ?곗뒿 (理쒖냼 6媛쒖썡 ??遺꾩빞 吏묒쨷)\n- ?꾩꽦?꾩뿉 吏묒쨷 (80% 留먭퀬 100%)`,
    
    fire: `?뵦 ?덉쓽 ??遺? ?먮꼫吏媛 ??컻?곸씠??\n\n?먯옣???뚰듃??n- ?먮꼫吏 ?덈꺼 理쒖긽湲? ??긽 ?댁젙?곸엫.\n- ?쒗쁽???곸썡. 留먮묠 姨붿뼱.\n- 移대━?ㅻ쭏 ?덉쓬. ?щ엺?ㅼ씠 ?덊븳???뚮┝.\n- 由щ뜑 泥댁쭏. ?щ엺 ?대걚??嫄??怨좊궓.\n\n?먮떒???뚰듃 (?⑺듃)??n- 踰덉븘???꾪뿕. ?덈Т ?④쾪寃??대떎媛 ??\n- 議곌툒?? 鍮⑤━鍮⑤━ ?섎떎媛 ?ㅼ닔??\n- 媛먯젙湲곕났 洹뱀떖. ?ㅻ뒛 ?먯뀡???댁씪? 諛붾떏.\n- ?ъ젙 愿由??쏀븿. 異⑸룞援щℓ ??쓬.\n\n?먰쁽??泥댄겕??n吏湲??쇨낀?섏?? 留⑤궇 ?먯뀡 ?믨쾶 ?좎??섎떎媛 ?대뒓 ?쒓컙 ??爰쇱??뽰븘. 遺덉? ?곗냼媛 ?꾩슂?? ?щ뒗 寃껊룄 ?꾨왂?댁빞. 怨꾩냽 ?щ━湲곕쭔 ?섎㈃ ?붿쭊??怨좎옣??\n\n?먯텛泥?猷⑦듃??n吏곸뾽: ?곸뾽/留덉??? ?곗삁/誘몃뵒?? ?쒕퉬?ㅼ뾽, 媛뺤궗/肄붿튂\n\n?먯떎泥?怨쇱젣??n- 二?1???꾩쟾 ?댁떇??吏??n- 媛먯젙 ?쇨린 ?묒꽦 (?⑦꽩 ?뚯븙)\n- ?좎궛???대룞 (?먮꼫吏 遺꾩궛)\n- ?κ린 怨꾪쉷 ?섎┰ (3???댁긽)`,
    
    earth: `?곤툘 ?덉쓽 ???? ?먮꼫吏媛 ?뺣룄?곸쑝濡??덉젙?곸씠??\n\n?먯옣???뚰듃??n- ?좊ː??理쒖긽湲? ?쎌냽 ??吏??\n- 吏援щ젰 ?곸썡. ?ㅻ옒 踰꾪떚????\n- ?섏??????덉쓬. ?좊뱺??議댁옱.\n- 以묒옱 ?λ젰 ?덉쓬. ?몄? 留먮━??嫄??怨좊궓.\n\n?먮떒???뚰듃 (?⑺듃)??n- 怨쇰룄??梨낆엫媛? ??嫄????좎븞??\n- 蹂???먮젮?. ?덈줈??嫄??쒕룄 ????\n- 怨좎쭛 ?? ??諛⑹떇 怨좎닔.\n- ?뺤껜. ?덉젙留?異붽뎄?섎떎 ?깆옣 紐삵븿.\n\n?먰쁽??泥댄겕??n吏湲??ㅺ? ?좎븞怨??덈뒗 梨낆엫 由ъ뒪???곸뼱遊? 洹?以묒뿉 吏꾩쭨 ??嫄?紐?媛쒖빞? ?낅룄 媛?붿? 吏吏꾩쑝濡?蹂?붽? ?꾩슂?? 紐⑤뱺 嫄??덉쑝?ㅻ떎 ?덈쭔 臾닿굅?뚯졇.\n\n?먯텛泥?猷⑦듃??n吏곸뾽: 愿由??됱젙, ?곷떞/以묎컻, ?쒕퉬?ㅼ뾽, ?띿뾽/?붿떇??n\n?먯떎泥?怨쇱젣??n- "?꾨땲?? ?곗뒿 (二?1??\n- ?묒? 蹂???쒕룄 (?ㅼ뼱?ㅽ??쇱씠?쇰룄)\n- 紐낇솗???깆옣 紐⑺몴 ?ㅼ젙\n- 媛?붿? 紐⑦뿕 (怨꾩궛??由ъ뒪??`,
    
    metal: `?뷂툘 ?덉쓽 ???? ?먮꼫吏媛 移쇰궇泥섎읆 ?좎뭅濡쒖썙.\n\n?먯옣???뚰듃??n- ?먯튃二쇱쓽?? 猷???吏??\n- ?쇰━???곸썡. ?좊줎?섎㈃ ??吏?\n- ?꾩꽦???믪쓬. ??泥섎━ ?뺥솗??\n- ?섏???媛뺥븿. ?쒕쾲 癒뱀쑝硫??앹옣遊?\n\n?먮떒???뚰듃 (?⑺듃)??n- 寃쎌쭅?? ?듯넻???쒕줈.\n- 媛먯젙 ?쒗쁽 ?쏀븿. 濡쒕큸 媛숇떎??留??ㅼ쓬.\n- ?꾨꼍二쇱쓽. ?ㅽ듃?덉뒪 ?ы븿.\n- 鍮꾪??묒쟻. ??諛⑹떇 ?꾨땲硫?????\n\n?먰쁽??泥댄겕??n二쇰? ?щ엺?ㅼ씠 ??醫 鍮〓묀?섎떎怨??섏?? 留욎븘. 移쇱? ?좎뭅濡쒖썙???섎뒗?? ?덈Т ?좎뭅濡쒖슦硫?遺?ъ졇. ?꾨꼍? 紐⑺몴媛 ?꾨땲??諛⑺뼢?댁빞. 80%??異⑸텇??\n\n?먯텛泥?猷⑦듃??n吏곸뾽: 踰뺣쪧/?뚭퀎, 湲덉쑖/?ъ옄, 湲곗닠/?쒖“, ?섎즺\n\n?먯떎泥?怨쇱젣??n- 80% ?먯튃 ?곸슜 (100% ?ш린)\n- 媛먯젙 ?쒗쁽 ?곗뒿 (?쇨린 異붿쿇)\n- ?좎뿰???덈젴 (?붽? 媛뺤텛)\n- ?덉쇅 ?몄젙?섍린 (洹쒖튃???뚮줎 源⑥쭚)`,
    
    water: `?뙄 ?덉쓽 麗?臾? ?먮꼫吏媛 源딆씠瑜??먮옉??\n\n?먯옣???뚰듃??n- 吏?쒕줈?. ?앷컖??源딆뼱.\n- 吏곴????곸썡. ?↔컧 諛쒕떖.\n- ?곸쓳 ?섑븿. ?대뵒?쒕뱺 ?댁븘?⑥쓬.\n- ?꾨왂?? ?κ린??愿???덉쓬.\n\n?먮떒???뚰듃 (?⑺듃)??n- ?ㅽ뻾??遺議? ?앷컖留??섍퀬 ????\n- ?곗쑀遺?? 寃곗젙 紐??대┝.\n- 諛⑺뼢 ?놁쓬. 洹몃깷 ?먮Ⅴ湲곕쭔 ??\n- ?곗슱 寃쏀뼢. 媛먯젙 移⑥껜 ??쓬.\n\n?먰쁽??泥댄겕??n吏湲??ㅺ? 怨좊??섍퀬 ?덈뒗 嫄?紐?媛쒖빞? 洹쇰뜲 洹?以묒뿉 ?닿껐??嫄?紐?媛쒖빞? 臾쇱? 怨좎뿬 ?덉쑝硫??⑹뼱. ?먮Ⅴ?ㅻ㈃ 諛⑺뼢???꾩슂?? ?앷컖 醫 ???섍퀬 ?쇰떒 ?쒖옉?대킄.\n\n?먯텛泥?猷⑦듃??n吏곸뾽: ?곌뎄/遺꾩꽍, ?꾨왂湲고쉷, ?덉닠/李쎌옉, IT/湲곗닠\n\n?먯떎泥?怨쇱젣??n- "Think less, do more" (醫뚯슦紐?\n- 紐⑺몴 由ъ뒪???묒꽦 (援ъ껜?곸쑝濡?\n- ?대룞 ?쒖옉 (紐??吏곸씠湲?\n- ?щ엺??留뚮굹湲?(怨좊┰ ?덉텧)`
  };
  
  analysis += funStrongAnalysis[strongEl] + "\n\n";

  // ?뵻 媛뺥븳 ?ㅽ뻾???꾩떎 ?⑺듃 (1,000??異붽?)
  if (strongCount > 0 && strongEl) {
    const realWorldPatterns: Record<Element, string> = {
      wood: `?뱀떊, ?뚯쓽 ?쒓컙?????쒖씪 癒쇱? ?ㅼ짛? ???꾨줈?앺듃 ?섏삤硫?"???" ?섍퀬 ??대굹媛怨? 蹂???녿뒗 ?섍꼍? 3媛쒖썡 踰꾪떚硫??ν븯???띠? 嫄?留욎짛.

湲고쉷?대굹 留덉???履?媛硫??щ컡寃??쇳븯?붾뜲, 媛숈? ??諛섎났?섎뒗 怨녹? ?듬떟?댁꽌 紐?寃щ뵦?덈떎. 臾몄젣???쒖옉? ?섑븯?붾뜲 ?앹? 紐??대뒗 嫄? ?쒖옉??嫄?10媛?以묒뿉 ?앸궦 嫄?4媛쒕㈃ ?좊갑??寃곷땲??

?곗븷???뚮룄 珥덈컲?????뚯뼱?밴린?붾뜲, 愿怨꾧? ?덉젙?섎㈃ "萸붽? ?ъ떖?쒕뜲?"媛 ?쒖옉?⑸땲?? ?곷?媛 蹂???レ뼱?섎뒗 ??낆씠硫??듬떟?댁꽌 紐??쎈땲??`,

      fire: `?뱀떊, 紐⑥엫 媛硫?遺꾩쐞湲?硫붿씠而???븷 ?뺤젙?댁짛? 議곗슜???먮━? 5遺?紐?寃щ뵒怨?癒쇱? 留?爰쇰궡??嫄?留욎뒿?덈떎. ?쇱옄 ?쇳븯??嫄? 3???섎㈃ 臾닿린??李얠븘?듬땲??

?곸뾽?대굹 ?띾낫 履?媛硫??좊굹寃??쇳븯?붾뜲, ?ы깮洹쇰Т???앹궛??諛붾떏移⑸땲?? 臾몄젣??媛먯젙 湲곕났???ы빐??二쇰? ?щ엺??吏移섍쾶 留뚮뱶??嫄? 醫 吏꾩젙?섎씪??留??먯＜ ?ｌ짛?

?곗븷?????댁젙 ??컻?섎뒗?? ?곷?媛 議곗슜?섎㈃ "?섑븳??愿???녿굹?" 遺덉븞 ?쒖옉?⑸땲?? ?⑤룄李⑤줈 ?몄슦??嫄??쇱긽?낅땲??`,

      earth: `?뱀떊, ?쎌냽 ??吏?ㅻ뒗 ?щ엺 吏꾩쭨 紐?寃щ뵒二? 怨꾪쉷??留뚮뱾怨? 猷⑦떞 吏?ㅺ퀬, 湲됲븳 寃곗젙? ?덈? ???⑸땲?? 蹂??留롮? ?뚯궗? ?ㅽ듃?덉뒪濡?癒몃━ ?곗쭛?덈떎.

?됱젙?대굹 ?щТ 履?媛硫??덉젙?곸쑝濡??ㅻ옒 ?쇳븯?붾뜲, ?ㅽ??몄뾽? 3媛쒖썡 紐?踰꾪똻?덈떎. ?μ젏? ?좊ː ?볥뒗 嫄대뜲, ?⑥젏? ?덈줈??嫄??쒕룄 ???섎뒗 嫄? "?쒕쾲 ?대킄" ?대룄 ???⑸땲??

?곗븷??泥쒖쿇???좊ː ?볥뒗?? ?곷?媛 利됲씎?곸씠硫?"遺덉븞?댁꽌 紐?留뚮굹" ?⑸땲?? ?덉젙 異붽뎄?섎뒗 嫄?留욎짛?`,

      metal: `?뱀떊, ?뚯쓽?먯꽌 "?닿굅 鍮꾪슚?⑥쟻?몃뜲?? ?섎뒗 ?щ엺 留욎짛? ?쇰━ ??留욎쑝硫?紐?李멸퀬, 媛먯젙蹂대떎 ?먯튃??癒쇱??낅땲?? ?좊ℓ???곹솴? 寃щ뵒??嫄?遺덇??ν빀?덈떎.

踰뺣쪧?대굹 ?뚭퀎 履?媛硫???留욌뒗?? 媛먯젙 諛곕젮 ?꾩슂???낅Т???됯? ??쾶 ?섏샃?덈떎. ?꾨꼍二쇱쓽 ?ы빐??蹂몄씤????몃룄 吏移섍쾶 留뚮뱶??嫄?留욎뒿?덈떎.

?곗븷????紐낇솗??愿怨??먰븯?붾뜲, 媛먯젙 ?쒗쁽? 遺議깊빀?덈떎. ?곷?媛 媛먯꽦?곸씠硫?"??洹몃젃寃??덈???" ?⑸땲?? 李④컩?ㅻ뒗 留??먯＜ ?ｌ짛?`,

      water: `?뱀떊, ?곷? 媛먯젙 癒쇱? ?뚯븘梨꾨뒗 ?щ엺 留욎짛? ?쇱옄 ?덈뒗 ?쒓컙 ?꾩슂?섍퀬, 源딆? ???醫뗭븘?섍퀬, ?쒕㈃?곸씤 愿怨? 愿???놁뒿?덈떎.

?덉닠?대굹 ?곷떞 履?媛硫???留욌뒗?? 鍮좊Ⅸ 寃곗젙 ?꾩슂??怨녹? ?ㅽ듃?덉뒪 ??컻?⑸땲?? ?곗쑀遺?⑦빐??寃곗젙 誘몃（?ㅺ? 湲고쉶 ?좊━??嫄??쇱긽?낅땲??

?곗븷????源딆? 援먭컧 ?먰븯?붾뜲, ?쒗쁽 遺議깊빐???곷?媛 ?듬떟?댄빀?덈떎. ?곷?媛 鍮좊Ⅴ寃?愿怨?吏꾩쟾?쒗궎???섎㈃ "?덈Т 湲됲빐" ?⑸땲??`
    };

    analysis += `?먰쁽???⑺듃 ?뺤씤??n\n`;
    analysis += realWorldPatterns[strongEl] + "\n\n";
  }
  
  // ?쏀븳 ?ㅽ뻾
  if (weakCount === 0) {
    analysis += `?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺\n`;
    analysis += `?먯떖媛곹븳 臾몄젣 諛쒓껄??n\n`;
    
    const elementKorean: Record<Element, string> = {
      wood: "?섎Т",
      fire: "遺?,
      earth: "??,
      metal: "??,
      water: "臾?
    };
    
    analysis += `??${weakEl.toUpperCase()}(${elementKorean[weakEl]}) ?먮꼫吏媛 ?섎굹???놁뼱. ?닿굅 臾몄젣??\n\n`;
    
    const funWeakTips: Record<Element, string> = {
      wood: `?먯솢 臾몄젣?멸???n- ?깆옣 湲고쉶瑜??몄떇 紐삵븿\n- ?덈줈??嫄?諛곗슦湲??レ뼱??n- 李쎌쓽??遺議깊븿\n- 蹂???곸쓳 紐삵븿\n\n?먰빐寃?諛⑸쾿??n\n1?④퀎: ?앸Ъ ?ㅼ슦湲?n- ?붾텇 3媛?援щℓ (愿?쎌떇臾?異붿쿇)\n- 留ㅼ씪 臾?二쇰㈃??愿李?n- ?깆옣 怨쇱젙 湲곕줉\n- ?④낵: ?앸챸???깆옣 泥댄뿕\n\n2?④퀎: ?낆꽌 ?듦?\n- 二?1沅?紐⑺몴 ?ㅼ젙\n- ?λⅤ 臾닿? (萸먮뱺 ?쎌뼱)\n- ?낆꽌 紐⑥엫 李몄뿬 怨좊젮\n- ?④낵: 吏???뺤옣\n\n3?④퀎: ?좉퇋 ?숈뒿\n- ??1???덈줈???쒕룄\n- ?⑤씪??媛뺤쓽 ?섍컯\n- 愿??遺꾩빞 ?먯깋\n- ?④낵: ?숈뒿 ?λ젰 媛쒕컻\n\n4?④퀎: ?됱긽 ?쒖슜\n- 珥덈줉????援щℓ\n- 梨낆긽???앸Ъ 諛곗튂\n- 怨듭썝/???곗콉 (二?2??\n- ?④낵: ?섎Т ?먮꼫吏 ?≪닔\n\n?먯떎泥????섎㈃??n?됱깮 ?쒖옄由? ?깆옣 ?놁쓬. ?섏쨷???꾪쉶??`,
      
      fire: `?먯솢 臾몄젣?멸???n- ?댁젙 遺議깊븿\n- ?ы쉶????쓬\n- ?쒗쁽???쏀븿\n- ?먮꼫吏 ?덈꺼 ??쓬\n\n?먰빐寃?諛⑸쾿??n\n1?④퀎: ?대룞 ?쒖옉\n- 二?3???댁긽 ?꾩닔\n- ? ?섎━???쒕룞 (?щ━湲? 蹂듭떛)\n- ?⑥껜 ?대룞 異붿쿇 (?띻뎄, 異뺢뎄)\n- ?④낵: ?먮꼫吏 異⑹쟾\n\n2?④퀎: ?ы쉶 ?쒕룞\n- 二?1??紐⑥엫 李몄뿬\n- ?ㅽ듃?뚰궧 ?대깽??李몄꽍\n- ?⑤씪??而ㅻ??덊떚 媛??n- ?④낵: ?ш탳??媛쒕컻\n\n3?④퀎: ?쒗쁽 ?덈젴\n- SNS 怨꾩젙 ?댁쁺\n- 釉붾줈洹??묒꽦 ?쒖옉\n- ?좏뒠釉?梨꾨꼸 怨좊젮\n- ?④낵: ?쒗쁽???μ긽\n\n4?④퀎: ?됱긽 ?쒖슜\n- 鍮④컯/二쇳솴 ??援щℓ\n- 議곕챸 諛앷쾶 ?ㅼ젙\n- ?뉖튆 留롮씠 弛먭린\n- ?④낵: 遺??먮꼫吏 ?≪닔\n\n?먯떎泥????섎㈃??n?됱깮 議곗슜?? 湲고쉶 紐??≪쓬. ?곹뼢???쒕줈.`,
      
      earth: `?먯솢 臾몄젣?멸???n- ?덉젙??遺議깊븿\n- 怨꾪쉷 ?놁씠 ??n- 梨낆엫媛??쏀븿\n- ?좊ː 紐?以?n\n?먰빐寃?諛⑸쾿??n\n1?④퀎: 猷⑦떞 援ъ텞\n- 湲곗긽/痍⑥묠 ?쒓컙 怨좎젙\n- ?앹궗 ?쒓컙 洹쒖튃??n- 二쇨컙 怨꾪쉷 ?섎┰ (?쇱슂??\n- ?④낵: ?앺솢 ?덉젙??n\n2?④퀎: 怨듦컙 ?뺣━\n- 二?1??泥?냼 ?꾩닔\n- 誘몃땲硫由ъ쬁 ?ㅼ쿇\n- 遺덊븘?뷀븳 臾쇨굔 ?쒓굅\n- ?④낵: ?섍꼍 ?덉젙??n\n3?④퀎: 紐낆긽 ?듦?\n- 留ㅼ씪 10遺?紐낆긽\n- ?명씉??吏묒쨷\n- ?붽? ?섏뾽 ?섍컯\n- ?④낵: ?뺤떊 ?덉젙??n\n4?④퀎: ?됱긽 ?쒖슜\n- ?몃옉/媛덉깋 ??援щℓ\n- ???뚯옱 ?뚰뭹 諛곗튂\n- ?꾩옄湲?而щ젆???쒖옉\n- ?④낵: ???먮꼫吏 ?≪닔\n\n?먯떎泥????섎㈃??n?됱깮 遺덉븞?? ?좊ː 紐?諛쏆쓬. 愿怨?源⑥쭚.`,
      
      metal: `?먯솢 臾몄젣?멸???n- 泥닿퀎??遺議깊븿\n- ?꾩꽦????쓬\n- ?쇰━???쏀븿\n- 紐⑺몴 紐??대８\n\n?먰빐寃?諛⑸쾿??n\n1?④퀎: 怨꾪쉷 ?섎┰\n- To-do 由ъ뒪???묒꽦\n- 泥댄겕由ъ뒪???쒖슜\n- 吏꾪뻾 ?곹솴 ?먭? (二쇨컙)\n- ?④낵: 泥닿퀎 ?뺣┰\n\n2?④퀎: ?뺣━ ?뺣룉\n- ?뚯씪 泥닿퀎??n- 臾쇨굔 ?뺣━\n- ?⑥닚??異붽뎄\n- ?④낵: ?섍꼍 泥닿퀎??n\n3?④퀎: ?쇰━ ?덈젴\n- ?쇱쫹 ?湲?(留ㅼ씪)\n- ?좊줎 李몄뿬\n- 遺꾩꽍??湲?곌린\n- ?④낵: ?쇰━???μ긽\n\n4?④퀎: ?됱긽 ?쒖슜\n- ?곗깋/?????援щℓ\n- 湲덉냽 ?≪꽭?쒕━ 李⑹슜\n- ?쒓퀎 李④퀬 ?ㅻ땲湲?n- ?④낵: ???먮꼫吏 ?≪닔\n\n?먯떎泥????섎㈃??n?됱깮 ?댁꽕?? ??紐삵븿. ?몄젙 紐?諛쏆쓬.`,
      
      water: `?먯솢 臾몄젣?멸???n- 吏??遺議깊븿\n- 吏곴????쏀븿\n- ?곸쓳 紐삵븿\n- ?앷컖 ?뺤쓬\n\n?먰빐寃?諛⑸쾿??n\n1?④퀎: 異⑸텇???댁떇\n- ?섎㈃ 7-8?쒓컙 ?꾩닔\n- 二쇰쭚 ?꾩쟾 ?댁떇\n- ??옞 ?쒖슜 (15-20遺?\n- ?④낵: ?먮꼫吏 ?뚮났\n\n2?④퀎: ?낆꽌 ?듦?\n- 泥좏븰/?몃Ц??梨?n- 源딆씠 ?덈뒗 ?ш퀬 ?덈젴\n- ?쇨린 ?묒꽦\n- ?④낵: 吏??異뺤쟻\n\n3?④퀎: 臾?移쒗솕\n- ?섏쁺 諛곗슦湲?n- ?⑥쿇 諛⑸Ц (??1??\n- 諛붾떎 ?ы뻾\n- ?④낵: 臾??먮꼫吏 ?≪닔\n\n4?④퀎: ?됱긽 ?쒖슜\n- ?뚮옉/寃????援щℓ\n- ?섏”愿 ?ㅼ튂\n- 遺꾩닔 ?뚰뭹 諛곗튂\n- ?④낵: 臾??먮꼫吏 蹂댁땐\n\n?먯떎泥????섎㈃??n?됱깮 ?뺤쓬. ?듭같???놁쓬. 吏???쒕줈.`
    };
    
    analysis += funWeakTips[weakEl] + "\n\n";
  }
  
  // 洹좏삎 ?됯?
  analysis += `?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺\n`;
  analysis += `?먯턀醫??먯젙??n\n`;
  
  if (isBalanced) {
    analysis += `?덉쓽 ?ㅽ뻾 諛몃윴?? ?묓샇\n\n`;
    analysis += `?붿쭅??遺?ъ썙. ?ㅽ뻾??怨좊Ⅴ寃?遺꾪룷?섏뼱 ?덉뼱?? 洹밸떒?곸쑝濡??먮슕?댁쭊 嫄??섎굹???놁뼱. ?닿쾶 吏꾩쭨 ?댁긽?곸씠??\n\n`;
    analysis += `?먯옣?먦?n- ?덉젙?곸엫 (洹밸떒 ?뚰뵾)\n- ?곸쓳???곗닔 (?대뵒?쒕뱺 OK)\n- ???ш퀬 ?놁쓬 (臾대궃??\n- 吏??媛?μ꽦 ?믪쓬\n\n`;
    analysis += `?먮떒?먦?n- ?뱀깋 遺議?(?됰쾾??\n- ???嫄??놁쓬 (臾닿컻??\n- ?꾨Ц???쏀븿 (?뺢퀬 ?볦쓬)\n\n`;
    analysis += `?먯텛泥??꾨왂??n洹몃깷 ?덉쓽 湲?媛. 援녹씠 萸붽? ?밸퀎?????꾩슂 ?놁뼱. ?ㅻ쭔 ??遺꾩빞??源딄쾶 ?뚮킄. 洹좏삎? 醫뗭??? ?꾨Ц?깆? ?덇? 留뚮뱾?댁빞 ??\n\n`;
    analysis += `?먮챸????諛⒲?n"?됰쾾???띿뿉??鍮꾨쾾?⑥쓣 李얠븘??"\n- 異쒖쿂 遺덈챸, ?섏?留?留욌뒗 留?;
  } else {
    analysis += `?덉쓽 ?ㅽ뻾 諛몃윴?? 遺덇퇏??n\n`;
    analysis += `洹쇰뜲 ?닿쾶 ?섏걶 嫄??꾨땲?? ?ㅽ엳???뱀깋 ?덉뼱??醫뗭쓣 ?섎룄 ?덉뼱. ??궗 ???꾩씤???遺遺??ㅽ뻾 遺덇퇏?뺤씠?덉뼱.\n\n`;
    analysis += `?먯옣?먦?n- 媛뺤젏 紐낇솗??(?쒕졆??\n- ?꾨Ц???믪쓬 (源딆씠 ?덉쓬)\n- 媛쒖꽦 媛뺥븿 (?밸퀎??\n- ?꾪뙥???덉쓬 (湲곗뼲??\n\n`;
    analysis += `?먮떒?먦?n- ?쎌젏??紐낇솗??(痍⑥빟??議댁옱)\n- 洹밸떒???곹솴 媛??(由ъ뒪??\n- 諛몃윴??議곗젅 ?꾩슂 (?몃젰 ?붽뎄)\n\n`;
    analysis += `?먯텛泥??꾨왂??n媛뺥븳 嫄곕뒗 ??媛뺥솕?섍퀬, ?쏀븳 嫄곕뒗 ?섏떇?곸쑝濡?蹂댁셿?? 洹멸쾶 ?듭씠?? ?덉쓽 媛뺤젏??理쒕????쒖슜?섎릺, ?쎌젏 ?뚮Ц??臾대꼫吏吏??留?\n\n`;
    analysis += `?먮챸????諛⒲?n"寃곗젏???덈뒗 ?ㅼ씠?꾨が?쒓? ?꾨꼍???뚮ł?대낫???ル떎."\n- ?꾧? 留먰뻽?붿? 紐⑤Ⅴ寃좎?留?吏꾨━`;
  }
  
  analysis += `\n\n?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺?곣봺\n`;
  analysis += `?먮쭏吏留??쒕쭏?붵?n\n`;
  analysis += `?ъ＜??媛?대뱶??肉먯씠?? 寃곌뎅 ?덉쓽 ?몄깮? ?ㅺ? 留뚮뱶??嫄곗빞. ?ㅽ뻾 諛몃윴??醫뗫뱺 ?섏걯?? 洹멸굅 ?묎퀎 ?吏 留먭퀬 洹몃깷 ?댁떖???댁븘. ?묒썝?쒕떎. ?뮞?뵦`;
  
  return analysis;
}

function getBranchMainStem(branch: string): string | null {
  const map: Record<string, string> = {
    耶? "??, 訝? "藥?, 野? "??, ?? "阿?, 渦? "??, 藥? "訝?,
    ?? "訝?, ?? "藥?, ?? "佯?, ?? "渦?, ?? "??, 雅? "鶯?
  };
  return map[branch] || null;
}


----- FILE: frontend\data\fortuneAnalysis.ts -----
// frontend/data/fortuneAnalysis.ts

export const FORTUNE_ANALYSIS = {
  empathy: {
    title: "?뱀떊???몄깮 ??꾨씪?? 10?꾨쭏???쇱퀜吏???덈줈????塋?",
    icon: "?뱟",
  },
  reality: {
    title: "??는룹꽭???뺣? 遺꾩꽍 - ?뱀떊???대챸 ?먮쫫 ?쒕??덉씠??,
    icon: "?뱤",
  },
  fun: {
    title: "??吏湲?臾댁뒯 ???怨??덈뒗?? ??댁꽭???ㅼ떆媛??뺤씤",
    icon: "?렋",
  },
};

// =====================================================
// 湲곗큹 ?곗씠??
// =====================================================

const GANJI_60 = [
  "?꿨춴", "阿쇾툚", "訝쇿칲", "訝곩뜱", "?딂쒼", "藥긷럼", "佯싧뜄", "渦쎿쑋", "鶯х뵵", "?면뀎",
  "?꿩닃", "阿쇾벤", "訝쇿춴", "訝곦툚", "?듿칲", "藥긷뜱", "佯싪쒼", "渦쎾럼", "鶯у뜄", "?멩쑋",
  "?꿰뵵", "阿숅뀎", "訝숁닃", "訝곦벤", "?듿춴", "藥긴툚", "佯싧칲", "渦쎾뜱", "鶯ц쒼", "?멨럼",
  "?꿨뜄", "阿숁쑋", "訝숂뵵", "訝곲뀎", "?딀닃", "藥긴벤", "佯싧춴", "渦쎽툚", "鶯у칲", "?멨뜱",
  "?꿱쒼", "阿쇿럼", "訝쇿뜄", "訝곫쑋", "?딁뵵", "藥깁뀎", "佯싨닃", "渦쎽벤", "鶯у춴", "?멧툚",
  "?꿨칲", "阿쇿뜱", "訝숃쒼", "訝곩럼", "?듿뜄", "藥길쑋", "佯싩뵵", "渦쏃뀎", "鶯ф닃", "?멧벤"
];

const GANS = ['??, '阿?, '訝?, '訝?, '??, '藥?, '佯?, '渦?, '鶯?, '??];
const JIS = ['耶?, '訝?, '野?, '??, '渦?, '藥?, '??, '??, '??, '??, '??, '雅?];

// =====================================================
// ?ㅽ뻾 諛???꽦 怨꾩궛
// =====================================================

function getElement(hanja: string): string {
  const wood = ['??, '阿?, '野?, '??];
  const fire = ['訝?, '訝?, '藥?, '??];
  const earth = ['??, '藥?, '渦?, '??, '訝?, '??];
  const metal = ['佯?, '渦?, '??, '??];
  const water = ['鶯?, '??, '耶?, '雅?];

  if (wood.includes(hanja)) return 'wood';
  if (fire.includes(hanja)) return 'fire';
  if (earth.includes(hanja)) return 'earth';
  if (metal.includes(hanja)) return 'metal';
  if (water.includes(hanja)) return 'water';
  return 'none';
}

function getPolarity(gan: string): 'yang' | 'yin' {
  const yang = ['??, '訝?, '??, '佯?, '鶯?];
  return yang.includes(gan) ? 'yang' : 'yin';
}

function getTenGod(dayStem: string, targetStem: string): string {
  const dayEl = getElement(dayStem);
  const targetEl = getElement(targetStem);

  if (dayEl === 'none' || targetEl === 'none') return '';

  const produces: Record<string, string> = {
    wood: 'fire',
    fire: 'earth',
    earth: 'metal',
    metal: 'water',
    water: 'wood',
  };

  const controls: Record<string, string> = {
    wood: 'earth',
    fire: 'metal',
    earth: 'water',
    metal: 'wood',
    water: 'fire',
  };

  const samePol = getPolarity(dayStem) === getPolarity(targetStem);

  if (dayEl === targetEl) {
    return samePol ? '鍮꾧껄' : '寃곸옱';
  } else if (produces[dayEl] === targetEl) {
    return samePol ? '?앹떊' : '?곴?';
  } else if (produces[targetEl] === dayEl) {
    return samePol ? '?몄씤' : '?뺤씤';
  } else if (controls[dayEl] === targetEl) {
    return samePol ? '?몄옱' : '?뺤옱';
  } else if (controls[targetEl] === dayEl) {
    return samePol ? '?멸?' : '?뺢?';
  }

  return '';
}

// =====================================================
// 泥쒓컙 ?⑹땐 ?먯젙
// =====================================================

const CHEONGAN_HAP: Record<string, string> = {
  '?꿨런': '??,
  '阿쇿틲': '湲?,
  '訝숃풘': '??,
  '訝곩，': '紐?,
  '?딁쇅': '??,
};

function checkCheonganHap(stem1: string, stem2: string): string | null {
  const key1 = stem1 + stem2;
  const key2 = stem2 + stem1;
  return CHEONGAN_HAP[key1] || CHEONGAN_HAP[key2] || null;
}

const CHEONGAN_CHUNG: string[][] = [
  ['??, '佯?],
  ['阿?, '渦?],
  ['訝?, '鶯?],
  ['訝?, '??],
  ['??, '??],
  ['藥?, '阿?],
  ['佯?, '??],
  ['渦?, '阿?],
];

function checkCheonganChung(stem1: string, stem2: string): boolean {
  return CHEONGAN_CHUNG.some(pair =>
    (pair[0] === stem1 && pair[1] === stem2) || (pair[0] === stem2 && pair[1] === stem1)
  );
}

// =====================================================
// 吏吏 ?⑺삎異⑺빐???먯젙
// =====================================================

const JIJI_YUKHAP: string[][] = [
  ['耶?, '訝?], ['野?, '雅?], ['??, '??],
  ['渦?, '??], ['藥?, '??], ['??, '??]
];

function checkJijiYukhap(ji1: string, ji2: string): boolean {
  return JIJI_YUKHAP.some(pair =>
    (pair[0] === ji1 && pair[1] === ji2) || (pair[0] === ji2 && pair[1] === ji1)
  );
}

const JIJI_SAMHAP: { name: string; members: string[] }[] = [
  { name: '?좎옄吏??섍뎅', members: ['??, '耶?, '渦?] },
  { name: '?몄삤???붽뎅', members: ['野?, '??, '??] },
  { name: '?대쵖誘?紐⑷뎅', members: ['雅?, '??, '??] },
  { name: '?ъ쑀異?湲덇뎅', members: ['藥?, '??, '訝?] },
];

function checkJijiSamhap(branches: string[]): string[] {
  const results: string[] = [];
  JIJI_SAMHAP.forEach(samhap => {
    const count = samhap.members.filter(m => branches.includes(m)).length;
    if (count >= 2) {
      results.push(samhap.name);
    }
  });
  return results;
}

const JIJI_BANGHAP: { name: string; members: string[] }[] = [
  { name: '?몃쵖吏??숇갑紐?, members: ['野?, '??, '渦?] },
  { name: '?ъ삤誘??⑤갑??, members: ['藥?, '??, '??] },
  { name: '?좎쑀???쒕갑湲?, members: ['??, '??, '??] },
  { name: '?댁옄異?遺곷갑??, members: ['雅?, '耶?, '訝?] },
];

function checkJijiBanghap(branches: string[]): string[] {
  const results: string[] = [];
  JIJI_BANGHAP.forEach(banghap => {
    const count = banghap.members.filter(m => branches.includes(m)).length;
    if (count >= 2) {
      results.push(banghap.name);
    }
  });
  return results;
}

const JIJI_BANHAP: string[][] = [
  ['??, '耶?], ['耶?, '渦?], ['??, '渦?],
  ['野?, '??], ['??, '??], ['野?, '??],
  ['雅?, '??], ['??, '??], ['雅?, '??],
  ['藥?, '??], ['??, '訝?], ['藥?, '訝?],
];

function checkJijiBanhap(ji1: string, ji2: string): boolean {
  return JIJI_BANHAP.some(pair =>
    (pair[0] === ji1 && pair[1] === ji2) || (pair[0] === ji2 && pair[1] === ji1)
  );
}

const JIJI_CHUNG: string[][] = [
  ['耶?, '??], ['訝?, '??], ['野?, '??],
  ['??, '??], ['渦?, '??], ['藥?, '雅?]
];

function checkJijiChung(ji1: string, ji2: string): boolean {
  return JIJI_CHUNG.some(pair =>
    (pair[0] === ji1 && pair[1] === ji2) || (pair[0] === ji2 && pair[1] === ji1)
  );
}

const JIJI_HYUNG: { name: string; members: string[] }[] = [
  { name: '?몄궗??, members: ['野?, '藥?] },
  { name: '?ъ떊??, members: ['藥?, '??] },
  { name: '?좎씤??, members: ['??, '野?] },
  { name: '異뺤닠??, members: ['訝?, '??] },
  { name: '異뺣???, members: ['訝?, '??] },
  { name: '?좊???, members: ['??, '??] },
  { name: '?먮쵖??, members: ['耶?, '??] },
  { name: '吏꾩쭊?먰삎', members: ['渦?, '渦?] },
  { name: '?ㅼ삤?먰삎', members: ['??, '??] },
  { name: '?좎쑀?먰삎', members: ['??, '??] },
  { name: '?댄빐?먰삎', members: ['雅?, '雅?] },
];

function checkJijiHyung(ji1: string, ji2: string): string[] {
  const results: string[] = [];
  JIJI_HYUNG.forEach(hyung => {
    if (hyung.members.includes(ji1) && hyung.members.includes(ji2)) {
      results.push(hyung.name);
    }
  });
  return results;
}

const JIJI_HAE: string[][] = [
  ['耶?, '??], ['訝?, '??], ['野?, '藥?],
  ['??, '渦?], ['??, '雅?], ['??, '??]
];

function checkJijiHae(ji1: string, ji2: string): boolean {
  return JIJI_HAE.some(pair =>
    (pair[0] === ji1 && pair[1] === ji2) || (pair[0] === ji2 && pair[1] === ji1)
  );
}

const JIJI_PA: string[][] = [
  ['??, '耶?], ['??, '??], ['雅?, '野?], ['??, '藥?]
];

function checkJijiPa(ji1: string, ji2: string): boolean {
  return JIJI_PA.some(pair =>
    (pair[0] === ji1 && pair[1] === ji2) || (pair[0] === ji2 && pair[1] === ji1)
  );
}

function checkWonjin(ji1: string, ji2: string): boolean {
  const idx1 = JIS.indexOf(ji1);
  const idx2 = JIS.indexOf(ji2);
  if (idx1 === -1 || idx2 === -1) return false;
  const diff = Math.abs(idx1 - idx2);
  return diff === 7 || diff === 5;
}

const CHEONUL_GWIIN: Record<string, string[]> = {
  '??: ['訝?, '??],
  '阿?: ['耶?, '??],
  '訝?: ['雅?, '??],
  '訝?: ['雅?, '??],
  '??: ['訝?, '??],
  '藥?: ['耶?, '??],
  '佯?: ['訝?, '??],
  '渦?: ['野?, '??],
  '鶯?: ['??, '藥?],
  '??: ['??, '藥?],
};

function checkCheonulGwiin(dayStem: string, branch: string): boolean {
  const gwiin = CHEONUL_GWIIN[dayStem] || [];
  return gwiin.includes(branch);
}

// =====================================================
// ?⑺삎異⑺빐??醫낇빀 ?먯젙
// =====================================================

interface RelationResult {
  cheonganHap: string[];
  cheonganChung: string[];
  jijiYukhap: string[];
  jijiSamhap: string[];
  jijiBanghap: string[];
  jijiBanhap: string[];
  jijiChung: string[];
  jijiHyung: string[];
  jijiHae: string[];
  jijiPa: string[];
  wonjin: string[];
  cheonulGwiin: string[];
}

function analyzeRelations(
  fortuneStem: string,
  fortuneBranch: string,
  dayStem: string,
  originalPillars: { year: string; month: string; day: string; hour: string }
): RelationResult {
  const result: RelationResult = {
    cheonganHap: [],
    cheonganChung: [],
    jijiYukhap: [],
    jijiSamhap: [],
    jijiBanghap: [],
    jijiBanhap: [],
    jijiChung: [],
    jijiHyung: [],
    jijiHae: [],
    jijiPa: [],
    wonjin: [],
    cheonulGwiin: [],
  };

  const originalStems = [
    originalPillars.year[0],
    originalPillars.month[0],
    originalPillars.day[0],
    originalPillars.hour[0],
  ];

  const originalBranches = [
    originalPillars.year[1],
    originalPillars.month[1],
    originalPillars.day[1],
    originalPillars.hour[1],
  ];

  // 泥쒓컙??
  originalStems.forEach(stem => {
    const hap = checkCheonganHap(fortuneStem, stem);
    if (hap) result.cheonganHap.push(`${fortuneStem}${stem}??${hap})`);
  });

  // 泥쒓컙異?
  originalStems.forEach(stem => {
    if (checkCheonganChung(fortuneStem, stem)) {
      result.cheonganChung.push(`${fortuneStem}${stem}異?);
    }
  });

  // 吏吏 ?≫빀
  originalBranches.forEach(branch => {
    if (checkJijiYukhap(fortuneBranch, branch)) {
      result.jijiYukhap.push(`${fortuneBranch}${branch}?≫빀`);
    }
  });

  // 吏吏 ?쇳빀
  const allBranches = [...originalBranches, fortuneBranch];
  result.jijiSamhap = checkJijiSamhap(allBranches);

  // 吏吏 諛⑺빀
  result.jijiBanghap = checkJijiBanghap(allBranches);

  // 吏吏 諛섑빀
  originalBranches.forEach(branch => {
    if (checkJijiBanhap(fortuneBranch, branch)) {
      result.jijiBanhap.push(`${fortuneBranch}${branch}諛섑빀`);
    }
  });

  // 吏吏異?
  originalBranches.forEach(branch => {
    if (checkJijiChung(fortuneBranch, branch)) {
      result.jijiChung.push(`${fortuneBranch}${branch}異?);
    }
  });

  // 吏吏??
  originalBranches.forEach(branch => {
    const hyung = checkJijiHyung(fortuneBranch, branch);
    if (hyung.length > 0) {
      result.jijiHyung.push(...hyung);
    }
  });

  // 吏吏??
  originalBranches.forEach(branch => {
    if (checkJijiHae(fortuneBranch, branch)) {
      result.jijiHae.push(`${fortuneBranch}${branch}??);
    }
  });

  // 吏吏??
  originalBranches.forEach(branch => {
    if (checkJijiPa(fortuneBranch, branch)) {
      result.jijiPa.push(`${fortuneBranch}${branch}??);
    }
  });

  // ?먯쭊
  originalBranches.forEach(branch => {
    if (checkWonjin(fortuneBranch, branch)) {
      result.wonjin.push(`${fortuneBranch}${branch}?먯쭊`);
    }
  });

  // 泥쒖쓣洹??
  if (checkCheonulGwiin(dayStem, fortuneBranch)) {
    result.cheonulGwiin.push(`${fortuneBranch}泥쒖쓣洹??);
  }

  return result;
}

// =====================================================
// ????몄슫 ?곗씠?????
// =====================================================

export interface GreatFortuneData {
  startAge: number;
  endAge: number;
  pillar: string;
  stem: string;
  branch: string;
  stemTenGod: string;
  branchTenGod: string;
  direction: "?쒗뻾" | "??뻾";
  relations: RelationResult;
  interpretation: {
    empathy: string;
    reality: string;
    fun: string;
  };
}

export interface YearFortuneData {
  year: number;
  pillar: string;
  stem: string;
  branch: string;
  stemTenGod: string;
  branchTenGod: string;
  relations: RelationResult;
  interpretation: {
    empathy: string;
    reality: string;
    fun: string;
  };
}

// =====================================================
// ???怨꾩궛
// =====================================================

export function calculateGreatFortune(
  birthYear: number,
  gender: "M" | "F",
  monthPillar: string,
  daeunNum: number,
  currentAge: number,
  dayStem: string,
  originalPillars: { year: string; month: string; day: string; hour: string },
  sinGangScore: number
): {
  current: GreatFortuneData;
  next: GreatFortuneData;
  direction: "?쒗뻾" | "??뻾";
} {
  const yearStemIndex = (36 + (birthYear - 1900)) % 10;
  const isYangYear = yearStemIndex % 2 === 0;
  const isForward = (gender === "M" && isYangYear) || (gender === "F" && !isYangYear);
  const direction = isForward ? "?쒗뻾" : "??뻾";

  const monthPillarIndex = GANJI_60.indexOf(monthPillar);
  const fortuneIndex = Math.floor((currentAge - daeunNum) / 10);
  const currentStartAge = daeunNum + fortuneIndex * 10;
  const nextStartAge = currentStartAge + 10;

  const currentIndex = isForward
    ? (monthPillarIndex + fortuneIndex + 1) % 60
    : (monthPillarIndex - fortuneIndex - 1 + 60) % 60;
  const nextIndex = isForward
    ? (currentIndex + 1) % 60
    : (currentIndex - 1 + 60) % 60;

  const currentPillar = GANJI_60[currentIndex];
  const nextPillar = GANJI_60[nextIndex];

  const currentRelations = analyzeRelations(
    currentPillar[0],
    currentPillar[1],
    dayStem,
    originalPillars
  );

  const current: GreatFortuneData = {
    startAge: currentStartAge,
    endAge: nextStartAge - 1,
    pillar: currentPillar,
    stem: currentPillar[0],
    branch: currentPillar[1],
    stemTenGod: getTenGod(dayStem, currentPillar[0]),
    branchTenGod: getTenGod(dayStem, currentPillar[1]),
    direction,
    relations: currentRelations,
    interpretation: interpretGreatFortune(
      currentPillar,
      dayStem,
      originalPillars,
      currentStartAge,
      nextStartAge - 1,
      sinGangScore,
      currentRelations
    ),
  };

  const nextRelations = analyzeRelations(
    nextPillar[0],
    nextPillar[1],
    dayStem,
    originalPillars
  );

  const next: GreatFortuneData = {
    startAge: nextStartAge,
    endAge: nextStartAge + 9,
    pillar: nextPillar,
    stem: nextPillar[0],
    branch: nextPillar[1],
    stemTenGod: getTenGod(dayStem, nextPillar[0]),
    branchTenGod: getTenGod(dayStem, nextPillar[1]),
    direction,
    relations: nextRelations,
    interpretation: interpretGreatFortune(
      nextPillar,
      dayStem,
      originalPillars,
      nextStartAge,
      nextStartAge + 9,
      sinGangScore,
      nextRelations
    ),
  };

  return { current, next, direction };
}

// =====================================================
// ?몄슫 怨꾩궛
// =====================================================

export function calculateYearFortune(
  currentYear: number,
  dayStem: string,
  originalPillars: { year: string; month: string; day: string; hour: string },
  sinGangScore: number
): {
  current: YearFortuneData;
  next: YearFortuneData;
} {
  const baseYear = 2024;
  const baseYearIndex = 40;

  const yearDiff = currentYear - baseYear;
  const currentIndex = (baseYearIndex + yearDiff + 60) % 60;
  const nextIndex = (currentIndex + 1) % 60;

  const currentPillar = GANJI_60[currentIndex];
  const nextPillar = GANJI_60[nextIndex];

  const currentRelations = analyzeRelations(
    currentPillar[0],
    currentPillar[1],
    dayStem,
    originalPillars
  );

  const nextRelations = analyzeRelations(
    nextPillar[0],
    nextPillar[1],
    dayStem,
    originalPillars
  );

  return {
    current: {
      year: currentYear,
      pillar: currentPillar,
      stem: currentPillar[0],
      branch: currentPillar[1],
      stemTenGod: getTenGod(dayStem, currentPillar[0]),
      branchTenGod: getTenGod(dayStem, currentPillar[1]),
      relations: currentRelations,
      interpretation: interpretYearFortune(
        currentPillar,
        currentYear,
        dayStem,
        originalPillars,
        sinGangScore,
        currentRelations
      ),
    },
    next: {
      year: currentYear + 1,
      pillar: nextPillar,
      stem: nextPillar[0],
      branch: nextPillar[1],
      stemTenGod: getTenGod(dayStem, nextPillar[0]),
      branchTenGod: getTenGod(dayStem, nextPillar[1]),
      relations: nextRelations,
      interpretation: interpretYearFortune(
        nextPillar,
        currentYear + 1,
        dayStem,
        originalPillars,
        sinGangScore,
        nextRelations
      ),
    },
  };
}

// =====================================================
// ????댁꽍
// =====================================================

function interpretGreatFortune(
  pillar: string,
  dayStem: string,
  originalPillars: { year: string; month: string; day: string; hour: string },
  startAge: number,
  endAge: number,
  sinGangScore: number,
  relations: RelationResult
): {
  empathy: string;
  reality: string;
  fun: string;
} {
  const stem = pillar[0];
  const branch = pillar[1];
  const stemTenGod = getTenGod(dayStem, stem);
  const branchTenGod = getTenGod(dayStem, branch);

  const isSinGang = sinGangScore >= 60;
  const isSinYak = sinGangScore < 40;

  let specialNote = "";
  if (relations.cheonulGwiin.length > 0) {
    specialNote += " 泥쒖쓣洹?몄씠 ?④퍡?섏뿬 洹?몄쓽 ?꾩???諛쏆뒿?덈떎.";
  }
  if (relations.cheonganHap.length > 0) {
    specialNote += ` 泥쒓컙??${relations.cheonganHap.join(', ')})?쇰줈 ?앷컖怨??섏?媛 蹂?뷀빀?덈떎.`;
  }
  if (relations.cheonganChung.length > 0) {
    specialNote += ` 泥쒓컙異?${relations.cheonganChung.join(', ')})?쇰줈 媛덈벑?대굹 寃곕떒???쒓린?낅땲??`;
  }
  if (relations.jijiYukhap.length > 0) {
    specialNote += ` 吏吏?≫빀(${relations.jijiYukhap.join(', ')})?쇰줈 醫뗭? 留뚮궓怨??묐젰???대（?댁쭛?덈떎.`;
  }
  if (relations.jijiSamhap.length > 0) {
    specialNote += ` ?쇳빀(${relations.jijiSamhap.join(', ')})?쇰줈 媛뺣젰??湲곗슫???뺤꽦?⑸땲??`;
  }
  if (relations.jijiBanghap.length > 0) {
    specialNote += ` 諛⑺빀(${relations.jijiBanghap.join(', ')})?쇰줈 ??諛⑺뼢?쇰줈 ?먮꼫吏媛 紐곕┰?덈떎.`;
  }
  if (relations.jijiBanhap.length > 0) {
    specialNote += ` 諛섑빀(${relations.jijiBanhap.join(', ')})?쇰줈 遺遺꾩쟻 議고솕媛 ?앷퉩?덈떎.`;
  }
  if (relations.jijiChung.length > 0) {
    specialNote += ` 吏吏異?${relations.jijiChung.join(', ')})?쇰줈 ?섍꼍???ш쾶 蹂?뷀븯嫄곕굹 ?쒖꽦?붾맗?덈떎.`;
  }
  if (relations.jijiHyung.length > 0) {
    specialNote += ` 吏吏??${relations.jijiHyung.join(', ')})?쇰줈 ?뺣쾶???뺣컯???덉쓣 ???덉뒿?덈떎.`;
  }
  if (relations.jijiHae.length > 0) {
    specialNote += ` 吏吏??${relations.jijiHae.join(', ')})濡??먰빐???뚮え媛 諛쒖깮?????덉뒿?덈떎.`;
  }
  if (relations.jijiPa.length > 0) {
    specialNote += ` 吏吏??${relations.jijiPa.join(', ')})濡?媛덈벑?대굹 ?뚭눼???곹솴???????덉뒿?덈떎.`;
  }
  if (relations.wonjin.length > 0) {
    specialNote += ` ?먯쭊(${relations.wonjin.join(', ')})?쇰줈 ?諛??媛덈벑?대굹 遺덊렪?⑥씠 ?덉뒿?덈떎.`;
  }

  const tenGodTexts = getTenGodInterpretationWithSinGang(
    stemTenGod,
    branchTenGod,
    isSinGang,
    isSinYak
  );

  return {
    empathy: `${startAge}?몃???${endAge}?멸퉴吏??${tenGodTexts.empathy}${specialNote} ???쒓린瑜????쒖슜?섎㈃ ???깆옣???대０ ???덉뒿?덈떎.`,
    reality: `${startAge}~${endAge}?????${pillar}: 泥쒓컙(${stem} ${stemTenGod}) 3, 吏吏(${branch} ${branchTenGod}) 7.${specialNote} ${tenGodTexts.reality}`,
    fun: `${startAge}?대???${endAge}?닿퉴吏 ${tenGodTexts.fun}${specialNote}`,
  };
}

// =====================================================
// ?몄슫 ?댁꽍
// =====================================================

function interpretYearFortune(
  pillar: string,
  year: number,
  dayStem: string,
  originalPillars: { year: string; month: string; day: string; hour: string },
  sinGangScore: number,
  relations: RelationResult
): {
  empathy: string;
  reality: string;
  fun: string;
} {
  const stem = pillar[0];
  const branch = pillar[1];
  const stemTenGod = getTenGod(dayStem, stem);
  const branchTenGod = getTenGod(dayStem, branch);

  const isSinGang = sinGangScore >= 60;
  const isSinYak = sinGangScore < 40;

  let specialNote = "";
  if (relations.cheonulGwiin.length > 0) specialNote += " 泥쒖쓣洹?몄쓽 ??";
  if (relations.jijiChung.length > 0) specialNote += " 異⑹쑝濡?蹂?붿? ?쒖꽦??";
  if (relations.jijiYukhap.length > 0) specialNote += " ?≫빀?쇰줈 醫뗭? 留뚮궓.";

  const tenGodTexts = getTenGodInterpretationWithSinGang(
    stemTenGod,
    branchTenGod,
    isSinGang,
    isSinYak
  );

  return {
    empathy: `${year}??${pillar}??? ${tenGodTexts.empathy}${specialNote}`,
    reality: `${year}???몄슫 ${pillar}: 泥쒓컙 ${stemTenGod}(3), 吏吏 ${branchTenGod}(7).${specialNote}`,
    fun: `${year}?꾩? ${tenGodTexts.fun}${specialNote}`,
  };
}

// =====================================================
// ??꽦 + ?좉컯??湲곕컲 ?댁꽍
// =====================================================

function getTenGodInterpretationWithSinGang(
  stemTenGod: string,
  branchTenGod: string,
  isSinGang: boolean,
  isSinYak: boolean
): { empathy: string; reality: string; fun: string } {
  const mainTenGod = branchTenGod || stemTenGod;

  const interpretations: Record<
    string,
    {
      empathy: { sinGang: string; sinYak: string; normal: string };
      reality: { sinGang: string; sinYak: string; normal: string };
      fun: { sinGang: string; sinYak: string; normal: string };
    }
  > = {
    鍮꾧껄: {
      empathy: {
        sinGang: "?섏? 媛숈? ?먮꼫吏瑜?留뚮굹???쒓린?낅땲?? ?덉＜?섏? 留먭퀬 ?섎룄?곸쑝濡?諛붿걯寃??吏곸씠?몄슂. 寃뚯쑝由꾩뿉 二쇱쓽媛 ?꾩슂?댁슂.",
        sinYak: "?숇즺???뚰듃?덉쓽 ?꾩??쇰줈 ?ъ쑀媛 ?앷린怨??ы쉶???깆랬???④퍡 ?곕Ⅴ??湲명븳 ?쒓린?낅땲?? ?쇱옄蹂대떎 ?④퍡?????????섏쓣 諛쒗쐶?????덉뼱??",
        normal: "?섏? 媛숈? ?먮꼫吏瑜?留뚮굹???쒓린?낅땲?? ?숈뾽?대굹 ?뚰듃?덉떗???쒕컻?댁쭏 ???덉뼱??",
      },
      reality: {
        sinGang: "鍮꾧껄?? ?좉컯?대?濡??덉＜ 寃쎄퀎. ?섎룄???쒕룞 沅뚯옣.",
        sinYak: "鍮꾧껄?? ?좎빟?대?濡??묐젰?쇰줈 ?ъ쑀? ?깆랬 ?숈떆 ?뺣낫. 湲명븿.",
        normal: "鍮꾧껄?댁쑝濡?寃쎌웳쨌?묐젰 ?숈떆 諛쒖깮.",
      },
      fun: {
        sinGang: "??媛뺥븳??鍮꾧껄 留뚮굹硫?寃뚯쑝由?二쇱쓽?뗣뀑 ?섎룄?곸쑝濡?諛붿걯寃??吏곸뿬!",
        sinYak: "???쏀븳??鍮꾧껄 留뚮굹硫?移쒓뎄?ㅼ씠 ?꾩?以섏꽌 ?ъ쑀 ?앷??뗣뀑 湲명븳 ?쒓린!",
        normal: "?덈옉 鍮꾩듂???좊뱾 留롮씠 留뚮궓?뗣뀑",
      },
    },
    寃곸옱: {
      empathy: {
        sinGang: "媛뺥븳 ?먮꼫吏媛 ?덉?留??덉＜?섍린 ?ъ슫 ?쒓린?낅땲?? 寃뚯쑝由꾩쓣 寃쎄퀎?섍퀬 ?섎룄?곸쑝濡?紐⑺몴瑜??ㅼ젙?섎ŉ ?吏곸씠?몄슂. ?щЪ 愿由щ룄 ?좉꼍 ?곗꽭??",
        sinYak: "二쇰????꾩??쇰줈 ?ъ쑀媛 ?앷린怨??깆랬???곕Ⅴ???쒓린?낅땲?? ?섏?留??щЪ 愿由щ뒗 ?ъ쟾??議곗떖?댁빞 ?댁슂.",
        normal: "媛뺥븳 ?먮꼫吏媛 異⑸룎?섎뒗 ?쒓린?낅땲?? ?щЪ 愿由ъ? ?멸컙愿怨꾩뿉 二쇱쓽媛 ?꾩슂?댁슂.",
      },
      reality: {
        sinGang: "寃곸옱?? ?좉컯?대?濡?寃뚯쑝由?二쇱쓽. ?섎룄???쒕룞 ?꾩슂. ?щЪ 遺꾩궛 寃쎄퀎.",
        sinYak: "寃곸옱?? ?좎빟?대?濡??ъ쑀? ?깆랬 ?덉쑝???щЪ 愿由??ъ쟾??以묒슂.",
        normal: "寃곸옱?댁쑝濡??щЪ ?먯떎 二쇱쓽.",
      },
      fun: {
        sinGang: "??媛뺥븳??寃곸옱 留뚮굹硫?寃뚯쑝由?二쇱쓽?뗣뀑 ?덈룄 議곗떖!",
        sinYak: "???쏀븳??寃곸옱 留뚮굹硫??ъ쑀 ?앷린怨?醫뗭????덉? 議곗떖??",
        normal: "??議곗떖! 寃곸옱 ?ㅼ뼱?ㅻ㈃ ?щЪ ?섍컝 ???덉쓬?졼뀪",
      },
    },
    ?앹떊: {
      empathy: {
        sinGang: "李쎌쓽?κ낵 ?쒗쁽?μ씠 鍮쏅굹???쒓린?낅땲?? ?됱냼蹂대떎 諛붿걯吏留??ы쉶???깆랬媛 ?곕Ⅴ??湲명븳 ?먮쫫?댁뿉?? ?곴레?곸쑝濡??꾩쟾?섏꽭??",
        sinYak: "?꾩씠?붿뼱媛 ?섏넖怨?諛붿걶 ?쒓린?낅땲?? ?깆랬???덉?留?泥대젰?곸쑝濡??섎뱾 ???덉쑝??臾대━?섏? 留먭퀬 ?댁떇??梨숆린?몄슂.",
        normal: "李쎌쓽?κ낵 ?쒗쁽?μ씠 鍮쏅굹???쒓린?낅땲?? ?덈줈???꾩씠?붿뼱瑜?留덉쓬猿??쇱퀜蹂댁꽭??",
      },
      reality: {
        sinGang: "?앹떊?? ?좉컯?대?濡?諛붿겏 + ?깆랬. 李쎌옉쨌湲고쉷쨌援먯쑁 遺꾩빞 湲명븿.",
        sinYak: "?앹떊?? ?좎빟?대?濡?諛붿겏 + ?깆랬 but 泥대젰 ?뚮え. ?댁떇 ?꾩닔.",
        normal: "?앹떊?댁쑝濡?李쎌옉쨌湲고쉷쨌援먯쑁 遺꾩빞 ?좊━. ?섏엯 ?덉젙.",
      },
      fun: {
        sinGang: "?꾩씠?붿뼱 ?섏넖?? ?앹떊???ㅼ뼱?ㅻ㈃ 諛붿걯吏留??諛?李ъ뒪?뗣뀑",
        sinYak: "?꾩씠?붿뼱??醫뗭??????쏀빐??醫 ?섎뱾 ???덉쓬?졼뀪 ?ъ뾼?ъ뾼!",
        normal: "?꾩씠?붿뼱 ?섏넖?? ?앹떊?댁? 李쎌옉?섍린 ??醫뗭쓬?뗣뀑",
      },
    },
    ?곴?: {
      empathy: {
        sinGang: "?먯쑀濡?퀬 ?곸떊?곸씤 ?먮꼫吏媛 ?섏튂???쒓린?낅땲?? 諛붿걯吏留??ы쉶???깆랬媛 ?곕Ⅴ???곴레?곸쑝濡??쒗쁽?섏꽭?? ?? 留먯“?ъ? ?꾩슂?댁슂.",
        sinYak: "?쒗쁽?μ씠 洹밸??붾릺怨?諛붿걶 ?쒓린?낅땲?? ?깆랬???덉?留??뺤떊?겶룹쑁泥댁쟻?쇰줈 ?섎뱾 ???덉쑝??臾대━?섏? 留덉꽭?? 留먯“?щ룄 ?꾩닔!",
        normal: "?먯쑀濡?퀬 ?곸떊?곸씤 ?먮꼫吏媛 ?섏튂???쒓린?낅땲?? ?섏?留?留먯“?ъ씠 ?꾩슂?댁슂.",
      },
      reality: {
        sinGang: "?곴??? ?좉컯?대?濡?諛붿겏 + ?깆랬. ?쒗쁽??洹밸??? 留먯“??",
        sinYak: "?곴??? ?좎빟?대?濡?諛붿겏 + ?깆랬 but ?섎벀. ?ㅽ듃?덉뒪 愿由??꾩닔.",
        normal: "?곴??댁쑝濡??쒗쁽??洹밸??? 愿吏겶룹쭅?μ슫 遺덉븞??媛??",
      },
      fun: {
        sinGang: "留?議곗떖?섎㈃??諛붿걯寃??щ젮! ?곴? ?곗?硫??諛?媛곥뀑??,
        sinYak: "???쏀븳???곴? 留뚮굹硫???嫄곗묠?놁뼱吏怨??섎뱾 ???덉쓬?졼뀪",
        normal: "留?議곗떖! ?곴? ?곗?硫??낆씠 嫄곗묠?놁뼱吏먦뀑??,
      },
    },
    ?몄옱: {
      empathy: {
        sinGang: "?쒕컻???щЪ ?먮쫫???앷린???쒓린?낅땲?? ?됱냼蹂대떎 諛붿걯吏留??ы쉶???깆랬媛 ?곕Ⅴ???ъ뾽?대굹 ?ъ옄???곴레 ?꾩쟾?섏꽭??",
        sinYak: "?щЪ 湲고쉶媛 ?ㅺ퀬 諛붿걶 ?쒓린?낅땲?? ?깆랬???덉?留?臾대━?섎㈃ ?섎뱾 ???덉쑝???덉젙?곸씤 ?異뺤씠???묒? ?ъ옄濡??좎쨷?섍쾶 ?묎렐?섏꽭??",
        normal: "?쒕컻???щЪ ?먮쫫???앷린???쒓린?낅땲?? ?ъ뾽?대굹 ?ъ옄 湲고쉶媛 留롮븘吏????덉뼱??",
      },
      reality: {
        sinGang: "?몄옱?? ?좉컯?대?濡?諛붿겏 + ?깆랬. ?ъ뾽쨌?ъ옄 ?곴레 沅뚯옣.",
        sinYak: "?몄옱?? ?좎빟?대?濡?諛붿겏 + ?깆랬 but ?섎벀. 臾대━???ъ뾽 吏?? ?덉젙???ы뀒??沅뚯옣.",
        normal: "?몄옱?댁쑝濡??좊룞?ъ궛 利앷?. ?ъ뾽쨌?ъ옄 ?곴린.",
      },
      fun: {
        sinGang: "??踰?李ъ뒪! ?몄옱 ?ㅼ뼱?ㅻ㈃ 諛붿걯吏留??ъ뾽?대굹 ?ъ옄 怨좉퀬!",
        sinYak: "??踰?湲고쉶???붾뒗?????쏀빐??臾대━?섎㈃ ???ⓦ뀪???異뺤씠????",
        normal: "??踰?李ъ뒪! ?몄옱 ?ㅼ뼱?ㅻ㈃ ?ъ뾽?대굹 ?ъ옄 怨좉퀬!",
      },
    },
    ?뺤옱: {
      empathy: {
        sinGang: "?덉젙?곸씤 ?щЪ怨?寃곗떎???삳뒗 ?쒓린?낅땲?? ?됱냼蹂대떎 諛붿걯吏留?袁몄????몃젰???ы쉶???깆랬濡??댁뼱吏묐땲??",
        sinYak: "?щЪ?댁? ?덇퀬 諛붿걶 ?쒓린?낅땲?? ?깆랬???덉?留?臾대━?섏? 留먭퀬 ?덉젙?곸쑝濡?愿由ы븯?몄슂. 怨쇱슃? 湲덈Ъ?댁뿉??",
        normal: "?덉젙?곸씤 ?щЪ怨?寃곗떎???삳뒗 ?쒓린?낅땲?? 袁몄????몃젰??鍮쏆쓣 諛쒗븷 嫄곗삁??",
      },
      reality: {
        sinGang: "?뺤옱?? ?좉컯?대?濡?諛붿겏 + ?깆랬. 怨좎젙?섏엯 利앷?. 遺?숈궛쨌?異??좊━.",
        sinYak: "?뺤옱?? ?좎빟?대?濡?諛붿겏 + ?깆랬 but ?섎벀. ?덉젙??愿由??꾩슂. 臾대━???ъ옄 吏??",
        normal: "?뺤옱?댁쑝濡?怨좎젙?섏엯 ?덉젙. 遺?숈궛쨌?異??좊━.",
      },
      fun: {
        sinGang: "?붽툒?곸씠 理쒓퀬???? ?뺤옱??諛붿걯吏留?李⑹떎?섍쾶 紐⑥쑝湲??깆엫??,
        sinYak: "?뺤옱 ?붾뒗?????쏀빐?????ъ옄??湲덈Ъ! ?덉젙?곸쑝濡?媛??",
        normal: "?붽툒?곸씠 理쒓퀬???? ?뺤옱??李⑹떎?섍쾶 紐⑥쑝湲??깆엫??,
      },
    },
    ?멸?: {
      empathy: {
        sinGang: "媛뺥븳 ?꾩쟾怨??뺣컯???덈뒗 ?쒓린?낅땲?? ?됱냼蹂대떎 諛붿걯吏留?洹밸났?섎㈃ ???ы쉶???깆랬? 由щ뜑??쓣 ?살쓣 ???덉뼱?? ?곴레?곸쑝濡??꾩쟾?섏꽭??",
        sinYak: "梨낆엫怨??뺣컯??紐곕젮?ㅻ뒗 ?쒓린?낅땲?? ?깆랬???덉?留??뺤떊?겶룹쑁泥댁쟻?쇰줈 留ㅼ슦 ?섎뱾 ???덉쑝???ㅽ듃?덉뒪 愿由ъ? ?댁떇???꾩닔?덉슂.",
        normal: "媛뺥븳 ?꾩쟾怨??뺣컯???덈뒗 ?쒓린?낅땲?? ?섏?留?洹밸났?섎㈃ ???깆옣???곕씪???",
      },
      reality: {
        sinGang: "?멸??? ?좉컯?대?濡?諛붿겏 + ?깆랬. 由щ뜑??룹듅吏?湲고쉶. 湲명븿.",
        sinYak: "?멸??? ?좎빟?대?濡?諛붿겏 + ?깆랬 but 留ㅼ슦 ?섎벀. ?ㅽ듃?덉뒪 愿由??꾩닔.",
        normal: "?멸??댁쑝濡?由щ뜑??룹듅吏?湲고쉶. ?ㅽ듃?덉뒪 愿由??꾩닔.",
      },
      fun: {
        sinGang: "鍮≪꽱 ?쒓린?꾠뀑???멸? ?ㅻ㈃ 諛붿걯吏留??뱀쭊 李ъ뒪????",
        sinYak: "???쏀븳???멸? 留뚮굹硫?吏꾩쭨 ?섎벀?졼뀪 ?깆랬???덈뒗??紐?梨숆꺼!",
        normal: "鍮≪꽱 ?쒓린?꾠뀑???멸? ?ㅻ㈃ ?뺣컯 ?덉?留??뱀쭊 李ъ뒪????",
      },
    },
    ?뺢?: {
      empathy: {
        sinGang: "梨낆엫怨?紐낆삁媛 ?곕Ⅴ???쒓린?낅땲?? ?됱냼蹂대떎 諛붿걯吏留??ы쉶?곸쑝濡??몄젙諛쏄퀬 ?깆랬瑜??대（??湲명븳 ?먮쫫?댁뿉?? ?먯떊媛??덇쾶 ?섏븘媛?몄슂!",
        sinYak: "紐낆삁? 梨낆엫??二쇱뼱吏???쒓린?낅땲?? ?깆랬???덉?留?遺?댁씠 ?????덉쑝??臾대━?섏? 留먭퀬 二쇰????꾩???諛쏆쑝?몄슂.",
        normal: "梨낆엫怨?紐낆삁媛 ?곕Ⅴ???쒓린?낅땲?? ?ы쉶?곸쑝濡??몄젙諛쏆쓣 湲고쉶媛 留롮븘??",
      },
      reality: {
        sinGang: "?뺢??? ?좉컯?대?濡?諛붿겏 + ?깆랬. ?뱀쭊쨌?⑷꺽쨌紐낆삁 ?띾뱷 湲명븿.",
        sinYak: "?뺢??? ?좎빟?대?濡?諛붿겏 + ?깆랬 but 遺?? 臾대━ 湲덈Ъ.",
        normal: "?뺢??댁쑝濡??뱀쭊쨌?⑷꺽쨌紐낆삁 ?띾뱷 ?좊━. ?덉젙???곸듅.",
      },
      fun: {
        sinGang: "?뺢? ?ㅼ뼱?ㅻ㈃ 諛붿걯吏留??뱀쭊?대굹 ?⑷꺽 ?뺣쪧 ?? 紐낆삁???쒓린?꾠뀑",
        sinYak: "?뺢? ?붾뒗?????쏀빐??醫 遺?대맆 ???덉쓬?졼뀪 ?섎궡!",
        normal: "?뺢? ?ㅼ뼱?ㅻ㈃ ?뱀쭊?대굹 ?⑷꺽 ?뺣쪧 ?? 紐낆삁???쒓린?꾠뀑",
      },
    },
    ?몄씤: {
      empathy: {
        sinGang: "諛곗?怨?吏?앹쓣 ?삳뒗 ?쒓린?낅땲?? ?섏?留??덉＜?섍린 ?ъ슦???섎룄?곸쑝濡?諛붿걯寃??吏곸씠硫??덈줈??遺꾩빞???꾩쟾?섏꽭?? 寃뚯쑝由꾩쓣 寃쎄퀎?댁빞 ?댁슂.",
        sinYak: "?숈뒿怨??곌뎄???ъ쑀媛 ?앷린怨??ы쉶???깆랬???④퍡 ?곕Ⅴ??湲명븳 ?쒓린?낅땲?? ?몄븞?섎㈃?쒕룄 諛쒖쟾?????덈뒗 醫뗭? ?먮쫫?댁뿉??",
        normal: "諛곗?怨?吏?앹쓣 ?삳뒗 ?쒓린?낅땲?? ?덈줈??遺꾩빞???꾩쟾??蹂댁꽭??",
      },
      reality: {
        sinGang: "?몄씤?? ?좉컯?대?濡??덉＜ 寃쎄퀎. ?섎룄???숈뒿쨌?쒕룞 沅뚯옣.",
        sinYak: "?몄씤?? ?좎빟?대?濡??ъ쑀 + ?깆랬. ?숈뒿쨌?곌뎄 湲명븿.",
        normal: "?몄씤?댁쑝濡??숈뒿쨌?곌뎄쨌鍮꾩＜瑜?遺꾩빞 ?좊━. ?낆갹??諛쒗쐶.",
      },
      fun: {
        sinGang: "怨듬???嫄곕㈃ 吏湲? ?몄씤 ?붾뒗??寃뚯쑝由?二쇱쓽?뗣뀑",
        sinYak: "?몄씤 留뚮굹硫??ъ쑀 ?앷린怨?怨듬????섎맖! 湲명븳 ?쒓린??,
        normal: "怨듬????곌뎄 ??嫄곕㈃ 吏湲? ?몄씤? 吏???볤린 ?깆엫??,
      },
    },
    ?뺤씤: {
      empathy: {
        sinGang: "?곕쑜??吏?먭낵 蹂댄샇瑜?諛쏅뒗 ?쒓린?낅땲?? ?섏?留??덉＜?섍린 ?ъ슦???섎룄?곸쑝濡?紐⑺몴瑜??ㅼ젙?섍퀬 諛붿걯寃??吏곸씠?몄슂. 寃뚯쑝由꾩쓣 議곗떖?댁빞 ?댁슂.",
        sinYak: "洹?몄쓽 ?꾩??쇰줈 ?ъ쑀媛 ?앷린怨??ы쉶???깆랬???④퍡 ?곕Ⅴ??留ㅼ슦 湲명븳 ?쒓린?낅땲?? ?몄븞?섎㈃?쒕룄 諛쒖쟾?섎뒗 醫뗭? ?먮쫫?댁뿉??",
        normal: "?곕쑜??吏?먭낵 蹂댄샇瑜?諛쏅뒗 ?쒓린?낅땲?? 二쇰????꾩??쇰줈 ?덉젙??李얠쓣 ???덉뼱??",
      },
      reality: {
        sinGang: "?뺤씤?? ?좉컯?대?濡??덉＜ 寃쎄퀎. ?섎룄???쒕룞 沅뚯옣.",
        sinYak: "?뺤씤?? ?좎빟?대?濡??ъ쑀 + ?깆랬. ?숈뾽쨌?먭꺽利씲룹듅吏?湲명븿. 洹???꾩?.",
        normal: "?뺤씤?댁쑝濡??숈뾽쨌?먭꺽利씲룹듅吏??좊━. 洹???꾩?.",
      },
      fun: {
        sinGang: "?뺤씤 ?ㅼ뼱?ㅻ㈃ ?명븳??寃뚯쑝由?二쇱쓽?뗣뀑 ?섎룄?곸쑝濡??吏곸뿬!",
        sinYak: "?뺤씤 留뚮굹硫??ъ쑀 ?앷린怨?怨듬????섎릺怨??諛? 湲명븳 ?쒓린?뗣뀑",
        normal: "?뺤씤 ?ㅼ뼱?ㅻ㈃ 怨듬? ?섎맖! ?쒗뿕?대굹 ?먭꺽利??곌린 ??醫뗭쓬??,
      },
    },
  };

  const base = interpretations[mainTenGod] || {
    empathy: { sinGang: "?덈줈??蹂??, sinYak: "?덈줈??蹂??, normal: "?덈줈??蹂?? },
    reality: { sinGang: "?댁꽭 蹂??, sinYak: "?댁꽭 蹂??, normal: "?댁꽭 蹂?? },
    fun: { sinGang: "萸붽? 諛붾?", sinYak: "萸붽? 諛붾?", normal: "萸붽? 諛붾?" },
  };

  if (isSinGang) {
    return {
      empathy: base.empathy.sinGang,
      reality: base.reality.sinGang,
      fun: base.fun.sinGang,
    };
  } else if (isSinYak) {
    return {
      empathy: base.empathy.sinYak,
      reality: base.reality.sinYak,
      fun: base.fun.sinYak,
    };
  } else {
    return {
      empathy: base.empathy.normal,
      reality: base.reality.normal,
      fun: base.fun.normal,
    };
  }
}

// =====================================================
// ?듯빀 遺꾩꽍
// =====================================================

export function analyzeFullFortune(
  birthYear: number,
  gender: "M" | "F",
  monthPillar: string,
  daeunNum: number,
  currentAge: number,
  currentYear: number,
  dayStem: string,
  originalPillars: { year: string; month: string; day: string; hour: string },
  sinGangScore: number
) {
  const greatFortune = calculateGreatFortune(
    birthYear,
    gender,
    monthPillar,
    daeunNum,
    currentAge,
    dayStem,
    originalPillars,
    sinGangScore
  );

  const yearFortune = calculateYearFortune(
    currentYear,
    dayStem,
    originalPillars,
    sinGangScore
  );

  return {
    greatFortune,
    yearFortune,
  };
}


----- FILE: frontend\data\relationsAnalysis.ts -----
// frontend/data/relationsAnalysis.ts

export const RELATIONS_ANALYSIS = {
  empathy: {
    title: "愿怨꾩쓽 ?쒕꼫吏瑜??대뒗 李곕뼞沅곹빀??湲곗슫",
    icon: "?뮆",
  },
  reality: {
    title: "?몄쟻 ?ㅽ듃?뚰겕????븰 愿怨?諛??쒕꼫吏 諛몃윴??痢≪젙",
    icon: "?뵕",
  },
  fun: {
    title: "瑗ъ????멸컙愿怨? ???諛????ㅼ뼱?ㅻ젮怨?誘몃━ ?〓븳??嫄곗빞",
    icon: "?쩃",
  },
};

// ============================================
// 1. 泥쒓컙??(鸚⒴묾?? - 5媛吏
// ============================================
const 泥쒓컙?⑺몴 = [
  ["??, "藥?], // 媛묎린?⑺넗
  ["阿?, "佯?], // ?꾧꼍?⑷툑
  ["訝?, "渦?], // 蹂묒떊?⑹닔
  ["訝?, "鶯?], // ?뺤엫?⑸ぉ
  ["??, "??], // 臾닿퀎?⑺솕
];

// ============================================
// 2. 泥쒓컙異?(鸚⒴묾亦? - 7媛吏
// ============================================
const 泥쒓컙異⑺몴 = [
  ["??, "佯?], // 媛묎꼍異?
  ["阿?, "渦?], // ?꾩떊異?
  ["訝?, "鶯?], // 蹂묒엫異?
  ["訝?, "??], // ?뺢퀎異?
  ["??, "??], // 臾닿컩異?
  ["藥?, "阿?], // 湲곗쓣異?
  ["佯?, "訝?], // 寃쎈퀝異?
];

// ============================================
// 3. 吏吏 ?≫빀 (?경뵱??릦)
// ============================================
const 吏吏?≫빀??= [
  ["耶?, "訝?], // ?먯텞?⑺넗
  ["野?, "雅?], // ?명빐?⑸ぉ
  ["??, "??], // 臾섏닠?⑺솕
  ["渦?, "??], // 吏꾩쑀?⑷툑
  ["藥?, "??], // ?ъ떊?⑹닔
  ["??, "??], // ?ㅻ??⑺솕/??
];

// ============================================
// 4. 吏吏 ?쇳빀 (?경뵱訝됧릦) - 4媛吏 援?
// ============================================
const 吏吏?쇳빀??= [
  ["野?, "??, "??], // ?몄삤???붽뎅
  ["??, "耶?, "渦?], // ?좎옄吏??섍뎅
  ["藥?, "??, "訝?], // ?ъ쑀異?湲덇뎅
  ["雅?, "??, "??], // ?대쵖誘?紐⑷뎅
];

// ============================================
// 5. 吏吏 諛⑺빀 (?경뵱?밧릦) - 4媛吏 諛⑹쐞
// ============================================
const 吏吏諛⑺빀??= [
  ["野?, "??, "渦?], // ?몃쵖吏??숇갑紐?
  ["藥?, "??, "??], // ?ъ삤誘??⑤갑??
  ["??, "??, "??], // ?좎쑀???쒕갑湲?
  ["雅?, "耶?, "訝?], // ?댁옄異?遺곷갑??
];

// ============================================
// 6. 吏吏 諛섑빀 (?경뵱?듿릦) - ?쇳빀??2湲??
// ============================================
const 吏吏諛섑빀??= [
  ["野?, "??], // ?몄삤 諛섑빀
  ["??, "??], // ?ㅼ닠 諛섑빀
  ["野?, "??], // ?몄닠 諛섑빀
  ["??, "耶?], // ?좎옄 諛섑빀
  ["耶?, "渦?], // ?먯쭊 諛섑빀
  ["??, "渦?], // ?좎쭊 諛섑빀
  ["藥?, "??], // ?ъ쑀 諛섑빀
  ["??, "訝?], // ?좎텞 諛섑빀
  ["藥?, "訝?], // ?ъ텞 諛섑빀
  ["雅?, "??], // ?대쵖 諛섑빀
  ["??, "??], // 臾섎? 諛섑빀
  ["雅?, "??], // ?대? 諛섑빀
];

// ============================================
// 7. 吏吏 異?(?경뵱亦?
// ============================================
const 吏吏異⑺몴 = [
  ["耶?, "??], // ?먯삤異?
  ["訝?, "??], // 異뺣?異?
  ["野?, "??], // ?몄떊異?
  ["??, "??], // 臾섏쑀異?
  ["渦?, "??], // 吏꾩닠異?
  ["藥?, "雅?], // ?ы빐異?
];

// ============================================
// 8. 吏吏 ??(?경뵱??
// ============================================
const 吏吏?뺥몴 = [
  ["野?, "藥?, "??], // ?몄궗???쇳삎 (臾댁?吏??
  ["訝?, "??, "??], // 異뺤닠誘??쇳삎 (吏?몄???
  ["耶?, "??], // ?먮쵖??(臾대?吏??
  ["渦?, "渦?], // 吏꾩쭊?먰삎
  ["??, "??], // ?ㅼ삤?먰삎
  ["??, "??], // ?좎쑀?먰삎
  ["雅?, "雅?], // ?댄빐?먰삎
];

// ============================================
// 9. 吏吏 ??(?경뵱若?
// ============================================
const 吏吏?댄몴 = [
  ["耶?, "??], // ?먮???
  ["訝?, "??], // 異뺤삤??
  ["野?, "藥?], // ?몄궗??
  ["??, "渦?], // 臾섏쭊??
  ["??, "雅?], // ?좏빐??
  ["??, "??], // ?좎닠??
];

// ============================================
// 10. 吏吏 ??(?경뵱?? - 異붽?
// ============================================
const 吏吏?뚰몴 = [
  ["耶?, "??], // ?먯쑀??
  ["訝?, "渦?], // 異뺤쭊??
  ["野?, "雅?], // ?명빐??
  ["??, "??], // 臾섏삤??
  ["藥?, "??], // ?ъ떊??
  ["??, "??], // 誘몄닠??
];

// ============================================
// 11. ?먯쭊 (?ⓨ뿏) - 異붽?
// ============================================
const ?먯쭊??= [
  ["耶?, "??],
  ["訝?, "??],
  ["野?, "藥?],
  ["??, "渦?],
  ["??, "雅?],
  ["??, "??],
];

// ============================================
// ?⑹땐?뺥빐???먯젙 ?⑥닔 (?꾩쟾??
// ============================================
export function analyzeRelations(
  stems: string[],  // [?꾧컙, ?붽컙, ?쇨컙, ?쒓컙]
  branches: string[] // [?꾩?, ?붿?, ?쇱?, ?쒖?]
): {
  // 泥쒓컙
  泥쒓컙?? string[];
  泥쒓컙異? string[];
  
  // 吏吏 ??
  ?≫빀: string[];
  ?쇳빀: string[];
  諛⑺빀: string[];
  諛섑빀: string[];
  
  // 吏吏 ??
  異? string[];
  ?? string[];
  ?? string[];
  ?? string[];
  ?먯쭊: string[];
  
  // ?붿빟
  珥앺빀媛쒖닔: number;
  珥앺쓨媛쒖닔: number;
  
  // ?ㅻ챸
  empathy: string;
  reality: string;
  fun: string;
} {
  const 泥쒓컙?? string[] = [];
  const 泥쒓컙異? string[] = [];
  const ?≫빀: string[] = [];
  const ?쇳빀: string[] = [];
  const 諛⑺빀: string[] = [];
  const 諛섑빀: string[] = [];
  const 異? string[] = [];
  const ?? string[] = [];
  const ?? string[] = [];
  const ?? string[] = [];
  const ?먯쭊: string[] = [];

  // ========================================
  // 1. 泥쒓컙??泥댄겕
  // ========================================
  for (let i = 0; i < stems.length; i++) {
    for (let j = i + 1; j < stems.length; j++) {
      泥쒓컙?⑺몴.forEach(([a, b]) => {
        if (
          (stems[i] === a && stems[j] === b) ||
          (stems[i] === b && stems[j] === a)
        ) {
          泥쒓컙??push(`${stems[i]}${stems[j]}??);
        }
      });
    }
  }

  // ========================================
  // 2. 泥쒓컙異?泥댄겕
  // ========================================
  for (let i = 0; i < stems.length; i++) {
    for (let j = i + 1; j < stems.length; j++) {
      泥쒓컙異⑺몴.forEach(([a, b]) => {
        if (
          (stems[i] === a && stems[j] === b) ||
          (stems[i] === b && stems[j] === a)
        ) {
          泥쒓컙異?push(`${stems[i]}${stems[j]}異?);
        }
      });
    }
  }

  // ========================================
  // 3. 吏吏 ?≫빀 泥댄겕
  // ========================================
  for (let i = 0; i < branches.length; i++) {
    for (let j = i + 1; j < branches.length; j++) {
      吏吏?≫빀??forEach(([a, b]) => {
        if (
          (branches[i] === a && branches[j] === b) ||
          (branches[i] === b && branches[j] === a)
        ) {
          ?≫빀.push(`${branches[i]}${branches[j]}??);
        }
      });
    }
  }

  // ========================================
  // 4. 吏吏 ?쇳빀 泥댄겕 (3媛?紐⑤몢 ?덉뼱????
  // ========================================
  吏吏?쇳빀??forEach(group => {
    const count = group.filter(g => branches.includes(g)).length;
    if (count === 3) {
      ?쇳빀.push(`${group.join("")}?쇳빀`);
    }
  });

  // ========================================
  // 5. 吏吏 諛⑺빀 泥댄겕 (3媛?紐⑤몢 ?덉뼱????
  // ========================================
  吏吏諛⑺빀??forEach(group => {
    const count = group.filter(g => branches.includes(g)).length;
    if (count === 3) {
      諛⑺빀.push(`${group.join("")}諛⑺빀`);
    }
  });

  // ========================================
  // 6. 吏吏 諛섑빀 泥댄겕 (2媛쒕쭔 ?덉뼱???깅┰)
  // ========================================
  吏吏諛섑빀??forEach(([a, b]) => {
    if (branches.includes(a) && branches.includes(b)) {
      // 以묐났 諛⑹? (?대? ?쇳빀???ы븿?섏뿀?쇰㈃ ?쒖쇅)
      const is?쇳빀 = ?쇳빀.some(s => s.includes(a) && s.includes(b));
      if (!is?쇳빀) {
        諛섑빀.push(`${a}${b}諛섑빀`);
      }
    }
  });

  // ========================================
  // 7. 吏吏 異?泥댄겕
  // ========================================
  for (let i = 0; i < branches.length; i++) {
    for (let j = i + 1; j < branches.length; j++) {
      吏吏異⑺몴.forEach(([a, b]) => {
        if (
          (branches[i] === a && branches[j] === b) ||
          (branches[i] === b && branches[j] === a)
        ) {
          異?push(`${branches[i]}${branches[j]}異?);
        }
      });
    }
  }

  // ========================================
  // 8. 吏吏 ??泥댄겕
  // ========================================
  吏吏?뺥몴.forEach(group => {
    if (group.length === 3) {
      // ?쇳삎 (2媛??댁긽 ?덉쑝硫????깅┰)
      const matched = group.filter(g => branches.includes(g));
      if (matched.length >= 2) {
        ??push(`${matched.join("")}??);
      }
    } else if (group.length === 2) {
      // ?먰삎 (媛숈? 湲??2媛?
      const [a, b] = group;
      if (a === b) {
        const count = branches.filter(br => br === a).length;
        if (count >= 2) {
          ??push(`${a}${a}?먰삎`);
        }
      } else {
        // ?먮쵖??
        if (branches.includes(a) && branches.includes(b)) {
          ??push(`${a}${b}??);
        }
      }
    }
  });

  // ========================================
  // 9. 吏吏 ??泥댄겕
  // ========================================
  for (let i = 0; i < branches.length; i++) {
    for (let j = i + 1; j < branches.length; j++) {
      吏吏?댄몴.forEach(([a, b]) => {
        if (
          (branches[i] === a && branches[j] === b) ||
          (branches[i] === b && branches[j] === a)
        ) {
          ??push(`${branches[i]}${branches[j]}??);
        }
      });
    }
  }

  // ========================================
  // 10. 吏吏 ??泥댄겕
  // ========================================
  for (let i = 0; i < branches.length; i++) {
    for (let j = i + 1; j < branches.length; j++) {
      吏吏?뚰몴.forEach(([a, b]) => {
        if (
          (branches[i] === a && branches[j] === b) ||
          (branches[i] === b && branches[j] === a)
        ) {
          ??push(`${branches[i]}${branches[j]}??);
        }
      });
    }
  }

  // ========================================
  // 11. ?먯쭊 泥댄겕
  // ========================================
  for (let i = 0; i < branches.length; i++) {
    for (let j = i + 1; j < branches.length; j++) {
      ?먯쭊??forEach(([a, b]) => {
        if (
          (branches[i] === a && branches[j] === b) ||
          (branches[i] === b && branches[j] === a)
        ) {
          ?먯쭊.push(`${branches[i]}${branches[j]}?먯쭊`);
        }
      });
    }
  }

  // ========================================
  // 以묐났 ?쒓굅
  // ========================================
  const unique泥쒓컙??= [...new Set(泥쒓컙??];
  const unique泥쒓컙異?= [...new Set(泥쒓컙異?];
  const unique?≫빀 = [...new Set(?≫빀)];
  const unique?쇳빀 = [...new Set(?쇳빀)];
  const unique諛⑺빀 = [...new Set(諛⑺빀)];
  const unique諛섑빀 = [...new Set(諛섑빀)];
  const unique異?= [...new Set(異?];
  const unique??= [...new Set(??];
  const unique??= [...new Set(??];
  const unique??= [...new Set(??];
  const unique?먯쭊 = [...new Set(?먯쭊)];

  // ========================================
  // 珥?媛쒖닔 怨꾩궛
  // ========================================
  const 珥앺빀媛쒖닔 =
    unique泥쒓컙??length +
    unique?≫빀.length +
    unique?쇳빀.length +
    unique諛⑺빀.length +
    unique諛섑빀.length;

  const 珥앺쓨媛쒖닔 =
    unique泥쒓컙異?length +
    unique異?length +
    unique??length +
    unique??length +
    unique??length +
    unique?먯쭊.length;

  // ========================================
  // ?ㅻ챸 ?앹꽦
  // ========================================
  const has湲?= 珥앺빀媛쒖닔 > 0;
  const has??= 珥앺쓨媛쒖닔 > 0;
  const has異?= unique異?length > 0 || unique泥쒓컙異?length > 0;

  let empathyText = "";
  let realityText = "";
  let funText = "";

  // 媛먯꽦???ㅻ챸
  if (has湲?&& !has?? {
    empathyText = `議고솕濡쒖슫 湲곗슫??媛?앺빐?? `;
    if (unique泥쒓컙??length > 0) empathyText += `泥쒓컙??${unique泥쒓컙??join(", ")})?쇰줈 ?뺤떊???좊?媛 媛뺥븯怨? `;
    if (unique?쇳빀.length > 0) empathyText += `?쇳빀(${unique?쇳빀.join(", ")})?쇰줈 ???섏씠 紐⑥씠硫? `;
    if (unique?≫빀.length > 0) empathyText += `?≫빀(${unique?≫빀.join(", ")})?쇰줈 醫뗭? ?몄뿰??留롮븘?? `;
    empathyText += `?щ엺?ㅺ낵 ???댁슱由ш퀬 ?묐젰?????⑸땲?? ?몄뿰???뚯쨷???섎㈃ ?????됱슫??李얠븘??嫄곗삁??`;
  } else if (has湲?&& has?? {
    empathyText = `議고솕? 蹂?붽? ?④퍡 ?덉뼱?? `;
    if (unique泥쒓컙??length > 0 || unique?≫빀.length > 0 || unique?쇳빀.length > 0) {
      empathyText += `醫뗭? ?몄뿰(?? ${珥앺빀媛쒖닔}媛????덉?留? `;
    }
    if (has異? {
      empathyText += `異?${[...unique泥쒓컙異? ...unique異?.join(", ")})? 蹂?붿? ?쒖꽦?붿쓽 ?좏샇?덉슂. ?뺤껜?섏뼱 ?덈뜕 ?곹솴???吏곸씠湲??쒖옉?⑸땲?? `;
    }
    if (unique??length > 0 || unique??length > 0) {
      empathyText += `蹂듭옟??愿怨?${[...unique?? ...unique??.join(", ")})???덉?留? ?대뒗 ?깆옣??湲고쉶媛 ?⑸땲?? `;
    }
    empathyText += `蹂?붾? ?먮젮?뚰븯吏 留먭퀬, 愿怨꾨? ??議곗쑉?섎㈃ ?????깆옣???대０ ???덉뼱??`;
  } else if (!has湲?&& has?? {
    empathyText = `蹂?붿? ?꾩쟾??湲곗슫???덉뼱?? `;
    if (has異? {
      empathyText += `異?${[...unique泥쒓컙異? ...unique異?.join(", ")})? ?섏걶 寃껋씠 ?꾨땲???뺤껜???먮꼫吏瑜??쒖꽦?붿떆?ㅻ뒗 ?섏씠?먯슂. ?덈줈??湲고쉶媛 李얠븘?듬땲?? `;
    }
    if (unique??length > 0) empathyText += `??${unique??join(", ")})? ?쒕젴???듯븳 ?깆옣???섎??댁슂. `;
    empathyText += `?대젮????덈뜑?쇰룄 洹멸쾬???뱀떊????媛뺥븯寃?留뚮뱾 嫄곗삁?? ?댄빐? 諛곕젮濡???닿??몄슂.`;
  } else {
    empathyText = `?덉젙?곸씤 愿怨??먮쫫??媛吏怨??덉뼱?? ??異⑸룎?대굹 洹뱀쟻??蹂???놁씠 ?됱삩?섍쾶 ?щ엺?ㅺ낵 吏?????덉뼱?? ?대윴 ?덉젙媛먯씠 ?뱀떊???μ젏?낅땲??`;
  }

  // 遺꾩꽍???ㅻ챸
  if (has湲?&& !has?? {
    realityText = `?쒕꼫吏 ?쒖꽦??吏?? ${珥앺빀媛쒖닔}嫄? `;
    if (unique泥쒓컙??length > 0) realityText += `泥쒓컙??${unique泥쒓컙??length}嫄? - ?뺤떊???묐젰 ?곗닔. `;
    if (unique?쇳빀.length > 0) realityText += `?쇳빀(${unique?쇳빀.length}嫄? - 媛뺣젰???먮꼫吏 吏묒쨷. `;
    if (unique?≫빀.length > 0) realityText += `?≫빀(${unique?≫빀.length}嫄? - 1:1 議고솕 理쒖쟻. `;
    realityText += `?묐젰 ???깃낵 利앺룺 ?덉긽. ??뚰겕 ?⑥쑉 ?곸쐞 20%. ?ㅽ듃?뚰궧 ?λ젰 ?곗닔.`;
  } else if (has湲?&& has?? {
    realityText = `蹂듯빀 ??븰 援ъ“. 湲몄떊 ${珥앺빀媛쒖닔}嫄? ?됱떊 ${珥앺쓨媛쒖닔}嫄??숈떆 ?쒖꽦?? `;
    if (has異? {
      realityText += `異?${unique泥쒓컙異?length + unique異?length}嫄? - 蹂?숈꽦 利앷?, ?쒖꽦???④낵. ?뺤껜 ?덊뵾 諛??뚰뙆 媛?μ꽦. `;
    }
    if (unique??length > 0) realityText += `??${unique??length}嫄? - 媛덈벑 蹂??議댁옱, ?꾧린愿由??꾩슂. `;
    realityText += `洹좏삎 議곗쑉 ???쒕꼫吏 洹밸???媛?? ?좎뿰??????꾨왂 沅뚯옣.`;
  } else if (!has湲?&& has?? {
    realityText = `?쒖꽦??蹂??${珥앺쓨媛쒖닔}嫄?寃異? `;
    if (has異? {
      realityText += `異?${unique泥쒓컙異?length + unique異?length}嫄? - 蹂?숈꽦 ?믪쓬. 蹂???곸쓳???뚯뒪?? 湲고쉶 李쎌텧 媛?μ꽦 ?숈떆 議댁옱. `;
    }
    if (unique??length > 0) realityText += `??${unique??length}嫄? - 蹂듭옟??利앷?. 而ㅻ??덉??댁뀡 ?ㅽ궗 以묒슂. `;
    realityText += `?꾧린愿由?紐⑤뱶 沅뚯옣. 蹂?붾? 湲고쉶濡??꾪솚?섎뒗 ?꾨왂 ?꾩슂.`;
  } else {
    realityText = `以묐┰???ㅽ듃?뚰겕 援ъ“. 洹밸떒??蹂?숈꽦 ?놁쓬. ?덉젙??愿怨??좎?. ?덉륫 媛?ν븳 ?멸컙愿怨??⑦꽩. 由ъ뒪??理쒖냼??援ъ“.`;
  }

  // 李먯튇???ㅻ챸
  if (has湲?&& !has?? {
    funText = `?????몃났 ?諛뺤씠?? `;
    if (unique泥쒓컙??length > 0) funText += `泥쒓컙??${unique泥쒓컙??join(", ")})?쇰줈 留덉쓬 ???듯븯怨? `;
    if (unique?쇳빀.length > 0) funText += `?쇳빀(${unique?쇳빀.join(", ")})?쇰줈 ??뚰겕 ?앸궡二쇨퀬, `;
    if (unique?≫빀.length > 0) funText += `?≫빀(${unique?≫빀.join(", ")})?쇰줈 李곕뼞沅곹빀 留롮븘! `;
    funText += `二쇰??먯꽌 ?ㅻ뱾 ???꾩?二쇰젮怨??섎뜑?? ???????!`;
  } else if (has湲?&& has?? {
    funText = `???ъ＜ ?꾩쟾 ?쒕씪留덊떛?섎떎! `;
    if (has異? {
      funText += `異?${[...unique泥쒓컙異? ...unique異?.join(", ")})?덈뒗???닿굅 ?섏걶 嫄??꾨땲?? ?뺤껜??嫄???源⑤??섍퀬 ?덈줈??嫄??쒖옉?섎씪???좏샇?? `;
    }
    funText += `醫뗭? ?몄뿰(${珥앺빀媛쒖닔}媛????덇퀬 蹂??${珥앺쓨媛쒖닔}媛????덉뼱???몄깮 濡ㅻ윭肄붿뒪?? 洹쇰뜲 ?닿쾶 ?щ컡???몄깮?댁빞! ?됰쾾??嫄곕낫???섏븘!`;
  } else if (!has湲?&& has?? {
    funText = `??蹂?붿쓽 ?꾩씠肄? `;
    if (has異? {
      funText += `異?${[...unique泥쒓컙異? ...unique異?.join(", ")}) ?덉옏?? ?닿굅 ?諛??곗??ㅺ퀬 洹몃윭??嫄곗빞! 留됲??덈뜕 寃????ル┛?? `;
    }
    if (unique??length > 0) funText += `??${unique??join(", ")})???덈뒗???닿굔 ?쒕젴 醫 ?덈떎??嫄곗빞. 洹쇰뜲 ?닿굅 ?섏쑝硫??덈꺼?? `;
    funText += `吏湲??섎뱾?대룄 李몄븘! ?諛??⑤떎!`;
  } else {
    funText = `?됱삩????? 洹뱀쟻?????놁씠 議곗슜?????댁븘! ?멸컙愿怨?臾대궃?섍쾶 ?좎??섎뒗 寃????μ젏?댁빞!`;
  }

  // ========================================
  // 諛섑솚
  // ========================================
  return {
    泥쒓컙?? unique泥쒓컙??
    泥쒓컙異? unique泥쒓컙異?
    ?≫빀: unique?≫빀,
    ?쇳빀: unique?쇳빀,
    諛⑺빀: unique諛⑺빀,
    諛섑빀: unique諛섑빀,
    異? unique異?
    ?? unique??
    ?? unique??
    ?? unique??
    ?먯쭊: unique?먯쭊,
    珥앺빀媛쒖닔,
    珥앺쓨媛쒖닔,
    empathy: empathyText,
    reality: realityText,
    fun: funText,
  };
}


----- FILE: frontend\data\specialStarsAnalysis.ts -----
// frontend/data/specialStarsAnalysis.ts

export const SPECIAL_STARS_ANALYSIS = {
  empathy: {
    title: "?뱀떊???몄깮 ?쒕굹由ъ삤???④꺼吏??⑷툑 移대뱶",
    icon: "?뙚",
  },
  reality: {
    title: "?몄깮 ?쒕굹由ъ삤 ???뱀닔 蹂??諛??좎옱??濡쒓렇 遺꾩꽍",
    icon: "?뱥",
  },
  fun: {
    title: "?몄깮 ??쟾??湲고쉶! ???ъ＜ ?띿뿉 ?④꺼吏??⑷툑 移대뱶 李얘린",
    icon: "?렣",
  },
};

// ?꾪솕???먯젙??(?쇱? 湲곗?)
const ?꾪솕?댄몴: Record<string, string[]> = {
  "耶?: ["??],
  "訝?: ["??],
  "野?: ["??],
  "??: ["耶?],
  "渦?: ["??],
  "藥?: ["??],
  "??: ["??],
  "??: ["耶?],
  "??: ["??],
  "??: ["??],
  "??: ["??],
  "雅?: ["耶?],
};

// ??쭏???먯젙??
const ??쭏?댄몴: Record<string, string[]> = {
  "耶?: ["野?],
  "訝?: ["雅?],
  "野?: ["??],
  "??: ["藥?],
  "渦?: ["野?],
  "藥?: ["雅?],
  "??: ["??],
  "??: ["藥?],
  "??: ["野?],
  "??: ["雅?],
  "??: ["??],
  "雅?: ["藥?],
};

// ?붽컻???먯젙??
const ?붽컻?댄몴: Record<string, string[]> = {
  "耶?: ["渦?],
  "訝?: ["訝?],
  "野?: ["??],
  "??: ["??],
  "渦?: ["渦?],
  "藥?: ["訝?],
  "??: ["??],
  "??: ["??],
  "??: ["渦?],
  "??: ["訝?],
  "??: ["??],
  "雅?: ["??],
};

// ?좎궡 ?먯젙 ?⑥닔
export function analyzeSpecialStars(
  dayBranch: string,
  yearBranch: string,
  monthBranch: string,
  hourBranch: string
): {
  stars: Array<{ name: string; description: string }>;
  empathy: string;
  reality: string;
  fun: string;
} {
  const stars: Array<{ name: string; description: string }> = [];
  const branches = [yearBranch, monthBranch, dayBranch, hourBranch];

  // 1. ?꾪솕??泥댄겕
  const ?꾪솕吏吏 = ?꾪솕?댄몴[dayBranch] || [];
  let has?꾪솕 = false;

  branches.forEach(branch => {
    if (?꾪솕吏吏.includes(branch)) {
      has?꾪솕 = true;
    }
  });

  if (has?꾪솕) {
    stars.push({
      name: "?꾪솕??,
      description: "?댁꽦?먭쾶 ?멸린媛 留롪퀬 留ㅻ젰?곸엯?덈떎. ?덉닠???щ뒫怨??ш탳?깆씠 ?곗뼱?섏슂.",
    });
  }

  // 2. ??쭏??泥댄겕
  const ??쭏吏吏 = ??쭏?댄몴[dayBranch] || [];
  let has??쭏 = false;

  branches.forEach(branch => {
    if (??쭏吏吏.includes(branch)) {
      has??쭏 = true;
    }
  });

  if (has??쭏) {
    stars.push({
      name: "??쭏??,
      description: "?대룞怨?蹂?붽? 留롮뒿?덈떎. ?ы뻾, ?댁궗, 吏곸옣 ?대룞 ???쒕룞?곸씤 ?띠쓣 ?댁븘??",
    });
  }

  // 3. ?붽컻??泥댄겕
  const ?붽컻吏吏 = ?붽컻?댄몴[dayBranch] || [];
  let has?붽컻 = false;

  branches.forEach(branch => {
    if (?붽컻吏吏.includes(branch)) {
      has?붽컻 = true;
    }
  });

  if (has?붽컻) {
    stars.push({
      name: "?붽컻??,
      description: "?덉닠, 醫낃탳, 泥좏븰??愿?ъ씠 留롮뒿?덈떎. ?곸쟻?닿퀬 ?좊퉬濡쒖슫 ?쇱뿉 ?щ뒫???덉뼱??",
    });
  }

  // ?ㅻ챸 ?앹꽦
  const starNames = stars.map(s => s.name).join(", ");

  const descriptions = {
    empathy:
      stars.length > 0
        ? `${starNames}??瑜? 媛吏怨??덉뼱?? ?밸퀎???щ뒫怨?湲고쉶媛 ?⑥뼱 ?덈떟?덈떎. ${stars.map(s => s.description).join(" ")} ?대윴 ?밸퀎?⑥씠 ?뱀떊???붿슧 鍮쏅굹寃?留뚮뱾 嫄곗삁??`
        : "?됱삩?섍퀬 ?덉젙?곸씤 ?먮쫫??媛吏??ъ＜?덉슂. 洹뱀쟻??蹂?붾낫?ㅻ뒗 袁몄??⑥씠 ?뱀떊??臾닿린?낅땲?? ?밸퀎???좎궡???녿떎??寃껋? 李⑤텇?섍퀬 ?덉젙?곸씤 ?띠쓣 ?????덈떎???섎??덉슂.",
    reality:
      stars.length > 0
        ? `?뱀닔 蹂???쒖꽦?? ${starNames}. ?좎옱??濡쒓렇 ${stars.length}嫄?寃異? ${stars.map(s => `[${s.name}] ${s.description}`).join(" ")} ?뱀닔 ?λ젰 ?쒖슜 ???깃낵 利앺룺 ?덉긽.`
        : "?쒖???援ъ“. ?뱀씠 蹂???놁쓬. ?덉젙???⑦꽩 ?좎?. 洹밸떒??蹂?숈꽦 ??쓬. ?덉륫 媛?ν븳 ?덉젙??而ㅻ━???⑥뒪.",
    fun:
      stars.length > 0
        ? `?? ??${starNames} ?덉뼱! ?닿굅 ?諛?移대뱶?? ${stars.map(s => s.description).join(" ")} ???곕㈃ ?몄깮 ??쟾?댁빞!`
        : "?밸퀎???좎궡? ?녿꽕. 洹쇰뜲 愿쒖갖?? ?됰쾾??寃?媛??醫뗭? 嫄곗빞! 洹뱀쟻?????놁씠 ???????덉뼱!",
  };

  return {
    stars,
    empathy: descriptions.empathy,
    reality: descriptions.reality,
    fun: descriptions.fun,
  };
}


----- FILE: frontend\data\strengthAnalysis.ts -----
// frontend/data/strengthAnalysis.ts

export const STRENGTH_ANALYSIS = {
  empathy: {
    title: "?붾뱾由ъ? ?딅뒗 ?뱀떊留뚯쓽 ?⑤떒???대㈃????,
    icon: "?뮞",
  },
  reality: {
    title: "?대? 硫섑깉 肄붿뼱??諛??諛?二쇱껜??濡쒖쭅 吏꾨떒",
    icon: "?쭬",
  },
  fun: {
    title: "怨좎쭛 醫 ?몃㈃ ?대븣? ?붾뱾由ъ? ?딅뒗 ??硫섑깉??臾닿린??",
    icon: "?뵦",
  },
};

// ?붾졊 ?뺤뇿??(?쇨컙???붿??먯꽌 諛쏅뒗 ??
const ?붾졊?뺤뇿?? Record<string, Record<string, number>> = {
  "??: { "野?: 20, "??: 20, "渦?: 10, "雅?: 15, "耶?: 10, "??: 5, "??: 5, "藥?: 0, "??: -10, "??: -10, "??: 5, "訝?: 5 },
  "阿?: { "??: 20, "野?: 15, "渦?: 10, "??: 10, "雅?: 10, "耶?: 5, "??: 0, "藥?: 0, "??: -10, "??: -10, "??: 5, "訝?: 5 },
  "訝?: { "藥?: 20, "??: 20, "野?: 15, "??: 10, "??: 10, "??: 10, "渦?: 5, "訝?: 0, "??: -10, "??: -10, "耶?: -15, "雅?: -10 },
  "訝?: { "??: 20, "藥?: 15, "??: 10, "??: 10, "野?: 10, "??: 5, "渦?: 0, "訝?: 0, "??: -10, "??: -10, "耶?: -15, "雅?: -10 },
  "??: { "渦?: 20, "??: 20, "訝?: 15, "??: 15, "??: 10, "藥?: 10, "野?: 5, "??: 0, "??: 0, "??: 0, "耶?: -10, "雅?: -10 },
  "藥?: { "??: 20, "渦?: 15, "??: 15, "訝?: 15, "??: 10, "藥?: 5, "野?: 0, "??: 0, "??: 0, "??: 0, "耶?: -10, "雅?: -10 },
  "佯?: { "??: 20, "??: 20, "渦?: 10, "??: 10, "訝?: 10, "??: 5, "藥?: 5, "??: 0, "野?: -10, "??: -10, "耶?: 5, "雅?: 0 },
  "渦?: { "??: 20, "??: 15, "渦?: 10, "??: 10, "訝?: 10, "??: 5, "藥?: 0, "??: 0, "野?: -10, "??: -10, "耶?: 5, "雅?: 5 },
  "鶯?: { "耶?: 20, "雅?: 20, "??: 15, "渦?: 10, "訝?: 10, "??: 5, "野?: 5, "??: 0, "??: -15, "藥?: -10, "??: -5, "??: -5 },
  "??: { "雅?: 20, "耶?: 15, "??: 10, "渦?: 10, "訝?: 10, "??: 5, "野?: 0, "??: 0, "??: -15, "藥?: -10, "??: -5, "??: -5 },
};

// ??꽦蹂??먯닔 (媛꾨떒 踰꾩쟾)
function getTenGodScore(god: string): number {
  const scores: Record<string, number> = {
    "鍮꾧껄": 10,
    "寃곸옱": 10,
    "?뺤씤": 8,
    "?몄씤": 8,
    "?앹떊": -5,
    "?곴?": -5,
    "?뺤옱": -8,
    "?몄옱": -8,
    "?뺢?": -10,
    "?멸?": -10,
  };
  return scores[god] || 0;
}

// ?좉컯?좎빟 ?먯젙 ?⑥닔
export function analyzeStrength(
  dayStem: string,
  monthBranch: string,
  pillars: Array<{ cheongan: { hanja: string }; jiji: { hanja: string } }>,
  tenGodFunc: (dayStem: string, targetStem: string) => string
): {
  type: "?좉컯" | "?좎빟" | "以묓솕";
  score: number;
  empathy: string;
  reality: string;
  fun: string;
  recommendation: string;
} {
  let score = 50; // 湲곕낯 50??

  // 1. ?붾졊(?붿?) ?앸졊 ?щ? 泥댄겕
  const monthScore = ?붾졊?뺤뇿??dayStem]?.[monthBranch] || 0;
  score += monthScore;

  // 2. ?ъ＜ 泥쒓컙????꽦 泥댄겕
  pillars.forEach(pillar => {
    const god = tenGodFunc(dayStem, pillar.cheongan.hanja);
    score += getTenGodScore(god);
  });

  // 3. ?먯젙
  let type: "?좉컯" | "?좎빟" | "以묓솕";
  if (score >= 70) {
    type = "?좉컯";
  } else if (score <= 40) {
    type = "?좎빟";
  } else {
    type = "以묓솕";
  }

  // 4. ?ㅻ챸
  const descriptions = {
    ?좉컯: {
      empathy: "?뱀떊? ?ㅼ뒪濡쒕? 吏?ㅻ뒗 ?섏씠 媛뺥빐?? ?쇱옄?쒕룄 ???대궪 ???덈뒗 ?⑤떒???щ엺?낅땲?? ?몃????곹뼢???ш쾶 諛쏆? ?딄퀬, ?먯떊???뚯떊?濡??댁븘媛???섏씠 ?덉뼱?? ?뚮줈??怨좎쭛?ㅻ윭??蹂댁씪 ???덉?留? 洹멸쾬???뱀떊??媛뺤젏?댁뿉??",
      reality: `硫섑깉 肄붿뼱 諛?? ${score}?? ?먮┰???곗닔. ?낅┰???섏궗寃곗젙 ?λ젰 理쒖긽?? ?몃? ?뺣젰????????젰 ?믪쓬. ?먭린二쇰룄??紐⑺몴 ?ъ꽦 ?λ젰 ?곸썡. 由щ뜑??諛쒗쐶 ???④낵 洹밸???`,
      fun: "???쇱옄?쒕룄 ??踰꾪뀲! 洹?怨좎쭛 醫 ??蹂댁씠吏留?洹멸쾶 ??臾닿린?? ???섍껄 ???ㅼ뼱????湲?媛硫??? 洹쇰뜲 媛?붿? 醫 ?ㅼ뼱以섎씪 ?뗣뀑",
      recommendation: "?낅┰?곸씤 ?쇱씠 ??留욎븘?? 李쎌뾽, ?꾨━?쒖꽌, ?먯쁺?????ㅼ뒪濡?寃곗젙?섍퀬 梨낆엫吏???쇱뿉??鍮쏅굹?? ?ㅻ쭔 ?덈Т 怨좎쭛遺由ъ? 留먭퀬 ??묐룄 諛곗슦?몄슂.",
    },
    ?좎빟: {
      empathy: "遺?쒕읇怨??좎뿰???뱀떊. ?ㅻⅨ ?щ엺???꾩???諛쏆븘 ????苑껋쓣 ?쇱슱 ???덉뼱?? ?쇱옄 ?섎뱾 ?뚮뒗 二쇱? ?놁씠 ?먯쓣 ?대??몄슂. ?꾩???諛쏅뒗 寃껋? ?쏀븿???꾨땲??吏?쒕줈??댁뿉?? ?묐젰?????뱀떊??吏꾧?媛 諛쒗쐶?⑸땲??",
      reality: `硫섑깉 肄붿뼱 諛?? ${score}?? ?묐젰??援ъ“. ?몃? 吏?????쒕꼫吏 洹밸??? ??뚰겕 ?섍꼍?먯꽌 ?깃낵 利앺룺. 硫섑넗留?諛??ㅽ듃?뚰궧 ?쒖슜 沅뚯옣. 議곗쭅 ???묒뾽 ?λ젰 ?곗닔.`,
      fun: "?쇱옄 ?섎뱾 ???꾩? 諛쏆븘! 遺?꾨윭?뚰븯吏 留? 洹멸쾶 ???꾨챸??嫄곗빞! ????섑븯?뽰븘? 洹멸쾶 ???μ젏?댁빞! ?쇱옄 ?숇걲?吏 留먭퀬 媛숈씠??",
      recommendation: "??뚰겕媛 以묒슂???쇱씠 ??留욎븘?? ?湲곗뾽, 怨듬Т?? 議곗쭅 ?앺솢?먯꽌 ?λ젰 諛쒗쐶. 醫뗭? 硫섑넗瑜?留뚮굹硫????깃났 媛?? ?몃㎘?????쒖슜?섏꽭??",
    },
    以묓솕: {
      empathy: "洹좏삎 ?≫엺 ?대㈃??媛議뚯뼱?? ?꾩슂???곕씪 媛뺥븯湲곕룄, 遺?쒕읇湲곕룄 ???щ엺?낅땲?? ?곹솴??留욊쾶 ?좎뿰?섍쾶 ??묓븷 ???덈뒗 ?λ젰???뱀떊??媛?????μ젏?댁뿉?? ?대뼡 ?섍꼍?먯꽌???곸쓳?????덉뼱??",
      reality: `硫섑깉 肄붿뼱 諛?? ${score}?? 洹좏삎?? ?곹솴 ??묐젰 ?곗닔. ?낅┰/?묐젰 紐⑤몢 媛?ν븳 硫??紐⑤뱶. ?섍꼍 ?곸쓳??理쒖긽?? ?ㅼ뼇??遺꾩빞?먯꽌 ?덉젙???깃낵 ?덉긽.`,
      fun: "??諛몃윴?ㅺ? 醫뗭븘! ?쇱옄???섍퀬 媛숈씠???섑빐! ?꾩쟾 留뚮뒫罹? ?곹솴 遊먯꽌 ?뚯븘???섑븯??寃????щ뒫?댁빞!",
      recommendation: "?ㅼ뼇??遺꾩빞?먯꽌 ?쒖빟 媛?? ?곹솴??留욊쾶 ?낅┰/?묐젰???좏깮?????덉뼱?? ??꼻? 寃쏀뿕???볦쑝硫??????깃났 媛??",
    },
  };

  return {
    type,
    score,
    empathy: descriptions[type].empathy,
    reality: descriptions[type].reality,
    fun: descriptions[type].fun,
    recommendation: descriptions[type].recommendation,
  };
}


----- FILE: frontend\data\talentAnalysis.ts -----
// frontend/data/talentAnalysis.ts

export const TALENT_ANALYSIS = {
  empathy: {
    title: "?뱀떊??諛섎뱶???깃났???섎컰???녿뒗 泥쒖옱???щ뒫",
    icon: "?럞",
  },
  reality: {
    title: "?ы쉶???깆랬瑜??꾪븳 理쒖쟻???섎뱶?⑥뼱? ?щ뒫 ?ㅼ틪",
    icon: "?뮳",
  },
  fun: {
    title: "?ㅺ? ?댁쭞 ???섍퀬 '?닿쾬'留??뚮㈃ ?깃났?섎뒗 ?댁쑀",
    icon: "?뵦",
  },
};

export const TALENT_BY_TEN_GOD: Record<string, {
  field: string;
  empathy: string;
  reality: string;
  fun: string;
}> = {
  "?앹떊": {
    field: "李쎌옉/?덉닠/?쒗쁽",
    empathy: "?덉닠???щ뒫??鍮쏅굹???뱀떊. ?쒗쁽?섎뒗 ?쇱뿉???됰났??李얠쓣 嫄곗삁?? 湲???곌굅??洹몃┝??洹몃━嫄곕굹 ?몃옒瑜?遺瑜대뒗 ?? 臾댁뾿?대뱺 李쎌옉?섎뒗 ?쒓컙 ?뱀떊? 媛??鍮쏅굹??",
    reality: "李쎌쓽??吏??92%. 肄섑뀗痢??쒖옉, ?붿옄?? ?덉닠 遺꾩빞 ?곹빀??理쒖긽?? ?щ━?먯씠?곕툕 吏곴뎔?먯꽌 ?곸쐞 10% ?깃낵 ?덉긽. ?쒗쁽???쒖슜 ??寃쎌웳??洹밸???",
    fun: "?ㅺ? 留뚮뱺 嫄?蹂대㈃ ?щ엺?ㅼ씠 媛먰깂?? 李쎌옉?섎뒗 ???대씪, 吏꾩쭨! ?좏뒠踰? ?묎?, ?붿옄?대꼫 萸먮뱺 ?ㅺ? 留뚮뱶??嫄??섎㈃ ?諛??쒕떎?덇퉴?",
  },
  "?곴?": {
    field: "?곸떊/鍮꾪뙋/媛쒗쁺",
    empathy: "?낆갹?곸씤 ?쒓컖?쇰줈 ?몄긽??諛붽? ???덈뒗 ?щ엺?댁뿉?? 湲곗〈?????源④퀬 ?덈줈??寃껋쓣 留뚮뱾?대궡???뱀떊???λ젰? ?뺣쭚 ?밸퀎?댁슂. ?먮젮?뚰븯吏 留먭퀬 ?뱀떊留뚯쓽 湲몄쓣 媛?몄슂.",
    reality: "?곸떊??吏??95%. 湲곗〈 ???源⑤뒗 蹂??二쇰룄 ??븷??理쒖쟻?? ?ㅽ??몄뾽, R&D, 而⑥꽕??遺꾩빞 怨좎꽦怨??덉긽. 鍮꾪뙋???ш퀬?μ쑝濡?臾몄젣 ?닿껐 ?λ젰 ?곸썡.",
    fun: "???⑤뱾?대옉 ?ㅻⅨ 湲?媛???? ?됰쾾??嫄????ㅽ????꾨땲?뽰븘? 湲곗〈 諛⑹떇 臾댁떆?섍퀬 ??諛⑹떇?濡??? 洹멸쾶 ??臾닿린??",
  },
  "?뺤옱": {
    field: "?щТ/愿由??덉젙",
    empathy: "袁몄????볦븘媛???λ젰???곗뼱?섏슂. ?덉젙?곸씤 ?깃났???대０ 嫄곗삁?? 湲됲븯寃??쒕몢瑜댁? ?딆븘??愿쒖갖?꾩슂. ?뱀떊???띾룄濡?李④렐李④렐 ?볦븘媛??蹂대㈃ ?대뒓?????깃낵瑜??대（怨??덉쓣 嫄곗삁??",
    reality: "?щТ 愿由??λ젰 89%. 怨꾪쉷???먯궛 利앹떇 諛??덉젙???섏씡 李쎌텧 ?곗닔. ?뚭퀎, ?щТ, ?먯궛愿由?遺꾩빞 ?곹빀. 由ъ뒪??愿由??λ젰 ?곸썡. ?κ린 ?ъ옄 ?꾨왂 理쒖쟻??",
    fun: "????愿由??섑븯吏? 洹몃깷 ?ы뀒?щ굹 寃쎌쁺 履??섎㈃ ?諛????? 異⑸룞援щℓ ???섍퀬 怨꾪쉷?곸쑝濡?紐⑥쑝??嫄????μ젏?댁빞!",
  },
  "?몄옱": {
    field: "?ъ뾽/?곸뾽/?쒕룞",
    empathy: "?쒕컻?섍쾶 ?吏곸씠硫??덉쓣 踰????덈뒗 ?щ뒫???덉뼱?? ?щ엺??留뚮굹怨?愿怨꾨? 留븍뒗 ?쇱뿉??湲고쉶瑜?李얠쓣 ???덉뼱?? ?뱀떊???ш탳?깆씠 媛?????먯궛?댁뿉??",
    reality: "?ъ뾽 異붿쭊??吏??91%. ?곸뾽, ?몄씪利? ?좏넻 遺꾩빞 怨좎꽦怨??덉긽. ?ㅽ듃?뚰궧 ?λ젰?쇰줈 湲고쉶 李쎌텧 ?곸썡. ?ㅼ뼇???섏씡???뺣낫 ?λ젰 ?곗닔.",
    fun: "媛留뚰엳 ?됱븘???쇳븯??嫄??듬떟?섏?? 諛뽰뿉 ?섍????곕㈃ ??踰뚯뼱! ?곸뾽?대굹 ?μ궗 ?? ?щ엺 留뚮굹??寃????щ뒫?댁빞!",
  },
  "?뺢?": {
    field: "怨듬Т/議곗쭅/愿由?,
    empathy: "?ы쉶??梨낆엫???ㅽ븯???뱀떊. 議곗쭅?먯꽌 ?몄젙諛쏆쓣 嫄곗삁?? ?먯튃??吏?ㅺ퀬 梨낆엫媛??덇쾶 ?됰룞?섎뒗 ?뱀떊??紐⑥뒿? 留롮? ?щ엺?ㅼ뿉寃?洹媛먯씠 ?쇱슂.",
    reality: "議곗쭅 ?곸쓳??93%. 怨듦났 遺臾? ?湲곗뾽 愿由ъ쭅 ?곹빀??理쒖긽?? 泥닿퀎???낅Т 泥섎━ ?λ젰 ?곗닔. ?뱀쭊 媛?μ꽦 ?믪쓬. ?덉젙??而ㅻ━???⑥뒪 ?덉긽.",
    fun: "??洹쒖튃 吏?ㅺ퀬 梨낆엫吏??嫄??섑븯?뽰븘? 怨듬Т?먯씠???湲곗뾽 媛?? 議곗쭅?앺솢 ??留욎븘! ?뱀쭊??鍮좊? ??",
  },
  "?멸?": {
    field: "由щ뜑??沅뚮젰/?듭넄",
    empathy: "移대━?ㅻ쭏濡??щ엺?ㅼ쓣 ?대걚???怨좊궃 由щ뜑?덉슂. 梨낆엫??臾닿굅???뚮룄 ?덇쿋吏留? ?뱀떊? 洹멸쾬??媛먮떦?????덈뒗 ?섏쓣 媛議뚯뼱?? ?먯떊媛먯쓣 媛吏怨??욎옣?쒖꽭??",
    reality: "由щ뜑??吏??96%. 寃쎌쁺吏? CEO, 愿由ъ옄 ?ъ???理쒖쟻?? ?섏궗寃곗젙 ?λ젰 諛??꾧린愿由??λ젰 ?곸썡. 議곗쭅 ?μ븙???곗닔. ?꾩썝湲??뱀쭊 媛?μ꽦 ?믪쓬.",
    fun: "???꾩뿉 ?쒖빞 ?? 諛묒뿉???쒗궎??嫄?紐?李몄옏?? 蹂댁뒪媛 ?섎씪怨? CEO ?섎뱺 ?ъ옣 ?섎뱺 ?ㅺ? 寃곗젙沅뚯옄媛 ?쇱빞 ??",
  },
  "?뺤씤": {
    field: "援먯쑁/?곌뎄/?숇Ц",
    empathy: "諛곗슦怨?媛瑜댁튂???쇱뿉??蹂대엺???먮굜 嫄곗삁?? 吏?앹쓣 ?섎늻??寃껋씠 ?뱀떊??湲곗겏?댁뿉?? ?숈깮?ㅼ씠???꾨같?ㅼ뿉寃?醫뗭? 硫섑넗媛 ?????덉뼱??",
    reality: "?숈뒿 ?λ젰 94%. 援먯쑁, ?곌뎄, ?숈닠 遺꾩빞 ?꾨Ц??援ъ텞 理쒖긽?? ?됱깮?숈뒿 ??웾 ?곗닔. 援먯닔, ?곌뎄?? 媛뺤궗 ?곹빀. ?꾨Ц媛濡쒖꽌??沅뚯쐞 ?뺣┰ 媛??",
    fun: "??怨듬?媛 ?щ컡????? ?좎깮?섏씠??援먯닔 ?섎㈃ ?깆씠寃좊떎! 媛瑜댁튂??嫄?醫뗭븘?섏옏?? 洹멸굅 吏곸뾽?쇰줈 ??",
  },
  "?몄씤": {
    field: "泥좏븰/?뺤떊/李쎌옉",
    empathy: "源딆? ?ъ깋?쇰줈 ?몄긽??吏꾨━瑜?李얜뒗 ?щ엺?댁뿉?? ?⑤뱾怨??ㅻⅨ 湲몄쓣 媛?붾씪??愿쒖갖?꾩슂. ?뱀떊留뚯쓽 ?낇듅???쒓컖???몄긽???꾩슂???듭같??以?嫄곗삁??",
    reality: "?듭같??吏??90%. 泥좏븰, ?щ━, ?뺤떊 遺꾩빞 ?꾨Ц???곗닔. ?낆갹???ш퀬濡??덈줈???대줎 媛쒕컻 媛?? ?곌뎄 諛?吏묓븘 ?쒕룞 ?곹빀. ?ъ긽媛濡쒖꽌??媛?μ꽦.",
    fun: "??醫 ?낇듅??嫄?醫뗭븘?섏?? 泥좏븰?대굹 ?щ━ 履??뚮㈃ ?щ컡???? ?⑤뱾 ??媛??湲?媛??寃????ㅽ??쇱씠?뽰븘!",
  },
  "鍮꾧껄": {
    field: "?낅┰/?먯쁺/?꾨━?쒖꽌",
    empathy: "?쇱옄?쒕룄 ???대궡???낅┰?곸씤 ?λ젰???덉뼱?? ?꾧뎔媛??吏?쒕? 諛쏄린蹂대떎 ?ㅼ뒪濡?寃곗젙?섍퀬 ?ㅽ뻾?섎뒗 寃껋씠 ?뱀떊?먭쾶 留욎븘?? ?낅┰?댁꽌 ?뱀떊留뚯쓽 湲몄쓣 媛蹂댁꽭??",
    reality: "?먮┰??吏??88%. 1??湲곗뾽, ?꾨━?쒖꽌, ?낅┰ ?ъ뾽 ?곹빀???곗닔. ?먭린二쇰룄???낅Т 泥섎━ ?λ젰 ?곸썡. 議곗쭅 ?섏〈????쓬. ?낅┰??而ㅻ━??援ъ텞 理쒖쟻.",
    fun: "????諛묒뿉???쇳븯??嫄?紐?李몄옏?? ?낅┰?댁꽌 ???ъ뾽 ?? ?꾨━?쒖꽌??1???ъ뾽?대뱺 ?쇱옄 ?섎뒗 寃??듭씠??",
  },
  "寃곸옱": {
    field: "寃쎌웳/?꾩쟾/?밸?",
    empathy: "寃쎌웳 ?띿뿉??鍮쏅굹???뱀떊. ?꾩쟾??利먭굅???щ엺?댁뿉?? ?밸??뺤씠 ?뱀떊?????믪? 怨녹쑝濡??대걣 嫄곗삁?? ?먮젮?뚰븯吏 留먭퀬 寃쎌웳???곗뼱?쒖꽭??",
    reality: "寃쎌웳??吏??93%. ?ㅽ룷痢? ?곸뾽, 寃쎌웳 遺꾩빞 ?깃낵 理쒖긽?? ?밸??뺤쓣 ?쒖슜??紐⑺몴 ?ъ꽦 ?λ젰 ?곸썡. ?몄꽱?곕툕 湲곕컲 吏곸쥌 怨좎닔???덉긽.",
    fun: "??寃쎌웳???щ컡吏? ?밸???諛쒗쐶?섎뒗 ???섎㈃ 臾댁“嫄??닿릿?? ?곸뾽?대굹 ?ㅽ룷痢?履??? 1???섎뒗 寃???紐⑺몴?뽰븘!",
  },
};


----- FILE: frontend\data\todayAnalysis.ts -----
// frontend/data/todayAnalysis.ts

export const TODAY_ANALYSIS = {
  empathy: {
    title: "湲곕텇 醫뗭? ?덇컧! ?ㅻ뒛 ?뱀떊????궎 ?ъ씤??,
    icon: "??,
  },
  reality: {
    title: "湲덉씪 ?됱슫 ?뺣쪧 蹂닿퀬??諛?由ъ뒪??愿由?媛?대뱶",
    icon: "?뱤",
  },
  fun: {
    title: "湲곕텇 醫뗭?? ???먯뀡 洹몃?濡??ㅻ뒛 ?섎（ 李?뼱踰꾨젮!",
    icon: "?뵦",
  },
};

// ?ㅻ뒛???댁꽭 ?앹꽦 ?⑥닔
export function analyzeTodayFortune(
  strongElement: string,
  characterType: "empathy" | "reality" | "fun"
): {
  luckyColor: string;
  luckyNumber: number;
  luckyDirection: string;
  advice: string;
} {
  // ?ㅽ뻾蹂??됱긽
  const colors: Record<string, string> = {
    wood: "珥덈줉??,
    fire: "鍮④컙??,
    earth: "?몃???,
    metal: "?곗깋",
    water: "?뚮???,
  };

  // ?ㅽ뻾蹂?諛⑺뼢
  const directions: Record<string, string> = {
    wood: "?숈そ",
    fire: "?⑥そ",
    earth: "以묒븰",
    metal: "?쒖そ",
    water: "遺곸そ",
  };

  // 罹먮┃?곕퀎 議곗뼵
  const advices = {
    empathy: [
      "?ㅻ뒛? ?뚯쨷???щ엺?먭쾶 ?곕쑜??留??쒕쭏??嫄대꽕蹂댁꽭?? ?묒? 移쒖젅?????됱슫??遺덈윭??嫄곗삁??",
      "?묒? ?좊Ъ?????됱슫??遺덈윭??嫄곗삁?? ?щ옉?섎뒗 ?щ엺?먭쾶 留덉쓬???꾪빐蹂댁꽭??",
      "誘몄냼 吏볥뒗 ?쒓컙留덈떎 蹂듭씠 ?ㅼ뼱?듬땲?? ?ㅻ뒛? ?뱁엳 諛앷쾶 ?껋뼱蹂댁꽭??",
      "媛먯궗??留덉쓬???쒗쁽?섎뒗 ?좎씠?먯슂. 怨좊쭏???щ엺?먭쾶 ?곕씫??蹂댁꽭??",
      "?먯떊?먭쾶 ?묒? ?좊Ъ???대낫?몄슂. ?섎? ?щ옉?섎뒗 寃껋씠 ?됱슫???쒖옉?댁뿉??",
      "?ㅻ뒛? ?덈줈???쒖옉???꾪븳 ?꾨꼍???좎씠?먯슂. ?⑷린瑜??대낫?몄슂.",
      "吏곴???誘우쑝?몄슂. ?ㅻ뒛 ?뱀떊??媛먯씠 ?뱁엳 ?뺥솗??嫄곗삁??",
      "?먯뿰 ?띿뿉???먮쭅?섎뒗 ?쒓컙??媛?몃낫?몄슂. ?먮꼫吏媛 異⑹쟾??嫄곗삁??",
    ],
    reality: [
      "?ㅼ쟾 10??12?? 以묒슂??寃곗젙??理쒖쟻?붾맂 ?쒓컙??낅땲?? ???쒓컙???듭떖 ?낅Т瑜?泥섎━?섏꽭??",
      "?곗씠??湲곕컲 ?섏궗寃곗젙 ???깃났 ?뺣쪧 ?곸듅. 媛먯씠 ?꾨땶 ?ъ떎??洹쇨굅???먮떒?섏꽭??",
      "?ㅻ뒛???⑥쑉??吏?? ?곸쐞 20%. 吏묒쨷?μ씠 ?믪? ?좎엯?덈떎. 以묒슂???쇱쓣 ?곗꽑 泥섎━?섏꽭??",
      "?ㅽ듃?뚰궧 ?쒕룞 沅뚯옣. ?ㅻ뒛 留뚮굹???щ엺??以묒슂??湲고쉶瑜?媛?몄삱 ???덉뒿?덈떎.",
      "由ъ뒪??愿由?紐⑤뱶 ?쒖꽦?? ?좎쨷???먮떒???꾩슂???좎엯?덈떎.",
      "?숈뒿 ?⑥쑉 理쒕?移? ?덈줈??吏?앹쓣 ?듬뱷?섍린 醫뗭? ?좎엯?덈떎.",
      "?щТ 愿由??먭??? 吏異??댁뿭???뺤씤?섍퀬 怨꾪쉷???ъ젏寃?섏꽭??",
      "嫄닿컯 愿由??곗꽑. 異⑸텇???댁떇怨??곸뼇 ??랬媛 ?꾩슂?⑸땲??",
    ],
    fun: [
      "?ㅻ뒛 ?꾩쟾 ?諛?媛? ?섍퀬 ?띠? 嫄????? ?ㅻ뒛留뚰겮? ??留덉쓬?濡??댁븘!",
      "吏湲???湲곕텇 洹몃?濡?諛?대텤?? ?깃났?쒕떎! 留앹꽕?댁? 留?",
      "?ㅻ뒛 ??二쇱씤怨듭씠?? 湲곕텇 醫뗪쾶 ?섎（ 李?뼱! ???섎맆 嫄곗빞!",
      "怨좊??섏? 留? ?ㅻ뒛? ??吏곴컧 誘욧퀬 媛! 100% 留욎븘!",
      "?ㅻ뒛 ?꾧? 萸먮옒?????섍퀬 ?띠? ?濡??? ?꾪쉶 ?녾쾶!",
      "?먯뀡 ?좎??? ??湲곕텇 洹몃?濡?諛ㅺ퉴吏 媛硫??諛???",
      "?ㅻ뒛 留뚮굹???щ엺???됱슫???댁뇿?? ?곴레?곸쑝濡??섏꽌!",
      "留앹꽕?댁? 留먭퀬 ?쇰떒 吏덈윭! ?ㅻ뒛? ???섎뤌!",
    ],
  };

  // ?쒕뜡 ??궎 ?섎쾭 (1~100)
  const luckyNumber = Math.floor(Math.random() * 100) + 1;

  // ?쒕뜡 議곗뼵 ?좏깮
  const randomAdvice = advices[characterType][Math.floor(Math.random() * advices[characterType].length)];

  return {
    luckyColor: colors[strongElement] || "?몃???,
    luckyNumber,
    luckyDirection: directions[strongElement] || "?⑥そ",
    advice: randomAdvice,
  };
}

----- FILE: frontend\analysis\engine.ts -----
// frontend/analysis/engine.ts

import type { PillarBlock } from "../types/saju"; // ?놁쑝硫??꾨옒??諛붾줈 ????뺤쓽濡??泥댄븷 嫄곗엫
import { analyzeFullFortune, GreatFortuneData, YearFortuneData } from "../data/fortuneAnalysis";
import { CHARM_BY_PILLAR } from "../data/charmAnalysis";
import { analyzeStrength } from "../data/strengthAnalysis";
import { analyzeRelations } from "../data/relationsAnalysis";
import { analyzeSpecialStars } from "../data/specialStarsAnalysis";
import { analyzeTodayFortune } from "../data/todayAnalysis";
import { TALENT_BY_TEN_GOD } from "../data/talentAnalysis";

type CharKey = "empathy" | "reality" | "fun";

// page.tsx?먯꽌 ?곕뜕 寃껉낵 ?숈씪???쒓렇?덉쿂瑜?engine?쇰줈 ?섍린湲??꾪빐 ????뺤쓽
type Pillar = { hanja: string; hangul: string };
// ?좑툘 ??page.tsx???덈뒗 PillarBlock ??낆씠??留욎떠????
export type EnginePillarBlock = { label: string; cheongan: Pillar; jiji: Pillar };

export type EngineInput = {
  birthYmd: string;          // "YYYYMMDD"
  gender: "M" | "F";
  selectedChar: CharKey;
  result: {
    year: EnginePillarBlock;
    month: EnginePillarBlock;
    day: EnginePillarBlock;
    hour: EnginePillarBlock;
  };
  tenGod: (dayStem: string, targetStem: string) => string;
  hanjaToElement: (h: string) => "wood" | "fire" | "earth" | "metal" | "water" | "none";
};

export type EngineOutput = {
  fortuneAnalysis: {
    greatFortune: {
      current: GreatFortuneData;
      next: GreatFortuneData;
      direction: "?쒗뻾" | "??뻾";
    };
    yearFortune: {
      current: YearFortuneData;
      next: YearFortuneData;
    };
  } | null;

  charmAnalysis: string | null;
  talentAnalysis: string | null;

  strengthAnalysis: any;
  relationsAnalysis: any;
  specialStarsAnalysis: any;
  todayFortune: any;
};

// birthYmd?먯꽌 ????戮묎린 (page.tsx parseYmd ?泥?理쒖냼 踰꾩쟾)
function parseBirthYmd(birthYmd: string) {
  const s = birthYmd.replace(/\D/g, "");
  if (s.length !== 8) return null;
  const y = Number(s.slice(0, 4));
  const m = Number(s.slice(4, 6));
  const d = Number(s.slice(6, 8));
  if (y < 1900 || y > 2100) return null;
  if (m < 1 || m > 12) return null;
  if (d < 1 || d > 31) return null;
  return { year: y, month: m, day: d };
}

export function buildAnalysis(input: EngineInput): EngineOutput {
  const { birthYmd, gender, selectedChar, result, tenGod, hanjaToElement } = input;

  const parsed = parseBirthYmd(birthYmd);
  if (!parsed) {
    return {
      fortuneAnalysis: null,
      charmAnalysis: null,
      talentAnalysis: null,
      strengthAnalysis: null,
      relationsAnalysis: null,
      specialStarsAnalysis: null,
      todayFortune: null,
    };
  }

  const birthYear = parsed.year;
  const currentYear = new Date().getFullYear();
  const currentAge = currentYear - birthYear + 1;

  const monthPillar = result.month.cheongan.hanja + result.month.jiji.hanja;
  const dayStem = result.day.cheongan.hanja;

  const originalPillars = {
    year: result.year.cheongan.hanja + result.year.jiji.hanja,
    month: monthPillar,
    day: result.day.cheongan.hanja + result.day.jiji.hanja,
    hour: result.hour.cheongan.hanja + result.hour.jiji.hanja,
  };

  // TODO: ??湲곗〈 濡쒖쭅?먯꽌 daeunNum, sinGangScore瑜??대뼸寃?援ы븯?붿? ?섏쨷???곌껐
  const daeunNum = 5;
  const sinGangScore = 50;

  // 1) ????몄슫
  let fortuneAnalysis: EngineOutput["fortuneAnalysis"] = null;
  try {
    fortuneAnalysis = analyzeFullFortune(
      birthYear,
      gender,
      monthPillar,
      daeunNum,
      currentAge,
      currentYear,
      dayStem,
      originalPillars,
      sinGangScore
    );
  } catch {
    fortuneAnalysis = null;
  }

  // 2) 留ㅻ젰 (?쇱＜ 湲곗?)
  const dayPillar = result.day.cheongan.hanja + result.day.jiji.hanja;
  const charmText = CHARM_BY_PILLAR[dayPillar];
  const charmAnalysis = charmText ? charmText[selectedChar] : null;

  // 3) ?щ뒫 (?쇨컙 湲곗? ??꽦)
  const dayStemTenGod = tenGod(dayStem, dayStem);
  const talentText = TALENT_BY_TEN_GOD[dayStemTenGod];
  const talentAnalysis = talentText ? talentText[selectedChar] : null;

  // 4) ?좉컯??
  const strengthAnalysis = analyzeStrength(
    dayStem,
    result.month.jiji.hanja,
    [result.year, result.month, result.day, result.hour],
    tenGod
  );

  // 5) 愿怨??⑹땐)
  const relationsAnalysis = analyzeRelations(
    [
      result.year.cheongan.hanja,
      result.month.cheongan.hanja,
      result.day.cheongan.hanja,
      result.hour.cheongan.hanja,
    ],
    [
      result.year.jiji.hanja,
      result.month.jiji.hanja,
      result.day.jiji.hanja,
      result.hour.jiji.hanja,
    ]
  );

  // 6) ?뱀닔?좎궡
  const specialStarsAnalysis = analyzeSpecialStars(
    result.day.jiji.hanja,
    result.year.jiji.hanja,
    result.month.jiji.hanja,
    result.hour.jiji.hanja
  );

  // 7) ?ㅻ뒛???쇨컙 ?ㅽ뻾 湲곗?)
  const todayFortune = analyzeTodayFortune(hanjaToElement(dayStem), selectedChar);

  return {
    fortuneAnalysis,
    charmAnalysis,
    talentAnalysis,
    strengthAnalysis,
    relationsAnalysis,
    specialStarsAnalysis,
    todayFortune,
  };
}


----- FILE: backend\main.py -----
from datetime import datetime
from pathlib import Path
from typing import Optional
from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel, Field
import os
from dotenv import load_dotenv
import openai

from logic import test
from logic import lunar_converter

# .env ?뚯씪 寃쎈줈 紐낆떆
env_path = Path(__file__).resolve().parent / ".env"
load_dotenv(dotenv_path=env_path)

# ?붾쾭源낆슜
api_key = os.getenv("OPENAI_API_KEY")
if api_key:
    print(f"?뵎 API Key 濡쒕뱶?? {api_key[:10]}...")
    client = openai.OpenAI(api_key=api_key)
else:
    print("?좑툘  OPENAI_API_KEY ?놁쓬")
    client = None

app = FastAPI(title="Saju API", version="0.1.0")

# CORS ?ㅼ젙
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# DB 濡쒕뱶
DB_PATH = Path(__file__).resolve().parent / "logic" / "solar_terms_db.json"
DB = test.load_db(str(DB_PATH))
if DB is None:
    raise RuntimeError(f"solar_terms_db.json 濡쒕뱶 ?ㅽ뙣: {DB_PATH}")


# ==================== 紐⑤뜽 ?뺤쓽 ====================

class SajuRequest(BaseModel):
    calendar_type: str = Field(default="solar", description="solar ?먮뒗 lunar")
    year: int
    month: int
    day: int
    hour: int = Field(ge=0, le=23)
    minute: int = Field(ge=0, le=59)
    gender: str = Field(description="M ?먮뒗 F")
    is_leap_month: bool = Field(
        default=False, description="calendar_type??lunar???뚮쭔 ?섎? ?덉쓬")


class PillarsResponse(BaseModel):
    input_datetime: str
    solar_datetime_used: str
    year_pillar: str
    month_pillar: str
    day_pillar: str
    hour_pillar: str


class FullResponse(PillarsResponse):
    daeun_start_age: int
    daeun_direction: str
    daeun_list: list


class InterpretRequest(BaseModel):
    day_stem: str
    year_pillar: str
    month_pillar: str
    day_pillar: str
    hour_pillar: str
    tone: str = "empathy"


class GPTInterpretRequest(BaseModel):
    """GPT ?댁꽍 ?붿껌 紐⑤뜽"""
    day_stem: str
    year_pillar: str
    month_pillar: str
    day_pillar: str
    hour_pillar: str
    tone: str = "empathy"
    year: Optional[int] = None
    month: Optional[int] = None
    day: Optional[int] = None
    hour: Optional[int] = None
    minute: Optional[int] = None
    gender: Optional[str] = None


# ==================== ?ы띁 ?⑥닔 ====================

def _parse_gender(g: str) -> str:
    g = (g or "").strip().upper()
    if g not in ("M", "F"):
        raise ValueError("gender??M ?먮뒗 F")
    return g


def _to_datetime(req: SajuRequest) -> tuple:
    gender = _parse_gender(req.gender)

    if req.calendar_type not in ("solar", "lunar"):
        raise ValueError("calendar_type? solar ?먮뒗 lunar")

    if req.calendar_type == "solar":
        solar_dt = datetime(req.year, req.month, req.day, req.hour, req.minute)
        return solar_dt, solar_dt

    solar_y, solar_m, solar_d = lunar_converter.convert_lunar_to_solar(
        req.year, req.month, req.day, req.is_leap_month
    )
    solar_dt = datetime(solar_y, solar_m, solar_d, req.hour, req.minute)
    return solar_dt, solar_dt


def calculate_element_counts(pillars: dict) -> dict:
    """?ㅽ뻾 移댁슫??怨꾩궛"""
    element_map = {
        "??: "wood", "阿?: "wood",
        "訝?: "fire", "訝?: "fire",
        "??: "earth", "藥?: "earth",
        "佯?: "metal", "渦?: "metal",
        "鶯?: "water", "??: "water",
        "野?: "wood", "??: "wood",
        "藥?: "fire", "??: "fire",
        "渦?: "earth", "??: "earth", "訝?: "earth", "??: "earth",
        "??: "metal", "??: "metal",
        "耶?: "water", "雅?: "water",
    }

    counts = {"wood": 0, "fire": 0, "earth": 0, "metal": 0, "water": 0}

    for pillar in pillars.values():
        for char in pillar:
            element = element_map.get(char)
            if element:
                counts[element] += 1

    return counts


def get_title_by_tone(tone: str) -> str:
    """?ㅼ뿉 ?곕Ⅸ ?쒕ぉ 諛섑솚"""
    titles = {
        "empathy": "?뱀떊???ㅽ뻾 ?먮꼫吏",
        "reality": "?ㅽ뻾 遺꾪룷 遺꾩꽍",
        "fun": "???ㅽ뻾 諛몃윴???대븣?"
    }
    return titles.get(tone, "?ㅽ뻾 遺꾩꽍")


def format_ten_gods(ten_gods: dict) -> str:
    """??꽦 ?щ㎎??""
    lines = []
    for god, count in ten_gods.items():
        if count > 0:
            lines.append(f"- {god}: {count}媛?)
    return "\n".join(lines) if lines else "?놁쓬"


def split_pillar(pillar: str) -> tuple:
    """湲곕뫁??泥쒓컙/吏吏濡?遺꾨━"""
    if len(pillar) >= 2:
        return pillar[0], pillar[1]
    return '', ''


# ==================== ?붾뱶?ъ씤??====================

@app.get("/health")
def health():
    return {"ok": True}


@app.post("/saju/full")
async def get_full_saju(req: SajuRequest):
    """???꾩껜 ?ъ＜ 遺꾩꽍 (?꾨줎?몄뿏?쒖뿉???ъ슜)"""
    try:
        birth_dt, solar_dt_used = _to_datetime(req)

        yj = test.calculate_year_pillar(solar_dt_used, DB)
        mj = test.calculate_month_pillar(solar_dt_used, yj, DB)
        dj = test.calculate_day_pillar(solar_dt_used)
        sj = test.calculate_hour_pillar(solar_dt_used, dj)

        return {
            "input_datetime": f"{req.year}-{req.month:02d}-{req.day:02d} {req.hour:02d}:{req.minute:02d}",
            "solar_datetime_used": solar_dt_used.strftime("%Y-%m-%d %H:%M"),
            "year_pillar": yj,
            "month_pillar": mj,
            "day_pillar": dj,
            "hour_pillar": sj,
        }
    except Exception as e:
        print(f"??/saju/full ?먮윭: {e}")
        import traceback
        traceback.print_exc()
        raise HTTPException(status_code=400, detail=str(e))


@app.post("/saju/pillars", response_model=PillarsResponse)
def saju_pillars(req: SajuRequest):
    try:
        gender = _parse_gender(req.gender)
        birth_dt, solar_dt_used = _to_datetime(req)

        yj = test.calculate_year_pillar(
            solar_dt_used.year, solar_dt_used.month, solar_dt_used.day, DB)
        mj = test.calculate_month_pillar(
            solar_dt_used.year, solar_dt_used.month, solar_dt_used.day, DB)
        dj = test.calculate_day_pillar(
            solar_dt_used.year, solar_dt_used.month, solar_dt_used.day)
        sj = test.calculate_hour_pillar(dj[0], solar_dt_used.hour)

        return {
            "input_datetime": f"{req.year:04d}-{req.month:02d}-{req.day:02d} {req.hour:02d}:{req.minute:02d}",
            "solar_datetime_used": solar_dt_used.strftime("%Y-%m-%d %H:%M"),
            "year_pillar": yj,
            "month_pillar": mj,
            "day_pillar": dj,
            "hour_pillar": sj,
        }
    except Exception as e:
        raise HTTPException(status_code=400, detail=str(e))


@app.post("/saju/interpret-test")
async def test_new_engine(req: InterpretRequest):
    """???댁꽍 ?붿쭊 (GPT + ?대줎 DB)"""
    try:
        from logic.saju_engine.core.analyzer import analyze_full_saju

        pillars = {
            'year': req.year_pillar,
            'month': req.month_pillar,
            'day': req.day_pillar,
            'hour': req.hour_pillar
        }

        analysis = analyze_full_saju(req.day_stem, pillars)

        try:
            from logic.gpt_generator import GPTInterpretationGenerator

            generator = GPTInterpretationGenerator(
                api_key=os.getenv("OPENAI_API_KEY"))
            interpretation = generator.generate_section1(
                analysis, tone=req.tone)

            return {
                "success": True,
                "analysis": {
                    "strength": analysis['summary']['strength'],
                    "score": analysis['summary']['strength_score'],
                    "patterns": analysis.get('patterns', [])
                },
                "interpretations": [interpretation]
            }

        except Exception as gpt_error:
            print(f"?좑툘 GPT ?ㅽ뙣, 湲곕낯 ?댁꽍 ?ъ슜: {gpt_error}")

            from logic.saju_engine.interpretation.generator import InterpretationGenerator
            fallback_gen = InterpretationGenerator()
            interpretations = fallback_gen.generate(analysis, tone=req.tone)

            return {
                "success": True,
                "analysis": {
                    "strength": analysis['summary']['strength'],
                    "score": analysis['summary']['strength_score'],
                    "patterns": analysis.get('patterns', [])
                },
                "interpretations": interpretations
            }

    except Exception as e:
        import traceback
        traceback.print_exc()
        return {"success": False, "error": str(e)}


@app.post("/saju/interpret-gpt")
async def interpret_with_gpt(req: GPTInterpretRequest):
    """??RAG 湲곕컲 GPT ?ㅽ뻾 ?댁꽍 (?⑺솕 ?ы븿)"""
    try:
        print(f"??GPT ?댁꽍 ?붿껌: day_stem={req.day_stem}, tone={req.tone}")

        # ??1. ?ъ＜ 遺꾩꽍 以鍮?        pillars_dict = {
            'year': req.year_pillar,
            'month': req.month_pillar,
            'day': req.day_pillar,
            'hour': req.hour_pillar
        }

        # ??2. ?댁꽍 ?붿쭊?쇰줈 ?곸꽭 遺꾩꽍
        from logic.saju_engine.core.analyzer import analyze_full_saju

        analysis = analyze_full_saju(req.day_stem, pillars_dict)

        # ??pillars ?뺣낫 蹂닿컯 (?⑺솕 怨꾩궛??
        if 'pillars' not in analysis or not analysis['pillars']:
            print("?좑툘  pillars ?놁쓬, ?앹꽦 以?..")
            analysis['pillars'] = {}

            for pos, pillar_str in pillars_dict.items():
                stem, branch = split_pillar(pillar_str)
                analysis['pillars'][pos] = {
                    'heavenly_stem': stem,
                    'earthly_branch': branch
                }

            print(f"??pillars ?앹꽦 ?꾨즺: {analysis['pillars']}")

        print(
            f"?뱤 ?좉컯?? {analysis['summary']['strength']} ({analysis['summary']['strength_score']}??")

        # ??3. ?ㅽ뻾 移댁슫??(?덉쟾?섍쾶)
        if 'element_count' in analysis['summary']:
            element_counts = analysis['summary']['element_count']
            print(f"?뱤 ?ㅽ뻾 遺꾪룷 (?붿쭊): {element_counts}")
        else:
            element_counts = calculate_element_counts(pillars_dict)
            print(f"?뱤 ?ㅽ뻾 遺꾪룷 (吏곸젒): {element_counts}")

        # ??꽦 遺꾪룷
        if 'ten_gods_count' in analysis['summary']:
            print(f"?뱤 ??꽦 遺꾪룷: {analysis['summary']['ten_gods_count']}")

        # ?⑦꽩
        if 'patterns' in analysis:
            print(f"?뱤 ?⑦꽩: {analysis.get('patterns', [])}")

        # ??4. ?대줎 寃??        theories = ""
        try:
            from logic.theory_retriever import TheoryRetriever
            retriever = TheoryRetriever()
            theories = retriever.get_relevant_theories(analysis)
            print(f"?뱴 寃?됰맂 ?대줎: {len(theories)}??)
        except Exception as e:
            print(f"?좑툘 ?대줎 寃???ㅽ뙣: {e}")

        # ??5. ?⑺솕 ?뺣낫 怨꾩궛
        from logic.gpt_generator import GPTInterpretationGenerator
        generator = GPTInterpretationGenerator()

        # ?뵦 Tuple ?명뙣?뱀쑝濡??섏젙
        transformed_counts, transformations = generator._apply_harmony_transformation(
            element_counts,
            analysis
        )

        print(f"?뵦 ?⑺솕 諛쒓껄: {len(transformations)}嫄?)
        for trans in transformations:
            print(f"   - {trans.get('name', '')}")

        # ??6. GPT ?댁꽍 ?앹꽦
        try:
            content = generator.generate_comprehensive_interpretation(
                analysis=analysis,
                tone=req.tone,
                theories=theories
            )

            print(f"??GPT ?댁꽍 ?앹꽦 ?꾨즺: {len(content)}??)

            return {
                "success": True,
                "interpretations": [{
                    "section": "elements",
                    "title": get_title_by_tone(req.tone),
                    "content": content,
                    "related_theories": ["?좉컯??, "?ㅽ뻾??떊", "?⑹땐", "?좎궡"]
                }],
                "metadata": {
                    "model": "gpt-4o",
                    "day_stem": req.day_stem,
                    "tone": req.tone,
                    "strength": analysis['summary']['strength'],
                    "strength_score": analysis['summary']['strength_score'],
                    "element_counts": element_counts,
                    "ten_gods": analysis['summary']['ten_gods_count'],
                    "patterns": analysis.get('patterns', []),
                    # ???⑺솕 ?뺣낫 異붽?
                    "harmony": {
                        "original": element_counts,
                        "transformed": transformed_counts,
                        "transformations": transformations
                    }
                }
            }

        except Exception as e:
            print(f"??GPT ?앹꽦 ?ㅽ뙣: {e}")
            import traceback
            traceback.print_exc()

            # ?대갚
            fallback_content = f"""## ?뙂 ?뱀떊???ㅽ뻾 ?먮꼫吏

**?좉컯??** {analysis['summary']['strength']} ({analysis['summary']['strength_score']}??

**?ㅽ뻾 遺꾪룷:**
- ???섎Т): {element_counts.get('wood', 0)}媛?- ??遺?: {element_counts.get('fire', 0)}媛?- ????: {element_counts.get('earth', 0)}媛?- ????: {element_counts.get('metal', 0)}媛?- 麗?臾?: {element_counts.get('water', 0)}媛?
**??꽦 遺꾪룷:**
{format_ten_gods(analysis['summary']['ten_gods_count'])}

**諛쒓껄???⑦꽩:**
{', '.join(analysis.get('patterns', [])) if analysis.get('patterns') else '?놁쓬'}

?꾩옱 GPT ?댁꽍 ?앹꽦 以?臾몄젣媛 諛쒖깮?덉뒿?덈떎. ?좎떆 ???ㅼ떆 ?쒕룄?댁＜?몄슂.
"""

            return {
                "success": True,
                "interpretations": [{
                    "section": "elements",
                    "title": get_title_by_tone(req.tone),
                    "content": fallback_content,
                    "related_theories": []
                }],
                "metadata": {
                    "model": "fallback",
                    "day_stem": req.day_stem,
                    "tone": req.tone,
                    "strength": analysis['summary']['strength'],
                    "element_counts": element_counts,
                    "harmony": {
                        "original": element_counts,
                        "transformed": transformed_counts,
                        "transformations": transformations
                    }
                }
            }

    except Exception as e:
        print(f"???꾩껜 ?ㅽ뙣: {e}")
        import traceback
        traceback.print_exc()
        return {"success": False, "error": str(e)}


if __name__ == "__main__":
    import uvicorn
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)


----- FILE: backend\logic\gpt_generator.py -----
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
GPT 湲곕컲 ?ъ＜ ?댁꽍 ?앹꽦湲?"""

import os
from typing import Dict, List, Tuple
from logic.theory_retriever import TheoryRetriever
import openai
from openai import OpenAI


class GPTInterpretationGenerator:
    """GPT 湲곕컲 ?댁꽍 ?앹꽦湲?""

    def __init__(self, api_key=None):
        """
        Args:
            api_key: OpenAI API ??(?놁쑝硫??섍꼍蹂?섏뿉??濡쒕뱶)
        """
        if api_key:
            self.client = OpenAI(api_key=api_key)
        else:
            # ?섍꼍蹂?섏뿉??濡쒕뱶
            api_key_env = os.getenv('OPENAI_API_KEY')
            if api_key_env:
                self.client = OpenAI(api_key=api_key_env)
            else:
                print("?좑툘  OpenAI API ?ㅺ? ?놁뒿?덈떎. ?대갚 紐⑤뱶濡??묐룞?⑸땲??")
                self.client = None

        self.retriever = TheoryRetriever()
        self.harmony_theories = self._load_harmony_theories()

    def _load_harmony_theories(self):
        """theories ?대뜑?먯꽌 ?⑺솕 愿???대줎 濡쒕뱶"""
        from pathlib import Path

        theories_dir = Path(__file__).parent / 'theories'

        theory_files = {
            '泥쒓컙??: '?ъ＜?대줎(泥쒓컙??.txt',
            '吏吏??: '?ъ＜?대줎(吏吏??.txt',
            '泥쒓컙?⑹땐': '?ъ＜?대줎(泥쒓컙??異?.txt',
        }

        harmony_theories = {}

        for key, filename in theory_files.items():
            file_path = theories_dir / filename
            try:
                if file_path.exists():
                    with open(file_path, 'r', encoding='utf-8') as f:
                        content = f.read().strip()
                        harmony_theories[key] = content
                        print(f"??{key} ?대줎 濡쒕뱶: {len(content)}??)
                else:
                    print(f"?좑툘  {filename} ?뚯씪 ?놁쓬")
                    harmony_theories[key] = ""
            except Exception as e:
                print(f"??{key} ?대줎 濡쒕뱶 ?ㅻ쪟: {e}")
                harmony_theories[key] = ""

        return harmony_theories

    def _stem_to_element(self, stem):
        """泥쒓컙 ???ㅽ뻾"""
        mapping = {
            '??: 'wood', '阿?: 'wood',
            '訝?: 'fire', '訝?: 'fire',
            '??: 'earth', '藥?: 'earth',
            '佯?: 'metal', '渦?: 'metal',
            '鶯?: 'water', '??: 'water',
        }
        return mapping.get(stem, 'none')

    def _branch_to_element(self, branch):
        """吏吏 ???ㅽ뻾"""
        mapping = {
            '耶?: 'water', '雅?: 'water',
            '野?: 'wood', '??: 'wood',
            '藥?: 'fire', '??: 'fire',
            '??: 'metal', '??: 'metal',
            '渦?: 'earth', '??: 'earth', '訝?: 'earth', '??: 'earth',
        }
        return mapping.get(branch, 'none')

    def _element_to_korean(self, element):
        """?곸뼱 ?ㅽ뻾紐낆쓣 ?쒓?濡?蹂??""
        mapping = {
            'wood': '??,
            'fire': '??,
            'earth': '??,
            'metal': '??,
            'water': '麗?
        }
        return mapping.get(element, element)

    def _check_transformation_condition(self, result_element: str, month_branch: str) -> bool:
        """?⑺솕 ?깅┰ 議곌굔 泥댄겕"""
        return True  # 湲곕낯?곸쑝濡??⑺솕 ?깅┰

    def _check_heavenly_harmony(self, heavenly_stems: List[str], earthly_branches: List[str]) -> List[Dict]:
        """泥쒓컙??泥댄겕 (?대? ?ъ슜??泥쒓컙? ?쒖쇅)"""
        transformations = []
        used_indices = set()

        harmony_rules = {
            ('??, '藥?): 'earth',
            ('阿?, '佯?): 'metal',
            ('訝?, '渦?): 'water',
            ('訝?, '鶯?): 'wood',
            ('??, '??): 'fire'
        }

        print(f"?뵇 泥쒓컙??泥댄겕 ?쒖옉: {heavenly_stems}")

        for i in range(len(heavenly_stems)):
            if i in used_indices:
                continue
            stem1 = heavenly_stems[i]
            if not stem1:
                continue

            for j in range(i + 1, len(heavenly_stems)):
                if j in used_indices:
                    continue
                stem2 = heavenly_stems[j]
                if not stem2:
                    continue

                for (s1, s2), result_element in harmony_rules.items():
                    if (stem1 == s1 and stem2 == s2) or (stem1 == s2 and stem2 == s1):
                        month_branch = earthly_branches[1] if len(
                            earthly_branches) > 1 else ''
                        can_transform = self._check_transformation_condition(
                            result_element, month_branch)

                        if can_transform:
                            elem1 = self._stem_to_element(stem1)
                            elem2 = self._stem_to_element(stem2)
                            result_korean = self._element_to_korean(
                                result_element)
                            position_names = ['??, '??, '??, '??]

                            transformations.append({
                                'type': '泥쒓컙??,
                                'name': f'{stem1}{stem2}??result_korean}',
                                'stems': [stem1, stem2],
                                'positions': [position_names[i], position_names[j]],
                                'original_elements': [elem1, elem2],
                                'result': result_element,
                                'theory': self.harmony_theories.get('泥쒓컙??, '')
                            })

                            used_indices.add(i)
                            used_indices.add(j)
                            print(
                                f"   ??{stem1}({position_names[i]}) + {stem2}({position_names[j]}) ??{result_korean}")
                            break

                if i in used_indices:
                    break

        print(f"   ?뱦 理쒖쥌 ?ъ슜???몃뜳?? {used_indices}")
        return transformations

    def _check_earthly_harmony(self, earthly_branches: List[str]) -> List[Dict]:
        """吏吏??泥댄겕 (?≫빀 ?곗꽑, ?쇳빀 ?꾩닚?? ?대? ?ъ슜??吏吏???쒖쇅)"""
        transformations = []
        used_indices = set()  # ?대? ?⑹뿉 ?ъ슜???몃뜳??異붿쟻

        # 吏吏?≫빀 洹쒖튃
        liuhe_rules = {
            ('耶?, '訝?): 'earth',   # ?먯텞?⑺넗
            ('野?, '雅?): 'wood',    # ?명빐?⑸ぉ
            ('??, '??): 'fire',    # 臾섏닠?⑺솕
            ('渦?, '??): 'metal',   # 吏꾩쑀?⑷툑
            ('藥?, '??): 'water',   # ?ъ떊?⑹닔
            ('??, '??): 'fire'     # ?ㅻ??⑺솕 (?쒖뼇)
        }

        # 吏吏?쇳빀 洹쒖튃
        sanhe_rules = {
            ('??, '耶?, '渦?): 'water',   # ?좎옄吏??쇳빀?섍뎅
            ('雅?, '??, '??): 'wood',    # ?대쵖誘??쇳빀紐⑷뎅
            ('野?, '??, '??): 'fire',    # ?몄삤???쇳빀?붽뎅
            ('藥?, '??, '訝?): 'metal'    # ?ъ쑀異??쇳빀湲덇뎅
        }

        position_names = ['??, '??, '??, '??]

        print(f"?뵇 吏吏??泥댄겕 ?쒖옉: {earthly_branches}")

        # 1?④퀎: ?≫빀 ?곗꽑 泥섎━ (?≫빀????媛뺣젰)
        print(f"   ?뱦 1?④퀎: ?≫빀 泥댄겕")
        for i in range(len(earthly_branches)):
            if i in used_indices:
                continue
            branch1 = earthly_branches[i]
            if not branch1:
                continue

            for j in range(i + 1, len(earthly_branches)):
                if j in used_indices:
                    continue
                branch2 = earthly_branches[j]
                if not branch2:
                    continue

                # ?뺣갑????갑??紐⑤몢 泥댄겕
                for (b1, b2), result_element in liuhe_rules.items():
                    if (branch1 == b1 and branch2 == b2) or (branch1 == b2 and branch2 == b1):
                        elem1 = self._branch_to_element(branch1)
                        elem2 = self._branch_to_element(branch2)
                        result_korean = self._element_to_korean(result_element)

                        transformations.append({
                            'type': '吏吏?≫빀',
                            'name': f'{branch1}{branch2}??result_korean}',
                            'branches': [branch1, branch2],
                            'positions': [position_names[i], position_names[j]],
                            'original_elements': [elem1, elem2],
                            'result': result_element,
                            'theory': self.harmony_theories.get('吏吏??, '')
                        })

                        used_indices.add(i)
                        used_indices.add(j)
                        print(
                            f"      ???≫빀: {branch1}({position_names[i]}) + {branch2}({position_names[j]}) ??{result_korean}")
                        break

                if i in used_indices:
                    break

        print(f"   ?뱦 ?≫빀 ???ъ슜???몃뜳?? {used_indices}")

        # 2?④퀎: ?쇳빀 泥댄겕 (?⑥? 吏吏濡쒕쭔)
        print(f"   ?뱦 2?④퀎: ?쇳빀 泥댄겕")
        for (b1, b2, b3), result_element in sanhe_rules.items():
            # ??吏吏媛 紐⑤몢 ?덈뒗吏 ?뺤씤
            indices = []
            for i, branch in enumerate(earthly_branches):
                if i not in used_indices and branch in [b1, b2, b3]:
                    indices.append(i)

            # ?뺥솗??3媛쒓? ?덇퀬, 媛곴컖 ?ㅻⅨ 吏吏?ъ빞 ??            if len(indices) == 3:
                found_branches = [earthly_branches[i] for i in indices]
                if set(found_branches) == {b1, b2, b3}:
                    result_korean = self._element_to_korean(result_element)

                    # ?먯냼 ?ㅽ뻾 異붿텧
                    original_elements = [self._branch_to_element(
                        earthly_branches[i]) for i in indices]
                    positions = [position_names[i] for i in indices]

                    transformations.append({
                        'type': '吏吏?쇳빀',
                        'name': f'{b1}{b2}{b3}?쇳빀{result_korean}援?,
                        'branches': [b1, b2, b3],
                        'positions': positions,
                        'original_elements': original_elements,
                        'result': result_element,
                        'theory': self.harmony_theories.get('吏吏??, '')
                    })

                    # ??媛?紐⑤몢 ?ъ슜?⑥쑝濡??쒖떆
                    for idx in indices:
                        used_indices.add(idx)

                    print(
                        f"      ???쇳빀: {b1}{b2}{b3}({', '.join(positions)}) ??{result_korean}援?)

        print(f"   ?뱦 理쒖쥌 ?ъ슜???몃뜳?? {used_indices}")
        return transformations

    def _recalculate_elements(self, original_counts: Dict[str, int], transformations: List[Dict]) -> Dict[str, int]:
        """?⑺솕 ?곸슜 ???ㅽ뻾 ?ш퀎??
        寃곌낵 ?ㅽ뻾怨?媛숈? ?먯냼???좎?, ?ㅻⅨ ?먯냼留?蹂??        """
        result = original_counts.copy()

        print(f"?뵇 ?ш퀎???쒖옉 - ?먮낯: {result}")
        print(f"?뵇 ?곸슜??蹂?? {len(transformations)}嫄?)

        for trans in transformations:
            trans_type = trans.get('type', '')
            original_elements = trans.get('original_elements', [])
            result_element = trans.get('result', '')
            name = trans.get('name', '')

            print(f"   ?뱦 {name} ({trans_type})")
            print(f"   ?뱦 ?먯냼: {original_elements} ??{result_element}")

            converted_count = 0

            for elem in original_elements:
                if elem == result_element:
                    print(f"      ?뱄툘  {elem}??{result_element}? ?숈씪 ???좎?")
                else:
                    if elem in result and result[elem] > 0:
                        old_val = result[elem]
                        result[elem] -= 1
                        converted_count += 1
                        print(f"      ??{elem} 李④컧: {old_val} ??{result[elem]}")
                    else:
                        print(
                            f"      ?좑툘  {elem} 李④컧 遺덇? (?꾩옱媛? {result.get(elem, 0)})")

            if converted_count > 0 and result_element in result:
                old_val = result[result_element]
                result[result_element] += converted_count
                print(
                    f"      ??{result_element} 利앷?: {old_val} ??{result[result_element]} (+{converted_count})")

        print(f"?뵇 ?ш퀎???꾨즺 - 寃곌낵: {result}")
        return result

    def _apply_harmony_transformation(self, element_counts: Dict[str, int], analysis: Dict) -> Tuple[Dict[str, int], List[Dict]]:
        """?⑺솕 蹂???곸슜 諛??ㅽ뻾 ?ш퀎??""
        transformations = []

        # pillars ?먮뒗 basic_info?먯꽌 異붿텧
        pillars = analysis.get('pillars', {})
        basic_info = analysis.get('basic_info', {})

        if pillars:
            # pillars?먯꽌 異붿텧
            year_pillar = pillars.get('year', {})
            month_pillar = pillars.get('month', {})
            day_pillar = pillars.get('day', {})
            hour_pillar = pillars.get('hour', {})

            heavenly_stems = [
                year_pillar.get('heavenly_stem', ''),
                month_pillar.get('heavenly_stem', ''),
                day_pillar.get('heavenly_stem', ''),
                hour_pillar.get('heavenly_stem', '')
            ]

            earthly_branches = [
                year_pillar.get('earthly_branch', ''),
                month_pillar.get('earthly_branch', ''),
                day_pillar.get('earthly_branch', ''),
                hour_pillar.get('earthly_branch', '')
            ]
        elif basic_info:
            # basic_info?먯꽌 異붿텧 (?대갚)
            print("?좑툘  pillars ?놁쓬, basic_info?먯꽌 異붿텧")

            heavenly_stems = [
                basic_info.get('year', ['', ''])[0] if isinstance(
                    basic_info.get('year'), (list, tuple)) else '',
                basic_info.get('month', ['', ''])[0] if isinstance(
                    basic_info.get('month'), (list, tuple)) else '',
                basic_info.get('day', ['', ''])[0] if isinstance(
                    basic_info.get('day'), (list, tuple)) else '',
                basic_info.get('hour', ['', ''])[0] if isinstance(
                    basic_info.get('hour'), (list, tuple)) else ''
            ]

            earthly_branches = [
                basic_info.get('year', ['', ''])[1] if isinstance(
                    basic_info.get('year'), (list, tuple)) else '',
                basic_info.get('month', ['', ''])[1] if isinstance(
                    basic_info.get('month'), (list, tuple)) else '',
                basic_info.get('day', ['', ''])[1] if isinstance(
                    basic_info.get('day'), (list, tuple)) else '',
                basic_info.get('hour', ['', ''])[1] if isinstance(
                    basic_info.get('hour'), (list, tuple)) else ''
            ]
        else:
            print("?좑툘  pillars? basic_info 紐⑤몢 ?놁쓬")
            return element_counts.copy(), []

        print(f"?뵇 泥쒓컙: {heavenly_stems}")
        print(f"?뵇 吏吏: {earthly_branches}")

        # 泥쒓컙??泥댄겕
        heavenly_transformations = self._check_heavenly_harmony(
            heavenly_stems, earthly_branches)
        transformations.extend(heavenly_transformations)

        # 吏吏??泥댄겕
        earthly_transformations = self._check_earthly_harmony(earthly_branches)
        transformations.extend(earthly_transformations)

        if transformations:
            print(f"?뵦 ?⑺솕 諛쒓껄: {len(transformations)}嫄?)
            for trans in transformations:
                trans_type = trans.get('type', '')
                name = trans.get('name', '')
                print(f"   - {name} ({trans_type})")

        # ?ㅽ뻾 ?ш퀎??        transformed_counts = self._recalculate_elements(
            element_counts, transformations)

        print(f"?뵇 ?먮낯 ?ㅽ뻾: {element_counts}")
        print(f"?뵇 ?⑺솕 ???ㅽ뻾: {transformed_counts}")

        return transformed_counts, transformations

    def generate_element_interpretation(self, element_counts, tone='empathy', theories='', analysis=None):
        """
        ?ㅽ뻾 移댁슫??湲곕컲 ?댁꽍 ?앹꽦 (?⑺솕 諛섏쁺)

        Args:
            element_counts: {'wood': 1, 'fire': 2, 'earth': 1, 'metal': 2, 'water': 2}
            tone: 'empathy', 'reality', 'fun'
            theories: ?대줎 ?띿뒪??(?듭뀡)
            analysis: analyze_full_saju() 寃곌낵 (?⑺솕 ?먮떒??

        Returns:
            str: ?앹꽦???댁꽍
        """
        # ?⑺솕 ?곸슜
        transformed_counts, transformations = self._apply_harmony_transformation(
            element_counts, analysis)

        harmony_info = ""
        if transformations:
            harmony_info = "\n\n?뵦 ?⑺솕(?덂뙑) 諛쒖깮:\n"
            for t in transformations:
                name = t.get('name', '')
                positions = t.get('positions', [])
                harmony_info += f"- {name} ({', '.join(positions)})\n"

        final_counts = transformed_counts

        if not self.client:
            return self._fallback_element_interpretation(final_counts, tone)

        # ?ㅻ퀎 ?쒖뒪???꾨＼?꾪듃
        tone_prompts = {
            'empathy': "?뱀떊? ?곕쑜?섍퀬 怨듦컧?곸씤 ?ъ＜ ?곷떞媛?낅땲?? ?대챸濡좎쟻 寃곗젙濡좊낫?ㅻ뒗 ?щ엺???좎옱?κ낵 媛?μ꽦??吏묒쨷?섎ŉ, 寃⑸젮? 吏吏??硫붿떆吏瑜??꾨떖?⑸땲??",
            'reality': "?뱀떊? ?됱쿋?섍퀬 媛앷??곸씤 ?ъ＜ ?꾨Ц媛?낅땲?? ?ъ＜ ?대줎???뺥솗?섍쾶 遺꾩꽍?섍퀬, ?꾩떎?곸씠怨??쇰━?곸씤 ?댁꽍???쒓났?⑸땲??",
            'fun': "?뱀떊? ?щ??덇퀬 移쒓렐???ъ＜ ?댁꽍媛?낅땲?? 諛덇낵 ?대え吏瑜??쒖슜?섏뿬 Z?몃? 媛먯꽦?쇰줈 ?쎄퀬 ?щ??덇쾶 ?ъ＜瑜??댁꽍?⑸땲??"
        }

        system_prompt = tone_prompts.get(tone, tone_prompts['empathy'])

        # ?ㅽ뻾 ?뺣낫 ?뺣━ (?⑺솕 ?곸슜 ??
        elements_info = f"""
?ㅽ뻾 遺꾪룷 (?⑺솕 ?곸슜 ??: 
- ??紐??섎Т): {final_counts.get('wood', 0)}媛?- ????遺?: {final_counts.get('fire', 0)}媛? 
- ??????: {final_counts.get('earth', 0)}媛?- ??湲???: {final_counts.get('metal', 0)}媛?- 麗???臾?: {final_counts.get('water', 0)}媛?
{harmony_info}
"""

        # ?ъ슜???꾨＼?꾪듃 援ъ꽦
        theory_section = f"\n\n李멸퀬 ?대줎:\n{theories}" if theories else ""

        user_prompt = f"""?ㅼ쓬 ?ъ＜???ㅽ뻾 ?먮꼫吏瑜?遺꾩꽍?댁＜?몄슂:

{elements_info}{theory_section}

???⑺솕(?덂뙑)媛 ?덈뒗 寃쎌슦 (理쒖슦??遺꾩꽍!):
1. ?⑺솕??醫낅쪟 ?앸퀎 (泥쒓컙??吏吏???쇳빀)
2. ?먮옒 ?ㅽ뻾 ??蹂?붾맂 ?ㅽ뻾 紐낆떆
3. ?ъ＜ ?꾩껜??誘몄튂???곹뼢:
   - ?먮옒 媛뺥뻽???ㅽ뻾??以꾨㈃ ???좎옱???먮꼫吏濡??ㅻ챸
   - ?덈줈 ?앷릿 ?ㅽ뻾??利앷??섎㈃ ???덈줈??媛?μ꽦?쇰줈 ?ㅻ챸
4. 湲띿젙??遺?뺤쟻 痢〓㈃ 紐⑤몢 ?멸툒
5. ?ㅼ깮???덉떆 (????愿怨?

?묒꽦 媛?대뱶: 
1. ?꾩껜 ?ㅽ뻾 洹좏삎 ?곹깭瑜?癒쇱? ?됯? (洹좏삎 ?≫옒 / ?뱀젙 ?ㅽ뻾 媛뺤꽭 / 遺議?
2. 媛??媛뺥븳 ?ㅽ뻾???깃꺽怨??띠뿉 誘몄튂???곹뼢
3. 媛???쏀븳 ?ㅽ뻾???섎??섎뒗 寃?4. ?ㅽ뻾 洹좏삎??留욎텛湲??꾪븳 ?ㅼ쿇 媛?대뱶 (?됱긽, 諛⑹쐞, ?쒕룞 ??
5. ?꾩껜?곸씤 硫붿떆吏? 寃⑸젮

遺꾨웾: 1500-2000???뺤떇: 移쒓렐?섍퀬 ?쎄린 ?ъ슫 臾몄옣, 援ъ껜?곸씤 ?덉떆 ?ы븿
"""

        try:
            response = self.client.chat.completions.create(
                model="gpt-4o-mini",
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": user_prompt}
                ],
                temperature=0.8,
                max_tokens=3000
            )

            content = response.choices[0].message.content
            print(f"??GPT ?댁꽍 ?앹꽦 ?꾨즺: {len(content)}??)
            return content

        except Exception as e:
            print(f"??GPT API ?몄텧 ?ㅽ뙣: {e}")
            return self._fallback_element_interpretation(final_counts, tone)

    def _extract_harmony_from_patterns(self, patterns):
        """?⑦꽩?먯꽌 ?⑺솕 愿????ぉ留?異붿텧"""
        harmony_patterns = []
        for p in patterns:
            if any(keyword in p for keyword in ['泥쒓컙??, '吏吏??, '?≫빀', '?쇳빀', '諛섑빀']):
                harmony_patterns.append(p)
        return harmony_patterns

    def generate_comprehensive_interpretation(self, analysis, tone='empathy', theories=''):
        """
        ?댁꽍 ?붿쭊???곸꽭 遺꾩꽍 寃곌낵瑜??쒖슜??醫낇빀 ?댁꽍 ?앹꽦

        Args:
            analysis: analyze_full_saju()??寃곌낵
            tone: 'empathy' | 'reality' | 'fun'
            theories: ?대줎 ?띿뒪??
        Returns:
            str: GPT媛 ?앹꽦??醫낇빀 ?댁꽍 (3000~4000??
        """
        if not self.client:
            return self._fallback_comprehensive(analysis, tone)

        # ?ㅻ퀎 ?쒖뒪???꾨＼?꾪듃
        tone_prompts = {
            'empathy': "?뱀떊? ?곕쑜?섍퀬 怨듦컧?곸씤 ?ъ＜ ?곷떞媛?낅땲?? ?대챸濡좎쟻 寃곗젙濡좊낫?ㅻ뒗 ?щ엺???좎옱?κ낵 媛?μ꽦??吏묒쨷?섎ŉ, 寃⑸젮? 吏吏??硫붿떆吏瑜??꾨떖?⑸땲??",
            'reality': "?뱀떊? ?됱쿋?섍퀬 媛앷??곸씤 ?ъ＜ ?꾨Ц媛?낅땲?? ?ъ＜ ?대줎???뺥솗?섍쾶 遺꾩꽍?섍퀬, ?꾩떎?곸씠怨??쇰━?곸씤 ?댁꽍???쒓났?⑸땲??",
            'fun': "?뱀떊? ?щ??덇퀬 移쒓렐???ъ＜ ?댁꽍媛?낅땲?? 移쒓뎄媛숈? ?먮굦?쇰줈 諛섎쭚???섏짛. 諛덇낵 ?대え吏瑜??쒖슜?섏뿬 Z?몃? 媛먯꽦?쇰줈 ?쎄퀬 ?щ??덇쾶 ?ъ＜瑜??댁꽍?⑸땲??"
        }

        system_prompt = tone_prompts.get(tone, tone_prompts['empathy'])

        # 遺꾩꽍 寃곌낵 ?뺣━
        summary = analysis['summary']
        element_count = summary['element_count']
        ten_gods_count = summary['ten_gods_count']
        patterns = analysis.get('patterns', [])

        # ?⑺솕 ?뺣낫 異붿텧
        harmony_transformations = self._extract_harmony_from_patterns(patterns)
        harmony_section = ""
        if harmony_transformations:
            harmony_section = "\n\n?뵦 ?⑺솕(?덂뙑):\n"
            for h in harmony_transformations:
                harmony_section += f"- {h}\n"
            harmony_section += "\n?좑툘 ?⑺솕???ъ＜ ?댁꽍?먯꽌 留ㅼ슦 以묒슂???붿냼?낅땲??"

        analysis_info = f"""
?ъ＜ 湲곕낯 ?뺣낫: 
- ?쇨컙: {analysis['basic_info']['day_stem']}
- ?ъ＜ ?붿옄:
  ???꾩＜: {analysis['basic_info']['year']}
  ???붿＜: {analysis['basic_info']['month']}
  ???쇱＜: {analysis['basic_info']['day']}
  ???쒖＜: {analysis['basic_info']['hour']}

?좉컯??遺꾩꽍: 
- ?좏삎: {summary['strength']}
- ?먯닔: {summary['strength_score']}/100

?ㅽ뻾 遺꾪룷: 
- ??紐??섎Т): {element_count.get('wood', 0)}媛?- ????遺?: {element_count.get('fire', 0)}媛?- ??????: {element_count.get('earth', 0)}媛?- ??湲???: {element_count.get('metal', 0)}媛?- 麗???臾?: {element_count.get('water', 0)}媛?
??꽦 遺꾪룷: 
{self._format_ten_gods_detail(ten_gods_count)}

諛쒓껄???⑦꽩: 
{self._format_patterns(patterns)}

{harmony_section}
"""

        theory_section = f"\n\n李멸퀬 ?대줎:\n{theories}" if theories else ""

        user_prompt = f"""?ㅼ쓬 ?ъ＜瑜?醫낇빀?곸쑝濡?遺꾩꽍?섏뿬 ?곸꽭???댁꽍???묒꽦?댁＜?몄슂:

{analysis_info}{theory_section}

?묒꽦 媛?대뱶 (?⑹뼱 ?ъ슜 洹쒖튃 諛섏쁺蹂?

???뱀뀡? ?ъ슜?먯쓽 ?깃꺽???붿쭊怨?釉뚮젅?댄겕瑜?遺꾩꽍?⑸땲?? AI???ㅼ쓬 ??媛吏 愿?먯쓣 ?꾩떎?곸씤 ?덉떆(?? ?щ옉, ??? ?④퍡 ?낆껜?곸쑝濡??쒖닠?댁빞 ?⑸땲??

?좑툘 ?⑹뼱 ?ъ슜 怨듯넻 洹쒖튃 (?꾩닔)

?ㅽ뻾 媛쒖닔 0媛????뚭껐?띲??ъ슜
?ㅽ뻾 媛쒖닔 1媛????뚮?議긱? ?뚯빟???멥??깆쑝濡??쒗쁽 (寃고븤 ??
?ㅽ뻾 媛쒖닔 2媛????뚯쟻?밤??깆쑝濡??쒗쁽
?ㅽ뻾 媛쒖닔 3媛??댁긽 ???뚭낵?ㅳ??ъ슜
?뚭낵遺?섅띾씪???⑥뼱???ъ슜?섏? ?딆쓬
?섎????쒖닠濡쒕쭔 ?쒗쁽 (?? "?덈Т ?좎뭅濡쒖썙 ?ㅼ뒪濡쒕? 踰좉린???⑸땲??)
洹좏삎 ?≫엺 ?ъ＜?먯꽌??'怨쇰떎 / 寃고븤 / 怨쇰??? ?⑥뼱 紐⑤몢 ?ъ슜 湲덉?

0. [理쒖슦??遺꾩꽍] 湲곗슫??寃고빀怨?蹂?? "???덉쓽 ?④꺼吏?諛섏쟾 移대뱶" (1000??

??湲곗슫??留뚮굹 ?꾪? ?ㅻⅨ ????湲곗슫?쇰줈 蹂?섎뒗 ?꾩긽??遺꾩꽍. ?ъ슜?먭? ?댄빐?섍린 ?쎄쾶 "湲곗슫???⑹퀜??蹂?덈떎"怨??쒗쁽?섏꽭??
?놁쑝硫?洹몃깷 嫄대꼫?곗뼱?꾨맖.

?좑툘 ??/ ?⑺솕 遺꾩꽍 洹쒖튃 (?꾩닔)

AI???꾨옒 3?④퀎瑜??쒖꽌?濡??먮떒?섍퀬, ?대떦?섎뒗 耳?댁뒪留??꾩떎 ?덉떆源뚯? 援ъ껜?곸쑝濡??묒꽦?섏꽭??

A) "?⑹씠 ?덈떎" (寃곗냽/臾띠엫/諛섏쟾???⑥븮)
B) "?⑹씠 ?묐룞?쒕떎" (?ㅼ젣濡??띠뿉??怨꾩냽 諛쒕룞?섎뒗 ?곹깭)
C) "?⑺솕媛 ?쒕떎" (????湲곗슫?쇰줈 蹂??

1. 媛뺥븳 ?ㅽ뻾 : "?섎? ?吏곸씠???먮룞 諛섏궗???듦?" (800??
2. ?쏀븳 ?ㅽ뻾 : "臾댁쓽?앹쟻 媛덈쭩怨??щ━???ш컖吏?" (800??
3. 洹좏삎 ?≫엺 ?ъ＜ : "?됱삩???띿뿉 ?④꺼吏??쇱꽦??遺?? (400??

遺꾨웾: 3000~4000??"""

        try:
            response = self.client.chat.completions.create(
                model="gpt-4o",
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": user_prompt}
                ],
                temperature=0.8,
                max_tokens=5000
            )

            content = response.choices[0].message.content
            print(f"??醫낇빀 GPT ?댁꽍 ?앹꽦 ?꾨즺: {len(content)}??)
            return content

        except Exception as e:
            print(f"??GPT API ?몄텧 ?ㅽ뙣: {e}")
            return self._fallback_comprehensive(analysis, tone)

    def _format_ten_gods_detail(self, ten_gods):
        """??꽦 ?곸꽭 ?щ㎎??""
        lines = []
        god_meanings = {
            '鍮꾧껄': '?뺤젣?먮ℓ, ?숇즺',
            '寃곸옱': '寃쎌웳?? ?쇱씠踰?,
            '?앹떊': '?쒗쁽?? ?ъ쑀',
            '?곴?': '?щ뒫, 李쎌쓽??,
            '?몄옱': '?좊룞???щЪ',
            '?뺤옱': '?덉젙???щЪ',
            '?멸?': '?꾩쟾, 蹂??,
            '?뺢?': '紐낆삁, 吏??,
            '?몄씤': '?숇Ц, 李쎌쓽',
            '?뺤씤': '?숈뾽, 紐낆삁'
        }

        for god, count in ten_gods.items():
            if count > 0:
                meaning = god_meanings.get(god, '')
                lines.append(f"- {god} {count}媛?({meaning})")
        return "\n".join(lines) if lines else "?놁쓬"

    def _format_patterns(self, patterns):
        """?⑦꽩 ?щ㎎??""
        if not patterns:
            return "?밸퀎???⑦꽩 ?놁쓬"

        pattern_groups = {
            '??: [],
            '異?: [],
            '??: [],
            '??: [],
            '湲고?': []
        }

        for p in patterns:
            if '?? in p:
                pattern_groups['??].append(p)
            elif '異? in p:
                pattern_groups['異?].append(p)
            elif '?? in p:
                pattern_groups['??].append(p)
            elif '?? in p:
                pattern_groups['??].append(p)
            else:
                pattern_groups['湲고?'].append(p)

        result = []
        for group, items in pattern_groups.items():
            if items:
                result.append(f"??{group}: {', '.join(items)}")

        return "\n".join(result) if result else "?밸퀎???⑦꽩 ?놁쓬"

    def _fallback_comprehensive(self, analysis, tone):
        """?대갚 醫낇빀 ?댁꽍"""
        summary = analysis['summary']
        element_count = summary['element_count']

        # 媛??媛뺥븳/?쏀븳 ?ㅽ뻾
        strongest = max(element_count.items(), key=lambda x: x[1])
        weakest = min(element_count.items(), key=lambda x: x[1])

        element_names = {
            'wood': '???섎Т)', 'fire': '??遺?', 'earth': '????',
            'metal': '????', 'water': '麗?臾?'
        }

        return f"""## ?뙂 ?뱀떊???ъ＜ 醫낇빀 遺꾩꽍

?좉컯?? {summary['strength']} ({summary['strength_score']}??

?뱀떊???ъ＜??{summary['strength']} ?깊뼢?낅땲??

?ㅽ뻾 洹좏삎: 
媛??媛뺥븳 ?ㅽ뻾? {element_names[strongest[0]]} ({strongest[1]}媛??닿퀬,
媛???쏀븳 ?ㅽ뻾? {element_names[weakest[0]]} ({weakest[1]}媛??낅땲??

??꽦 遺꾪룷: 
{self._format_ten_gods_detail(summary['ten_gods_count'])}

?⑦꽩: 
{self._format_patterns(analysis.get('patterns', []))}

?곸꽭???댁꽍? GPT ?쒕퉬???곌껐 ???쒓났?⑸땲??
"""

    def _fallback_element_interpretation(self, element_counts, tone):
        """GPT ?ㅽ뙣 ???대갚 ?댁꽍"""
        total = sum(element_counts.values())

        if total == 0:
            return "?ъ＜ ?뺣낫瑜?遺꾩꽍?????놁뒿?덈떎."

        # 媛뺥븳 ?ㅽ뻾 李얘린
        strongest = max(element_counts.items(), key=lambda x: x[1])
        weakest = min(element_counts.items(), key=lambda x: x[1])

        element_names = {
            'wood': '???섎Т)',
            'fire': '??遺?',
            'earth': '????',
            'metal': '????',
            'water': '麗?臾?'
        }

        element_traits = {
            'wood': '?깆옣, 李쎌쓽?? ?좎뿰??,
            'fire': '?댁젙, ?쒗쁽?? 由щ뜑??,
            'earth': '?덉젙, ?좊ː, ?ъ슜??,
            'metal': '?뺤쓽, ?먯튃, 寃곕떒??,
            'water': '吏?? ?곸쓳?? 吏곴?'
        }

        content = f"""## ?뙂 ?뱀떊???ㅽ뻾 ?먮꼫吏

?ㅽ뻾 遺꾪룷 
- ???섎Т): {element_counts.get('wood', 0)}媛?- ??遺?: {element_counts.get('fire', 0)}媛?- ????: {element_counts.get('earth', 0)}媛?- ????: {element_counts.get('metal', 0)}媛?- 麗?臾?: {element_counts.get('water', 0)}媛?
?뱀떊???ъ＜?먯꽌 {element_names[strongest[0]]} ?먮꼫吏媛 媛??媛뺥븯寃??섑??⑸땲??({strongest[1]}媛?. 
?대뒗 {element_traits[strongest[0]]}???뱀꽦??媛뺥븯寃?媛吏怨??덉쓬???섎??⑸땲??

諛섎㈃ {element_names[weakest[0]]} ?먮꼫吏???곷??곸쑝濡??쏀븳 ?몄엯?덈떎 ({weakest[1]}媛?.
??遺遺꾩쓣 蹂댁셿?섎㈃ ??洹좏삎 ?≫엺 ?띠쓣 ?????덉뒿?덈떎.

?ㅼ쿇 媛?대뱶: 
- 媛뺥븳 ?ㅽ뻾???μ젏???곴레 ?쒖슜?섏꽭??- ?쏀븳 ?ㅽ뻾??蹂댁셿?섎뒗 ?됱긽, 諛⑹쐞, ?쒕룞???앺솢???곸슜?대낫?몄슂
- 洹좏삎???듯빐 ??議고솕濡쒖슫 ?띠쓣 留뚮뱾?닿??몄슂
"""

        return content

    def generate_section1(self, analysis, tone='empathy'):
        """
        ?뱀뀡 1: ?ㅽ뻾 ?먮꼫吏 遺꾩꽍 ?앹꽦

        Args:
            analysis: analyze_full_saju 寃곌낵
            tone: 'empathy' | 'reality' | 'fun'

        Returns:
            {
                'section_id': 1,
                'title': '...',
                'content': '...',
                'tone': tone
            }
        """

        # 1. 愿???대줎 異붿텧
        theories = self.retriever.get_relevant_theories(analysis)

        # 2. 遺꾩꽍 寃곌낵 ?붿빟
        summary = self._create_analysis_summary(analysis)

        # 3. ?ㅻ퀎 ?쒖뒪??硫붿떆吏
        system_prompts = {
            'empathy': "?뱀떊? ?곕쑜?섍퀬 怨듦컧?곸씤 ?ъ＜ ?곷떞媛?낅땲?? 遺?쒕윭???댁“濡?湲띿젙??硫붿떆吏瑜??꾨떖?섎릺, ?꾩떎?곸씤 議곗뼵???④퍡 ?쒓났?⑸땲??",
            'reality': "?뱀떊? 媛앷??곸씠怨?遺꾩꽍?곸씤 ?ъ＜ 紐낅━?숈옄?낅땲?? 媛먯젙??諛곗젣?섍퀬 ?⑺듃? ?곗씠??以묒떖?쇰줈 媛꾧껐?섍쾶 ?꾨떖?⑸땲??",
            'fun': "?뱀떊? 移쒓렐?섍퀬 ?щ??덈뒗 移쒓뎄 媛숈? ?ъ＜ ?곷떞媛?낅땲?? 諛섎쭚???욎뼱 ?명븯寃??댁빞湲고븯硫? ?듭떖??李뚮Ⅴ??議곗뼵???⑸땲??"
        }

        # 4. GPT ?꾨＼?꾪듃 援ъ꽦
        prompt = f"""?ㅼ쓬 ?ъ＜ 遺꾩꽍 寃곌낵? ?대줎??諛뷀깢?쇰줈 ?댁꽍???묒꽦?댁＜?몄슂.

[?ъ＜ 遺꾩꽍 寃곌낵]
{summary}

[愿???ъ＜ ?대줎]
{theories}

[?붽뎄?ы빆]
1. ???대줎??李멸퀬?섏뿬 ?뺥솗?섍퀬 ?꾨Ц?곸씤 ?댁꽍 ?묒꽦
2. {tone} ?ㅼ뿉 留욎떠 ?묒꽦:
   - empathy: ?곕쑜?섍퀬 怨듦컧?? "?뱀떊", "~?덉슂", "~?낅땲??
   - reality: 媛앷??곸씠怨?遺꾩꽍?? "~??, "~??, ?곗씠??以묒떖
   - fun: 移쒓렐?섍퀬 ?щ??덇쾶, 諛섎쭚 ?욎뼱?? "??, "??

3. ?ㅼ쓬 援ъ“濡?1500???댁쇅 ?묒꽦:
   - ?꾩껜?곸씤 ?ъ＜ ?뱀쭠 (?좉컯/?좎빟, ?ㅽ뻾 遺꾪룷)
   - ?ㅽ뻾 ?먮꼫吏 遺꾩꽍 (留롮? ?ㅽ뻾, 遺議깊븳 ?ㅽ뻾???섎?)
   - ??꽦 遺꾪룷 ?댁꽍 (?대뼡 ??꽦??留롪퀬 洹??섎?)
   - ?ㅼ쟾 議곗뼵 (?대뼡 ?ㅽ뻾/??꽦??蹂댁셿?댁빞 ?섎뒗吏)

4. ?대줎 ?댁슜??洹몃?濡?蹂듭궗?섏? 留먭퀬, ???ъ＜??留욊쾶 ?ы빐??5. ?꾨Ц ?⑹뼱???쎄쾶 ??댁꽌 ?ㅻ챸
6. 援ъ껜?곸씠怨??ㅼ슜?곸씤 議곗뼵 ?쒓났
"""

        # 5. GPT ?몄텧
        if not self.client:
            return self._fallback_interpretation(analysis, tone)

        try:
            response = self.client.chat.completions.create(
                model="gpt-4o",
                messages=[
                    {"role": "system", "content": system_prompts[tone]},
                    {"role": "user", "content": prompt}
                ],
                temperature=0.7,
                max_tokens=2000
            )

            content = response.choices[0].message.content

            return {
                'section_id': 1,
                'title': '?ㅽ뻾 ?먮꼫吏 遺꾩꽍',
                'content': content,
                'tone': tone
            }

        except Exception as e:
            print(f"??GPT ?몄텧 ?ㅽ뙣: {e}")
            return self._fallback_interpretation(analysis, tone)

    def _create_analysis_summary(self, analysis):
        """遺꾩꽍 寃곌낵瑜?GPT媛 ?쎄린 ?ъ슫 ?뺤떇?쇰줈 ?붿빟"""

        bi = analysis['basic_info']
        strength = analysis['summary']['strength']
        score = analysis['summary']['strength_score']
        ten_gods = analysis['summary']['ten_gods_count']
        element_count = analysis['summary']['element_count']
        patterns = analysis.get('patterns', [])

        summary = f"""
?ъ＜ ?붿옄 
- ?곗＜: {bi['year']}
- ?붿＜: {bi['month']}
- ?쇱＜: {bi['day']}
- ?쒖＜: {bi['hour']}

?쇨컙 
- {bi['day_stem']}

?좉컯??
- ?좏삎: {strength}
- ?먯닔: {score}/100

?ㅽ뻾 遺꾪룷 
- 紐???: {element_count.get('wood', 0)}媛?- ????: {element_count.get('fire', 0)}媛?- ????: {element_count.get('earth', 0)}媛?- 湲???: {element_count.get('metal', 0)}媛?- ??麗?: {element_count.get('water', 0)}媛?
??꽦 遺꾪룷 
{self._format_ten_gods(ten_gods)}

諛쒓껄???⑦꽩 
{', '.join(patterns) if patterns else '?놁쓬'}
"""
        return summary.strip()

    def _format_ten_gods(self, ten_gods):
        """??꽦???쎄린 ?쎄쾶 ?щ㎎"""
        lines = []
        for god, count in ten_gods.items():
            if count > 0:
                lines.append(f"- {god}: {count}媛?)
        return "\n".join(lines) if lines else "- ?놁쓬"

    def _fallback_interpretation(self, analysis, tone):
        """GPT ?ㅽ뙣 ??湲곕낯 ?댁꽍"""
        strength = analysis['summary']['strength']
        score = analysis['summary']['strength_score']

        content = f"""?뱀떊???ъ＜??{strength} ?깊뼢?낅땲??

?좉컯???먯닔: {score}??
?ㅽ뻾 ?먮꼫吏? ??꽦 遺꾪룷瑜?醫낇빀?곸쑝濡?遺꾩꽍?섏뿬 ?댁꽍???쒓났?⑸땲??

(?곸꽭 ?댁꽍? GPT ?쒕퉬???곌껐 ???쒓났?⑸땲??
"""

        return {
            'section_id': 1,
            'title': '?ㅽ뻾 ?먮꼫吏 遺꾩꽍',
            'content': content,
            'tone': tone
        }


def test_generator():
    """?뚯뒪??""
    element_counts = {
        'wood': 2,
        'fire': 1,
        'earth': 1,
        'metal': 2,
        'water': 2
    }

    generator = GPTInterpretationGenerator()
    result = generator._fallback_element_interpretation(
        element_counts, 'empathy')

    print("="*70)
    print("?ㅽ뻾 ?먮꼫吏 ?댁꽍 (?대갚 紐⑤뱶)")
    print("="*70)
    print(result)


if __name__ == "__main__":
    test_generator()


----- FILE: backend\logic\saju_engine\core\analyzer.py -----
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
?꾩쟾???ъ＜ 遺꾩꽍 ?듯빀 ?붿쭊
紐⑤뱺 ?ъ＜??????뺥솗?섍퀬 鍮좎쭚?놁씠 遺꾩꽍
"""

from .ten_gods import calculate_ten_god
from .strength import calculate_strength_score
from .harmony_clash import analyze_harmony_clash
from .sinsal import analyze_sinsal

# =====================================================
# ?듯빀 遺꾩꽍 ?붿쭊
# =====================================================


def analyze_full_saju(day_stem, pillars):
    """
    ?꾩쟾???ъ＜ 遺꾩꽍

    Args:
        day_stem: ?쇨컙 (?? '??)
        pillars: {
            'year': '佯싪쒼',
            'month': '阿숅뀎',
            'day': '?멩쑋',
            'hour': '佯싩뵵'
        }

    Returns:
        紐⑤뱺 遺꾩꽍 寃곌낵瑜??댁? ?뺤뀛?덈━
    """

    result = {
        'basic_info': {
            'day_stem': day_stem,
            'year': pillars['year'],
            'month': pillars['month'],
            'day': pillars['day'],
            'hour': pillars['hour']
        },
        'strength': None,
        'ten_gods': {},
        'harmony_clash': {},
        'sinsal': {},
        'summary': {}
    }

    # 1. ?좉컯??遺꾩꽍
    result['strength'] = calculate_strength_score(day_stem, pillars)

    # 2. ??꽦 遺꾩꽍
    chars = {
        '?꾧컙': pillars['year'][0],
        '?꾩?': pillars['year'][1],
        '?붽컙': pillars['month'][0],
        '?붿?': pillars['month'][1],
        '?쇨컙': day_stem,
        '?쇱?': pillars['day'][1],
        '?쒓컙': pillars['hour'][0],
        '?쒖?': pillars['hour'][1]
    }

    for pos, char in chars.items():
        if pos == '?쇨컙':
            continue
        result['ten_gods'][pos] = {
            'char': char,
            'ten_god': calculate_ten_god(day_stem, char)
        }

    # 3. ?⑹땐 遺꾩꽍
    result['harmony_clash'] = analyze_harmony_clash(pillars)

    # 4. ?좎궡 遺꾩꽍
    result['sinsal'] = analyze_sinsal(day_stem, pillars)

    # ??5. ?ㅽ뻾 移댁슫??怨꾩궛 (異붽?!)
    element_count = _calculate_element_count(pillars)

    # 6. ?붿빟
    result['summary'] = {
        'strength': result['strength']['strength'],
        'strength_score': result['strength']['total_score'],
        'deukryeong': result['strength']['deukryeong'],
        'deukji': result['strength']['deukji'],
        'deukse': result['strength']['deukse'],
        'element_count': element_count,  # ??異붽?!
        'ten_gods_count': {},
        'harmony_clash_count': {
            'cheongan_hap': len(result['harmony_clash']['cheongan_hap']),
            'cheongan_chung': len(result['harmony_clash']['cheongan_chung']),
            'jiji_yukhap': len(result['harmony_clash']['jiji_yukhap']),
            'jiji_samhap': len(result['harmony_clash']['jiji_samhap']),
            'jiji_banhap': len(result['harmony_clash']['jiji_banhap']),
            'jiji_chung': len(result['harmony_clash']['jiji_chung'])
        },
        'sinsal_count': {
            'cheonul_gwiin': len(result['sinsal']['cheonul_gwiin']),
            'dohwa': len(result['sinsal']['dohwa']),
            'yeokma': len(result['sinsal']['yeokma']),
            'hwagae': len(result['sinsal']['hwagae']),
            'wolgong': len(result['sinsal']['wolgong']),
            'munchang_gwiin': len(result['sinsal']['munchang_gwiin'])
        }
    }

    # ??꽦 移댁슫??    for info in result['ten_gods'].values():
        tg = info['ten_god']
        result['summary']['ten_gods_count'][tg] = result['summary']['ten_gods_count'].get(
            tg, 0) + 1

    # ??7. ?⑦꽩 ?뺣━ (GPT媛 ?ъ슜)
    result['patterns'] = _extract_patterns(result)

    return result


# =====================================================
# ???덈줈 異붽?: ?ㅽ뻾 移댁슫??怨꾩궛
# =====================================================

def _calculate_element_count(pillars):
    """?ъ＜ ?붿옄?먯꽌 ?ㅽ뻾 移댁슫??怨꾩궛"""
    element_map = {
        "??: "wood", "阿?: "wood",
        "訝?: "fire", "訝?: "fire",
        "??: "earth", "藥?: "earth",
        "佯?: "metal", "渦?: "metal",
        "鶯?: "water", "??: "water",
        "野?: "wood", "??: "wood",
        "藥?: "fire", "??: "fire",
        "渦?: "earth", "??: "earth", "訝?: "earth", "??: "earth",
        "??: "metal", "??: "metal",
        "耶?: "water", "雅?: "water",
    }

    counts = {"wood": 0, "fire": 0, "earth": 0, "metal": 0, "water": 0}

    for pillar in pillars.values():
        if pillar:
            for char in pillar:
                element = element_map.get(char)
                if element:
                    counts[element] += 1

    return counts


# =====================================================
# ???덈줈 異붽?: ?⑦꽩 異붿텧 (GPT??
# =====================================================

def _extract_patterns(result):
    """GPT媛 ?ъ슜???⑦꽩 臾몄옄??由ъ뒪??異붿텧"""
    patterns = []

    # ?⑹땐 ?⑦꽩
    hc = result['harmony_clash']

    for item in hc['cheongan_hap']:
        patterns.append(f"泥쒓컙?? {item['description']}")

    for item in hc['jiji_yukhap']:
        patterns.append(f"吏吏?≫빀: {item['description']}")

    for item in hc['jiji_samhap']:
        patterns.append(f"吏吏?쇳빀: {item['description']}")

    for item in hc['jiji_banhap']:
        patterns.append(f"吏吏諛섑빀: {item['description']}")

    for item in hc['cheongan_chung']:
        patterns.append(f"泥쒓컙異? {item['description']}")

    for item in hc['jiji_chung']:
        patterns.append(f"吏吏異? {item['description']}")

    # ?좎궡 ?⑦꽩
    ss = result['sinsal']

    for item in ss['cheonul_gwiin']:
        patterns.append(f"泥쒖쓣洹?? {item['description']}")

    for item in ss['dohwa']:
        patterns.append(f"?꾪솕?? {item['description']}")

    for item in ss['yeokma']:
        patterns.append(f"??쭏?? {item['description']}")

    for item in ss['hwagae']:
        patterns.append(f"?붽컻?? {item['description']}")

    return patterns


# =====================================================
# ?덉걶 異쒕젰 ?⑥닔
# =====================================================

def print_full_analysis(result):
    """遺꾩꽍 寃곌낵 ?덉걯寃?異쒕젰"""

    print("="*70)
    print("?꾩쟾???ъ＜ 遺꾩꽍 由ы룷??)
    print("="*70)

    bi = result['basic_info']
    print(f"\n?ъ＜: {bi['year']} {bi['month']} {bi['day']} {bi['hour']}")
    print(f"?쇨컙: {bi['day_stem']}")

    # 1. ?좉컯??    print("\n" + "?"*70)
    print("[ 1. ?좉컯??遺꾩꽍 ]")
    print("?"*70)

    strength = result['strength']
    print(f"?먯젙: {strength['strength']} ({strength['total_score']}/100??")
    print(f"?앸졊 (?붿?): {'O' if strength['deukryeong'] else 'X'}")
    print(f"?앹? (?쇱?): {'O' if strength['deukji'] else 'X'}")
    print(f"?앹꽭 (?몃젰): {'O' if strength['deukse'] else 'X'}")

    print(f"\n?먯닔 ?곸꽭:")
    for pos, info in strength['details'].items():
        char = info['char']
        ten_god = info['ten_god']
        score = info['score']
        print(f"  {pos:4s}: {char} ({ten_god:4s}) ??{score:+3d}??)

    # ??1-1. ?ㅽ뻾 遺꾪룷 異붽?
    print("\n" + "?"*70)
    print("[ 1-1. ?ㅽ뻾 遺꾪룷 ]")
    print("?"*70)

    element_count = result['summary']['element_count']
    element_names = {
        'wood': '???섎Т)', 'fire': '??遺?', 'earth': '????',
        'metal': '????', 'water': '麗?臾?'
    }

    for element, name in element_names.items():
        count = element_count.get(element, 0)
        print(f"  {name}: {count}媛?)

    # 2. ??꽦 遺꾪룷
    print("\n" + "?"*70)
    print("[ 2. ??꽦 遺꾪룷 ]")
    print("?"*70)

    tg_count = result['summary']['ten_gods_count']
    for tg, count in sorted(tg_count.items(), key=lambda x: x[1], reverse=True):
        print(f"  {tg}: {count}媛?)

    # 3. ?⑹땐
    print("\n" + "?"*70)
    print("[ 3. ?⑹땐 遺꾩꽍 ]")
    print("?"*70)

    hc = result['harmony_clash']

    if hc['cheongan_hap']:
        print("\n泥쒓컙??")
        for item in hc['cheongan_hap']:
            print(f"  ??{item['description']}")

    if hc['jiji_yukhap']:
        print("\n吏吏?≫빀:")
        for item in hc['jiji_yukhap']:
            print(f"  ??{item['description']}")

    if hc['jiji_samhap']:
        print("\n吏吏?쇳빀:")
        for item in hc['jiji_samhap']:
            print(f"  ??{item['description']}")

    if hc['jiji_banhap']:
        print("\n吏吏諛섑빀:")
        for item in hc['jiji_banhap']:
            print(f"  ??{item['description']}")

    if hc['cheongan_chung']:
        print("\n泥쒓컙異?")
        for item in hc['cheongan_chung']:
            print(f"  ??{item['description']}")

    if hc['jiji_chung']:
        print("\n吏吏異?")
        for item in hc['jiji_chung']:
            print(f"  ??{item['description']}")

    if not any([hc['cheongan_hap'], hc['jiji_yukhap'], hc['jiji_samhap'],
                hc['jiji_banhap'], hc['cheongan_chung'], hc['jiji_chung']]):
        print("  (?⑹땐 ?놁쓬)")

    # 4. ?좎궡
    print("\n" + "?"*70)
    print("[ 4. ?좎궡 遺꾩꽍 ]")
    print("?"*70)

    ss = result['sinsal']

    if ss['cheonul_gwiin']:
        print("\n泥쒖쓣洹??")
        for item in ss['cheonul_gwiin']:
            print(f"  ??{item['description']}")

    if ss['dohwa']:
        print("\n?꾪솕??")
        for item in ss['dohwa']:
            print(f"  ??{item['description']}")

    if ss['yeokma']:
        print("\n??쭏??")
        for item in ss['yeokma']:
            print(f"  ??{item['description']}")

    if ss['hwagae']:
        print("\n?붽컻??")
        for item in ss['hwagae']:
            print(f"  ??{item['description']}")

    if ss['wolgong']:
        print("\n?붽났:")
        for item in ss['wolgong']:
            print(f"  ??{item['description']}")

    if ss['munchang_gwiin']:
        print("\n臾몄갹洹??")
        for item in ss['munchang_gwiin']:
            print(f"  ??{item['description']}")

    if not any(ss.values()):
        print("  (?좎궡 ?놁쓬)")

    # 5. ?붿빟
    print("\n" + "="*70)
    print("[ ?붿빟 ]")
    print("="*70)

    summary = result['summary']
    print(f"\n?좉컯?? {summary['strength']} ({summary['strength_score']}??")
    print(f"?ㅽ뻾: {sum(summary['element_count'].values())}媛?)
    print(f"??꽦: {len(summary['ten_gods_count'])}醫낅쪟")
    print(f"?⑹땐: {sum(summary['harmony_clash_count'].values())}嫄?)
    print(f"?좎궡: {sum(summary['sinsal_count'].values())}媛?)

    print("\n" + "="*70)


# =====================================================
# ?뚯뒪??# =====================================================

def test_full_engine():
    """媛뺥븘???ъ＜濡??꾩껜 ?붿쭊 ?뚯뒪??""

    day_stem = '??
    pillars = {
        'year': '佯싪쒼',
        'month': '阿숅뀎',
        'day': '?멩쑋',
        'hour': '佯싩뵵'
    }

    result = analyze_full_saju(day_stem, pillars)
    print_full_analysis(result)


if __name__ == "__main__":
    test_full_engine()


----- FILE: backend\logic\saju_engine\core\harmony_clash.py -----
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
?꾩쟾???⑹땐 遺꾩꽍 ?붿쭊
- 泥쒓컙?? 泥쒓컙異?- 吏吏?≫빀, 吏吏?쇳빀, 吏吏諛섑빀, 吏吏異?- ?뺥뙆???쒖쇅
"""

# =====================================================
# 泥쒓컙 ?⑹땐 ?곗씠??# =====================================================

CHEONGAN_HAP = {
    ('??, '藥?): '??,
    ('藥?, '??): '??,
    ('阿?, '佯?): '湲?,
    ('佯?, '阿?): '湲?,
    ('訝?, '渦?): '??,
    ('渦?, '訝?): '??,
    ('訝?, '鶯?): '紐?,
    ('鶯?, '訝?): '紐?,
    ('??, '??): '??,
    ('??, '??): '??
}

CHEONGAN_CHUNG = [
    ('??, '佯?), ('佯?, '??),
    ('阿?, '渦?), ('渦?, '阿?),
    ('訝?, '鶯?), ('鶯?, '訝?),
    ('訝?, '??), ('??, '訝?)
]

# =====================================================
# 吏吏 ?⑹땐 ?곗씠??# =====================================================

# ?≫빀
JIJI_YUKHAP = [
    ('耶?, '訝?), ('訝?, '耶?),
    ('野?, '雅?), ('雅?, '野?),
    ('??, '??), ('??, '??),
    ('渦?, '??), ('??, '渦?),
    ('藥?, '??), ('??, '藥?),
    ('??, '??), ('??, '??)
]

# ?쇳빀
JIJI_SAMHAP = {
    '?녑춴渦??섍뎅': ['??, '耶?, '渦?],
    '野끻뜄???붽뎅': ['野?, '??, '??],
    '雅ε뜱??紐⑷뎅': ['雅?, '??, '??],
    '藥녜뀎訝?湲덇뎅': ['藥?, '??, '訝?]
}

# 諛섑빀 (?쇳빀??2媛?議고빀)
JIJI_BANHAP = [
    ('??, '耶?), ('耶?, '??),
    ('耶?, '渦?), ('渦?, '耶?),
    ('??, '渦?), ('渦?, '??),
    ('野?, '??), ('??, '野?),
    ('??, '??), ('??, '??),
    ('野?, '??), ('??, '野?),
    ('雅?, '??), ('??, '雅?),
    ('??, '??), ('??, '??),
    ('雅?, '??), ('??, '雅?),
    ('藥?, '??), ('??, '藥?),
    ('??, '訝?), ('訝?, '??),
    ('藥?, '訝?), ('訝?, '藥?)
]

# 異?JIJI_CHUNG = [
    ('耶?, '??), ('??, '耶?),
    ('訝?, '??), ('??, '訝?),
    ('野?, '??), ('??, '野?),
    ('??, '??), ('??, '??),
    ('渦?, '??), ('??, '渦?),
    ('藥?, '雅?), ('雅?, '藥?)
]

# =====================================================
# ?⑹땐 遺꾩꽍 ?⑥닔
# =====================================================

def analyze_harmony_clash(pillars):
    """
    ?꾩쟾???⑹땐 遺꾩꽍
    
    Args:
        pillars: {
            'year': '佯싪쒼',
            'month': '阿숅뀎',
            'day': '?멩쑋',
            'hour': '佯싩뵵'
        }
    
    Returns:
        {
            'cheongan_hap': [...],
            'cheongan_chung': [...],
            'jiji_yukhap': [...],
            'jiji_samhap': [...],
            'jiji_banhap': [...],
            'jiji_chung': [...]
        }
    """
    
    # 遺꾪빐
    stems = [
        pillars['year'][0],   # ?꾧컙
        pillars['month'][0],  # ?붽컙
        pillars['day'][0],    # ?쇨컙
        pillars['hour'][0]    # ?쒓컙
    ]
    
    branches = [
        pillars['year'][1],   # ?꾩?
        pillars['month'][1],  # ?붿?
        pillars['day'][1],    # ?쇱?
        pillars['hour'][1]    # ?쒖?
    ]
    
    positions = ['??, '??, '??, '??]
    
    result = {
        'cheongan_hap': [],
        'cheongan_chung': [],
        'jiji_yukhap': [],
        'jiji_samhap': [],
        'jiji_banhap': [],
        'jiji_chung': []
    }
    
    # 1. 泥쒓컙??    for i in range(len(stems)):
        for j in range(i+1, len(stems)):
            pair = (stems[i], stems[j])
            if pair in CHEONGAN_HAP:
                result['cheongan_hap'].append({
                    'position': f"{positions[i]}-{positions[j]}",
                    'chars': f"{stems[i]}{stems[j]}",
                    'element': CHEONGAN_HAP[pair],
                    'description': f"{positions[i]}媛?{stems[i]} + {positions[j]}媛?{stems[j]} ??{CHEONGAN_HAP[pair]}??
                })
    
    # 2. 泥쒓컙異?    for i in range(len(stems)):
        for j in range(i+1, len(stems)):
            pair = (stems[i], stems[j])
            if pair in CHEONGAN_CHUNG:
                result['cheongan_chung'].append({
                    'position': f"{positions[i]}-{positions[j]}",
                    'chars': f"{stems[i]}{stems[j]}",
                    'description': f"{positions[i]}媛?{stems[i]} + {positions[j]}媛?{stems[j]} 異⑸룎"
                })
    
    # 3. 吏吏?≫빀
    for i in range(len(branches)):
        for j in range(i+1, len(branches)):
            pair = (branches[i], branches[j])
            if pair in JIJI_YUKHAP:
                result['jiji_yukhap'].append({
                    'position': f"{positions[i]}-{positions[j]}",
                    'chars': f"{branches[i]}{branches[j]}",
                    'description': f"{positions[i]}吏 {branches[i]} + {positions[j]}吏 {branches[j]} ?≫빀"
                })
    
    # 4. 吏吏?쇳빀
    for name, members in JIJI_SAMHAP.items():
        present = [br for br in branches if br in members]
        if len(present) >= 2:
            result['jiji_samhap'].append({
                'name': name,
                'chars': ', '.join(present),
                'count': len(present),
                'complete': len(present) == 3,
                'description': f"{name} ({'?꾩쟾' if len(present) == 3 else '諛섑빀'}: {', '.join(present)})"
            })
    
    # 5. 吏吏諛섑빀
    for i in range(len(branches)):
        for j in range(i+1, len(branches)):
            pair = (branches[i], branches[j])
            if pair in JIJI_BANHAP:
                result['jiji_banhap'].append({
                    'position': f"{positions[i]}-{positions[j]}",
                    'chars': f"{branches[i]}{branches[j]}",
                    'description': f"{positions[i]}吏 {branches[i]} + {positions[j]}吏 {branches[j]} 諛섑빀"
                })
    
    # 6. 吏吏異?    for i in range(len(branches)):
        for j in range(i+1, len(branches)):
            pair = (branches[i], branches[j])
            if pair in JIJI_CHUNG:
                result['jiji_chung'].append({
                    'position': f"{positions[i]}-{positions[j]}",
                    'chars': f"{branches[i]}{branches[j]}",
                    'description': f"{positions[i]}吏 {branches[i]} + {positions[j]}吏 {branches[j]} 異⑸룎"
                })
    
    return result


# =====================================================
# ?뚯뒪??# =====================================================

def test_harmony_clash():
    """媛뺥븘???ъ＜ ?뚯뒪??""
    
    pillars = {
        'year': '佯싪쒼',
        'month': '阿숅뀎',
        'day': '?멩쑋',
        'hour': '佯싩뵵'
    }
    
    print("="*60)
    print("?꾩쟾???⑹땐 遺꾩꽍 (?뺥뙆???쒖쇅)")
    print("="*60)
    print(f"?ъ＜: {pillars['year']} {pillars['month']} {pillars['day']} {pillars['hour']}")
    print("="*60)
    
    result = analyze_harmony_clash(pillars)
    
    print("\n[泥쒓컙??")
    if result['cheongan_hap']:
        for item in result['cheongan_hap']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[泥쒓컙異?")
    if result['cheongan_chung']:
        for item in result['cheongan_chung']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[吏吏?≫빀]")
    if result['jiji_yukhap']:
        for item in result['jiji_yukhap']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[吏吏?쇳빀]")
    if result['jiji_samhap']:
        for item in result['jiji_samhap']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[吏吏諛섑빀]")
    if result['jiji_banhap']:
        for item in result['jiji_banhap']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[吏吏異?")
    if result['jiji_chung']:
        for item in result['jiji_chung']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n" + "="*60)
    print("?붿빟")
    print("="*60)
    print(f"泥쒓컙?? {len(result['cheongan_hap'])}嫄?)
    print(f"泥쒓컙異? {len(result['cheongan_chung'])}嫄?)
    print(f"吏吏?≫빀: {len(result['jiji_yukhap'])}嫄?)
    print(f"吏吏?쇳빀: {len(result['jiji_samhap'])}嫄?)
    print(f"吏吏諛섑빀: {len(result['jiji_banhap'])}嫄?)
    print(f"吏吏異? {len(result['jiji_chung'])}嫄?)


if __name__ == "__main__":
    test_harmony_clash()


----- FILE: backend\logic\saju_engine\core\sinsal.py -----
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
?좎궡 遺꾩꽍 ?붿쭊
二쇱슂 ?좎궡: 泥쒖쓣洹?? ?꾪솕?? ??쭏?? ?붽났, 臾몄갹洹????"""

# =====================================================
# ?좎궡 ?곗씠??# =====================================================

# 泥쒖쓣洹??(?쇨컙 湲곗?)
CHEONUL_GWIIN = {
    '??: ['訝?, '??],
    '阿?: ['耶?, '??],
    '訝?: ['雅?, '??],
    '訝?: ['雅?, '??],
    '??: ['訝?, '??],
    '藥?: ['耶?, '??],
    '佯?: ['訝?, '??],
    '渦?: ['野?, '??],
    '鶯?: ['??, '藥?],
    '??: ['??, '藥?]
}

# ?꾪솕??(?쇱?/?꾩? 湲곗?)
DOHWA = {
    '耶?: '??,
    '??: '??,
    '??: '耶?,
    '??: '??,
    '野?: '雅?,
    '??: '藥?,
    '藥?: '??,
    '雅?: '野?,
    '渦?: '??,
    '??: '??,
    '訝?: '??,
    '??: '耶?
}

# ??쭏??(?꾩? 湲곗?)
YEOKMA = {
    '耶?: '野?,
    '??: '??,
    '??: '藥?,
    '??: '雅?,
    '野?: '??,
    '??: '野?,
    '藥?: '雅?,
    '雅?: '藥?,
    '渦?: '野?,
    '??: '??,
    '訝?: '雅?,
    '??: '藥?
}

# ?붽컻??(?쇱?/?꾩? 湲곗?)
HWAGAE = {
    '耶?: '渦?,
    '??: '??,
    '??: '??,
    '??: '訝?,
    '野?: '??,
    '??: '渦?,
    '藥?: '訝?,
    '雅?: '??,
    '渦?: '渦?,
    '??: '??,
    '訝?: '訝?,
    '??: '??
}

# ?붽났 (?붿? + 泥쒓컙 議고빀)
WOLGONG = {
    '耶?: ['訝?],
    '訝?: ['訝?],
    '野?: ['鶯?],
    '??: ['佯?],
    '渦?: ['鶯?],
    '藥?: ['??],
    '??: ['鶯?],
    '??: ['佯?],
    '??: ['訝?],
    '??: ['??],
    '??: ['鶯?],
    '雅?: ['佯?]
}

# 臾몄갹洹??(?쇨컙 湲곗?)
MUNCHANG_GWIIN = {
    '??: ['藥?],
    '阿?: ['??],
    '訝?: ['??],
    '訝?: ['??],
    '??: ['??],
    '藥?: ['??],
    '佯?: ['雅?],
    '渦?: ['耶?],
    '鶯?: ['野?],
    '??: ['??]
}

# =====================================================
# ?좎궡 遺꾩꽍 ?⑥닔
# =====================================================

def analyze_sinsal(day_stem, pillars):
    """
    ?좎궡 遺꾩꽍
    
    Args:
        day_stem: ?쇨컙 (?? '??)
        pillars: {
            'year': '佯싪쒼',
            'month': '阿숅뀎',
            'day': '?멩쑋',
            'hour': '佯싩뵵'
        }
    
    Returns:
        {
            'cheonul_gwiin': [...],
            'dohwa': [...],
            'yeokma': [...],
            'hwagae': [...],
            'wolgong': [...],
            'munchang_gwiin': [...]
        }
    """
    
    # 遺꾪빐
    stems = [
        pillars['year'][0],
        pillars['month'][0],
        pillars['day'][0],
        pillars['hour'][0]
    ]
    
    branches = [
        pillars['year'][1],
        pillars['month'][1],
        pillars['day'][1],
        pillars['hour'][1]
    ]
    
    year_branch = pillars['year'][1]
    month_branch = pillars['month'][1]
    day_branch = pillars['day'][1]
    
    positions = ['??, '??, '??, '??]
    
    result = {
        'cheonul_gwiin': [],
        'dohwa': [],
        'yeokma': [],
        'hwagae': [],
        'wolgong': [],
        'munchang_gwiin': []
    }
    
    # 1. 泥쒖쓣洹??(?쇨컙 湲곗?)
    gwiin_branches = CHEONUL_GWIIN.get(day_stem, [])
    for i, branch in enumerate(branches):
        if branch in gwiin_branches:
            result['cheonul_gwiin'].append({
                'position': f"{positions[i]}吏",
                'char': branch,
                'description': f"泥쒖쓣洹??({positions[i]}吏 {branch})"
            })
    
    # 2. ?꾪솕??(?쇱? 湲곗?)
    dohwa_branch = DOHWA.get(day_branch)
    if dohwa_branch:
        for i, branch in enumerate(branches):
            if branch == dohwa_branch:
                result['dohwa'].append({
                    'position': f"{positions[i]}吏",
                    'char': branch,
                    'description': f"?꾪솕??({positions[i]}吏 {branch})"
                })
    
    # 3. ??쭏??(?꾩? 湲곗?)
    yeokma_branch = YEOKMA.get(year_branch)
    if yeokma_branch:
        for i, branch in enumerate(branches):
            if branch == yeokma_branch:
                result['yeokma'].append({
                    'position': f"{positions[i]}吏",
                    'char': branch,
                    'description': f"??쭏??({positions[i]}吏 {branch})"
                })
    
    # 4. ?붽컻??(?쇱? 湲곗?)
    hwagae_branch = HWAGAE.get(day_branch)
    if hwagae_branch:
        for i, branch in enumerate(branches):
            if branch == hwagae_branch:
                result['hwagae'].append({
                    'position': f"{positions[i]}吏",
                    'char': branch,
                    'description': f"?붽컻??({positions[i]}吏 {branch})"
                })
    
    # 5. ?붽났 (?붿? + 泥쒓컙 議고빀)
    wolgong_stems = WOLGONG.get(month_branch, [])
    for i, stem in enumerate(stems):
        if stem in wolgong_stems:
            result['wolgong'].append({
                'position': f"{positions[i]}媛?,
                'char': stem,
                'description': f"?붽났 (?붿? {month_branch} + {positions[i]}媛?{stem})"
            })
    
    # 6. 臾몄갹洹??(?쇨컙 湲곗?)
    munchang_branches = MUNCHANG_GWIIN.get(day_stem, [])
    for i, branch in enumerate(branches):
        if branch in munchang_branches:
            result['munchang_gwiin'].append({
                'position': f"{positions[i]}吏",
                'char': branch,
                'description': f"臾몄갹洹??({positions[i]}吏 {branch})"
            })
    
    return result


# =====================================================
# ?뚯뒪??# =====================================================

def test_sinsal():
    """媛뺥븘???ъ＜ ?뚯뒪??""
    
    day_stem = '??
    pillars = {
        'year': '佯싪쒼',
        'month': '阿숅뀎',
        'day': '?멩쑋',
        'hour': '佯싩뵵'
    }
    
    print("="*60)
    print("?좎궡 遺꾩꽍")
    print("="*60)
    print(f"?ъ＜: {pillars['year']} {pillars['month']} {pillars['day']} {pillars['hour']}")
    print(f"?쇨컙: {day_stem} (怨꾩닔)")
    print("="*60)
    
    result = analyze_sinsal(day_stem, pillars)
    
    print("\n[泥쒖쓣洹?? - ?섎뒛????? 怨좉껐???덉꽦, ?щ궃 蹂댄샇")
    if result['cheonul_gwiin']:
        for item in result['cheonul_gwiin']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[?꾪솕?? - ?댁꽦 留ㅻ젰, ?덉닠??媛먭컖, ?멸린")
    if result['dohwa']:
        for item in result['dohwa']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[??쭏?? - ?대룞, 蹂?? ?쒕룞??)
    if result['yeokma']:
        for item in result['yeokma']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[?붽컻?? - 醫낃탳, 泥좏븰, ?덉닠, 怨좊룆")
    if result['hwagae']:
        for item in result['hwagae']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[?붽났] - 二쇰ぉ, ?멸린, ?以묒꽦")
    if result['wolgong']:
        for item in result['wolgong']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n[臾몄갹洹?? - ?숇Ц, 臾몄옣?? 李쎌쓽??)
    if result['munchang_gwiin']:
        for item in result['munchang_gwiin']:
            print(f"  ??{item['description']}")
    else:
        print("  (?놁쓬)")
    
    print("\n" + "="*60)
    print("?붿빟")
    print("="*60)
    print(f"泥쒖쓣洹?? {len(result['cheonul_gwiin'])}媛?)
    print(f"?꾪솕?? {len(result['dohwa'])}媛?)
    print(f"??쭏?? {len(result['yeokma'])}媛?)
    print(f"?붽컻?? {len(result['hwagae'])}媛?)
    print(f"?붽났: {len(result['wolgong'])}媛?)
    print(f"臾몄갹洹?? {len(result['munchang_gwiin'])}媛?)
    
    total = sum([
        len(result['cheonul_gwiin']),
        len(result['dohwa']),
        len(result['yeokma']),
        len(result['hwagae']),
        len(result['wolgong']),
        len(result['munchang_gwiin'])
    ])
    
    print(f"\n珥??좎궡: {total}媛?)


if __name__ == "__main__":
    test_sinsal()


----- FILE: backend\logic\saju_engine\core\strength.py -----
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
?좉컯???먮퀎 濡쒖쭅 (?먯닔??諛⑹떇)
媛뺥븘???쒓났 ?먮즺 湲곕컲
"""

from .ten_gods import calculate_ten_god, get_element

# =====================================================
# ?먯닔 湲곗? (?먮즺 湲곕컲)
# =====================================================

SCORE_TABLE = {
    "?꾧컙": 8,
    "?꾩?": 8,
    "?붽컙": 12,
    "?붿?": 25,  # 媛??以묒슂!
    "?쇨컙": 0,   # 湲곗??먯씠誘濡?怨꾩궛 ????    "?쇱?": 20,  # ??踰덉㎏濡?以묒슂
    "?쒓컙": 12,
    "?쒖?": 15
}

# =====================================================
# ?좉컯???먮퀎 ?⑥닔
# =====================================================

def calculate_strength_score(day_stem, pillars):
    """
    ?좉컯???먯닔 怨꾩궛
    
    Args:
        day_stem: ?쇨컙 (?? '??)
        pillars: {
            'year': '佯싪쒼',
            'month': '阿숅뀎',
            'day': '?멩쑋',
            'hour': '佯싩뵵'
        }
    
    Returns:
        {
            'total_score': ?먯닔 ?⑷퀎,
            'strength': '?좉컯' | '以묓솕' | '?좎빟',
            'details': 媛??먮━蹂??먯닔 ?곸꽭,
            'deukryeong': True/False (?붿? ?앸졊 ?щ?),
            'deukji': True/False (?쇱? ?앹? ?щ?),
            'deukse': True/False (?몃젰 ?앹꽭 ?щ?)
        }
    """
    
    # 媛??먮━ 遺꾪빐
    positions = {
        '?꾧컙': pillars['year'][0],
        '?꾩?': pillars['year'][1],
        '?붽컙': pillars['month'][0],
        '?붿?': pillars['month'][1],
        '?쇨컙': day_stem,
        '?쇱?': pillars['day'][1],
        '?쒓컙': pillars['hour'][0],
        '?쒖?': pillars['hour'][1]
    }
    
    total_score = 0
    details = {}
    
    # ?몄꽦쨌鍮꾧쾪 移댁슫??(?앹꽭 ?먮퀎??
    inseong_bigap_count = 0
    siksang_jaeseong_gwanseong_count = 0
    
    for pos, char in positions.items():
        if pos == '?쇨컙':
            continue  # ?쇨컙? 湲곗??대?濡??먯닔 怨꾩궛 ????        
        ten_god = calculate_ten_god(day_stem, char)
        score_base = SCORE_TABLE[pos]
        
        # ?몄꽦쨌鍮꾧쾪?대㈃ +?먯닔, ?앹긽쨌?ъ꽦쨌愿?깆씠硫?0??        if ten_god in ['?뺤씤', '?몄씤', '鍮꾧껄', '寃곸옱']:
            score = score_base
            inseong_bigap_count += 1
        elif ten_god in ['?앹떊', '?곴?', '?뺤옱', '?몄옱', '?뺢?', '?멸?']:
            score = 0  # 留덉씠?덉뒪 ?꾨떂! 0??
            siksang_jaeseong_gwanseong_count += 1
        else:
            score = 0
        
        total_score += score
        
        details[pos] = {
            'char': char,
            'ten_god': ten_god,
            'score': score
        }
    
    # ?앸졊쨌?앹?쨌?앹꽭 ?먮퀎
    deukryeong = details['?붿?']['ten_god'] in ['?뺤씤', '?몄씤', '鍮꾧껄', '寃곸옱']
    deukji = details['?쇱?']['ten_god'] in ['?뺤씤', '?몄씤', '鍮꾧껄', '寃곸옱']
    
    # ?앹꽭: ?몄꽦쨌鍮꾧쾪???덈컲 ?댁긽
    total_positions = inseong_bigap_count + siksang_jaeseong_gwanseong_count
    deukse = inseong_bigap_count >= (total_positions / 2) if total_positions > 0 else False
    
    # ?좉컯쨌?좎빟 ?먮떒
    # 100??留뚯젏 湲곗? (?몄꽦쨌鍮꾧쾪留??먯닔瑜?以?
    if total_score >= 60:
        strength = '?좉컯'
    elif total_score >= 40:
        strength = '以묓솕'
    else:
        strength = '?좎빟'
    
    return {
        'total_score': total_score,
        'strength': strength,
        'details': details,
        'deukryeong': deukryeong,
        'deukji': deukji,
        'deukse': deukse,
        'inseong_bigap_count': inseong_bigap_count,
        'siksang_count': siksang_jaeseong_gwanseong_count
    }


# =====================================================
# ?앸졊쨌?앹?쨌?앹꽭 議고빀 遺꾩꽍
# =====================================================

def analyze_strength_combination(deukryeong, deukji, deukse):
    """
    ?앸졊쨌?앹?쨌?앹꽭 議고빀?쇰줈 ?좉컯???먮퀎
    
    Args:
        deukryeong: ?앸졊 ?щ? (bool)
        deukji: ?앹? ?щ? (bool)
        deukse: ?앹꽭 ?щ? (bool)
    
    Returns:
        ?먮떒 寃곌낵 臾몄옄??    """
    
    combinations = {
        (True, True, True): "?좉컯 (媛??媛뺥븿)",
        (True, True, False): "?좉컯 (?붿?쨌?쇱? ?곹뼢 ??",
        (True, False, True): "?좉컯 (?붿?? ?몃젰 ?곗꽭)",
        (True, False, False): "以묓솕 ?먮뒗 ?쏀븳 ?좉컯",
        (False, True, True): "以묓솕 ?먮뒗 ?쏀븳 ?좉컯",
        (False, True, False): "?좎빟 (?붿? 遺?? ?몃젰 ?쏀븿)",
        (False, False, True): "?좎빟 (?붿?쨌?쇱? 遺??",
        (False, False, False): "?좎빟 (媛???쏀븿, 洹뱀떊??"
    }
    
    return combinations.get((deukryeong, deukji, deukse), "?먮떒 遺덇?")


# =====================================================
# ?뚯뒪?? 媛뺥븘???ъ＜
# =====================================================

def test_strength_analysis():
    """媛뺥븘???ъ＜ ?좉컯??遺꾩꽍"""
    
    day_stem = '??
    pillars = {
        'year': '佯싪쒼',
        'month': '阿숅뀎',
        'day': '?멩쑋',
        'hour': '佯싩뵵'
    }
    
    print("="*60)
    print("?좉컯???먮퀎 遺꾩꽍")
    print("="*60)
    print(f"?ъ＜: {pillars['year']} {pillars['month']} {pillars['day']} {pillars['hour']}")
    print(f"?쇨컙: {day_stem} (怨꾩닔)")
    print("="*60)
    
    result = calculate_strength_score(day_stem, pillars)
    
    print("\n[?먯닔 ?곸꽭]")
    print("-"*60)
    for pos, info in result['details'].items():
        char = info['char']
        ten_god = info['ten_god']
        score = info['score']
        sign = "+" if score >= 0 else ""
        print(f"{pos}: {char} ({ten_god}) ??{sign}{score}??)
    
    print("\n[?앸졊쨌?앹?쨌?앹꽭]")
    print("-"*60)
    print(f"?앸졊 (?붿?): {'O' if result['deukryeong'] else 'X'}")
    print(f"?앹? (?쇱?): {'O' if result['deukji'] else 'X'}")
    print(f"?앹꽭 (?몃젰): {'O' if result['deukse'] else 'X'}")
    
    combination_result = analyze_strength_combination(
        result['deukryeong'],
        result['deukji'],
        result['deukse']
    )
    
    print(f"\n議고빀 ?먮떒: {combination_result}")
    
    print("\n[理쒖쥌 寃곌낵]")
    print("-"*60)
    print(f"珥앹젏: {result['total_score']}??)
    print(f"?먮떒: {result['strength']}")
    
    print("\n[?듦퀎]")
    print("-"*60)
    print(f"?몄꽦쨌鍮꾧쾪: {result['inseong_bigap_count']}媛?)
    print(f"?앹긽쨌?ъ꽦쨌愿?? {result['siksang_count']}媛?)
    
    # ?댁꽍
    print("\n[?댁꽍]")
    print("-"*60)
    if result['strength'] == '?좉컯':
        print("???좉컯: ?먮꼫吏 怨듦툒??異⑸텇??)
        print("   ???앹긽쨌?ъ꽦쨌愿???댁씠 ?좊━")
        print("   ???쒕룞?곸씠怨??곴레?곸씤 ??沅뚯옣")
    elif result['strength'] == '?좎빟':
        print("???좎빟: ?먮꼫吏 ?뚮え媛 ?곗꽭??)
        print("   ???몄꽦쨌鍮꾧쾪 ?댁씠 ?좊━")
        print("   ???댁떇怨?蹂댁땐???꾩슂, 臾대━???쒕룞 吏??)
    else:
        print("??以묓솕: ?먮꼫吏 洹좏삎???곸젅??)
        print("   ??媛???댁긽?곸씤 ?곹깭")
        print("   ????댁뿉 ?곕씪 ?좎뿰?섍쾶 ???)


if __name__ == "__main__":
    test_strength_analysis()


----- FILE: backend\logic\saju_engine\core\ten_gods.py -----
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
?щ컮瑜???꽦 怨꾩궛 濡쒖쭅 (泥댁슜諛섎? 洹쒖튃 ?곸슜)
"""

# =====================================================
# 湲곕낯 ?곗씠??# =====================================================

# 泥쒓컙 ?뚯뼇
HEAVENLY_STEM_POLARITY = {
    '??: 'yang', '阿?: 'yin',
    '訝?: 'yang', '訝?: 'yin',
    '??: 'yang', '藥?: 'yin',
    '佯?: 'yang', '渦?: 'yin',
    '鶯?: 'yang', '??: 'yin'
}

# 吏吏 ?뚯뼇 (湲곕낯)
EARTHLY_BRANCH_POLARITY_BASE = {
    '耶?: 'yang', '訝?: 'yin',
    '野?: 'yang', '??: 'yin',
    '渦?: 'yang', '藥?: 'yin',
    '??: 'yang', '??: 'yin',
    '??: 'yang', '??: 'yin',
    '??: 'yang', '雅?: 'yin'
}

# 狩?泥댁슜諛섎?(遙붺뵪?띶컢) ?덉쇅 洹쒖튃
SPECIAL_POLARITY_REVERSE = {
    '??: 'yin',  # ?묒? ???뚯쑝濡?痍④툒
    '藥?: 'yang', # ?뚯? ???묒쑝濡?痍④툒
    '耶?: 'yin',  # ?묒? ???뚯쑝濡?痍④툒
    '雅?: 'yang'  # ?뚯? ???묒쑝濡?痍④툒
}

# ?ㅽ뻾
ELEMENT_MAP = {
    '??: 'wood', '阿?: 'wood', '野?: 'wood', '??: 'wood',
    '訝?: 'fire', '訝?: 'fire', '藥?: 'fire', '??: 'fire',
    '??: 'earth', '藥?: 'earth', '渦?: 'earth', '??: 'earth', '訝?: 'earth', '??: 'earth',
    '佯?: 'metal', '渦?: 'metal', '??: 'metal', '??: 'metal',
    '鶯?: 'water', '??: 'water', '耶?: 'water', '雅?: 'water'
}

# ?ㅽ뻾 ?곸깮?곴레
PRODUCES = {
    'wood': 'fire',
    'fire': 'earth',
    'earth': 'metal',
    'metal': 'water',
    'water': 'wood'
}

CONTROLS = {
    'wood': 'earth',
    'fire': 'metal',
    'earth': 'water',
    'metal': 'wood',
    'water': 'fire'
}

# =====================================================
# ??꽦 怨꾩궛 ?⑥닔
# =====================================================

def get_polarity(char):
    """
    ?뚯뼇 ?먮퀎 (泥댁슜諛섎? 洹쒖튃 ?곸슜)
    """
    # 泥쒓컙??寃쎌슦
    if char in HEAVENLY_STEM_POLARITY:
        return HEAVENLY_STEM_POLARITY[char]
    
    # 吏吏??寃쎌슦 - 泥댁슜諛섎? ?곗꽑 ?뺤씤
    if char in SPECIAL_POLARITY_REVERSE:
        return SPECIAL_POLARITY_REVERSE[char]
    
    # ?쇰컲 吏吏
    if char in EARTHLY_BRANCH_POLARITY_BASE:
        return EARTHLY_BRANCH_POLARITY_BASE[char]
    
    return None


def get_element(char):
    """?ㅽ뻾 ?먮퀎"""
    return ELEMENT_MAP.get(char)


def calculate_ten_god(day_stem, target_char):
    """
    ??꽦 怨꾩궛 (泥댁슜諛섎? 洹쒖튃 ?곸슜)
    
    Args:
        day_stem: ?쇨컙 (泥쒓컙)
        target_char: ???湲??(泥쒓컙 ?먮뒗 吏吏)
    
    Returns:
        ??꽦 ?대쫫 (鍮꾧껄, 寃곸옱, ?앹떊, ?곴?, ?몄옱, ?뺤옱, ?멸?, ?뺢?, ?몄씤, ?뺤씤)
    """
    day_element = get_element(day_stem)
    target_element = get_element(target_char)
    
    if not day_element or not target_element:
        return "?????놁쓬"
    
    # 狩?泥댁슜諛섎? 洹쒖튃 ?곸슜???뚯뼇 ?먮퀎
    day_polarity = get_polarity(day_stem)
    target_polarity = get_polarity(target_char)
    
    same_polarity = (day_polarity == target_polarity)
    
    # ??꽦 寃곗젙
    if day_element == target_element:
        # 媛숈? ?ㅽ뻾
        return "鍮꾧껄" if same_polarity else "寃곸옱"
    
    elif PRODUCES[day_element] == target_element:
        # ?쇨컙???앺븯???ㅽ뻾 (?앹긽)
        return "?앹떊" if same_polarity else "?곴?"
    
    elif PRODUCES[target_element] == day_element:
        # ?쇨컙???앺븯???ㅽ뻾 (?몄꽦)
        return "?뺤씤" if not same_polarity else "?몄씤"
    
    elif CONTROLS[day_element] == target_element:
        # ?쇨컙??洹뱁븯???ㅽ뻾 (?ъ꽦)
        return "?몄옱" if same_polarity else "?뺤옱"
    
    elif CONTROLS[target_element] == day_element:
        # ?쇨컙??洹뱁븯???ㅽ뻾 (愿??
        return "?멸?" if same_polarity else "?뺢?"
    
    return "?????놁쓬"


# =====================================================
# ?뚯뒪?? ?멩객 ?쇨컙
# =====================================================

def test_guisu():
    """?멩객 ?쇨컙 ??꽦 ?뚯뒪??""
    
    day_stem = '??
    
    print("="*60)
    print("??꽦 怨꾩궛 ?뚯뒪??(泥댁슜諛섎? 洹쒖튃 ?곸슜)")
    print("="*60)
    print(f"?쇨컙: {day_stem} (怨꾩닔, ??")
    print("="*60)
    
    # ?뚯뒪??耳?댁뒪
    test_cases = [
        ('??, 'wood', 'yang', '?곴?'),
        ('阿?, 'wood', 'yin', '?앹떊'),
        ('訝?, 'fire', 'yang', '?뺤옱'),
        ('訝?, 'fire', 'yin', '?몄옱'),
        ('佯?, 'metal', 'yang', '?뺤씤'),
        ('渦?, 'metal', 'yin', '?몄씤'),
        ('野?, 'wood', 'yang', '?곴?'),
        ('??, 'wood', 'yin', '?앹떊'),
        ('藥?, 'fire', 'yang(泥댁슜諛섎?)', '?뺤옱'),
        ('??, 'fire', 'yin(泥댁슜諛섎?)', '?몄옱'),
        ('耶?, 'water', 'yin(泥댁슜諛섎?)', '鍮꾧껄'),
        ('雅?, 'water', 'yang(泥댁슜諛섎?)', '寃곸옱'),
        ('??, 'metal', 'yang', '?뺤씤'),
        ('??, 'metal', 'yin', '?몄씤'),
    ]
    
    print("\n泥쒓컙 ?뚯뒪??")
    print("-"*60)
    for char, element, polarity, expected in test_cases[:6]:
        result = calculate_ten_god(day_stem, char)
        status = "?? if result == expected else "??
        actual_pol = get_polarity(char)
        print(f"{status} {char}({element}, {polarity}) ??{result} (?덉긽: {expected})")
    
    print("\n吏吏 ?뚯뒪??(?쇰컲):")
    print("-"*60)
    for char, element, polarity, expected in test_cases[6:8]:
        result = calculate_ten_god(day_stem, char)
        status = "?? if result == expected else "??
        actual_pol = get_polarity(char)
        print(f"{status} {char}({element}, {polarity}) ??{result} (?덉긽: {expected})")
    
    print("\n吏吏 ?뚯뒪??(泥댁슜諛섎? 洹쒖튃 ?곸슜):")
    print("-"*60)
    for char, element, polarity, expected in test_cases[8:]:
        result = calculate_ten_god(day_stem, char)
        status = "?? if result == expected else "??
        actual_pol = get_polarity(char)
        print(f"{status} {char}({element}, {polarity}) ??{result} (?덉긽: {expected})")


# =====================================================
# ?ㅼ젣 ?ъ＜ ?뚯뒪??# =====================================================

def test_actual_saju():
    """?ㅼ젣 ?ъ＜ ?뚯뒪?? 佯싪쒼 阿숅뀎 ?멩쑋 佯싩뵵"""
    
    print("\n\n" + "="*60)
    print("?ㅼ젣 ?ъ＜ ??꽦 遺꾩꽍")
    print("="*60)
    print("?ъ＜: 佯싪쒼 阿숅뀎 ?멩쑋 佯싩뵵")
    print("?쇨컙: ??(怨꾩닔)")
    print("="*60)
    
    day_stem = '??
    
    pillars = [
        ('?꾧컙', '佯?),
        ('?꾩?', '渦?),
        ('?붽컙', '阿?),
        ('?붿?', '??),
        ('?쇨컙', '??),
        ('?쇱?', '??),
        ('?쒓컙', '佯?),
        ('?쒖?', '??),
    ]
    
    print("\n??꽦 遺꾪룷:")
    print("-"*60)
    
    ten_gods_count = {}
    
    for position, char in pillars:
        if position == '?쇨컙':
            print(f"{position}: {char} ??(?쇨컙 ?먯껜)")
            continue
        
        ten_god = calculate_ten_god(day_stem, char)
        element = get_element(char)
        polarity = get_polarity(char)
        
        # 泥댁슜諛섎? ?쒖떆
        is_special = char in SPECIAL_POLARITY_REVERSE
        special_mark = " 狩먯껜?⑸컲?" if is_special else ""
        
        print(f"{position}: {char}({element}, {polarity}{special_mark}) ??{ten_god}")
        
        # 移댁슫??        ten_gods_count[ten_god] = ten_gods_count.get(ten_god, 0) + 1
    
    print("\n??꽦 ?듦퀎:")
    print("-"*60)
    for tg, count in sorted(ten_gods_count.items(), key=lambda x: x[1], reverse=True):
        print(f"{tg}: {count}媛?)


if __name__ == "__main__":
    test_guisu()
    test_actual_saju()


----- FILE: backend\logic\saju_engine\core\__init__.py -----
=== END ===
