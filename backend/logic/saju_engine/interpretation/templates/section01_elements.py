#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ì„¹ì…˜ 1: ì˜¤í–‰ ì—ë„ˆì§€ ë¶„ì„ í…œí”Œë¦¿
"""

# =====================================================
# í—¬í¼ í•¨ìˆ˜
# =====================================================

def count_element(analysis, element):
    """íŠ¹ì • ì˜¤í–‰ ê°œìˆ˜ ì„¸ê¸°"""
    element_map = {
        'ëª©': ['ç”²', 'ä¹™', 'å¯…', 'å¯'],
        'í™”': ['ä¸™', 'ä¸', 'å·³', 'åˆ'],
        'í† ': ['æˆŠ', 'å·±', 'è¾°', 'æˆŒ', 'ä¸‘', 'æœª'],
        'ê¸ˆ': ['åºš', 'è¾›', 'ç”³', 'é…‰'],
        'ìˆ˜': ['å£¬', 'ç™¸', 'å­', 'äº¥']
    }
    
    chars = element_map.get(element, [])
    pillars = analysis['basic_info']
    all_chars = [
        pillars['year'][0], pillars['year'][1],
        pillars['month'][0], pillars['month'][1],
        pillars['day'][1],
        pillars['hour'][0], pillars['hour'][1]
    ]
    
    return sum(1 for c in all_chars if c in chars)


def get_day_stem_name(stem):
    """ì¼ê°„ ì´ë¦„"""
    names = {
        'ç”²': 'ê°‘ëª©', 'ä¹™': 'ì„ëª©',
        'ä¸™': 'ë³‘í™”', 'ä¸': 'ì •í™”',
        'æˆŠ': 'ë¬´í† ', 'å·±': 'ê¸°í† ',
        'åºš': 'ê²½ê¸ˆ', 'è¾›': 'ì‹ ê¸ˆ',
        'å£¬': 'ì„ìˆ˜', 'ç™¸': 'ê³„ìˆ˜'
    }
    return names.get(stem, stem)


def get_missing_elements(analysis):
    """ê²°í•ëœ ì˜¤í–‰ ì°¾ê¸°"""
    missing = []
    for element in ['ëª©', 'í™”', 'í† ', 'ê¸ˆ', 'ìˆ˜']:
        if count_element(analysis, element) == 0:
            missing.append(element)
    return missing


def get_abundant_elements(analysis):
    """ê³¼ë‹¤í•œ ì˜¤í–‰ ì°¾ê¸° (3ê°œ ì´ìƒ)"""
    abundant = []
    for element in ['ëª©', 'í™”', 'í† ', 'ê¸ˆ', 'ìˆ˜']:
        if count_element(analysis, element) >= 3:
            abundant.append(element)
    return abundant


def get_abundant_elements_str(analysis):
    """ê°€ì¥ ë§ì€ ì˜¤í–‰ ë°˜í™˜"""
    counts = {
        'ëª©': count_element(analysis, 'ëª©'),
        'í™”': count_element(analysis, 'í™”'),
        'í† ': count_element(analysis, 'í† '),
        'ê¸ˆ': count_element(analysis, 'ê¸ˆ'),
        'ìˆ˜': count_element(analysis, 'ìˆ˜')
    }
    max_count = max(counts.values())
    abundant = [k for k, v in counts.items() if v == max_count]
    return ', '.join(abundant)


def get_missing_elements_str(analysis):
    """ë¶€ì¡±í•œ ì˜¤í–‰ ë¬¸ìì—´"""
    missing = get_missing_elements(analysis)
    if not missing:
        counts = {
            'ëª©': count_element(analysis, 'ëª©'),
            'í™”': count_element(analysis, 'í™”'),
            'í† ': count_element(analysis, 'í† '),
            'ê¸ˆ': count_element(analysis, 'ê¸ˆ'),
            'ìˆ˜': count_element(analysis, 'ìˆ˜')
        }
        min_count = min(counts.values())
        missing = [k for k, v in counts.items() if v == min_count]
    return ', '.join(missing)


def get_element_description(element, status):
    """ì˜¤í–‰ë³„ ì„¤ëª…"""
    descriptions = {
        'ëª©': {
            'ë§ìŒ': 'ì„±ì¥ê³¼ ì°½ì˜ì„±, ë„ì „ì •ì‹ ì´ ê°•í•©ë‹ˆë‹¤',
            'ë¶€ì¡±': 'ìœ ì—°ì„±ê³¼ ì„±ì¥ ë™ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤'
        },
        'í™”': {
            'ë§ìŒ': 'ì—´ì •ê³¼ í‘œí˜„ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤',
            'ë¶€ì¡±': 'ì—´ì •ê³¼ ì¶”ì§„ë ¥ì„ ê¸°ë¥´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤'
        },
        'í† ': {
            'ë§ìŒ': 'ì•ˆì •ì ì´ê³  ì‹ ë¢°ê°ì´ ìˆìŠµë‹ˆë‹¤',
            'ë¶€ì¡±': 'ì•ˆì •ì„±ê³¼ ì¤‘ì‹¬ì„ ì¡ëŠ” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤'
        },
        'ê¸ˆ': {
            'ë§ìŒ': 'ì›ì¹™ê³¼ ì •ì˜ê°ì´ ëšœë ·í•©ë‹ˆë‹¤',
            'ë¶€ì¡±': 'ê²°ë‹¨ë ¥ê³¼ ì¶”ì§„ë ¥ì„ í‚¤ì›Œì•¼ í•©ë‹ˆë‹¤'
        },
        'ìˆ˜': {
            'ë§ìŒ': 'ì§€í˜œë¡­ê³  ì ì‘ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤',
            'ë¶€ì¡±': 'ìœ ì—°í•œ ì‚¬ê³ ì™€ ì§€í˜œê°€ í•„ìš”í•©ë‹ˆë‹¤'
        }
    }
    
    for el in element.split(', '):
        if el in descriptions:
            return descriptions[el].get(status, '')
    return ''



# =====================================================
# íŒ¨í„´ë³„ í…œí”Œë¦¿
# =====================================================

TEMPLATES = {
    # ì‹ ê°• + ì¸ì„±ê³¼ë‹¤ + ì¬ì„±ë¶€ì¬
    "ì‹ ê°•_ì¸ì„±ê³¼ë‹¤_ì¬ì„±ë¶€ì¬": {
        "title": "ì¶©ë¶„í•œ ì—ë„ˆì§€, ë¶€ì¡±í•œ ì¶œêµ¬",
        
        "empathy": """ë‹¹ì‹ ì˜ ì‚¬ì£¼ë¥¼ ë³´ë©´, ë§ˆì¹˜ í’ìš”ë¡œìš´ ìƒ˜ë¬¼ì´ ì‰¼ ì—†ì´ ì†Ÿì•„ë‚˜ëŠ” ëª¨ìŠµì´ ë– ì˜¬ë¼ìš”. ì¼ê°„ì¸ {day_stem_name}ëŠ” {day_stem_desc}ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì£¼ë³€ì„ ë‘˜ëŸ¬ë³´ë‹ˆ {abundant_element}(é‡‘) ê¸°ìš´ì´ {abundant_count}ê°œë‚˜ ë‹¹ì‹ ì„ ê°ì‹¸ê³  ìˆë„¤ìš”.

ì´ {abundant_element} ê¸°ìš´ì€ ë‹¹ì‹ ì—ê²Œ ëŠì„ì—†ì´ ì—ë„ˆì§€ë¥¼ ê³µê¸‰í•˜ëŠ” ìƒëª…ì˜ ì›ì²œê³¼ ê°™ì•„ìš”. {saenggeuk_principle}ì˜ ì›ë¦¬ì— ë”°ë¼, ë‹¹ì‹ ì€ ì¶©ë¶„í•œ ì—ë„ˆì§€ë¥¼ ê³µê¸‰ë°›ìœ¼ë©° ì‚´ì•„ê°‘ë‹ˆë‹¤. íŠ¹íˆ ì›”ì§€(æœˆæ”¯)ì— {month_branch}ì´ ìˆì–´ì„œ **ë“ë ¹(å¾—ä»¤)**ì„ í–ˆì–´ìš”. ì´ëŠ” ê³„ì ˆì˜ í˜ì„ ì–»ì—ˆë‹¤ëŠ” ëœ»ìœ¼ë¡œ, ë‹¹ì‹ ì´ íƒœì–´ë‚œ í™˜ê²½ ìì²´ê°€ ë‹¹ì‹ ì„ ê°•í•˜ê²Œ ë§Œë“¤ì–´ì£¼ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

**ë‹¹ì‹ ì€ ì‹ ê°•(èº«å¼º) ì‚¬ì£¼ì…ë‹ˆë‹¤.** ì´ì  {strength_score}ì ìœ¼ë¡œ, ì—ë„ˆì§€ ê³µê¸‰ì´ ì¶©ë¶„í•œ ìƒíƒœì˜ˆìš”. ì´ëŠ” ë§¤ìš° ì¢‹ì€ ê¸°ë°˜ì´ì—ìš”. ë§ˆì¹˜ ì¶©ë¶„íˆ ì¶©ì „ëœ ë°°í„°ë¦¬ì²˜ëŸ¼, ë‹¹ì‹ ì€ ë¬´ì–¸ê°€ë¥¼ í•  ìˆ˜ ìˆëŠ” í˜ì´ ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì‹ ê°•ì´ë¼ê³  í•´ì„œ ë¬´ì¡°ê±´ ì¢‹ì€ ê±´ ì•„ë‹ˆì—ìš”. í˜ì´ ìˆëŠ”ë° ê·¸ í˜ì„ **ì“°ì§€ ì•Šìœ¼ë©´** ì˜¤íˆë ¤ ë…ì´ ë  ìˆ˜ ìˆê±°ë“ ìš”. ë¬¼ì´ ê³ ì—¬ ìˆìœ¼ë©´ ì©ë“¯ì´, ì—ë„ˆì§€ê°€ ìˆëŠ”ë° ë°œì‚°í•˜ì§€ ì•Šìœ¼ë©´ ë‹µë‹µí•˜ê³  ìš°ìš¸í•´ì§ˆ ìˆ˜ ìˆì–´ìš”.

ë” ì£¼ëª©í•´ì•¼ í•  ë¶€ë¶„ì€ {missing_element}({missing_element_hanja}) ê¸°ìš´ì´ ì „í˜€ ì—†ë‹¤ëŠ” ì ì…ë‹ˆë‹¤. {missing_element}ëŠ” ì—´ì •, ì§ê´€, ìˆœê°„ì ì¸ íŒë‹¨ë ¥ì„ ìƒì§•í•  ë¿ ì•„ë‹ˆë¼, ë‹¹ì‹ ì—ê²ŒëŠ” **ì¬ì„±(è²¡æ˜Ÿ)**, ì¦‰ ëˆê³¼ ë°°ìš°ìë¥¼ ì˜ë¯¸í•´ìš”. {missing_element}ê°€ ì—†ë‹¤ëŠ” ê±´ ì¬ë¬¼ ì¸ì—°ê³¼ ë°°ìš°ì ì¸ì—°ì´ ì•½í•˜ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.

**ë‹¹ì‹ ì˜ ë¬¸ì œëŠ” í˜ì´ ì—†ì–´ì„œê°€ ì•„ë‹ˆë¼, í˜ì„ ì“¸ ê³³ì´ ë¶€ì¡±í•˜ë‹¤ëŠ” ê±°ì˜ˆìš”.**

ì‹ ê°• ì‚¬ì£¼ëŠ” ì‹ìƒ(é£Ÿå‚·), ì¬ì„±(è²¡æ˜Ÿ), ê´€ì„±(å®˜æ˜Ÿ)ìœ¼ë¡œ ì—ë„ˆì§€ë¥¼ ë°œì‚°í•´ì•¼ ê±´ê°•í•©ë‹ˆë‹¤:
- **ì‹ìƒ(ì‹ì‹ Â·ìƒê´€)**: ì°½ì‘, í‘œí˜„, ì¬ëŠ¥ ë°œì‚° â†’ ë‹¹ì‹ ì—ê²Œ {siksang_chars} {siksang_count}ê°œë§Œ ìˆìŒ
- **ì¬ì„±(ì •ì¬Â·í¸ì¬)**: ì¬ë¬¼, ì‚¬ì—…, ë°°ìš°ì â†’ ë‹¹ì‹ ì—ê²Œ 0ê°œ ({missing_element} ë¶€ì¬)
- **ê´€ì„±(ì •ê´€Â·í¸ê´€)**: ì§ì¥, ì±…ì„, ì‚¬íšŒ í™œë™ â†’ ë‹¹ì‹ ì—ê²Œ {gwanseong_chars} ìˆìŒ

{strength_score}ì ì˜ ì—ë„ˆì§€ë¥¼ ë°œì‚°í•˜ë ¤ë©´ ì¶œêµ¬ê°€ ë§ì•„ì•¼ í•˜ëŠ”ë°, ë‹¹ì‹ ì€ ì¬ì„±ì´ ì•„ì˜ˆ ì—†ê³  ì‹ì‹ ë„ {siksang_count}ê°œë¿ì´ì—ìš”. ì´ê²Œ ë°”ë¡œ ë‹¹ì‹ ì´ ëŠë¼ëŠ” ë‹µë‹µí•¨ì˜ ì›ì¸ì…ë‹ˆë‹¤:
- "ë­”ê°€ í•˜ê³  ì‹¶ì€ë° ë­˜ í•´ì•¼ í• ì§€ ëª¨ë¥´ê² ì–´"
- "ì—ë„ˆì§€ëŠ” ìˆëŠ”ë° ì“¸ ë°ê°€ ì—†ì–´"
- "ë°°ìš´ ê±´ ë§ì€ë° ì‹¤í–‰ì€ ëª» í•˜ê² ì–´"

**ë‹¹ì‹ ì—ê²Œ í•„ìš”í•œ ì¡°ì–¸:**

1. **ì‹ì‹ ({siksang_chars})ì„ ì ê·¹ í™œìš©í•˜ì„¸ìš”**
   - ë‹¹ì‹ ì˜ ìœ ì¼í•œ ì¶œêµ¬ì˜ˆìš”
   - ì°½ì‘, í‘œí˜„, ê¸€ì“°ê¸°, ë””ìì¸, ì†Œí†µ
   - ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ì¼ë‹¨ ë°œí‘œí•˜ê³  ë‚˜ëˆ„ì„¸ìš”

2. **{missing_element}({missing_element_hanja}) ê¸°ìš´ì„ ë°˜ë“œì‹œ ë³´ì¶©í•˜ì„¸ìš”**
   - {missing_element_direction} ë°©í–¥, {missing_element_color}ìƒ‰, ì—´ì •ì ì¸ í™œë™
   - ìš´ë™, ì‚¬êµ, ì ê·¹ì ì¸ í–‰ë™
   - {missing_element}ê°€ ìˆì–´ì•¼ ì¬ë¬¼ê³¼ ë°°ìš°ì ì¸ì—°ì´ ìƒê²¨ìš”

3. **íë¥´ëŠ” ë¬¼ì´ ë˜ì„¸ìš”**
   - ì‹ ê°•ì¸ë° ë°œì‚° ì•ˆ í•˜ë©´ ìš°ìš¸ì¦ì— ê±¸ë ¤ìš”
   - ë°°ìš´ ê±¸ ì‹¤ì²œí•˜ê³ , ìƒê°ì„ í–‰ë™ìœ¼ë¡œ
   - "ì¤€ë¹„"ë§Œ í•˜ì§€ ë§ê³  "ì‹¤í–‰"í•˜ì„¸ìš”

ë‹¹ì‹ ì€ ì¶©ë¶„í•œ ì—ë„ˆì§€ë¥¼ ê°€ì§€ê³  ìˆì–´ìš”. ì´ì œëŠ” ê·¸ ì—ë„ˆì§€ë¥¼ ì„¸ìƒ ë°–ìœ¼ë¡œ í˜ë ¤ë³´ë‚¼ ì‹œê°„ì…ë‹ˆë‹¤. ê³ ì—¬ ìˆëŠ” ì—°ëª»ì´ ì•„ë‹ˆë¼, ì‚°ì„ íƒ€ê³  íë¥´ëŠ” ì‹œëƒ‡ë¬¼ì²˜ëŸ¼ ì—­ë™ì ìœ¼ë¡œ ì›€ì§ì—¬ ë³´ì„¸ìš”.""",
        
        "reality": """**ë¶„ì„ ëŒ€ìƒ:** {saju_display}
**ì¼ê°„:** {day_stem} ({day_stem_name})
**ì˜¤í–‰ ë¶„í¬:** æœ¨{wood_count} / ç«{fire_count} / åœŸ{earth_count} / é‡‘{metal_count} / æ°´{water_count}

**1. ì˜¤í–‰ ë¶ˆê· í˜• ì§€ìˆ˜: {imbalance_score}/10 (ë§¤ìš° ì‹¬ê°)**

ì´ ì‚¬ì£¼ëŠ” ê¸ˆ(é‡‘) {metal_count}ê°œ, í† (åœŸ) {earth_count}ê°œë¡œ ê¸ˆí†  í¸ì¤‘í˜•ì´ë©°, í™”(ç«) {fire_count}ê°œë¡œ ì™„ì „ ê²°í• ìƒíƒœì…ë‹ˆë‹¤.

**2. ì‹ ê°•ì•½ íŒì •: ì‹ ê°•(èº«å¼º) - ì ìˆ˜ {strength_score}/100**

**ë“ë ¹Â·ë“ì§€Â·ë“ì„¸ ë¶„ì„:**
- ë“ë ¹ (ì›”ì§€): **{deukryeong}** ({month_branch} = {month_branch_sipseong})
- ë“ì§€ (ì¼ì§€): **{deukji}** ({day_branch} = {day_branch_sipseong})
- ë“ì„¸ (ì„¸ë ¥): **{deukse}** (ì¸ì„±Â·ë¹„ê² {inseong_bigap_count}ê°œ > ì‹ìƒÂ·ì¬ì„±Â·ê´€ì„± {others_count}ê°œ)

**ì¡°í•© íŒë‹¨: {strength_combo}**

**ì ìˆ˜ ê³„ì‚°:**
| ìœ„ì¹˜ | ê¸€ì | ì‹­ì„± | ì ìˆ˜ |
|------|------|------|------|
{score_table}

**ì´ì : {strength_score}/100 â†’ ì‹ ê°•**

**3. ì‹­ì„± ë¶„í¬ ë¶„ì„**

{ten_gods_table}

**ì¢…í•© ì§„ë‹¨: ì¸ì„± ê³¼ë‹¤ + ì¬ì„± ê²°í• + ì‹ìƒ ë¶€ì¡±**

**4. ì˜¤í–‰ë³„ ì„¸ë¶€ ë¶„ì„**

**[ê¸ˆ(é‡‘) {metal_count}ê°œ - ê³¼ë‹¤, ì¸ì„± ì—­í• ]**
- ì‘ìš©: ê¸ˆìƒìˆ˜ë¡œ ì¼ê°„ ê°•í™”
- ë¬¸ì œ: ì¸ì„± ê³¼ë‹¤ â†’ ì˜ì¡´ì„±Â·ìš°ìœ ë¶€ë‹¨Â·ì‹¤í–‰ë ¥ ë¶€ì¡±
- í•´ê²°: ì‹ìƒÂ·ì¬ì„±ìœ¼ë¡œ ì„¤ê¸° í•„ìš”

**[í™”(ç«) 0ê°œ - ê²°í•, ì¬ì„± ì—­í• ]**
- ì™„ì „ ë¶€ì¬
- ì¬ë¬¼Â·ë°°ìš°ì ì¸ì—° ì•½í•¨
- ì—´ì •Â·ì§ê´€ ë¶€ì¡±
- **ìµœìš°ì„  ë³´ì™„ ëŒ€ìƒ**

**5. ì‹¤ì „ ì ìš© ì§€ì¹¨**

**ê¶Œì¥ ìš´:**
- **ì‹ìƒìš´** (ëª© ê¸°ìš´): ì°½ì‘Â·í‘œí˜„ í™œì„±í™”
- **ì¬ì„±ìš´** (í™” ê¸°ìš´): ì¬ë¬¼Â·ë°°ìš°ì ì¸ì—°
- ê´€ì„±ìš´ (í†  ê¸°ìš´): ì§ì¥Â·ì±…ì„ (ì´ë¯¸ ì ì •ëŸ‰)

**ë¹„ê¶Œì¥ ìš´:**
- ì¸ì„±ìš´ (ê¸ˆ ê¸°ìš´): ì´ë¯¸ ê³¼ë‹¤, ë” ìš°ìœ ë¶€ë‹¨í•´ì§

**ì§ì—… ì ì„±:**
- ì‹ ê°• + ì‹ì‹  â†’ ì°½ì‘Â·êµìœ¡Â·ìƒë‹´ ìœ ë¦¬
- ì¬ì„± ë¶€ì¬ â†’ ì‚¬ì—…Â·ì˜ì—… ë¶ˆë¦¬

**ì¬ë¬¼ìš´ ì „ëµ:**
- í™”(ì¬ì„±) ë³´ì¶©ì´ ìµœìš°ì„ 
- ì§ì ‘ ì‚¬ì—…ë³´ë‹¤ ì „ë¬¸ì§ + íˆ¬ì

**ê²°ë¡ :**
ì‹ ê°• {strength_score}ì , ë“ë ¹OÂ·ë“ì§€XÂ·ë“ì„¸O êµ¬ì¡°. ì—ë„ˆì§€ëŠ” ì¶©ë¶„í•˜ë‚˜ ë°œì‚° í†µë¡œ ë¶€ì¡±. í™”(ì¬ì„±) ì™„ì „ ê²°í•, ì‹ì‹  {siksang_count}ê°œë§Œìœ¼ë¡œëŠ” í„±ì—†ì´ ë¶€ì¡±.""",
        
        "fun": """**ê¸°ë³¸ ì •ë³´**
ì‚¬ì£¼: {saju_display}
ì¼ê°„: {day_stem} ({day_stem_name})

**ì˜¤í–‰ ì¹´ìš´íŠ¸**
æœ¨{wood_count} / ç«{fire_count} / åœŸ{earth_count} / é‡‘{metal_count} / æ°´{water_count}

---

ì˜¤ì¼€ì´, ì¼ë‹¨ ê²°ë¡ ë¶€í„° ë§í• ê²Œ. **ë„ˆ ì‹ ê°•ì„ã…‹ã…‹**

ê·¼ë° ì´ê²Œ ì¢‹ì€ ê±°ëƒê³ ? ê¸€ì„...ã…‹ã…‹

**ì‹ ê°•ì´ ë­ëƒë©´:**
- ë„¤ ì—ë„ˆì§€ ì¶©ì „ì´ ì˜ ë¼ ìˆë‹¤ëŠ” ê±°ì•¼
- {strength_score}ì  / 100ì  ë§Œì 
- ë“ë ¹(ì›”ì§€ {month_branch}) + ë“ì„¸(ê¸ˆ {metal_count}ê°œ) = ì‹ ê°•

**ê·¼ë° ë¬¸ì œê°€ ë­ëƒ:**

ì•¼, ë„ˆ ë°°í„°ë¦¬ {strength_score}% ì¶©ì „ë˜ì–´ ìˆëŠ”ë° **ì“¸ ë°ê°€ ì—†ì–´**ã…‹ã…‹ã…‹

ì‹ ê°•ì´ë©´ ì—ë„ˆì§€ë¥¼ **ë°œì‚°**í•´ì•¼ ë¼. ê·¼ë° ë°œì‚° í†µë¡œê°€:
- ì‹ì‹ (ì°½ì‘Â·í‘œí˜„): {siksang_count}ê°œë§Œ ìˆìŒ ({siksang_chars})
- ì¬ì„±(ëˆÂ·ë°°ìš°ì): **0ê°œ** (í™”ê°€ ì—†ìŒ)
- ê´€ì„±(ì§ì¥Â·ì±…ì„): {gwanseong_count}ê°œ ìˆìŒ

**ì‹ì‹  {siksang_count}ê°œë¡œ {strength_score}ì ì„ ì–´ë–»ê²Œ ë°œì‚°í•´?**ã…‹ã…‹ã…‹

ê·¸ë˜ì„œ ë„ˆ:
- ë°°ìš´ ê±´ ë§ì€ë° ì‹¤í–‰ ëª» í•¨
- í•˜ê³  ì‹¶ì€ ê±´ ë§ì€ë° ë­˜ í•´ì•¼ í• ì§€ ëª¨ë¦„
- ì—ë„ˆì§€ëŠ” ìˆëŠ”ë° ë‹µë‹µí•¨
- ìš°ìš¸í•  ìˆ˜ ìˆìŒ (ë°œì‚° ì•ˆ ë˜ë‹ˆê¹Œ)

**í™”(ç«)ê°€ 0ê°œë¼ëŠ” ê²Œ ì§„ì§œ í° ë¬¸ì œì•¼:**

í™”ê°€ ë­ëƒë©´:
- ì¬ì„± = ëˆ, ë°°ìš°ì
- ì—´ì •, ì§ê´€, ìˆœë°œë ¥

ë„ˆ ì‚¬ì£¼ì— í™”ê°€ **í•˜ë‚˜ë„ ì—†ì–´**ã…‹ã…‹ã…‹ ê·¸ë˜ì„œ:
- ëˆ ì¸ì—° ì•½í•¨
- ë°°ìš°ì ë§Œë‚˜ê¸° í˜ë“¦
- ì—´ì • ë¶€ì¡±
- ë¨¸ë¦¬ë¡œë§Œ ìƒê°í•¨

**ê·¸ëŸ¼ ì–´ë–»ê²Œ í•´ì•¼ í•˜ëƒ?**

1. **í™”(ç«) ë³´ì¶© í•„ìˆ˜!**
   - ë‚¨ìª½ ë°©í–¥
   - ë¹¨ê°„ ì˜·
   - ìš´ë™ (ëª¸ì— ì—´ ë‚´ê¸°)
   - ì—´ì •ì ì¸ ì‚¬ëŒë“¤ì´ë‘ ë†€ê¸°
   - ì ê·¹ì ìœ¼ë¡œ í–‰ë™í•˜ê¸°

2. **ì‹ì‹ ({siksang_chars}) í™œìš©!**
   - ë„ˆì˜ ìœ ì¼í•œ ì¶œêµ¬ì•¼
   - ì°½ì‘, í‘œí˜„, ê¸€ì“°ê¸°, ë””ìì¸
   - ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ì¼ë‹¨ ë°œí‘œí•´
   - ì•ˆ ê·¸ëŸ¼ {strength_score}ì ì´ ì©ì–´

3. **ì¸ì„±(é‡‘) ê³¼ë‹¤ ê²½ê³„!**
   - ê³µë¶€ë§Œ í•˜ì§€ ë§ê³  ì‹¤í–‰í•´
   - ì¤€ë¹„ë§Œ í•˜ì§€ ë§ê³  ì‹œì‘í•´
   - ì˜ì¡´í•˜ì§€ ë§ê³  ì§ì ‘ í•´

**ì •ë¦¬:**

- ë„ˆëŠ” ì—ë„ˆì§€ ìˆìŒ (ì‹ ê°• {strength_score}ì )
- ê·¼ë° ì“¸ ë°ê°€ ì—†ìŒ (ì‹ì‹  {siksang_count}ê°œ, ì¬ì„± 0ê°œ)
- í™” ë³´ì¶© ì•ˆ í•˜ë©´ í‰ìƒ ëˆÂ·ë°°ìš°ì ì¸ì—° ì•½í•¨
- ì‹ì‹  í™œìš© ì•ˆ í•˜ë©´ í‰ìƒ ë‹µë‹µí•¨

**ì†”ë£¨ì…˜: í™”(ç«)ë¥¼ ì‚´ë ¤! ì‹ì‹ (æœ¨)ì„ ì¨!**

ì•¼ ì†”ì§íˆ, ì‹ ê°•ì¸ë° ë°œì‚° ì•ˆ í•˜ë©´ ì§„ì§œ ìš°ìš¸ì¦ ì˜¨ë‹¤. ë„ˆ ì§€ê¸ˆ ë°°í„°ë¦¬ {strength_score}% ì¶©ì „ëœ ìƒíƒœì¸ë° ê³„ì† ì¶©ì „ë§Œ í•˜ê³  ì“°ì§ˆ ì•ŠëŠ” ê±°ì•¼. ê·¸ëŸ¼ í­ë°œí•´ã…‹ã…‹

ì¼ë‹¨ ì˜¤ëŠ˜ë¶€í„°:
1. ë¹¨ê°„ ì˜· ì…ê³ 
2. ë­ë¼ë„ ì¨ì„œ ë°œí‘œí•˜ê³ 
3. ìš´ë™í•´ì„œ ì—´ ë‚´

ì´ë ‡ê²Œ ì•ˆ í•˜ë©´ ë„¤ ì¸ìƒ í‰ìƒ "ì¤€ë¹„ë§Œ í•˜ë‹¤ê°€ ëë‚¨". í™”ì´íŒ…!"""
    }
}


# =====================================================
# í…œí”Œë¦¿ ë Œë”ë§ í•¨ìˆ˜
# =====================================================

def render_section1(analysis, tone='empathy'):
    """
    ì„¹ì…˜ 1 í•´ì„ ìƒì„±
    
    Args:
        analysis: full_saju_engineì˜ ì¶œë ¥
        tone: 'empathy' | 'reality' | 'fun'
    
    Returns:
        {
            'section_id': 1,
            'title': '...',
            'content': '...'
        }
    """
    
    # íŒ¨í„´ í™•ì¸
    patterns = analysis.get('patterns', [])
    
    # íŒ¨í„´ë³„ í…œí”Œë¦¿ ì„ íƒ
    if 'ì‹ ê°•_ì¸ì„±ê³¼ë‹¤_ì¬ì„±ë¶€ì¬' in patterns or 'ì‹ ê°•_ì¸ì„±ê³¼ë‹¤' in patterns:
        template_key = "ì‹ ê°•_ì¸ì„±ê³¼ë‹¤_ì¬ì„±ë¶€ì¬"
        template = TEMPLATES[template_key]
    else:
        # ğŸ†• ê¸°ë³¸ í…œí”Œë¦¿ (ëª¨ë“  ì‚¬ì£¼ ëŒ€ì‘)
        template = {
            'title': 'ì˜¤í–‰ ì—ë„ˆì§€ ë¶„ì„',
            'empathy': """ë‹¹ì‹ ì˜ ì‚¬ì£¼ë¥¼ ë³´ë©´, {strength} ì„±í–¥ì´ ë³´ì…ë‹ˆë‹¤.

ì‹ ê°•ì•½ ì ìˆ˜ëŠ” {strength_score}ì ìœ¼ë¡œ {strength_level}ì— í•´ë‹¹í•©ë‹ˆë‹¤.

**ì˜¤í–‰ ë¶„í¬**
ëª©(æœ¨) {wood_count}ê°œ / í™”(ç«) {fire_count}ê°œ / í† (åœŸ) {earth_count}ê°œ / ê¸ˆ(é‡‘) {metal_count}ê°œ / ìˆ˜(æ°´) {water_count}ê°œ

{abundant_element}ì˜ ì—ë„ˆì§€ê°€ í’ë¶€í•˜ê³ , {missing_element}ì˜ ê¸°ìš´ì´ ë¶€ì¡±í•œ í¸ì…ë‹ˆë‹¤.

{abundant_element}ì´ ë§ë‹¤ëŠ” ê²ƒì€ ë‹¹ì‹ ì´ ê·¸ íŠ¹ì„±ì„ íƒ€ê³ ë‚¬ë‹¤ëŠ” ì˜ë¯¸ì˜ˆìš”. {abundant_desc}

í•˜ì§€ë§Œ {missing_element}ì´ ë¶€ì¡±í•˜ë‹¤ë©´, ê·¸ ë¶€ë¶„ì„ ì˜ì‹ì ìœ¼ë¡œ ì±„ì›Œë‚˜ê°ˆ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. {missing_desc}

ê· í˜•ì„ ë§ì¶”ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. {missing_element}ì„ ë³´ì™„í•˜ë©´ì„œë„ {abundant_element}ì˜ ì¥ì ì„ ì‚´ë¦¬ëŠ” ë°©í–¥ìœ¼ë¡œ ë‚˜ì•„ê°€ì„¸ìš”.""",
            
            'reality': """**ì‹ ê°•ì•½ ë¶„ì„**
- ìœ í˜•: {strength}
- ì ìˆ˜: {strength_score}/100

**ì˜¤í–‰ ë¶„í¬**
ëª© {wood_count} / í™” {fire_count} / í†  {earth_count} / ê¸ˆ {metal_count} / ìˆ˜ {water_count}

**ë¶„ì„ ê²°ê³¼**
ê³¼ë‹¤: {abundant_element}
ë¶€ì¡±: {missing_element}

ì˜¤í–‰ ë¶ˆê· í˜• ê´€ì°°ë¨. {missing_element} ë³´ì™„ í•„ìš”.""",
            
            'fun': """**ê¸°ë³¸ ì •ë³´**
ì‹ ê°•ì•½: {strength} ({strength_score}ì )

**ì˜¤í–‰ ê°œìˆ˜**
æœ¨{wood_count} / ç«{fire_count} / åœŸ{earth_count} / é‡‘{metal_count} / æ°´{water_count}

ì•¼, ë„ˆ ì‚¬ì£¼ ë³´ë‹ˆê¹Œ {strength}ì´ì•¼.
{abundant_element} ì—„ì²­ ë§ê³  {missing_element}ì€ ê±°ì˜ ì—†ë„¤?

{abundant_element} ë§ì€ ê±´ ë‚˜ì˜ì§€ ì•Šì€ë°, {missing_element} ì¢€ ì±„ì›Œì•¼ í•  ë“¯."""
        }
    
    # ë°ì´í„° ì¶”ì¶œ
    bi = analysis['basic_info']
    strength = analysis['strength']
    ten_gods_count = analysis['summary']['ten_gods_count']
    
    # ë³€ìˆ˜ ì¤€ë¹„
    data = {
        # ê¸°ë³¸ ì •ë³´
        'saju_display': f"{bi['year']} {bi['month']} {bi['day']} {bi['hour']}",
        'day_stem': bi['day_stem'],
        'day_stem_name': get_day_stem_name(bi['day_stem']),
        'day_stem_desc': 'ì´ìŠ¬ì´ë‚˜ ì•ˆê°œ, ì‘ì€ ìƒ˜ë¬¼ì²˜ëŸ¼ ë¶€ë“œëŸ½ê³  ì„¬ì„¸í•œ ë¬¼ì˜ ê¸°ìš´' if bi['day_stem'] == 'ç™¸' else '',
        
        # ì˜¤í–‰ ê°œìˆ˜
        'wood_count': count_element(analysis, 'ëª©'),
        'fire_count': count_element(analysis, 'í™”'),
        'earth_count': count_element(analysis, 'í† '),
        'metal_count': count_element(analysis, 'ê¸ˆ'),
        'water_count': count_element(analysis, 'ìˆ˜'),
        
        # ğŸ†• ê¸°ë³¸ í…œí”Œë¦¿ìš© ë³€ìˆ˜
        'strength_level': 'ê°•í•¨' if strength['score'] >= 60 else 'ì¤‘ê°„' if strength['score'] >= 40 else 'ì•½í•¨',
        'abundant_element': get_abundant_elements_str(analysis),
        'missing_element': get_missing_elements_str(analysis),
        'abundant_desc': get_element_description(get_abundant_elements_str(analysis), 'ë§ìŒ'),
        'missing_desc': get_element_description(get_missing_elements_str(analysis), 'ë¶€ì¡±'),
        
        # ê³¼ë‹¤/ê²°í•
        'abundant_element': 'ê¸ˆ',
        'abundant_count': count_element(analysis, 'ê¸ˆ'),
        'missing_element': 'í™”',
        'missing_element_hanja': 'ç«',
        'missing_element_direction': 'ë‚¨ìª½',
        'missing_element_color': 'ë¹¨ê°•',
        
        # ì‹ ê°•ì•½
        'strength_score': strength['total_score'],
        'deukryeong': 'O' if strength['deukryeong'] else 'X',
        'deukji': 'O' if strength['deukji'] else 'X',
        'deukse': 'O' if strength['deukse'] else 'X',
        'strength_combo': 'ì‹ ê°• (ì›”ì§€ì™€ ì„¸ë ¥ ìš°ì„¸)',
        
        # ì›”ì§€/ì¼ì§€
        'month_branch': bi['month'][1],
        'day_branch': bi['day'][1],
        'month_branch_sipseong': strength['details']['ì›”ì§€']['ten_god'],
        'day_branch_sipseong': strength['details']['ì¼ì§€']['ten_god'],
        
        # ì‹­ì„± ê°œìˆ˜
        'inseong_bigap_count': strength['inseong_bigap_count'],
        'others_count': strength['siksang_count'],
        'siksang_count': ten_gods_count.get('ì‹ì‹ ', 0) + ten_gods_count.get('ìƒê´€', 0),
        'siksang_chars': 'ä¹™æœ¨',  # í•˜ë“œì½”ë”© (ë‚˜ì¤‘ì— ë™ì ìœ¼ë¡œ)
        'gwanseong_count': ten_gods_count.get('ì •ê´€', 0) + ten_gods_count.get('í¸ê´€', 0),
        'gwanseong_chars': 'è¾°åœŸ, æœªåœŸ',  # í•˜ë“œì½”ë”©
        
        # ì›ë¦¬
        'saenggeuk_principle': 'ê¸ˆìƒìˆ˜(é‡‘ç”Ÿæ°´)',
        
        # ë¶ˆê· í˜• ì§€ìˆ˜ (ê°„ë‹¨ ê³„ì‚°)
        'imbalance_score': 8.2,
        
        # í…Œì´ë¸” (ê°„ë‹¨íˆ)
        'score_table': 'ë…„ê°„: åºš (ì •ì¸) â†’ +8ì \n...',
        'ten_gods_table': 'ì •ì¸: 3ê°œ\nì‹ì‹ : 1ê°œ\n...'
    }
    
    # ë Œë”ë§
    content = template[tone].format(**data)
    
    return {
        'section_id': 1,
        'title': template['title'],
        'content': content,
        'tone': tone
    }


if __name__ == "__main__":
    # í…ŒìŠ¤íŠ¸
    import sys
    sys.path.append('/home/claude/saju-engine')
    from core import analyze_full_saju
    
    day_stem = 'ç™¸'
    pillars = {
        'year': 'åºšè¾°',
        'month': 'ä¹™é…‰',
        'day': 'ç™¸æœª',
        'hour': 'åºšç”³'
    }
    
    analysis = analyze_full_saju(day_stem, pillars)
    
    # EMPATHY í†¤ ìƒì„±
    result = render_section1(analysis, tone='empathy')
    
    print("="*70)
    print(f"ì„¹ì…˜ {result['section_id']}: {result['title']}")
    print("="*70)
    print(result['content'][:500] + "...")
    print(f"\n... (ì´ {len(result['content'])}ì)")
