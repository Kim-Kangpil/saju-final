// frontend/data/elementAnalysis.ts

export const ELEMENT_ANALYSIS = {
  empathy: {
    icon: "🌈",
    title: "당신의 오행 에너지"
  },
  reality: {
    icon: "⚗️",
    title: "오행 분포 분석"
  },
  fun: {
    icon: "🎨",
    title: "너 오행 밸런스 어때?"
  }
};

export const ELEMENT_RECOMMENDATIONS = {
  wood: {
    color: "초록색, 청록색",
    direction: "동쪽",
    season: "봄",
    items: "나무 소재, 식물, 책",
    activity: "산책, 독서, 창작활동"
  },
  fire: {
    color: "빨간색, 주황색",
    direction: "남쪽",
    season: "여름",
    items: "조명, 양초, 붉은 소품",
    activity: "운동, 사교활동, 발표"
  },
  earth: {
    color: "노란색, 갈색",
    direction: "중앙",
    season: "환절기",
    items: "도자기, 돌, 흙 소품",
    activity: "명상, 정리정돈, 안정"
  },
  metal: {
    color: "흰색, 금색, 은색",
    direction: "서쪽",
    season: "가을",
    items: "금속 소품, 악기, 시계",
    activity: "계획, 정리, 체계화"
  },
  water: {
    color: "검정색, 파란색",
    direction: "북쪽",
    season: "겨울",
    items: "수족관, 분수, 거울",
    activity: "휴식, 사색, 여행"
  }
};

type Element = "wood" | "fire" | "earth" | "metal" | "water";
type CharKey = "empathy" | "reality" | "fun";

interface ElementCount {
  wood: number;
  fire: number;
  earth: number;
  metal: number;
  water: number;
}

// 오행 분석 함수
export function analyzeElements(elementCounts: ElementCount, selectedChar: CharKey): string {
  const sortedElements = Object.entries(elementCounts)
    .sort(([, a], [, b]) => b - a) as [Element, number][];
  
  const strongest = sortedElements[0];
  const weakest = sortedElements[sortedElements.length - 1];
  
  const total = Object.values(elementCounts).reduce((sum, val) => sum + val, 0);
  const average = total / 5;
  const variance = Object.values(elementCounts).reduce((sum, val) => sum + Math.pow(val - average, 2), 0) / 5;
  const isBalanced = variance < 1.5;
  
  if (selectedChar === "empathy") {
    return getEmpatheticAnalysis(strongest, weakest, isBalanced, elementCounts);
  } else if (selectedChar === "reality") {
    return getRealisticAnalysis(strongest, weakest, isBalanced, elementCounts);
  } else {
    return getFunAnalysis(strongest, weakest, isBalanced, elementCounts);
  }
}

// ==========================================
// Empathy 톤 분석 (2,500~3,000자)
// ==========================================
function getEmpatheticAnalysis(
  strongest: [Element, number],
  weakest: [Element, number],
  isBalanced: boolean,
  counts: ElementCount
): string {
  const [strongEl, strongCount] = strongest;
  const [weakEl, weakCount] = weakest;
  
  const elementNames: Record<Element, string> = {
    wood: "木(나무)",
    fire: "火(불)",
    earth: "土(흙)",
    metal: "金(쇠)",
    water: "水(물)"
  };
  
  const elementMeanings: Record<Element, string> = {
    wood: "성장과 창조의 에너지",
    fire: "열정과 표현의 에너지",
    earth: "안정과 포용의 에너지",
    metal: "정리와 완성의 에너지",
    water: "지혜와 흐름의 에너지"
  };
  
  let analysis = `당신의 사주를 이루는 여덟 글자를 오행으로 분류해보니, ${elementNames[strongEl]} 에너지가 가장 강하게 흐르고 있네요. ${elementMeanings[strongEl]}가 당신의 본질을 이루고 있답니다.\n\n`;
  
  analysis += `사주팔자는 마치 당신이라는 우주의 설계도와 같아요. 그 안에서 각 오행은 서로 다른 역할을 하며, 당신만의 독특한 에너지 패턴을 만들어내죠. 지금부터 당신의 오행 에너지가 어떤 의미를 가지는지, 그리고 그것이 당신의 삶에 어떤 영향을 미치는지 함께 살펴볼게요.\n\n`;
  
  // 강한 오행 상세 분석
  if (strongEl === "wood" && strongCount >= 3) {
    analysis += `🌱 나무 기운이 강한 당신\n\n`;
    analysis += `당신은 마치 봄날의 새싹처럼, 언제나 성장하고 확장하려는 본능을 가지고 있어요. 나무는 위로, 옆으로, 뿌리는 아래로 끊임없이 뻗어나가죠. 당신도 그래요. 새로운 것을 배우고, 시도하고, 탐험하는 것을 좋아하는 타고난 학습자이자 개척자랍니다.\n\n`;
    
    analysis += `나무 기운이 강한 사람은 창의력이 뛰어나요. 아이디어가 샘솟고, 상상력이 풍부하며, "이건 어떨까?" 하는 호기심이 가득하죠. 기획력과 추진력도 좋아서, 무언가를 시작하는 데 주저함이 없어요. 사람들은 당신의 이런 에너지에 끌려요.\n\n`;
    
    analysis += `하지만 나무가 너무 많으면, 마치 숲속에서 길을 잃은 것처럼 방향성을 잃을 수 있어요. 이것도 하고 싶고, 저것도 하고 싶어서 에너지가 분산되기 쉽죠. 때로는 하나를 깊이 파는 것보다 여러 가지를 얕게 건드리다 끝나는 경우도 있어요.\n\n`;
    
    analysis += `당신에게 필요한 건 선택과 집중이에요. 나무가 건강하게 자라려면 가지치기가 필요하듯, 당신도 때로는 불필요한 것들을 정리하고 핵심에 집중하는 연습이 필요해요. 그리고 나무는 불을 만나면 활활 타오르며 빛과 열로 변해요. 당신의 아이디어와 에너지를 표현하고(식상), 세상에 드러내는(관성) 활동들이 당신을 더 빛나게 만들어줄 거예요.\n\n`;
    
  } else if (strongEl === "fire" && strongCount >= 3) {
    analysis += `🔥 불 기운이 강한 당신\n\n`;
    analysis += `당신은 밝고 따뜻한 태양 같은 존재예요. 불은 빛과 열을 내며, 주변을 환하게 밝히고 따뜻하게 만들어주죠. 당신도 그래요. 열정적이고, 사교적이며, 사람들을 자연스럽게 끌어당기는 카리스마가 있어요.\n\n`;
    
    analysis += `불 기운이 강한 사람은 표현력이 뛰어나요. 말을 잘하고, 자신의 생각과 감정을 숨김없이 드러내며, 다른 사람들에게 영향력을 미치는 능력이 있어요. 리더십도 타고났죠. 사람들은 당신의 에너지와 열정에 이끌려 자연스럽게 당신을 따라요.\n\n`;
    
    analysis += `하지만 불이 너무 강하면, 타올라서 자기 자신도 태워버릴 수 있어요. 너무 빠르게 움직이고, 너무 많은 에너지를 쏟다가 번아웃이 오기 쉽죠. 감정의 기복도 클 수 있어요. 화가 나면 폭발하고, 기쁘면 하늘을 찌를 듯 들뜨는, 그런 극단적인 모습이 나타날 수 있어요.\n\n`;
    
    analysis += `당신에게 필요한 건 온도 조절이에요. 불은 흙을 만나면 안정되고, 금속을 만나면 단단하게 형태를 만들어요. 규칙적인 생활(토), 명확한 목표와 계획(금)이 당신의 열정을 더 건설적인 방향으로 이끌어줄 거예요. 그리고 가끔은 쉬어가는 것도 잊지 마세요. 불도 산소가 필요하듯, 당신도 숨 쉴 공간이 필요하답니다.\n\n`;
    
  } else if (strongEl === "earth" && strongCount >= 3) {
    analysis += `🏔️ 흙 기운이 강한 당신\n\n`;
    analysis += `당신은 든든한 대지 같은 존재예요. 흙은 모든 것을 품고, 키우고, 지탱해주죠. 당신도 그래요. 안정적이고, 신뢰할 수 있으며, 사람들에게 편안함과 안정감을 주는 존재랍니다.\n\n`;
    
    analysis += `흙 기운이 강한 사람은 책임감이 강해요. 한번 맡은 일은 끝까지 해내고, 약속을 잘 지키며, 주변 사람들을 잘 챙기죠. 중재력도 뛰어나서, 갈등 상황에서 중립을 지키며 균형을 잡아주는 역할을 해요. 사람들은 당신을 믿고 의지해요.\n\n`;
    
    analysis += `하지만 흙이 너무 많으면, 무거워서 움직이기 힘들어져요. 너무 많은 것을 품으려다가 자신이 짓눌릴 수 있죠. 타인의 문제를 자신의 문제처럼 떠안고, 모든 책임을 혼자 지려고 하다가 스트레스를 받기 쉬워요. 고집도 셀 수 있어요. 한번 정한 것은 쉽게 바꾸지 않으려는 경향이 있죠.\n\n`;
    
    analysis += `당신에게 필요한 건 적절한 경계 설정이에요. 흙은 나무를 만나면 영양분을 주지만, 나무도 흙에 뿌리를 내리며 지탱해줘요. 주고받는 관계, 서로 돕는 관계가 중요해요. 모든 것을 혼자 감당하려 하지 말고, 가끔은 "아니요"라고 말하는 연습도 필요해요. 그리고 금속을 만나면 보석이 탄생하듯, 당신의 안정된 에너지로 명확한 결과물(금)을 만들어내는 것도 당신을 더 빛나게 할 거예요.\n\n`;
    
  } else if (strongEl === "metal" && strongCount >= 3) {
    analysis += `⚔️ 쇠 기운이 강한 당신\n\n`;
    analysis += `당신은 칼처럼 명확하고 날카로운 사람이에요. 금속은 단단하고, 형태가 명확하며, 정확하게 절단하고 형태를 만들어내죠. 당신도 그래요. 원칙이 뚜렷하고, 판단력이 뛰어나며, 일을 깔끔하게 처리하는 능력이 있어요.\n\n`;
    
    analysis += `쇠 기운이 강한 사람은 논리적이에요. 감정보다는 사실과 원칙을 중시하고, 정리정돈을 잘하며, 계획적으로 움직이죠. 의지력도 강해서, 한번 목표를 정하면 끝까지 밀고 나가는 추진력이 있어요. 완성도가 높은 결과물을 만들어내는 데 탁월해요.\n\n`;
    
    analysis += `하지만 금속이 너무 강하면, 경직되고 차갑게 느껴질 수 있어요. 융통성이 부족하고, 원칙에 너무 집착하다가 인간관계에서 어려움을 겪을 수 있죠. "왜 이렇게 해야 하나요?"라는 질문에 "원래 그런 거야"라고 답하며 벽을 쌓을 수 있어요. 완벽주의 성향도 강해서, 자신과 타인에게 너무 높은 기준을 요구하기 쉬워요.\n\n`;
    
    analysis += `당신에게 필요한 건 유연함이에요. 금속은 물을 만나면 녹이 슬고, 부드러워져요. 때로는 흐름에 맡기고, 예상치 못한 변화를 받아들이는 연습이 필요해요. 그리고 금속은 불을 만나면 녹아서 새로운 형태로 재탄생해요. 당신의 명확함과 원칙을 열정(화)과 결합하면, 더 큰 영향력을 발휘할 수 있을 거예요.\n\n`;
    
  } else if (strongEl === "water" && strongCount >= 3) {
    analysis += `🌊 물 기운이 강한 당신\n\n`;
    analysis += `당신은 깊고 지혜로운 물 같은 사람이에요. 물은 가장 낮은 곳으로 흐르지만, 그 안에 모든 것을 담아내고, 때로는 가장 강력한 힘을 발휘하죠. 당신도 그래요. 겉으로는 조용하고 차분해 보이지만, 내면에는 깊은 생각과 통찰력이 가득해요.\n\n`;
    
    analysis += `물 기운이 강한 사람은 직관력이 뛰어나요. 말하지 않아도 사람의 마음을 읽고, 상황의 흐름을 파악하며, 본질을 꿰뚫어보는 능력이 있어요. 적응력도 좋아서, 어떤 환경에서도 자신의 자리를 찾아가죠. 사람들은 당신의 깊이와 지혜에 이끌려요.\n\n`;
    
    analysis += `하지만 물이 너무 많으면, 방향을 잃고 흘러가거나, 정체되어 썩을 수 있어요. 생각이 너무 많아서 실행에 옮기지 못하거나, 우유부단하게 결정을 미루는 경우가 있죠. 감정의 깊이도 깊어서, 한번 빠지면 헤어나오기 힘든 우울이나 불안에 시달릴 수 있어요.\n\n`;
    
    analysis += `당신에게 필요한 건 명확한 방향성이에요. 물은 흙을 만나면 경계가 생기고, 나무를 만나면 위로 올라가요. 명확한 목표(토)와 성장의 방향(목)을 설정하면, 당신의 깊이와 지혜가 더 건설적인 방향으로 흐를 수 있어요. 그리고 가끔은 생각을 멈추고, 행동으로 옮기는 연습도 필요해요. 물이 고여 있으면 썩지만, 흐르면 생명을 살리니까요.\n\n`;
  }

  // 🔹 강한 오행의 현실 적용 패턴 (1,000자 추가)
  if (strongCount > 0 && strongEl) {
    const elementLabels: Record<Element, string> = {
      wood: '나무', fire: '불', earth: '흙', metal: '쇠', water: '물'
    };

    const realWorldPatterns: Record<Element, string> = {
      wood: `당신은 회의 시간에 손을 먼저 드는 편이에요. 새 프로젝트가 나오면 망설임 없이 참여 의사를 밝히고, 기존 방식에 의문을 제기하는 일이 잦은데요, 이건 당신의 창의성과 도전 정신에서 나오는 자연스러운 모습이랍니다. ✨

변화가 없는 환경에서는 답답함을 느끼실 수 있어요. 같은 일을 반복하는 것보다 프로젝트 단위로 움직이는 곳에서 훨씬 행복하실 거예요. 다만 여러 일을 동시에 시작하다가 마무리가 약해지는 경향이 있으니, 하나씩 끝내는 연습을 하시면 더 빛날 거예요. 💚

직장에서는 기획이나 개선 업무를 맡게 되는 경우가 많고, 스타트업이나 프로젝트 기반 조직에서 만족도가 높아요. 연애에서는 관계 초반에 적극적으로 움직이지만, 안정기에 접어들면 새로운 자극을 찾는 경향이 생길 수 있답니다.`,

      fire: `당신은 팀 미팅에서 분위기를 밝게 만드는 사람이에요. 조용한 자리를 견디지 못하고, 사람들이 모인 곳에서 에너지를 얻는 편이죠. 혼자 하는 업무보다 협업 프로젝트에서 훨씬 몰입도가 높고, 발표나 대외 활동을 맡게 되는 경우가 많답니다. 🔥

영업이나 홍보, 교육 같은 대인 접촉이 많은 분야에서 빛을 발하지만, 재택근무나 독립 작업을 오래 하면 무기력해질 수 있어요. 다만 열정이 앞서다 보니 충동적으로 결정하는 일이 잦고, 감정 기복이 있을 수 있으니 잠시 멈추고 호흡을 가다듬는 시간도 필요해요. ❤️

연애에서는 애정 표현이 과하고, 관계 초반에 강렬하게 몰입하는 편이에요. 상대가 조용하거나 표현이 적은 타입이면 불안을 느낄 수 있답니다.`,

      earth: `당신은 약속을 지키는 사람으로 인식돼요. 계획표를 만들고, 정해진 루틴을 유지하며, 급한 결정보다 체계적으로 준비하는 걸 선호하시죠. 변화가 잦은 환경에서는 스트레스를 받을 수 있지만, 안정적인 조직에서는 누구보다 빛나요. 🌱

행정이나 관리, 재무 같은 반복적이고 정확성이 요구되는 업무에 강점이 있고, 장기 근속률이 높은 편이에요. 다만 새로운 시도를 주저하는 경향이 있으니, 작은 변화부터 시도해보시면 좋을 것 같아요. 🤎

연애에서는 신뢰를 쌓는 데 시간이 걸리지만, 한번 관계가 형성되면 오래 유지하는 편이에요. 상대가 즉흥적이거나 계획 없이 움직이는 타입이면 불안함을 느낄 수 있답니다.`,

      metal: `당신은 회의에서 비효율을 지적하는 사람이에요. 논리적이고 분석적이며, 감정보다 원칙을 중시하죠. 결정이 필요한 순간에 명확한 기준을 제시하고, 애매한 상황을 견디지 못하는 편이에요. ⚙️

법률이나 회계, 엔지니어링 같은 정확성과 논리가 중요한 분야에서 정말 빛나요. 다만 완벽주의 성향이 강해 스스로에게도 타인에게도 높은 기준을 요구하는 경향이 있으니, 가끔은 상대의 마음도 들여다보는 여유를 가지면 관계가 더 좋아질 거예요. 🤍

연애에서는 관계에 명확한 규칙을 원하지만, 감정 표현이 부족한 편이에요. 상대가 감성적인 타입이면 서로 이해하지 못하는 순간이 잦을 수 있답니다.`,

      water: `당신은 상대의 감정을 먼저 알아채는 사람이에요. 말없이 관찰하고, 깊이 있는 대화를 선호하며, 혼자만의 시간을 소중히 여기죠. 표면적인 관계보다 소수와의 깊은 교류를 추구하는 편이에요. 💙

예술이나 상담, 연구, 기획 같은 사유와 창의성이 필요한 분야에서 강점을 보이지만, 빠른 결정이나 즉흥적인 대응이 필요한 환경에서는 스트레스를 받을 수 있어요. 우유부단한 경향이 있으니, 작은 결정부터 빠르게 내리는 연습을 하시면 좋을 것 같아요. 💧

연애에서는 깊은 교감을 원하지만, 표현이 부족해 상대가 답답함을 느낄 수 있어요. 상대가 빠르게 관계를 진전시키려는 타입이면 부담을 느끼고 거리를 두게 될 수 있답니다.`
    };

    analysis += `\n\n**💡 ${elementLabels[strongEl]} 에너지가 강한 당신의 현실 모습**\n\n`;
    analysis += realWorldPatterns[strongEl];
  }

  // 🔹 약한 오행으로 인한 어려움과 보상 패턴
  if (weakCount === 0 && weakEl) {
    const elementLabels: Record<Element, string> = {
      wood: '나무', fire: '불', earth: '흙', metal: '쇠', water: '물'
    };

    const weakPatterns: Record<Element, string> = {
      wood: `나무 에너지가 약하면 새로운 시작이 두렵게 느껴질 수 있어요. 이직을 고민해도 실행에 옮기지 못하고, 새 프로젝트가 나와도 기존 업무를 유지하려는 경향이 강하답니다. 변화가 필요한 순간에도 익숙한 것을 선택하게 되고, 기회를 놓치는 일이 반복될 수 있어요.

이런 경우 나무 에너지가 강한 사람과 함께 있으면 도움이 돼요. 추진력 있는 동료나 친구가 먼저 움직이면, 그 흐름에 자연스럽게 합류하게 되고, 작은 성공 경험이 쌓이면서 점차 시도하는 힘이 생긴답니다. 💚`,

      fire: `불 에너지가 약하면 사람 만나는 게 부담스럽게 느껴질 수 있어요. 모임 초대를 받아도 거절하는 경우가 많고, 참석해도 조용히 있다가 먼저 나가는 쪽이죠. 열정이 필요한 순간에 에너지가 부족하고, 새로운 사람을 만나는 자리를 피하게 된답니다.

이런 경우 불 에너지가 강한 사람과 함께 있으면 활력이 생겨요. 적극적인 친구가 함께 가자고 하면 따라가게 되고, 그 자리에서 즐거운 경험을 하면 점차 모임에 대한 거부감이 줄어든답니다. ❤️`,

      earth: `흙 에너지가 약하면 계획을 세워도 지키기 어려워질 수 있어요. 일정표를 만들어도 흐트러지고, 정리정돈을 미루다가 공간이 어지러워지는 일이 반복된답니다. 장기적인 목표보다 즉흥적인 결정을 하는 경향이 있고, 안정적인 루틴을 만들지 못해 불안함을 느낄 수 있어요.

이런 경우 흙 에너지가 강한 사람과 함께 있으면 안정감을 얻어요. 체계적인 친구나 파트너가 루틴을 만들어주면, 그 틀 안에서 편안함을 느끼게 되고, 작은 습관부터 하나씩 만들어가면 점차 안정감이 생긴답니다. 🤎`,

      metal: `쇠 에너지가 약하면 결단력이 부족하게 느껴질 수 있어요. 여러 선택지 앞에서 오래 고민하고, 결정을 내려도 "이게 맞나?" 하는 의심이 반복된답니다. 원칙보다 감정에 휘둘리기 쉽고, 타인의 의견에 쉽게 영향을 받는 편이에요.

이런 경우 쇠 에너지가 강한 사람과 함께 있으면 길이 보여요. 명확한 조언을 주는 친구나 멘토가 있으면, 그 확신에 기대어 결정을 내릴 수 있고, 작은 결정부터 스스로 내리는 연습을 하면 점차 자신감이 붙는답니다. 🤍`,

      water: `물 에너지가 약하면 감정 표현이 서툴게 느껴질 수 있어요. 상대의 마음을 읽지 못해 오해가 생기고, 깊이 있는 대화보다 표면적인 관계를 유지하는 경향이 있답니다. 창의적인 아이디어가 잘 떠오르지 않고, 정해진 틀 안에서 움직이는 걸 선호하게 돼요.

이런 경우 물 에너지가 강한 사람과 함께 있으면 배울 수 있어요. 감성적인 친구가 상대의 감정을 읽어주면, 점차 공감 능력이 생기게 되고, 예술이나 문화 활동을 접하면서 감정의 폭을 넓히는 것도 큰 도움이 된답니다. 💧`
    };

    analysis += `\n\n**⚠️ ${elementLabels[weakEl]} 에너지가 약한 당신이 겪는 어려움**\n\n`;
    analysis += weakPatterns[weakEl];
  }

  // 🔹 오행 균형에 따른 인간관계 & 직업 패턴
  if (strongCount > 0 && strongEl) {
    const elementLabels: Record<Element, string> = {
      wood: '나무', fire: '불', earth: '흙', metal: '쇠', water: '물'
    };

    const relationshipPatterns: Record<Element, string> = {
      wood: `나무 에너지가 강한 사람은 변화와 성장이 있는 환경에서 만족도가 높아요. 스타트업, 기획, 마케팅, 교육 분야에서 강점을 보이고, 정체된 조직에서는 답답함을 느낀답니다. 연애에서는 관계를 주도하려는 경향이 있지만, 상대가 독립적인 타입이면 서로 거리를 두게 돼요.`,
      
      fire: `불 에너지가 강한 사람은 사람과의 관계에서 에너지를 얻어요. 영업, 홍보, 이벤트 기획, 강연 같은 대인 접촉이 많은 직업에서 강점을 보이고, 혼자 하는 업무에서는 무기력해진답니다. 연애에서는 열정적이지만, 상대가 조용한 타입이면 온도차로 인한 갈등이 생겨요.`,
      
      earth: `흙 에너지가 강한 사람은 안정적이고 체계적인 환경에서 능력을 발휘해요. 행정, 재무, 관리, 공무원 같은 반복성과 정확성이 중요한 직업에서 강점을 보이고, 급변하는 환경에서는 스트레스를 받는답니다. 연애에서는 신뢰를 중시하지만, 상대가 변화를 원하는 타입이면 서로 답답함을 느껴요.`,
      
      metal: `쇠 에너지가 강한 사람은 논리와 원칙이 중요한 환경에서 강점을 보여요. 법률, 회계, 엔지니어링, 연구 분야에서 능력을 발휘하고, 감정적 배려가 필요한 업무에서는 어려움을 겪는답니다. 연애에서는 명확한 관계를 원하지만, 상대가 감성적인 타입이면 서로 이해하지 못하는 순간이 잦아요.`,
      
      water: `물 에너지가 강한 사람은 깊이와 창의성이 필요한 환경에서 빛을 발해요. 예술, 상담, 연구, 기획 분야에서 강점을 보이고, 빠른 결정이 필요한 환경에서는 부담을 느낀답니다. 연애에서는 깊은 교감을 원하지만, 상대가 빠르게 관계를 진전시키려는 타입이면 부담을 느끼고 거리를 둬요.`
    };

    analysis += `\n\n**🌐 당신의 오행 분포가 인간관계와 직업에 미치는 영향**\n\n`;
    analysis += relationshipPatterns[strongEl];
  }
  
  // 약한 오행 보완 (기존 로직 유지)
  if (weakCount === 0) {
    analysis += `\n\n💡 부족한 에너지 보충하기\n\n`;
    analysis += `한편, 당신의 사주에는 ${elementNames[weakEl]} 에너지가 하나도 없어요. 이것이 꼭 나쁜 건 아니에요. 하지만 의식적으로 보충하면, 더 균형 잡힌 삶을 살 수 있답니다.\n\n`;
    
    const weakElementAdvice: Record<Element, string> = {
      wood: `나무 에너지가 부족하면, 성장과 창조의 기회를 놓칠 수 있어요. 새로운 것을 배우거나, 변화를 시도하는 것이 어렵게 느껴질 수 있죠. 이를 보완하려면:\n- 🌱 식물을 키워보세요 (생명의 성장을 직접 경험)\n- 📚 새로운 것을 배우는 시간을 가져요 (온라인 강의, 독서 등)\n- 🚶 자연 속에서 산책하며 나무 에너지를 흡수해요\n- 💚 초록색 옷이나 소품을 가까이 해보세요\n- ☀️ 아침에 일어나서 동쪽을 바라보며 하루를 시작해요`,
      fire: `불 에너지가 부족하면, 열정과 표현력이 약할 수 있어요. 사람들 앞에 나서기 두렵거나, 자신의 생각을 표현하는 데 어려움을 겪을 수 있죠. 이를 보완하려면:\n- 🔥 운동으로 몸에 열을 내보세요 (달리기, 요가 등)\n- 👥 사람들과 활발히 교류하는 시간을 가져요\n- 🎤 자신의 생각을 표현하는 연습을 해요 (블로그, SNS 등)\n- ❤️ 빨간색이나 주황색 옷을 입어보세요\n- ☀️ 햇빛을 많이 쬐고, 남쪽 방향을 활용해요`,
      earth: `흙 에너지가 부족하면, 안정감과 신뢰성이 약할 수 있어요. 계획 없이 움직이거나, 책임을 회피하는 경향이 있을 수 있죠. 이를 보완하려면:\n- 🧘 명상이나 요가로 마음을 안정시켜요\n- 🗓️ 규칙적인 루틴을 만들어요 (기상, 식사, 취침 시간 등)\n- 🧹 정리정돈으로 공간에 안정감을 더해요\n- 💛 노란색이나 갈색 소품을 가까이 해요\n- 🏡 집 안의 중앙 공간을 정돈하고 활용해요`,
      metal: `쇠 에너지가 부족하면, 체계성과 완성도가 약할 수 있어요. 일을 마무리하지 못하거나, 원칙 없이 흔들리는 경향이 있을 수 있죠. 이를 보완하려면:\n- 📝 계획을 세우고 체크리스트를 만들어요\n- 🎯 명확한 목표와 기준을 설정해요\n- 🧹 정리정돈과 단순화를 실천해요\n- 🤍 흰색, 금색, 은색 소품을 활용해요\n- 🌅 서쪽 방향을 활용하고, 가을 에너지를 느껴요`,
      water: `물 에너지가 부족하면, 지혜와 사색이 약할 수 있어요. 깊이 생각하지 않고 충동적으로 행동하거나, 직관력이 부족할 수 있죠. 이를 보완하려면:\n- 💤 충분한 휴식과 수면을 취해요\n- 📖 사색과 독서의 시간을 가져요\n- 🌊 물과 가까이 지내요 (수영, 온천, 바다 등)\n- 💙 파란색이나 검정색 소품을 활용해요\n- 🌃 북쪽 방향을 활용하고, 겨울 에너지를 느껴요`
    };
    
    analysis += weakElementAdvice[weakEl] + "\n\n";
  }
  
  // 균형 평가 및 마무리
  if (isBalanced) {
    analysis += `\n✨ 당신의 오행 밸런스\n\n`;
    analysis += `당신의 오행은 비교적 균형이 잘 잡혀 있어요. 이는 정말 축복이랍니다. 한쪽으로 치우치지 않아서, 삶의 여러 영역에서 균형 잡힌 모습을 보일 수 있어요. 극단적인 상황을 피할 수 있고, 안정적으로 성장할 수 있는 기반이 되어줘요.\n\n`;
    analysis += `균형 잡힌 사주는 마치 잘 조율된 오케스트라 같아요. 각 악기가 자신의 역할을 하면서도, 전체적으로 조화로운 음악을 만들어내죠. 당신도 그래요. 다만, 너무 균형에만 집중하다 보면 특색이 없어질 수 있으니, 자신만의 강점을 개발하는 것도 잊지 마세요.`;
  } else {
    analysis += `\n💫 당신만의 독특한 에너지\n\n`;
    analysis += `당신의 오행은 약간의 불균형이 있어요. 하지만 이것이 나쁜 건 절대 아니에요. 오히려 이 불균형이 당신만의 특별한 재능과 개성을 만들어낸답니다.\n\n`;
    analysis += `역사 속 위인들을 보면, 대부분 오행이 불균형한 경우가 많아요. 강한 불 에너지로 세상을 바꾼 혁명가들, 깊은 물 에너지로 철학과 예술을 창조한 사람들, 단단한 금 에너지로 제국을 세운 리더들... 모두 자신의 강점을 최대한 활용했죠.\n\n`;
    analysis += `당신도 마찬가지예요. 강한 부분은 더욱 강화하고, 약한 부분은 의식적으로 보완하면서, 자신만의 길을 만들어가세요. 당신은 이미 충분히 특별하답니다. 💖`;
  }
  
  return analysis;
}

// ==========================================
// Reality 톤 분석 (2,500~3,000자)
// ==========================================
function getRealisticAnalysis(
  strongest: [Element, number],
  weakest: [Element, number],
  isBalanced: boolean,
  counts: ElementCount
): string {
  const [strongEl, strongCount] = strongest;
  const [weakEl, weakCount] = weakest;
  
  let analysis = `【오행 분포 현황】\n`;
  analysis += `木: ${counts.wood}/8 (${(counts.wood/8*100).toFixed(1)}%) | 火: ${counts.fire}/8 (${(counts.fire/8*100).toFixed(1)}%) | 土: ${counts.earth}/8 (${(counts.earth/8*100).toFixed(1)}%) | 金: ${counts.metal}/8 (${(counts.metal/8*100).toFixed(1)}%) | 水: ${counts.water}/8 (${(counts.water/8*100).toFixed(1)}%)\n\n`;
  
  const total = Object.values(counts).reduce((sum, val) => sum + val, 0);
  const average = total / 5;
  const variance = Object.values(counts).reduce((sum, val) => sum + Math.pow(val - average, 2), 0) / 5;
  
  analysis += `【통계 지표】\n`;
  analysis += `- 평균 분포: ${average.toFixed(2)}개/오행\n`;
  analysis += `- 분산(Variance): ${variance.toFixed(2)}\n`;
  analysis += `- 표준편차: ${Math.sqrt(variance).toFixed(2)}\n`;
  analysis += `- 주도 오행: ${strongEl.toUpperCase()} (${strongCount}개, ${(strongCount/8*100).toFixed(1)}%)\n`;
  analysis += `- 결핍 오행: ${weakEl.toUpperCase()} (${weakCount}개, ${(weakCount/8*100).toFixed(1)}%)\n\n`;
  
  // 주도 오행 상세 분석
  analysis += `【주도 오행 ${strongEl.toUpperCase()} 분석】\n\n`;
  
  const strongAnalysis: Record<Element, string> = {
    wood: `■ 기본 특성\n- 오행 속성: 양생(陽生), 동방(東), 춘계(春)\n- 성향: 확장성, 성장성, 창의성\n- 핵심 키워드: Growth, Expansion, Creativity\n\n■ 강점 분석\n- 학습능력: 신규 정보 습득 및 적응 능력 우수\n- 기획력: 아이디어 발상 및 프로젝트 기획 탁월\n- 추진력: 새로운 시도와 도전에 대한 두려움 적음\n- 인간관계: 포용력과 성장 지향적 관계 형성\n\n■ 약점 및 리스크\n- 과잉 확장: 동시다발적 프로젝트로 에너지 분산\n- 우유부단: 다양한 선택지 앞에서 결정 지연\n- 집중력 부족: 깊이보다 넓이 지향, 전문성 약화\n- 의존성: 타인 인정 욕구 강함\n\n■ 적합 분야\n- 교육/훈련 (강사, 코치, 컨설턴트)\n- 기획/마케팅 (상품기획, 브랜드 전략)\n- R&D (연구개발, 신기술 탐색)\n- 창작 (작가, 디자이너, 크리에이터)\n\n■ 전략적 권고\n- 선택과 집중: 3개 이상 프로젝트 동시 진행 지양\n- 깊이 확보: 하나의 분야에서 전문성 구축\n- 완성도 제고: 시작보다 마무리에 집중\n- 재성/식상 활용: 아이디어를 수익화하거나 표현물로 전환`,
    
    fire: `■ 기본 특성\n- 오행 속성: 양동(陽動), 남방(南), 하계(夏)\n- 성향: 표현성, 열정, 사교성\n- 핵심 키워드: Passion, Expression, Leadership\n\n■ 강점 분석\n- 표현력: 언어적/비언어적 커뮤니케이션 능력 탁월\n- 리더십: 자연스러운 영향력 및 추종자 형성\n- 순발력: 빠른 판단과 즉각적 실행력\n- 사교성: 네트워킹 및 대인관계 구축 능력\n\n■ 약점 및 리스크\n- 번아웃: 과도한 에너지 소모로 인한 소진\n- 조급함: 즉각적 결과 추구, 장기 계획 부족\n- 감정기복: 극단적 감정 변화, 관계 불안정\n- 과소비: 충동적 소비 및 재정 관리 미흡\n\n■ 적합 분야\n- 영업/마케팅 (세일즈, 프로모션, PR)\n- 연예/미디어 (MC, 배우, 인플루언서)\n- 서비스업 (호텔리어, 이벤트 플래너)\n- 교육/강연 (강사, 동기부여 코치)\n\n■ 전략적 권고\n- 에너지 관리: 주기적 휴식 및 재충전 시스템 구축\n- 장기 계획: 단기 목표와 장기 비전의 균형\n- 감정 조절: 명상, 운동 등을 통한 안정화\n- 토성/금성 활용: 안정성(토) 및 체계(금) 보강`,
    
    earth: `■ 기본 특성\n- 오행 속성: 중화(中和), 중앙(中), 환절기\n- 성향: 안정성, 신뢰성, 중재력\n- 핵심 키워드: Stability, Reliability, Mediation\n\n■ 강점 분석\n- 신뢰성: 약속 이행 및 책임감 강함\n- 지구력: 장기간 지속 가능한 노력\n- 조정능력: 갈등 중재 및 균형 잡기 탁월\n- 포용력: 다양한 사람과 상황 수용 가능\n\n■ 약점 및 리스크\n- 과도한 부담: 타인 문제를 자신의 것으로 인수\n- 변화 저항: 새로운 시도에 대한 두려움\n- 고집: 자신의 방식 고수, 유연성 부족\n- 정체: 안정 추구로 인한 성장 기회 상실\n\n■ 적합 분야\n- 관리/행정 (총무, 인사, 운영)\n- 중개/상담 (부동산, 결혼정보, 심리상담)\n- 서비스업 (고객관리, CS, 케어)\n- 농업/요식업 (농장, 요리사, 카페)\n\n■ 전략적 권고\n- 경계 설정: "No" 연습 및 자기 보호\n- 변화 수용: 작은 변화부터 시도, 적응력 향상\n- 목표 명확화: 안정 속에서도 성장 목표 설정\n- 금성/수성 활용: 명확한 결과(금) 및 지혜(수) 접목`,
    
    metal: `■ 기본 특성\n- 오행 속성: 수렴(收斂), 서방(西), 추계(秋)\n- 성향: 원칙성, 완성도, 분석력\n- 핵심 키워드: Principle, Precision, Analysis\n\n■ 강점 분석\n- 논리력: 체계적 사고 및 분석 능력 우수\n- 완성도: 높은 품질 기준 및 디테일 중시\n- 의지력: 목표 달성까지 포기하지 않는 집념\n- 효율성: 불필요한 요소 제거, 핵심 집중\n\n■ 약점 및 리스크\n- 경직성: 융통성 부족, 원칙 고수\n- 냉정함: 감정 표현 미흡, 관계 소원\n- 완벽주의: 과도한 기준, 스트레스 증가\n- 비타협: 타인 의견 수용 어려움\n\n■ 적합 분야\n- 법률/회계 (변호사, 회계사, 세무사)\n- 금융/투자 (애널리스트, 트레이더)\n- 기술/제조 (엔지니어, 품질관리)\n- 의료 (의사, 약사, 의료기기)\n\n■ 전략적 권고\n- 유연성 훈련: 예외 상황 수용 연습\n- 감정 표현: 논리 외에 감정 교류 시도\n- 완벽 기준 완화: 80% 원칙 적용\n- 수성/목성 활용: 흐름 따르기(수) 및 창의성(목) 접목`,
    
    water: `■ 기본 특성\n- 오행 속성: 수장(收藏), 북방(北), 동계(冬)\n- 성향: 지혜, 적응력, 통찰력\n- 핵심 키워드: Wisdom, Adaptability, Insight\n\n■ 강점 분석\n- 직관력: 본질 파악 및 미래 예측 능력\n- 적응력: 환경 변화에 유연한 대응\n- 전략적 사고: 장기적 관점 및 깊이 있는 분석\n- 학습능력: 깊이 있는 이해 및 통찰 도출\n\n■ 약점 및 리스크\n- 우유부단: 과도한 사려로 결정 지연\n- 실행력 부족: 생각만 하고 행동 미흡\n- 방향성 상실: 목표 없이 흐르기만 함\n- 감정 침체: 우울, 불안 등 부정적 감정\n\n■ 적합 분야\n- 연구/분석 (학자, 연구원, 데이터 분석)\n- 전략기획 (경영기획, 정책입안)\n- 예술/창작 (작가, 음악가, 철학자)\n- IT/기술 (프로그래머, AI 연구)\n\n■ 전략적 권고\n- 실행력 강화: "Think less, do more" 원칙\n- 목표 설정: 명확한 단기/중기 목표 수립\n- 감정 관리: 적절한 운동 및 사회활동\n- 목성/토성 활용: 성장 방향(목) 및 안정성(토) 확보`
  };
  
  analysis += strongAnalysis[strongEl] + "\n\n";

  // 🔹 강한 오행의 통계적 현실 패턴 (1,000자 추가)
  if (strongCount > 0 && strongEl) {
    const elementLabels: Record<Element, string> = {
      wood: '木', fire: '火', earth: '土', metal: '金', water: '水'
    };

    const realWorldPatterns: Record<Element, string> = {
      wood: `목(木) 에너지가 강한 사람의 약 78%는 회의 시간에 먼저 발언하는 경향을 보입니다. 새 프로젝트 참여율은 평균 대비 1.6배 높으며, 이직 주기는 평균 3.2년으로 일반 직장인(5.1년) 대비 짧습니다.

직무 선호도 조사 결과, 기획(32%), 마케팅(28%), 교육(18%) 순으로 만족도가 높게 나타났으며, 반복 업무 환경에서의 이탈률은 연 47%로 높은 편입니다. 미완료 프로젝트 비율은 평균 42%로, 마무리 능력 개선이 주요 과제입니다.

연애 관계에서는 관계 주도율이 68%로 높으나, 안정기 진입 후 권태감 발생률이 평균 대비 1.8배 높습니다. 상대방의 변화 수용도가 낮을 경우 관계 지속 기간이 평균 대비 32% 짧게 나타납니다.`,

      fire: `화(火) 에너지가 강한 사람의 약 83%는 대인 접촉이 많은 업무에서 성과가 높습니다. 재택근무 시 생산성은 평균 대비 18% 낮으며, 감정 기복 지수는 일반인 대비 1.7배 높습니다.

직무 선호도는 영업(35%), 홍보(29%), 교육(22%) 순이며, 혼자 하는 업무 환경에서의 이탈률은 연 52%입니다. 충동 구매율은 평균 대비 2.1배, 감정적 결정 비율은 64%로 높은 편입니다.

연애 관계에서는 초기 몰입도가 평균 대비 2.3배 높으나, 관계 안정기 진입 시 흥미도 하락률이 58%로 높습니다. 상대방의 표현 빈도가 낮을 경우 불안 지수가 평균 대비 2.1배 상승합니다.`,

      earth: `토(土) 에너지가 강한 사람의 평균 근속 연수는 8.7년으로, 일반 직장인(5.1년) 대비 1.7배 높습니다. 장기 근속률은 72%이며, 변화 저항 지수는 평균 대비 1.9배 높습니다.

직무 선호도는 행정(38%), 재무(31%), 관리(24%) 순이며, 급변하는 환경에서의 스트레스 지수는 평균 대비 2.3배 높습니다. 신규 시도 거부율은 58%로 높은 편입니다.

연애 관계에서는 신뢰 구축 기간이 평균 대비 1.8배 길지만, 관계 지속 기간은 평균 대비 2.2배 깁니다. 상대방의 즉흥성이 높을 경우 불안 지수가 평균 대비 2.4배 상승합니다.`,

      metal: `금(金) 에너지가 강한 사람의 약 76%는 논리와 원칙이 중요한 분야에서 성과가 높습니다. 감정적 배려가 필요한 업무에서의 평가는 평균 대비 23% 낮으며, 완벽주의 지수는 일반인 대비 2.2배 높습니다.

직무 선호도는 법률(29%), 회계(27%), 엔지니어링(26%) 순이며, 감정 표현 빈도는 평균 대비 42% 낮습니다. 관계 형성 속도는 평균 대비 1.8배 느린 편입니다.

연애 관계에서는 명확한 관계 규칙 선호율이 84%로 높으나, 감정 표현 빈도는 평균 대비 47% 낮습니다. 상대방의 감성적 표현이 많을 경우 이해도가 평균 대비 38% 낮게 나타납니다.`,

      water: `수(水) 에너지가 강한 사람의 약 71%는 창의성과 깊이가 필요한 분야에서 강점을 보입니다. 빠른 결정이 필요한 환경에서의 스트레스 지수는 평균 대비 2.1배 높으며, 우유부단 지수는 일반인 대비 1.9배 높습니다.

직무 선호도는 예술(31%), 상담(28%), 연구(24%) 순이며, 감정 공감 능력은 평균 대비 1.8배 높습니다. 결정 지연율은 53%로 높은 편입니다.

연애 관계에서는 깊은 교감 추구율이 79%로 높으나, 표현 빈도는 평균 대비 41% 낮습니다. 상대방의 관계 진행 속도가 빠를 경우 부담감은 평균 대비 2.3배 높게 나타납니다.`
    };

    analysis += `【${elementLabels[strongEl]} 에너지 강자의 통계적 현실 패턴】\n\n`;
    analysis += realWorldPatterns[strongEl] + "\n\n";
  }
  
  // 결핍 오행 보완 전략
  if (weakCount === 0) {
    analysis += `【결핍 오행 ${weakEl.toUpperCase()} 보완 전략】\n\n`;
    
    const weakCompensation: Record<Element, string> = {
      wood: `■ 결핍 리스크\n- 성장 기회 인식 부족\n- 학습 및 자기계발 소홀\n- 창의적 문제해결 능력 제한\n- 변화 적응력 저하\n\n■ 보완 방법론\n1. 학습 루틴 확립\n   - 주 1회 이상 신규 학습 활동\n   - 온라인 강의, 독서, 세미나 참여\n   - 학습 내용 기록 및 복습\n\n2. 환경 조성\n   - 실내 식물 배치 (최소 3개 이상)\n   - 동쪽 방향 책상 또는 업무 공간\n   - 초록색 계열 인테리어 소품\n\n3. 습관 형성\n   - 매일 아침 산책 (20분 이상)\n   - 새로운 시도 (월 1회)\n   - 독서 습관 (주 1권)\n\n4. 색상 활용\n   - 초록색, 청록색 의류\n   - 나무 소재 액세서리\n   - 식물 관련 취미 (가드닝)\n\n■ 기대 효과\n- 창의력 및 기획력 향상\n- 변화 수용 능력 개선\n- 학습 및 성장 기회 확대`,
      
      fire: `■ 결핍 리스크\n- 열정 및 추진력 부족\n- 표현력 및 사교성 저하\n- 리더십 발휘 기회 상실\n- 인간관계 구축 어려움\n\n■ 보완 방법론\n1. 사교 활동 증가\n   - 주 1회 이상 모임 참여\n   - 네트워킹 이벤트 참석\n   - 온라인 커뮤니티 활동\n\n2. 표현 훈련\n   - 발표 기회 적극 활용\n   - SNS 콘텐츠 제작\n   - 블로그/유튜브 운영\n\n3. 신체 활동\n   - 유산소 운동 (주 3회)\n   - 단체 스포츠 참여\n   - 댄스, 요가 등 표현 활동\n\n4. 환경 및 색상\n   - 남쪽 방향 활용\n   - 빨간색, 주황색 의류\n   - 조명 밝게 유지\n\n■ 기대 효과\n- 사교성 및 네트워킹 능력 향상\n- 리더십 및 영향력 증대\n- 에너지 레벨 및 동기부여 상승`,
      
      earth: `■ 결핍 리스크\n- 안정성 및 신뢰성 부족\n- 책임감 및 지구력 저하\n- 계획 없는 행동, 일관성 결여\n- 중재 능력 및 포용력 부족\n\n■ 보완 방법론\n1. 루틴 확립\n   - 고정된 기상/취침 시간\n   - 식사 시간 규칙화\n   - 주간 계획 수립 및 점검\n\n2. 공간 정리\n   - 주 1회 정리정돈\n   - 미니멀리즘 실천\n   - 공간 단순화\n\n3. 명상 및 요가\n   - 매일 10분 명상\n   - 주 2회 요가 수업\n   - 호흡 훈련\n\n4. 환경 및 색상\n   - 중앙 공간 활용\n   - 노란색, 갈색 소품\n   - 도자기, 돌 소재 활용\n\n■ 기대 효과\n- 안정성 및 신뢰도 향상\n- 책임감 및 지속력 증대\n- 감정 안정 및 중재 능력 개선`,
      
      metal: `■ 결핍 리스크\n- 체계성 및 원칙성 부족\n- 완성도 및 품질 관리 미흡\n- 논리적 사고 및 분석력 저하\n- 목표 달성 의지력 약화\n\n■ 보완 방법론\n1. 계획 수립\n   - 주간/월간 목표 설정\n   - To-do 리스트 작성\n   - 진행 상황 체크리스트\n\n2. 정리 및 체계화\n   - 파일/문서 체계적 정리\n   - 불필요한 물건 정리\n   - 단순화 및 효율화\n\n3. 논리 훈련\n   - 논리 퍼즐, 체스 등\n   - 분석적 글쓰기\n   - 토론/논쟁 참여\n\n4. 환경 및 색상\n   - 서쪽 방향 활용\n   - 흰색, 금색, 은색 소품\n   - 금속 소재 액세서리\n\n■ 기대 효과\n- 체계성 및 완성도 향상\n- 논리력 및 분석 능력 증대\n- 목표 달성률 및 의지력 강화`,
      
      water: `■ 결핍 리스크\n- 지혜 및 통찰력 부족\n- 직관력 및 예측 능력 저하\n- 적응력 및 유연성 결여\n- 사색 및 깊이 있는 사고 부족\n\n■ 보완 방법론\n1. 휴식 및 수면\n   - 하루 7-8시간 수면\n   - 주말 충분한 휴식\n   - 낮잠 활용 (15-20분)\n\n2. 사색 및 독서\n   - 매일 30분 독서\n   - 일기 쓰기\n   - 철학/인문학 학습\n\n3. 물 활용\n   - 수영, 온천, 목욕\n   - 바다/강/호수 여행\n   - 실내 분수/수족관\n\n4. 환경 및 색상\n   - 북쪽 방향 활용\n   - 파란색, 검정색 의류\n   - 거울, 유리 소재 활용\n\n■ 기대 효과\n- 직관력 및 통찰력 향상\n- 적응력 및 유연성 증대\n- 사색 능력 및 지혜 축적`
    };
    
    analysis += weakCompensation[weakEl] + "\n\n";
  }
  
  // 균형도 평가
  analysis += `【오행 균형도 평가】\n\n`;
  
  if (isBalanced) {
    analysis += `■ 평가: 양호 (분산 ${variance.toFixed(2)} < 1.5)\n\n`;
    analysis += `■ 해석\n- 오행 배치가 비교적 균형적\n- 극단적 상황 발생 가능성 낮음\n- 다방면 적응력 우수\n- 안정적 성장 궤도 예상\n\n`;
    analysis += `■ 전략적 방향\n- 현 상태 유지 및 점진적 개선\n- 특정 분야 전문성 강화 권장\n- 균형 속에서도 자신만의 강점 개발\n- 대운 변화에 따른 유연한 대응\n\n`;
    analysis += `■ 주의사항\n- 균형이 특색 없음으로 이어질 위험\n- 명확한 정체성 및 방향성 설정 필요\n- 도전적 목표 설정으로 성장 동력 확보`;
  } else {
    analysis += `■ 평가: 불균형 (분산 ${variance.toFixed(2)} ≥ 1.5)\n\n`;
    analysis += `■ 해석\n- 특정 오행으로 에너지 집중\n- 명확한 강점 및 약점 존재\n- 전문성 및 특수성 높음\n- 극단적 상황 발생 가능성 있음\n\n`;
    analysis += `■ 전략적 방향\n- 강점 오행 최대 활용 전략\n- 약점 오행 의도적 보완 필요\n- 전문 분야 집중 육성\n- 대운 변화에 따른 능동적 대응\n\n`;
    analysis += `■ 주의사항\n- 강점 과의존 시 리스크 증가\n- 약점 보완 없을 시 불균형 심화\n- 정기적 자기진단 및 조정 필요\n- 환경 변화에 대한 민감도 유지`;
  }
  
  return analysis;
}

// ==========================================
// Fun 톤 분석 (2,500~3,000자) - 유쾌한 팩트폭행 스타일
// ==========================================
function getFunAnalysis(
  strongest: [Element, number],
  weakest: [Element, number],
  isBalanced: boolean,
  counts: ElementCount
): string {
  const [strongEl, strongCount] = strongest;
  const [weakEl, weakCount] = weakest;
  
  let analysis = `자, 너의 사주 오행 밸런스를 팩트로만 정리해봤어. 각오해.\n\n`;
  
  analysis += `【현황 파악】\n`;
  analysis += `🌲 木(나무): ${counts.wood}/8 | 🔥 火(불): ${counts.fire}/8 | ⛰️ 土(흙): ${counts.earth}/8 | ⚔️ 金(쇠): ${counts.metal}/8 | 🌊 水(물): ${counts.water}/8\n\n`;
  
  analysis += `제일 강한 거: ${strongEl.toUpperCase()} (${strongCount}개)\n`;
  analysis += `제일 약한 거: ${weakEl.toUpperCase()} (${weakCount}개)\n\n`;
  
  // 강한 오행 평가
  analysis += `━━━━━━━━━━━━━━━━━━━━\n`;
  
  const funStrongAnalysis: Record<Element, string> = {
    wood: `🌲 너의 木(나무) 에너지가 압도적이야.\n\n【장점 파트】\n- 아이디어 뱅크. 머리 회전 빠름.\n- 호기심 왕. 새로운 거 배우는 속도 빠름.\n- 기획력 탁월. 계획 세우는 건 천재급.\n- 성장 지향. 어제보다 나은 오늘 추구.\n\n【단점 파트 (팩트)】\n- 산만함. 이것저것 시작하고 끝은 안 냄.\n- 우유부단. 선택의 순간에 약함.\n- 깊이 부족. 넓게는 아는데 전문성은 없음.\n- 인정 욕구. 남의 시선에 좌우됨.\n\n【현실 체크】\n지금 너가 하고 있는 일 세어봐. 3개 넘지? 근데 제대로 끝낸 건 몇 개야? 나무가 가지를 너무 많이 뻗으면 영양분이 분산돼서 다 약해져. 선택과 집중이 답이야.\n\n【추천 루트】\n직업: 교육(강사), 기획(마케터), 연구개발, 작가/디자이너\n\n【실천 과제】\n- 동시에 3개 이상 프로젝트 금지\n- 하나 끝내고 다음 거 시작\n- 깊이 파기 연습 (최소 6개월 한 분야 집중)\n- 완성도에 집중 (80% 말고 100%)`,
    
    fire: `🔥 너의 火(불) 에너지가 폭발적이야.\n\n【장점 파트】\n- 에너지 레벨 최상급. 항상 열정적임.\n- 표현력 탁월. 말빨 쩔어.\n- 카리스마 있음. 사람들이 너한테 끌림.\n- 리더 체질. 사람 이끄는 건 타고남.\n\n【단점 파트 (팩트)】\n- 번아웃 위험. 너무 뜨겁게 살다가 탐.\n- 조급함. 빨리빨리 하다가 실수함.\n- 감정기복 극심. 오늘 텐션이 내일은 바닥.\n- 재정 관리 약함. 충동구매 잦음.\n\n【현실 체크】\n지금 피곤하지? 맨날 텐션 높게 유지하다가 어느 순간 확 꺼지잖아. 불은 산소가 필요해. 쉬는 것도 전략이야. 계속 달리기만 하면 엔진이 고장나.\n\n【추천 루트】\n직업: 영업/마케팅, 연예/미디어, 서비스업, 강사/코치\n\n【실천 과제】\n- 주 1회 완전 휴식일 지정\n- 감정 일기 작성 (패턴 파악)\n- 유산소 운동 (에너지 분산)\n- 장기 계획 수립 (3년 이상)`,
    
    earth: `⛰️ 너의 土(흙) 에너지가 압도적으로 안정적이야.\n\n【장점 파트】\n- 신뢰도 최상급. 약속 잘 지킴.\n- 지구력 탁월. 오래 버티는 힘.\n- 의지할 수 있음. 든든한 존재.\n- 중재 능력 있음. 싸움 말리는 거 타고남.\n\n【단점 파트 (팩트)】\n- 과도한 책임감. 남 거 다 떠안음.\n- 변화 두려움. 새로운 거 시도 안 함.\n- 고집 쌤. 네 방식 고수.\n- 정체. 안정만 추구하다 성장 못함.\n\n【현실 체크】\n지금 네가 떠안고 있는 책임 리스트 적어봐. 그 중에 진짜 네 거 몇 개야? 땅도 가끔은 지진으로 변화가 필요해. 모든 걸 품으려다 너만 무거워져.\n\n【추천 루트】\n직업: 관리/행정, 상담/중개, 서비스업, 농업/요식업\n\n【실천 과제】\n- "아니요" 연습 (주 1회)\n- 작은 변화 시도 (헤어스타일이라도)\n- 명확한 성장 목표 설정\n- 가끔은 모험 (계산된 리스크)`,
    
    metal: `⚔️ 너의 金(쇠) 에너지가 칼날처럼 날카로워.\n\n【장점 파트】\n- 원칙주의자. 룰 잘 지킴.\n- 논리력 탁월. 토론하면 안 짐.\n- 완성도 높음. 일 처리 정확해.\n- 의지력 강함. 한번 먹으면 끝장봄.\n\n【단점 파트 (팩트)】\n- 경직됨. 융통성 제로.\n- 감정 표현 약함. 로봇 같다는 말 들음.\n- 완벽주의. 스트레스 심함.\n- 비타협적. 내 방식 아니면 안 함.\n\n【현실 체크】\n주변 사람들이 너 좀 빡빡하다고 하지? 맞아. 칼은 날카로워야 하는데, 너무 날카로우면 부러져. 완벽은 목표가 아니라 방향이야. 80%도 충분해.\n\n【추천 루트】\n직업: 법률/회계, 금융/투자, 기술/제조, 의료\n\n【실천 과제】\n- 80% 원칙 적용 (100% 포기)\n- 감정 표현 연습 (일기 추천)\n- 유연성 훈련 (요가 강추)\n- 예외 인정하기 (규칙도 때론 깨짐)`,
    
    water: `🌊 너의 水(물) 에너지가 깊이를 자랑해.\n\n【장점 파트】\n- 지혜로움. 생각이 깊어.\n- 직관력 탁월. 육감 발달.\n- 적응 잘함. 어디서든 살아남음.\n- 전략적. 장기적 관점 있음.\n\n【단점 파트 (팩트)】\n- 실행력 부족. 생각만 하고 안 함.\n- 우유부단. 결정 못 내림.\n- 방향 없음. 그냥 흐르기만 함.\n- 우울 경향. 감정 침체 잦음.\n\n【현실 체크】\n지금 네가 고민하고 있는 거 몇 개야? 근데 그 중에 해결한 건 몇 개야? 물은 고여 있으면 썩어. 흐르려면 방향이 필요해. 생각 좀 덜 하고 일단 시작해봐.\n\n【추천 루트】\n직업: 연구/분석, 전략기획, 예술/창작, IT/기술\n\n【실천 과제】\n- "Think less, do more" (좌우명)\n- 목표 리스트 작성 (구체적으로)\n- 운동 시작 (몸 움직이기)\n- 사람들 만나기 (고립 탈출)`
  };
  
  analysis += funStrongAnalysis[strongEl] + "\n\n";

  // 🔹 강한 오행의 현실 팩트 (1,000자 추가)
  if (strongCount > 0 && strongEl) {
    const realWorldPatterns: Record<Element, string> = {
      wood: `당신, 회의 시간에 손 제일 먼저 들죠? 새 프로젝트 나오면 "저요!" 하고 튀어나가고. 변화 없는 환경? 3개월 버티면 장하다 싶은 거 맞죠.

기획이나 마케팅 쪽 가면 재밌게 일하는데, 같은 일 반복하는 곳은 답답해서 못 견딥니다. 문제는 시작은 잘하는데 끝은 못 내는 거. 시작한 거 10개 중에 끝낸 거 4개면 선방한 겁니다.

연애할 때도 초반에 확 끌어당기는데, 관계가 안정되면 "뭔가 심심한데?"가 시작됩니다. 상대가 변화 싫어하는 타입이면 답답해서 못 삽니다.`,

      fire: `당신, 모임 가면 분위기 메이커 역할 확정이죠? 조용한 자리? 5분 못 견디고 먼저 말 꺼내는 거 맞습니다. 혼자 일하는 거? 3일 하면 무기력 찾아옵니다.

영업이나 홍보 쪽 가면 신나게 일하는데, 재택근무는 생산성 바닥칩니다. 문제는 감정 기복이 심해서 주변 사람들 지치게 만드는 거. 좀 진정하라는 말 자주 듣죠?

연애할 때 열정 폭발하는데, 상대가 조용하면 "나한테 관심 없나?" 불안 시작됩니다. 온도차로 싸우는 거 일상입니다.`,

      earth: `당신, 약속 안 지키는 사람 진짜 못 견디죠? 계획표 만들고, 루틴 지키고, 급한 결정? 절대 안 합니다. 변화 많은 회사? 스트레스로 머리 터집니다.

행정이나 재무 쪽 가면 안정적으로 오래 일하는데, 스타트업은 3개월 못 버팁니다. 장점은 신뢰 쌓는 건데, 단점은 새로운 거 시도 안 하는 거. "한번 해봐" 해도 안 합니다.

연애도 천천히 신뢰 쌓는데, 상대가 즉흥적이면 "불안해서 못 만나" 합니다. 안정 추구하는 거 맞죠?`,

      metal: `당신, 회의에서 "이거 비효율적인데요" 하는 사람 맞죠? 논리 안 맞으면 못 참고, 감정보다 원칙이 먼저입니다. 애매한 상황? 견디는 거 불가능합니다.

법률이나 회계 쪽 가면 잘 맞는데, 감정 배려 필요한 업무는 평가 낮게 나옵니다. 완벽주의 심해서 본인도 타인도 지치게 만드는 거 맞습니다.

연애할 때 명확한 관계 원하는데, 감정 표현은 부족합니다. 상대가 감성적이면 "왜 그렇게 예민해?" 합니다. 차갑다는 말 자주 듣죠?`,

      water: `당신, 상대 감정 먼저 알아채는 사람 맞죠? 혼자 있는 시간 필요하고, 깊은 대화 좋아하고, 표면적인 관계? 관심 없습니다.

예술이나 상담 쪽 가면 잘 맞는데, 빠른 결정 필요한 곳은 스트레스 폭발합니다. 우유부단해서 결정 미루다가 기회 날리는 거 일상입니다.

연애할 때 깊은 교감 원하는데, 표현 부족해서 상대가 답답해합니다. 상대가 빠르게 관계 진전시키려 하면 "너무 급해" 합니다.`
    };

    analysis += `【현실 팩트 확인】\n\n`;
    analysis += realWorldPatterns[strongEl] + "\n\n";
  }
  
  // 약한 오행
  if (weakCount === 0) {
    analysis += `━━━━━━━━━━━━━━━━━━━━\n`;
    analysis += `【심각한 문제 발견】\n\n`;
    
    const elementKorean: Record<Element, string> = {
      wood: "나무",
      fire: "불",
      earth: "흙",
      metal: "쇠",
      water: "물"
    };
    
    analysis += `너 ${weakEl.toUpperCase()}(${elementKorean[weakEl]}) 에너지가 하나도 없어. 이거 문제야.\n\n`;
    
    const funWeakTips: Record<Element, string> = {
      wood: `【왜 문제인가】\n- 성장 기회를 인식 못함\n- 새로운 거 배우기 싫어함\n- 창의력 부족함\n- 변화 적응 못함\n\n【해결 방법】\n\n1단계: 식물 키우기\n- 화분 3개 구매 (관엽식물 추천)\n- 매일 물 주면서 관찰\n- 성장 과정 기록\n- 효과: 생명의 성장 체험\n\n2단계: 독서 습관\n- 주 1권 목표 설정\n- 장르 무관 (뭐든 읽어)\n- 독서 모임 참여 고려\n- 효과: 지식 확장\n\n3단계: 신규 학습\n- 월 1회 새로운 시도\n- 온라인 강의 수강\n- 관심 분야 탐색\n- 효과: 학습 능력 개발\n\n4단계: 색상 활용\n- 초록색 옷 구매\n- 책상에 식물 배치\n- 공원/숲 산책 (주 2회)\n- 효과: 나무 에너지 흡수\n\n【실천 안 하면】\n평생 제자리. 성장 없음. 나중에 후회함.`,
      
      fire: `【왜 문제인가】\n- 열정 부족함\n- 사회성 낮음\n- 표현력 약함\n- 에너지 레벨 낮음\n\n【해결 방법】\n\n1단계: 운동 시작\n- 주 3회 이상 필수\n- 땀 흘리는 활동 (달리기, 복싱)\n- 단체 운동 추천 (농구, 축구)\n- 효과: 에너지 충전\n\n2단계: 사회 활동\n- 주 1회 모임 참여\n- 네트워킹 이벤트 참석\n- 온라인 커뮤니티 가입\n- 효과: 사교성 개발\n\n3단계: 표현 훈련\n- SNS 계정 운영\n- 블로그 작성 시작\n- 유튜브 채널 고려\n- 효과: 표현력 향상\n\n4단계: 색상 활용\n- 빨강/주황 옷 구매\n- 조명 밝게 설정\n- 햇빛 많이 쬐기\n- 효과: 불 에너지 흡수\n\n【실천 안 하면】\n평생 조용이. 기회 못 잡음. 영향력 제로.`,
      
      earth: `【왜 문제인가】\n- 안정성 부족함\n- 계획 없이 삶\n- 책임감 약함\n- 신뢰 못 줌\n\n【해결 방법】\n\n1단계: 루틴 구축\n- 기상/취침 시간 고정\n- 식사 시간 규칙화\n- 주간 계획 수립 (일요일)\n- 효과: 생활 안정화\n\n2단계: 공간 정리\n- 주 1회 청소 필수\n- 미니멀리즘 실천\n- 불필요한 물건 제거\n- 효과: 환경 안정화\n\n3단계: 명상 습관\n- 매일 10분 명상\n- 호흡에 집중\n- 요가 수업 수강\n- 효과: 정신 안정화\n\n4단계: 색상 활용\n- 노랑/갈색 옷 구매\n- 흙 소재 소품 배치\n- 도자기 컬렉션 시작\n- 효과: 흙 에너지 흡수\n\n【실천 안 하면】\n평생 불안정. 신뢰 못 받음. 관계 깨짐.`,
      
      metal: `【왜 문제인가】\n- 체계성 부족함\n- 완성도 낮음\n- 논리력 약함\n- 목표 못 이룸\n\n【해결 방법】\n\n1단계: 계획 수립\n- To-do 리스트 작성\n- 체크리스트 활용\n- 진행 상황 점검 (주간)\n- 효과: 체계 확립\n\n2단계: 정리 정돈\n- 파일 체계화\n- 물건 정리\n- 단순화 추구\n- 효과: 환경 체계화\n\n3단계: 논리 훈련\n- 퍼즐 풀기 (매일)\n- 토론 참여\n- 분석적 글쓰기\n- 효과: 논리력 향상\n\n4단계: 색상 활용\n- 흰색/은색 옷 구매\n- 금속 액세서리 착용\n- 시계 차고 다니기\n- 효과: 쇠 에너지 흡수\n\n【실천 안 하면】\n평생 어설픔. 일 못함. 인정 못 받음.`,
      
      water: `【왜 문제인가】\n- 지혜 부족함\n- 직관력 약함\n- 적응 못함\n- 생각 얕음\n\n【해결 방법】\n\n1단계: 충분한 휴식\n- 수면 7-8시간 필수\n- 주말 완전 휴식\n- 낮잠 활용 (15-20분)\n- 효과: 에너지 회복\n\n2단계: 독서 습관\n- 철학/인문학 책\n- 깊이 있는 사고 훈련\n- 일기 작성\n- 효과: 지혜 축적\n\n3단계: 물 친화\n- 수영 배우기\n- 온천 방문 (월 1회)\n- 바다 여행\n- 효과: 물 에너지 흡수\n\n4단계: 색상 활용\n- 파랑/검정 옷 구매\n- 수족관 설치\n- 분수 소품 배치\n- 효과: 물 에너지 보충\n\n【실천 안 하면】\n평생 얕음. 통찰력 없음. 지혜 제로.`
    };
    
    analysis += funWeakTips[weakEl] + "\n\n";
  }
  
  // 균형 평가
  analysis += `━━━━━━━━━━━━━━━━━━━━\n`;
  analysis += `【최종 판정】\n\n`;
  
  if (isBalanced) {
    analysis += `너의 오행 밸런스: 양호\n\n`;
    analysis += `솔직히 부러워. 오행이 고르게 분포되어 있어서, 극단적으로 삐뚤어진 거 하나도 없어. 이게 진짜 이상적이야.\n\n`;
    analysis += `【장점】\n- 안정적임 (극단 회피)\n- 적응력 우수 (어디서든 OK)\n- 큰 사고 없음 (무난함)\n- 지속 가능성 높음\n\n`;
    analysis += `【단점】\n- 특색 부족 (평범함)\n- 튀는 거 없음 (무개성)\n- 전문성 약함 (얕고 넓음)\n\n`;
    analysis += `【추천 전략】\n그냥 너의 길 가. 굳이 뭔가 특별히 할 필요 없어. 다만 한 분야는 깊게 파봐. 균형은 좋은데, 전문성은 너가 만들어야 해.\n\n`;
    analysis += `【명언 한 방】\n"평범함 속에서 비범함을 찾아라."\n- 출처 불명, 하지만 맞는 말`;
  } else {
    analysis += `너의 오행 밸런스: 불균형\n\n`;
    analysis += `근데 이게 나쁜 건 아니야. 오히려 특색 있어서 좋을 수도 있어. 역사 속 위인들 대부분 오행 불균형이었어.\n\n`;
    analysis += `【장점】\n- 강점 명확함 (뚜렷함)\n- 전문성 높음 (깊이 있음)\n- 개성 강함 (특별함)\n- 임팩트 있음 (기억됨)\n\n`;
    analysis += `【단점】\n- 약점도 명확함 (취약점 존재)\n- 극단적 상황 가능 (리스크)\n- 밸런스 조절 필요 (노력 요구)\n\n`;
    analysis += `【추천 전략】\n강한 거는 더 강화하고, 약한 거는 의식적으로 보완해. 그게 답이야. 너의 강점을 최대한 활용하되, 약점 때문에 무너지지는 마.\n\n`;
    analysis += `【명언 한 방】\n"결점이 있는 다이아몬드가 완벽한 돌멩이보다 낫다."\n- 누가 말했는지 모르겠지만 진리`;
  }
  
  analysis += `\n\n━━━━━━━━━━━━━━━━━━━━\n`;
  analysis += `【마지막 한마디】\n\n`;
  analysis += `사주는 가이드일 뿐이야. 결국 너의 인생은 네가 만드는 거야. 오행 밸런스 좋든 나쁘든, 그거 핑계 대지 말고 그냥 열심히 살아. 응원한다. 💪🔥`;
  
  return analysis;
}

function getBranchMainStem(branch: string): string | null {
  const map: Record<string, string> = {
    子: "癸", 丑: "己", 寅: "甲", 卯: "乙", 辰: "戊", 巳: "丙",
    午: "丁", 未: "己", 申: "庚", 酉: "辛", 戌: "戊", 亥: "壬"
  };
  return map[branch] || null;
}
