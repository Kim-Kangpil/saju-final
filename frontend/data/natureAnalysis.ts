type CharKey = "empathy" | "reality" | "fun";
type GenderKey = "male" | "female";

interface NatureAnalysisResult {
  dayStem: string;
  yangCount: number;
  yinCount: number;
  combinedText: Record<CharKey, string>;
}

// 일간별 기질 설명 (3가지 톤)
const DAY_STEM_NATURE: Record<string, Record<CharKey, string>> = {
  "甲": {
    empathy: "타고난 기질은 곧게 자라는 나무예요. 느려 보여도 결국 자기 방향으로 가는 힘이 있어요. 리더가 되고 싶어서가 아니라 책임을 그냥 지나치지 못해서 중심에 서게 되는 타입이에요. 신념에서 오는 단단함이 있어 시간이 지나면 사람들이 믿고 따르게 돼요. 다만 혼자 다 감당하려는 습관 때문에 지칠 수 있어요. 감수성도 높은 편이라 분위기는 잘 읽지만 표현은 서툴 수 있어요. 당신은 원래 과묵한 나무예요.",
    reality: "타고난 기질은 방향성이 강한 나무형 구조입니다. 속도보다는 일관성을 중시하고, 외부보다 내부 기준을 따르는 편이에요. 리더십은 욕심이 아니라 책임 회피가 어려운 성향에서 자연스럽게 발생합니다. 신념 기반의 고집이 있어 시간이 지나면 신뢰가 쌓이는 패턴을 만들어요. 다만 자율성이 높아 부담을 혼자 처리하려는 경향이 있습니다. 감수성은 높지만 표현값은 낮은 편이에요. 조용하지만 중심이 선명한 타입입니다.",
    fun: "너는 그냥 방향 정하면 끝까지 가는 나무같은 사람이야. 느려 보여도 결국 네가 맞다고 생각한 길로 가잖아. 리더 되고 싶어서가 아니라 책임 생기면 그냥 네가 나서게 돼. 고집 있는데 그게 신념이라 사람들이 결국 인정해. 문제는 혼자 다 짊어진다는 거야. 도움 잘 안 받고 버티다가 지치는 패턴 있지. 분위기 다 읽으면서도 말은 별로 안 해. 속 깊은데 표현이 짧아. 너 원래 과묵한 나무야."
  },
  "乙": {
    empathy: "타고난 기질은 덩굴처럼 유연한 생명력이에요. 어떤 상황에서도 적응하는 힘이 있고, 뻣뻣하게 부러지기보다 휘었다가 다시 일어나는 타입이에요. 겉으로는 순해 보여도 내면엔 꽤 단단한 중심이 있어요. 그래서 사람들이 가볍게 봤다가 나중에 “생각보다 강하네” 하고 놀라는 경우가 많죠. 사람에게 잘 맞춰주는 편이라 인간관계가 넓지만, 그만큼 에너지 소모도 큰 편이에요. 사실 혼자만의 시간이 꼭 필요한 사람이에요. 분위기를 워낙 잘 읽다 보니 하고 싶은 말을 참는 경우도 있고, 그게 쌓이면 번아웃으로 이어질 수 있어요. 미적 감각이 좋고, 예쁘게 꾸미거나 세심하게 챙기는 걸 좋아해요. 당신은 약해서 유연한 게 아니라, 오래 살아남는 방식이 몸에 밴 사람이에요.",
    reality: "타고난 기질은 유연 적응형 구조입니다. 환경 변화에 대한 대응력이 빠르고, 충돌보다 조율을 선택하는 성향이에요. 겉으로는 순해 보이지만 회복 탄성이 높아 쉽게 꺾이지 않습니다. 초기 평가보다 시간이 지날수록 강점이 드러나는 패턴이에요. 대인 적응력이 높아 인간관계는 넓지만 에너지 소모량도 큰 편입니다. 단독 회복 시간이 필요해요. 분위기 감지 능력이 뛰어나 표현을 절제하는 경향이 있고, 누적되면 번아웃으로 이어질 수 있습니다. 미적 감각과 디테일 감수성이 강점입니다.",
    fun: "너는 어디서든 살아남는 타입이야. 부러지지 않고 휘었다가 다시 일어나잖아. 겉은 순해 보여도 속은 꽤 단단해. 그래서 사람들이 만만하게 봤다가 나중에 놀라. 사람 잘 맞춰줘서 인간관계 넓은데, 그만큼 에너지 많이 쓴다. 혼자 있는 시간 없으면 금방 지쳐. 분위기 다 읽어서 하고 싶은 말 참고 넘기는 경우도 많고, 그게 쌓이면 번아웃 오기 쉬워. 그리고 너 감각 좋아. 예쁘게 꾸미고 세심하게 챙기는 거 잘하잖아. 유연한 건 약해서가 아니라, 오래 버티는 방식이 몸에 밴 거야."
  },
  "丙": {
    empathy: "타고난 기질은 태양처럼 환하고 따뜻한 에너지예요. 당신이 들어오는 것만으로 공간 분위기가 바뀌는 편이고, 낯을 가려도 금세 풀려 사람들이 자연스럽게 모여요. 친구들 고민을 잘 들어줘서 상담사 역할을 자주 맡죠. 밝음은 분명 큰 장점이에요. 다만 속이 복잡한 날에도 티를 잘 못 내서 겉으로 웃고 있지만 사실은 지쳐 있을 때가 있어요. 주변에 많이 퍼주는 만큼 자기 충전도 꼭 필요해요. 즉흥적이고 에너지 기반으로 움직여 준비가 덜 돼도 일단 해보고 결국 해내는 경우가 많아요. 당신이 있으면 분위기가 살아나요. 그건 분명한 재능이에요.",
    reality: "타고난 기질은 확산형 에너지 구조입니다. 존재 자체가 공간의 분위기를 바꾸는 영향력을 갖고 있고, 초기 낯가림이 있어도 사회적 적응 속도가 빠른 편이에요. 공감 능력이 높아 자연스럽게 고민 상담 역할을 맡게 됩니다. 밝음은 대인 매력으로 작용하지만, 감정 표현을 후순위로 두는 경향이 있어 내부 피로가 누적될 수 있어요. 에너지 소모 대비 충전 관리가 중요합니다. 행동 패턴은 즉흥성과 감각 중심이며 계획보다 실행이 빠른 편이에요. 준비 완성도보다 추진력이 결과를 만드는 구조입니다. 분위기를 살리는 힘이 병화의 핵심 자산입니다.",
    fun: "너는 태양같은 사람이야. 네가 들어오면 분위기 확 바뀌지. 낯 가린다고 해도 금방 풀리고 사람들이 자연스럽게 모여. 친구들 고민 상담도 자주 맡잖아. 근데 밝다고 해서 항상 괜찮은 건 아니지. 속 복잡한 날에도 티 잘 안 내고 혼자 웃고 넘기는 경우 많아. 퍼주는 건 잘하는데 충전은 잘 안 해. 그거 오래 가면 지친다. 너는 계획형이라기보다 감각형이야. 준비 덜 됐어도 일단 해보고 결국 해내는 스타일. 네가 있으면 분위기 살아나는 거, 그거 진짜 재능이야."
  },
  "丁": {
    empathy: "타고난 기질은 촛불처럼 집중된 따뜻함이에요. 관심 있는 사람과 소중한 것에는 전부를 쏟는 스타일이고, 넓게 퍼지기보다 깊게 파고드는 타입이라 친한 사람과의 관계는 진짜 깊고 오래가요. 처음엔 조용해 보여도 친해지면 전혀 다른 면이 드러난다는 말을 자주 듣죠. 감정 기복이 아예 없는 건 아니에요. 내면에서 많은 걸 느끼지만 밖으로 잘 드러내지 않아 혼자 삭히는 감정이 있는 편이에요. 가끔은 그냥 표현해도 괜찮다는 걸 스스로 잊기도 하죠. 완벽하게 해내고 싶은 마음이 커서 안 될 것 같으면 시작을 미루기도 하지만, 일단 붙잡으면 퀄리티는 확실히 나오는 타입이에요. 깊이 느끼고 깊이 사랑하는 힘, 그게 당신의 진짜 매력이에요.",
    reality: "타고난 기질은 집중형 정서 에너지 구조입니다. 관심 대상에 에너지를 강하게 투입하는 패턴을 보이며, 관계는 넓기보다 깊게 형성됩니다. 초기에는 조용하고 관찰 위주지만 친밀도가 높아질수록 표현 강도가 올라가는 구조예요. 감정 인지 능력은 높은 편이나 외부 표현 빈도는 낮습니다. 이로 인해 내적 정서 누적이 발생할 수 있습니다. 완성도 지향 성향이 강해 시작 전 자기 검열이 작동하는 경향이 있으며, 실행 이후에는 높은 퀄리티 산출이 특징입니다. 깊이 중심형 에너지, 이것이 정화의 핵심입니다.",
    fun: "너는 얕게 안 해. 마음 가는 사람이나 일에는 그냥 전부 쏟아버려. 넓게 퍼지는 타입이 아니라 깊게 파고드는 스타일이라 친해지면 완전 달라진다는 말 듣지. 겉은 조용한데 속은 생각 많고 감정도 꽤 깊어. 근데 그걸 잘 안 꺼내. 혼자 삭히는 경우 많아. 완벽하게 하고 싶어서 자신 없으면 시작을 미루기도 하지. 대신 붙잡으면 끝까지 파고들어서 결과는 확실히 만들어. 너는 깊게 느끼고 깊게 사랑하는 타입이야. 그게 네 힘이야."
  },
  "戊": {
    empathy: "타고난 기질은 산처럼 묵직하고 든든한 존재감이에요. 감정이나 상황에 쉽게 흔들리지 않아서 주변 사람들에게 심리적 안정감을 주는 편이에요. 친구들이 힘들면 자연스럽게 당신을 찾고, 당신도 그 역할이 싫지 않죠. 다만 가끔은 나도 기대고 싶다는 마음이 들 때가 있어요. 고집이 꽤 강한 편이지만 그건 중심이 뚜렷하다는 뜻이에요. 한번 생각을 정하면 쉽게 바꾸지 않죠. 상황에 따라 유연함이 필요하다는 것도 알고 있어요. 큰 목표보다 지금 내 자리를 지키는 데 집중하는 타입이고, 화려하게 앞에 나서기보다 든든하게 뒤를 받쳐주는 역할이 잘 맞아요. 흔들리지 않는 힘, 그게 당신의 가장 큰 재능이에요.",
    reality: "타고난 기질은 안정 중심형 구조입니다. 외부 자극에 대한 반응 폭이 크지 않고, 감정 기복이 비교적 완만해 주변에 심리적 안정감을 제공합니다. 자연스럽게 상담자·버팀목 역할을 맡는 패턴을 보이며, 정서적 의존을 받는 경우가 많습니다. 내부적으로는 의지 강도가 높아 한 번 정한 판단을 쉽게 수정하지 않습니다. 이는 중심의 선명함이지만 유연성 관리가 과제가 될 수 있습니다. 목표 지향성은 확장보다는 유지와 안정에 가깝고, 전면 리더보다 기반을 다지는 포지션에서 강점이 드러납니다. 지속성과 신뢰성이 핵심 자산입니다.",
    fun: "너는 그냥 버팀목 타입이야. 감정에 쉽게 흔들리지 않아서 사람들이 힘들면 자연스럽게 너한테 와. 너도 그게 싫지는 않지. 근데 가끔은 나도 좀 기대고 싶다는 생각 들잖아. 고집 있어. 한번 정하면 잘 안 바꿔. 근데 그게 나쁜 게 아니라 중심이 분명한 거야. 다만 상황 따라 조금만 더 유연하면 훨씬 편해질 수 있어. 너는 화려하게 앞에 나서는 사람이라기보다 뒤에서 묵직하게 받쳐주는 사람이고, 그 자리에서 진짜 강해. 흔들리지 않는 거, 그게 네 가장 큰 재능이야."
  },
  "己": {
    empathy: "타고난 기질은 비옥한 흙처럼 포용력이 넓은 성품이에요. 세심하고 배려가 자연스럽게 나와서, 그냥 지나칠 수 있는 것도 먼저 챙기고 주변 사람 상태를 본인도 모르게 읽고 있어요. 그래서 인간관계에서 신뢰를 빠르게 쌓는 편이에요. 걱정이 좀 많은 편이라 머릿속에서 여러 상황을 미리 그려보느라 에너지를 쓰기도 해요. 그게 꼼꼼함으로 이어지면 큰 장점이 되지만, 지나치면 스스로 지칠 수 있어요. 주변 기대에 맞추려다 자기 욕구를 뒤로 미루는 경향도 있어요. 가끔은 나를 위한 선택을 해도 괜찮아요. 당신이 있는 곳은 사람들이 숨을 고르는 곳이에요.",
    reality: "타고난 기질은 포용 중심형 구조입니다. 대인 감지 능력과 배려 반응 속도가 빠르며, 사소한 요소까지 챙기는 경향이 강합니다. 이로 인해 관계 신뢰 형성 속도가 높습니다. 인지적 시뮬레이션 빈도가 높아 잠재 리스크를 먼저 고려하는 패턴을 보이며, 이는 꼼꼼함으로 작동할 수 있으나 과도할 경우 에너지 소모가 커집니다. 외부 기대 반응성이 높아 자기 욕구 우선순위가 밀릴 수 있습니다. 자기 기준을 명확히 설정할수록 안정성이 높아집니다. 관계 완충 능력이 기토의 핵심 자산입니다.",
    fun: "너는 사람을 그냥 잘 품어. 세심하고 배려가 기본값이라 주변 상태를 자동으로 읽고 있잖아. 그래서 사람들이 너를 빨리 믿어. 근데 걱정 많지. 머릿속으로 계속 시뮬레이션 돌리느라 혼자 에너지 다 써버릴 때 있어. 그게 꼼꼼함이 되면 좋은데, 과하면 스스로 지쳐. 그리고 남 기대 먼저 챙기느라 네 욕구를 미루는 경향도 있어. 가끔은 너부터 생각해도 돼. 너 있는 자리, 사람들이 편해하는 거 사실이야."
  },
  "庚": {
    empathy: "타고난 기질은 단단하고 선명한 쇠의 기운이에요. 맞고 틀림이 분명해서 흐리게 넘어가는 걸 잘 못 보고, 말도 비교적 직접적으로 하는 편이라 처음엔 강하게 느껴질 수 있어요. 하지만 그건 누군가를 다치게 하려는 게 아니라 솔직함에서 나오는 태도예요. 정의감이 강해 불합리한 상황을 그냥 넘기지 못하고, 그래서 가끔은 불편한 사람으로 보일 수도 있지만 결국 맞는 말을 한다는 건 다들 알아요. 겉은 단단해 보여도 속은 생각보다 따뜻해요. 표현이 서툴러 오해가 생길 뿐, 친해지면 정말 든든한 사람이에요. 기준이 있다는 건 흔들리지 않는 힘이에요.",
    reality: "타고난 기질은 명확 기준형 구조입니다. 판단 체계가 선명하고 흑백 구분이 비교적 뚜렷해 모호한 상황을 오래 두지 않는 편이에요. 의사 표현이 직접적이라 초기 인상은 강하게 형성될 수 있습니다. 정의 민감도가 높아 불합리 상황에 대한 반응성이 크며, 이는 갈등 유발 요소가 아니라 가치 일관성에서 비롯됩니다. 외형은 단단하지만 내부 정서 온도는 높은 편이고, 감정 표현 채널이 제한적이라 오해가 발생하기도 합니다. 친밀도 상승 이후 신뢰 강도가 매우 높은 구조입니다. 기준 중심 안정성이 핵심 자산입니다.",
    fun: "너는 기준이 확실한 사람이야. 맞다 아니다가 분명해서 애매하게 넘기는 걸 잘 못 봐. 말도 돌려서 안 하고 바로 말하니까 처음엔 좀 세 보일 수 있어. 근데 그게 누굴 깎아내리려는 건 아니잖아. 그냥 솔직한 거지. 불합리한 상황 보면 그냥 못 넘어가고, 그래서 가끔 불편한 사람 취급받기도 하지만 결국 네 말이 맞는 경우 많아. 겉은 강해 보여도 속은 생각보다 따뜻해. 표현이 서툴러서 그렇지, 친해지면 진짜 든든한 타입이야. 기준 있다는 건 쉽게 안 흔들린다는 뜻이야."
  },
  "辛": {
    empathy: "타고난 기질은 정교하게 다듬어진 보석 같은 감각이에요. 눈이 높고 섬세해서 다른 사람이 그냥 지나치는 부분도 자연스럽게 잡아내요. 그래서 자기 관리나 결과물의 완성도에 대한 기준이 남들보다 조금 높은 편이에요. 대충 하기보다 제대로 하고 싶은 사람이죠. 자존심도 있어요. 무너지는 모습을 쉽게 보여주지 않아서 힘들어도 괜찮은 척하는 경우가 있고, 도움 요청이 유독 어렵기도 해요. 혼자 해결하려다 지치는 패턴을 겪어봤을 거예요. 평가와 시선에 생각보다 민감하지만, 그건 내면의 높은 기준에서 오는 거예요. 당신의 기준이 높다는 건, 그만큼 잘해낼 힘이 있다는 뜻이에요.",
    reality: "타고난 기질은 고완성도 지향형 구조입니다. 감각 인지 해상도가 높아 미세한 차이를 포착하고, 결과물 기준선이 평균보다 높은 편이에요. 자기 관리와 성과 품질에 대한 요구치가 분명합니다. 자존감 보호 성향이 강해 취약함 노출을 최소화하며, 도움 요청 지연 패턴이 나타날 수 있어요. 문제 해결을 독립적으로 수행하려는 경향이 반복될 경우 피로 누적이 발생합니다. 외부 평가 민감도는 높지만 이는 자기 기준과 연결된 반응입니다. 높은 내부 기준이 지속 성과를 만드는 핵심 동력입니다.",
    fun: "너는 디테일에서 차이 나는 타입이야. 그냥 대충 못 넘어가잖아. 눈이 높고 감각이 예민해서 남들 못 보는 것도 다 잡아내. 그래서 기준이 자연스럽게 높아. 자존심도 있어. 힘들어도 쉽게 티 안 내고, 도움 요청하는 게 유난히 어렵지. 혼자 다 해결하려다 지친 적 분명 있을 거야. 평가나 시선에 은근 신경 쓰지만, 그건 네가 대충 살고 싶지 않아서야. 제대로 하고 싶은 거지. 네 기준이 높다는 건 그만큼 잘할 수 있다는 뜻이야."
  },
  "壬": {
    empathy: "타고난 기질은 거대한 강처럼 흐르는 통찰의 기운이에요. 생각의 스케일이 커서 디테일보다 전체 흐름을 먼저 읽는 편이고, 아이디어가 많고 상상력도 풍부해요. 당신과 대화하면 예상 못 한 방향으로 이야기가 전개되기도 하죠. 지루함을 오래 못 참는 것도 이 기질의 일부예요. 자유롭게 움직이고 싶은 욕구가 강해서 통제되거나 틀에 박힌 환경에서는 답답함을 느끼지만, 재량이 주어지면 기대 이상으로 해내는 사람이에요. 한 번 깊이 파고들면 무섭게 몰입하지만 흥미가 끊기면 열기가 식을 수 있어요. 그래서 당신에겐 나만의 리듬을 만드는 게 중요해요. 크게 보는 눈, 그게 당신의 특별한 재능이에요.",
    reality: "타고난 기질은 확장 사고형 구조입니다. 정보 처리 시 세부보다 전체 맥락을 우선 파악하는 경향이 있고, 아이디어 생성 빈도와 방향 전환 유연성이 높습니다. 대화 전개가 비선형적으로 확장되는 특징이 있으며 반복 자극에는 낮은 흥미 지속도를 보입니다. 자율성 욕구가 강해 통제 강도가 높은 환경에서 동기 저하가 발생할 수 있으나, 재량 범위가 확보되면 성과 변동 폭이 크게 상승합니다. 관심 대상에 대한 집중 강도는 매우 높으나 지속성 관리가 필요합니다. 거시 시야 확보 능력이 임수의 핵심 경쟁력입니다.",
    fun: "너는 그냥 큰 그림 보는 타입이야. 디테일보다 전체 흐름부터 읽잖아. 아이디어 많고 상상력도 풍부해서 대화하다가 갑자기 전혀 다른 방향으로 튀기도 하지. 지루한 거 오래 못 버티는 것도 사실이고. 통제 많고 틀에 박힌 환경에서는 답답해하고, 대신 재량 주어지면 기대 이상으로 해내. 몰입하면 진짜 무섭게 파고드는데, 흥미 식으면 확 식어버리기도 해. 그래서 너한테 필요한 건 네 리듬을 지켜줄 루틴이야. 크게 보는 눈, 그거 아무나 못 가진 재능이야."
  },
  "癸": {
    empathy: "타고난 기질은 안개비처럼 섬세하고 깊은 감수성이에요. 보이지 않는 결을 자연스럽게 읽어내서 상대의 미묘한 감정 변화나 분위기를 직관적으로 알아채는 편이에요. 그래서 사람들이 당신 앞에서는 마음을 열기 쉬워요. 겉으로는 조용하고 잔잔해 보여도 속에서는 생각과 감정이 꽤 많이 오가고 있어요. 표현을 잘하면 큰 강점이 되는데, 혼자 삭히는 쪽을 선택할 때가 많아 스스로를 놓칠 때도 있어요. 상상력과 창의력이 뛰어나 감성적인 영역에서 두각을 나타내기 쉬워요. 느끼는 게 많은 만큼 표현했을 때 반응도 좋아요. 깊이 느끼는 감도, 그게 당신의 특별함이에요.",
    reality: "타고난 기질은 고감도 정서 인지형 구조입니다. 미묘한 정서 변화와 환경 분위기를 빠르게 포착하며, 공감 반응성이 높은 편이에요. 외형은 차분하지만 내부 정서 활동량은 많습니다. 감정 표현 빈도가 낮을 경우 내적 누적이 발생할 수 있습니다. 상상력과 창의성 지수가 높아 감성·예술 영역에서 성과가 나타날 가능성이 큽니다. 입력 대비 표현 비율을 높일수록 강점이 명확해집니다. 정서 해상도와 감도 차이가 계수의 핵심 경쟁력입니다.",
    fun: "너는 그냥 감도 자체가 달라. 남들 못 보는 분위기 변화를 바로 읽잖아. 그래서 사람들이 너한테 쉽게 마음을 열어. 겉은 조용해 보여도 속에서는 생각이 계속 돌아가고 있지. 문제는 그걸 잘 안 꺼낸다는 거야. 혼자 삭히는 쪽을 선택하는 경우 많잖아. 상상력 좋고 감성 영역에서 재능 확실해. 느끼는 게 많으니까 표현만 잘하면 반응도 좋아. 깊이 느끼는 건 약한 게 아니라 네가 특별하다는 증거야."
  },
};

// 음양 비율별 기질 설명 (성별 분리 + 3가지 톤)
const YIN_YANG_BALANCE: Record<GenderKey, Record<string, Record<CharKey, string>>> = {
  male: {
    "0:8": {
      empathy: "타고난 기운은 남성 안에 음의 기운이 가득 담긴 독특한 구조예요. 겉으로는 조용하고 차분해 보이지만, 내면에는 깊은 생각과 감정이 풍부하게 흐르고 있어요. 감수성과 직관이 탁월해서 사람의 속마음을 자연스럽게 읽어내고, 말하지 않아도 분위기를 이해하는 편이에요. 강하게 나서지 않아도 존재감이 은근히 느껴지는 타입이에요. 겉은 잔잔하지만 속은 넓고 깊어요. 쉽게 드러내지 않을 뿐이에요. 조용한 물이 깊다는 말이 어울리는 구조예요. 당신의 내면은 생각보다 훨씬 넓어요.",
      reality: "타고난 구조는 음 8:0의 내향 극대화 비율입니다. 외향 표현보다 내부 정서·직관 기능이 강하게 작동합니다. 발화 빈도는 낮으나 관찰·해석 능력은 매우 높으며, 감정 인지 해상도가 우수합니다. 남성 구조에서 음 기운이 우세해 전통적 외향 이미지와는 다른 깊이 중심 패턴을 보입니다. 직접적 개입보다 상황 읽기와 정서 조율이 선행됩니다. 표면 강도는 낮게 보일 수 있으나 내면 확장도는 매우 큽니다. 심층 통찰 능력이 핵심 자산입니다.",
      fun: "너는 겉으로 조용해 보여도 속은 엄청 깊어. 굳이 앞에 나서지 않아도 존재감이 은근히 느껴지는 타입이야. 감수성 세고 직관 빠르지. 사람 마음 읽는 거 웬만한 사람보다 훨씬 정확해. 세게 밀어붙이는 스타일은 아니지만, 대신 한 번 마음 열면 깊이로 승부 보는 사람이야. 티 안 나서 그렇지 내면 스케일 꽤 커. 조용한 물이 깊다는 말, 딱 너야. 네 안은 생각보다 훨씬 넓어."
    },
    "2:6": {
      empathy: "힐링형 타고난 기질은 겉은 차분하지만 안은 깊게 차 있는 구조예요. 나서기보다 먼저 보고 듣고 생각하는 타입이라 말은 많지 않지만, 한마디를 할 때는 무게가 있어요. 감수성이 풍부해서 사람의 마음을 깊이 이해하고, 쉽게 판단하지 않아요. 그래서 친해지면 생각보다 훨씬 든든한 사람이에요. 겉으로는 조용해 보여도 속은 단단하고 복잡해요. 쉽게 드러내지 않을 뿐이에요. 조용하지만 깊다는 건 아무나 가질 수 없는 결이에요. 아는 사람만 아는 매력, 그게 당신이에요.",
      reality: "타고난 구조는 음 6:양 2의 내향 우세 비율입니다. 외부 자극에 즉각 반응하기보다 내부에서 해석·분석 후 반응하는 패턴을 보입니다. 발화 빈도는 낮지만 발화 밀도는 높은 편이에요. 감정 인지 능력과 공감 반응성이 우수하며, 관계가 깊어질수록 신뢰 강도가 상승합니다. 초기 인상은 조용하고 안정적으로 형성되며, 관찰 중심적 사고 구조가 특징입니다. 외향 에너지 소비가 낮아 지속성은 높으나 표현 채널 관리가 과제가 될 수 있습니다. 깊이 중심형 안정 구조입니다.",
      fun: "너는 겉으로는 조용한데 속은 꽉 차 있어. 먼저 나서기보다 보고 듣고 판단하는 스타일이지. 말 많지 않은데 한 번 말하면 무게 있어. 괜히 떠드는 타입은 아니잖아. 감수성 깊어서 사람 마음 잘 읽고, 친해지면 진짜 의지되는 사람 돼. 겉으로 티 안 나서 그렇지 생각 엄청 많아. 너는 화려하게 튀는 타입은 아니야. 대신 알 사람은 다 알아. 조용한데 깊은 거, 그게 네 매력이야."
    },
    "4:4": {
      empathy: "타고난 기운은 음과 양이 균형을 이루는 안정적인 구조예요. 겉으로는 차분하고 편안해 보이지만, 안에는 추진력도 감수성도 함께 살아 있어요. 그래서 상황에 따라 앞에 서기도 하고, 필요하면 조용히 받쳐주기도 해요. 한쪽으로 치우치지 않아서 사람들과 잘 어울리고, 어디에 두어도 자연스럽게 제 역할을 찾아요. 단순하지 않고 여러 면을 가진 타입이라 볼수록 매력이 깊어지는 사람이에요. 어느 자리에서도 자기 역할을 찾는 능력, 그게 당신의 진짜 힘이에요.",
      reality: "타고난 구조는 양 4:음 4의 균형 비율입니다. 외향 추진 에너지와 내향 감수 기능이 동시에 작동하며, 상황 적응 폭이 넓은 편이에요. 초기 인상은 안정적이고 차분하게 형성되지만 필요 시 행동 강도도 충분히 상승합니다. 리더와 서포터 포지션을 유연하게 오갈 수 있는 구조이며, 환경 요구에 따라 기능을 전환하는 능력이 뛰어납니다. 극단으로 치우치지 않아 장기 안정성이 높고, 입체적 인상 형성이 가능합니다. 역할 적응력이 핵심 자산입니다.",
      fun: "너는 그냥 균형형이야. 겉으로 보면 차분하고 안정적인데, 안에는 추진력도 있고 감수성도 있어. 상황 따라 앞에 나설 수도 있고, 뒤에서 받쳐줄 수도 있지. 한쪽으로 치우치지 않아서 어디에 있어도 자기 자리 찾는 타입이야. 그래서 사람들도 너를 편하게 생각해. 단순한 사람이 아니라 여러 면이 겹쳐 있는 구조야. 화려하게 튀진 않아도 오래 보면 진짜 매력 있는 타입이지. 어느 자리에서도 자기 역할 찾는 거, 그게 네 진짜 능력이야."
    },
    "6:2": {
      empathy: "타고난 기운은 행동이 먼저 나오는 에너지예요. 생각보다 몸이 먼저 움직이고, 기회가 보이면 일단 붙잡는 타입이에요. 그렇다고 무작정 밀어붙이기만 하는 건 아니에요. 가끔은 스스로를 돌아보는 여유도 있어서 추진력과 감각이 비교적 균형 있게 살아 있어요. 그래서 시작할 때 망설임이 적고, 해보면서 조율하는 능력이 좋아요. 실행력이 분명한데 눈치도 있는 편이라 주변 흐름을 완전히 놓치지는 않아요. 과감하지만 둔하지 않은 구조예요. 생각보다 행동이 먼저 나오기 때문에, 당신은 기회를 그냥 흘려보내지 않는 사람이에요.",
      reality: "타고난 구조는 외향 에너지가 우세한 6:2 비율입니다. 행동 개시 속도가 빠르고, 의사결정 지연 시간이 짧은 편이에요. 다만 내면 반추 기능이 완전히 배제된 것은 아니라 상황 조율 능력도 함께 작동합니다. 추진력과 환경 감지 기능이 동시에 존재해 실행 후 보정 패턴을 보입니다. 초기 진입 장벽이 낮아 시작 빈도가 높고, 그만큼 기회 포착률도 상승합니다. 과속 위험은 있으나 감각 조절이 가능해 안정성이 유지됩니다. 실행 우선형 균형 구조가 핵심 특징입니다.",
      fun: "너는 그냥 일단 해보는 타입이야. 생각만 하다가 기회 놓치는 쪽은 아니지. 에너지가 충분해서 몸이 먼저 나가고, 해보면서 맞춰가는 스타일이야. 그렇다고 완전 직진만 하는 건 아니고, 은근히 눈치도 있어서 상황 보면서 조율하잖아. 그래서 추진력도 있고 감각도 있어. 시작할 때 망설임 적은 게 네 강점이야. 고민만 하는 사람들 사이에서 너는 이미 움직이고 있지. 생각보다 행동이 먼저 나오니까, 기회 잡는 속도도 빠른 거야."
    },
    "8:0": {
      empathy: "타고난 에너지가 전부 바깥을 향해 있는 사람이에요. 행동력과 추진력이 자연스럽게 흐르고, 가만히 있는 것보다 움직일 때 더 살아나는 타입이죠. 남성적인 기운이 또렷하게 드러나서 자기 확신이 분명하고, 마음먹은 일은 쉽게 놓지 않아요. 그래서 주변에서는 자연스럽게 중심으로 보고 기대를 걸어요. 당신도 그 자리가 낯설지 않죠. 다만 늘 앞에서 끌고 가는 역할을 하다 보면 쉴 틈을 놓치기 쉬워요. 힘이 넘치는 만큼 멈춤도 전략이에요. 타고난 기운이 강하다는 건, 어디서든 판을 만들 수 있다는 뜻이에요.",
      reality: "타고난 에너지가 외향으로 집중된 구조입니다. 행동 개시 속도가 빠르고, 추진력과 표현 강도가 평균보다 높습니다. 정적 환경보다 역동 환경에서 효율이 상승하며, 자율성과 결정권이 주어질수록 성과 변동 폭이 크게 나타납니다. 남성적 기운이 강화되어 자기 확신과 방향 설정 능력이 뚜렷합니다. 주변에서는 자연스럽게 리더 포지션으로 인식하는 경향이 있습니다. 과속 시 에너지 소모가 빠를 수 있으므로 리듬 관리가 핵심 변수입니다. 외향 추진 에너지가 이 구조의 핵심 자산입니다.",
      fun: "너는 그냥 에너지가 밖으로 터져 나오는 타입이야. 가만히 있으면 답답하고 뭔가 해야 숨 쉬는 느낌이지. 추진력 세고 표현도 직설적이라 주변에서 자연스럽게 리더로 보잖아. 마음먹으면 밀어붙이는 힘도 확실하고 자기 확신도 강해. 그래서 네 주변엔 항상 뭔가 일이 생겨. 근데 계속 달리기만 하면 소모 빠르다. 너는 멈춤까지 배워야 진짜 더 세진다. 타고난 기운 자체가 판을 만드는 에너지야."
    }
  },

  female: {
    "0:8": {
      empathy: "타고난 기운은 여성성이 깊게 살아 있는 구조예요. 직관이 뛰어나고 감수성이 풍부해서 말하지 않아도 분위기를 읽고 사람의 마음을 먼저 알아채는 편이에요. 강하게 나서지 않아도 자연스럽게 사람을 끌어당기는 부드러운 존재감이 있어요. 억지로 드러내지 않아도 기억에 남는 타입이고, 깊은 공감 능력으로 관계를 오래 이어가요. 겉은 잔잔해 보여도 내면은 넓고 깊어요. 느끼는 힘이 곧 당신의 재능이에요. 세상을 읽는 감도 자체가 남다른 사람이에요.",
      reality: "타고난 구조는 음 8:0의 내향 극대화 비율입니다. 정서 인지 해상도가 매우 높고 직관 기반 판단이 우선 작동합니다. 외향 추진보다 공감·관찰 기능이 중심이며, 직접적 개입 없이도 영향력을 형성하는 패턴을 보입니다. 초기 인상은 온화하게 형성되나 친밀도 상승 시 신뢰 강도가 크게 증가합니다. 감수성 밀도가 높아 정서 교류 효율이 우수합니다. 강성 표현이 적어도 존재감 유지가 가능한 구조입니다. 고감도 공감 능력이 핵심 자산입니다.",
      fun: "너는 굳이 앞에 안 나서도 사람들이 끌려. 직관 빠르고 감수성 깊어서 말 안 해도 분위기 읽잖아. 사람 마음 캐치하는 능력 진짜 좋아. 세게 밀어붙이지 않아도 자연스럽게 존재감 생기는 타입이야. 겉은 조용한데 안은 깊고 넓어. 그래서 한 번 기억에 남으면 오래 남지. 너는 느끼는 힘으로 세상을 읽는 사람이야. 그게 네 특별함이야."
    },
    "2:6": {
      empathy: "타고난 기운은 여성적인 감수성과 직관이 풍부한 구조예요. 분위기를 섬세하게 읽고 사람의 마음을 자연스럽게 헤아리는 편이라, 당신 앞에서는 사람들이 쉽게 마음을 열어요. 강하게 밀어붙이기보다 조용히 스며드는 방식으로 관계를 만들어 가는 타입이에요. 그래서 겉으로는 부드러워 보여도 존재감은 오래 남아요. 말이 많지 않아도 전달되는 게 있고, 설명하지 않아도 이해되는 결이 있어요. 섬세하게 느끼고 깊이 공감하는 힘, 그게 당신만의 특별한 에너지예요.",
      reality: "타고난 구조는 음 6:양 2의 내향 우세 비율입니다. 감정 인지 해상도가 높고 직관 기반 판단 빈도가 큽니다. 외향 추진보다 정서 공감 기능이 우선 작동하며, 관계 형성 시 직접적 개입보다 완만한 침투 방식을 선택합니다. 초기 인상은 온화하고 차분하게 형성되며, 친밀도 상승 시 신뢰 강도가 높아집니다. 강성 표현보다는 조율과 공감 중심 패턴이 특징입니다. 정서 민감도와 관계 완충 능력이 핵심 자산입니다.",
      fun: "너는 강하게 밀어붙이는 타입은 아니야. 대신 분위기 읽는 감각이 남달라. 사람 마음을 금방 알아채고, 그래서 네 앞에서는 다들 편하게 말해. 조용히 스며들듯 관계를 만들어 가잖아. 튀지는 않지만 오래 남는 타입이야. 감수성 깊고 직관 빠른 거, 그거 아무나 못 가져. 너는 세게 밀지 않아도 충분히 영향력 있어. 섬세하게 느끼는 게 네 힘이야."
    },
    "4:4": {
      empathy: "타고난 기운은 부드러움과 주관이 자연스럽게 공존하는 균형 구조예요. 너무 강하지도, 그렇다고 순하기만 한 것도 아니라서 주변 사람들이 편안하게 다가오는 타입이에요. 분위기를 읽는 감각이 있고, 원하는 걸 억지로 밀어붙이기보다 부드럽게 관철하는 방식을 본능적으로 알고 있어요. 그래서 갈등을 크게 만들지 않으면서도 자기 자리를 지켜요. 한쪽으로 치우치지 않아 오래 갈 수 있는 힘이 있어요. 균형 잡힌 에너지는 쉽게 타고나는 게 아니에요. 당신은 그걸 이미 가지고 있어요.",
      reality: "타고난 구조는 양 4:음 4의 균형 비율입니다. 외향 추진성과 내향 감수성이 동시에 유지되어, 강성과 유연성이 함께 작동합니다. 초기 인상은 온화하게 형성되며, 필요 시 자기 주장 강도도 충분히 상승합니다. 상황 인지 능력이 높아 갈등을 최소화하면서 목표를 달성하는 패턴을 보입니다. 과도한 직진이나 과도한 수동으로 치우치지 않아 장기 안정성이 높습니다. 에너지 균형 유지 능력이 핵심 경쟁력입니다.",
      fun: "너는 세지도 약하지도 않은, 딱 균형 잡힌 타입이야. 그래서 사람들이 편하게 다가와. 근데 그렇다고 네가 휘둘리는 건 아니지. 분위기 읽는 능력도 있고, 원하는 건 은근히 다 챙겨. 억지로 밀어붙이지 않아도 결국 네 쪽으로 흐름을 만들잖아. 그래서 오래 가는 사람이야. 한쪽으로 확 치우치지 않아서 안정감이 있어. 균형은 아무나 못 가져. 너는 그걸 기본값으로 가지고 있는 거야."
    },
    "6:2": {
      empathy: "타고난 기운은 에너지가 분명히 살아 있으면서도 섬세한 감각이 함께 있는 구조예요. 추진력 있게 나아가다가도 주변 분위기를 읽고 자연스럽게 조율할 줄 아는 타입이에요. 그래서 단순히 강한 사람이 아니라, 믿고 따를 수 있는 사람으로 보이는 경우가 많아요. 상황에 따라 강하게 밀어붙일 수도 있고, 필요하면 부드럽게 감싸줄 수도 있어요. 그 두 가지가 함께 있어서 매력이 한 방향으로만 고정되지 않아요. 강함과 섬세함이 동시에 살아 있는 조합, 그게 당신의 특별함이에요.",
      reality: "타고난 구조는 외향 에너지가 우세한 6:2 비율이지만 감각 기능이 함께 작동합니다. 행동 개시 속도가 빠르고 추진력이 뚜렷하며, 동시에 환경 감지와 정서 조율 능력도 유지됩니다. 이로 인해 단순 직진형이 아니라 보정 가능한 실행형 패턴을 보입니다. 초기 인상은 강하게 형성되나, 관계 유지 과정에서는 섬세함이 드러나 신뢰도가 상승합니다. 강성과 유연성이 공존하는 구조로, 리더십과 친화력이 동시에 작동하는 것이 특징입니다.",
      fun: "너는 그냥 에너지 자체가 살아 있어. 하고 싶은 게 생기면 바로 움직이고, 밀어붙일 힘도 충분해. 근데 거기서 끝이 아니야. 분위기 읽는 감각도 있어서 너무 세게만 가지는 않지. 그래서 사람들이 너를 무조건 강한 사람으로만 보지 않고, 믿고 따르는 쪽으로 보게 돼. 강한데도 부드럽고, 부드러운데도 중심이 있어. 그게 흔한 조합은 아니야. 강함이랑 섬세함 둘 다 가진 거, 그게 네 매력 포인트야."
    },
    "8:0": {
      empathy: "타고난 에너지가 또렷하게 밖으로 뻗어 있는 사람이에요. 여성스러움보다 자기 주관과 추진력이 먼저 드러나는 타입이고, 표현이 비교적 직접적이라 첫인상이 강하게 남아요. 그런데 그 강함은 거칠어서가 아니라 중심이 분명해서 나오는 거예요. 어떤 환경에 있어도 자기 색을 쉽게 잃지 않고, 상황에 휘둘리기보다 방향을 잡는 쪽에 가까워요. 그래서 주변에서는 자연스럽게 의지가 되는 사람으로 보게 돼요. 강한 여성의 에너지를 타고난 구조예요. 기운이 넘친다는 건, 당신이 스스로 삶을 이끄는 사람이라는 뜻이에요.",
      reality: "타고난 기운이 외향으로 집중된 구조입니다. 주관과 추진력이 전면에 나타나며, 의사 표현 강도가 비교적 높은 편이에요. 초기 인상이 강하게 형성되고, 자기 결정권을 스스로 확보하려는 경향이 뚜렷합니다. 외부 평가보다 내부 기준을 우선하며, 환경 변화 속에서도 자기 정체성을 유지하는 안정성이 높습니다. 전통적 여성성 이미지와는 결이 다를 수 있으나, 이는 에너지 강도와 자율성 지수가 높기 때문입니다. 중심 고정력이 이 구조의 핵심 경쟁력입니다.",
      fun: "너는 그냥 중심이 세. 여성스러움보다 네 주관이 먼저 보이고, 하고 싶은 말은 비교적 바로 하는 타입이잖아. 그래서 첫인상이 강하게 남아. 근데 그게 과해서가 아니라 네 중심이 흔들리지 않아서 그래. 어떤 환경에서도 네 색을 쉽게 안 잃어. 그래서 사람들은 은근히 너를 기준으로 보게 돼. 강한 여성 에너지 가진 사람 흔치 않아. 너는 그 드문 쪽이야. 기운이 세다는 건, 네가 네 인생을 직접 끌고 간다는 뜻이야."
    }
  }
};

// 천간 음양 분류
const CHEONGAN_POLARITY: Record<string, "양" | "음"> = {
  "甲": "양", "乙": "음",
  "丙": "양", "丁": "음",
  "戊": "양", "己": "음",
  "庚": "양", "辛": "음",
  "壬": "양", "癸": "음",
};

// 지지 음양 분류
const JIJI_POLARITY: Record<string, "양" | "음"> = {
  "子": "양", "丑": "음",
  "寅": "양", "卯": "음",
  "辰": "양", "巳": "음",
  "午": "양", "未": "음",
  "申": "양", "酉": "음",
  "戌": "양", "亥": "음",
};

// 음양 비율 키 매핑 함수
function getYinYangKey(yangCount: number, yinCount: number, gender: "M" | "F"): string {
  const genderKey: GenderKey = gender === "M" ? "male" : "female";
  const key = `${yangCount}:${yinCount}`;
  
  if (YIN_YANG_BALANCE[genderKey][key]) return key;
  
  // 가장 가까운 패턴 찾기
  if (yangCount === 0) return "0:8";
  if (yangCount <= 2) return "2:6";
  if (yangCount >= 6 && yinCount === 0) return "8:0";
  if (yangCount >= 6) return "6:2";
  return "4:4";
}

// 음양 분석 함수
export function analyzeNature(
  dayStem: string,
  pillars: Array<{ cheongan: { hanja: string }; jiji: { hanja: string } }>,
  tone: CharKey,
  gender: "M" | "F"
): { text: string; yangCount: number; yinCount: number } {  // ✅ 반환 타입 변경
  let yangCount = 0;
  let yinCount = 0;

  // 8글자 음양 카운트
  pillars.forEach((pillar) => {
    const cheonganPol = CHEONGAN_POLARITY[pillar.cheongan.hanja];
    const jijiPol = JIJI_POLARITY[pillar.jiji.hanja];

    if (cheonganPol === "양") yangCount++;
    else yinCount++;

    if (jijiPol === "양") yangCount++;
    else yinCount++;
  });

  const genderKey: GenderKey = gender === "M" ? "male" : "female";
  const dayStemText = DAY_STEM_NATURE[dayStem]?.[tone] || "타고난 기질을 분석 중입니다.";
  const yinYangKey = getYinYangKey(yangCount, yinCount, gender);
  const yinYangText = YIN_YANG_BALANCE[genderKey][yinYangKey]?.[tone] || "";

  // ✅ 반환 형식 변경
  return {
    text: `${dayStemText}\n\n${yinYangText}`,
    yangCount,
    yinCount,
  };
}

export const NATURE_ANALYSIS = {
  analyze: analyzeNature,
};
